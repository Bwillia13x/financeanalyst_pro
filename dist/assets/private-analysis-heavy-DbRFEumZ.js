import{r as e,j as s,C as t,D as a,e as r,S as l,T as i,I as n,Z as c,K as d,N as o,O as x,F as m,t as u,Q as p,P as h,g}from"./react-core-LZql00V9.js";import{D as b,W as j}from"./private-analysis-CULRlbZQ.js";import{m as y,A as f}from"./animations-PwArlWzR.js";import{m as v,l as N}from"./financial-engines-B7TnAHCU.js";import{ResponsiveContainer as w,AreaChart as C,CartesianGrid as R,XAxis as S,YAxis as k,Tooltip as M,Area as F,ScatterChart as D,Scatter as P,Cell as V,BarChart as A,Bar as O}from"./charts-vendor-EG81evMP.js";const I=({data:c,modelInputs:d,onModelInputChange:o,formatCurrency:x,formatPercent:m})=>{const[u,p]=e.useState(!1),[h,g]=e.useState(!0),[f,v]=e.useState("results"),N=e.useMemo(()=>{const{discountRate:e,terminalGrowthRate:s,projectionYears:t,taxRate:a}=d.dcf,r=c.statements,l=d.dcf.workingCapital||{receivablesDays:45,inventoryDays:60,payablesDays:30},i=d.dcf.capex||{capexAsPercentOfRevenue:3.5,depreciationRate:7},n={years:[],freeCashFlows:[],presentValues:[],workingCapitalChanges:[],capexAmounts:[],unleveredFreeCashFlow:[],cumulativePV:0,terminalValue:0,presentValueTerminal:0,enterpriseValue:0,equityValue:0,impliedShare:0},o=r.incomeStatement.totalRevenue?.[0]||1e5;for(let c=1;c<=t;c++){const s={year:c,revenue:r.incomeStatement.totalRevenue?.[c]||0,operatingIncome:r.incomeStatement.operatingIncome?.[c]||0,nopat:0,workingCapitalChange:0,capex:0,depreciation:0,freeCashFlow:0,presentValue:0};s.nopat=s.operatingIncome*(1-a/100);const t=s.revenue,d=c>1?r.incomeStatement.totalRevenue?.[c-1]||0:o,x=t*l.receivablesDays/365,m=t*l.inventoryDays/365,u=t*l.payablesDays/365,p=x-d*l.receivablesDays/365,h=m-d*l.inventoryDays/365,g=u-d*l.payablesDays/365;s.workingCapitalChange=-(p+h-g),s.capex=-t*i.capexAsPercentOfRevenue/100,s.depreciation=Math.abs(s.capex)/i.depreciationRate,s.freeCashFlow=s.nopat+s.depreciation+s.capex+s.workingCapitalChange;const b=Math.pow(1+e/100,c);s.presentValue=s.freeCashFlow/b,n.years.push(s),n.freeCashFlows.push(s.freeCashFlow),n.presentValues.push(s.presentValue),n.workingCapitalChanges.push(s.workingCapitalChange),n.capexAmounts.push(s.capex),n.unleveredFreeCashFlow.push(s.freeCashFlow),n.cumulativePV+=s.presentValue}const x=(n.years[n.years.length-1]?.freeCashFlow||0)*(1+s/100);n.terminalValue=x/((e-s)/100);const m=Math.pow(1+e/100,t);n.presentValueTerminal=n.terminalValue/m,n.enterpriseValue=n.cumulativePV+n.presentValueTerminal,n.equityValue=n.enterpriseValue-0;const u=d.dcf.sharesOutstanding||1e3;return n.impliedShare=n.equityValue/u,n},[c,d]),w=(e,s,t)=>{const a={...d.dcf,[e]:{...d.dcf[e],[s]:parseFloat(t)||0}};o("dcf",e,a[e])},C=(e,s)=>{o("dcf",e,parseFloat(s)||0)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(t,{size:20}),"Advanced DCF Valuation"]}),s.jsx("p",{className:"text-gray-600",children:"Professional-grade DCF with working capital analysis, capex modeling, and detailed cash flow projections."})]}),s.jsx("div",{className:"flex gap-2",children:["results","charts","wacc","assumptions"].map(e=>s.jsxs("button",{onClick:()=>v(e),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 "+(f===e?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:["results"===e&&s.jsx(a,{size:14}),"charts"===e&&s.jsx(r,{size:14}),"wacc"===e&&s.jsx(t,{size:14}),"assumptions"===e&&s.jsx(l,{size:14}),e.charAt(0).toUpperCase()+e.slice(1)]},e))})]}),"results"===f&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(y.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(a,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"ENTERPRISE VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:x(N.enterpriseValue)}),s.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["PV Operations: ",x(N.cumulativePV)]})]}),s.jsxs(y.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(i,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EQUITY VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-800",children:x(N.equityValue)}),s.jsxs("div",{className:"text-sm text-blue-600 mt-1",children:["Per Share: ",x(N.impliedShare)]})]}),s.jsxs(y.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(r,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"TERMINAL VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-800",children:x(N.terminalValue)}),s.jsxs("div",{className:"text-sm text-purple-600 mt-1",children:["PV: ",x(N.presentValueTerminal)]})]}),s.jsxs(y.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(n,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"IMPLIED MULTIPLE"})]}),s.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[(N.enterpriseValue/(c.statements.incomeStatement.totalRevenue?.[1]||1)).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"EV/Revenue (Year 1)"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Detailed Cash Flow Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b bg-gray-50",children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Year"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Operating Income"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"NOPAT"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Depreciation"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Capex"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"ΔWorking Capital"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Free Cash Flow"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Present Value"})]})}),s.jsxs("tbody",{children:[N.years.map((e,t)=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3 font-medium",children:e.year}),s.jsx("td",{className:"p-3 text-right",children:x(e.revenue)}),s.jsx("td",{className:"p-3 text-right",children:x(e.operatingIncome)}),s.jsx("td",{className:"p-3 text-right",children:x(e.nopat)}),s.jsxs("td",{className:"p-3 text-right text-green-600",children:["+",x(e.depreciation)]}),s.jsx("td",{className:"p-3 text-right text-red-600",children:x(e.capex)}),s.jsxs("td",{className:"p-3 text-right "+(e.workingCapitalChange>=0?"text-green-600":"text-red-600"),children:[e.workingCapitalChange>=0?"+":"",x(e.workingCapitalChange)]}),s.jsx("td",{className:"p-3 text-right font-medium",children:x(e.freeCashFlow)}),s.jsx("td",{className:"p-3 text-right font-medium",children:x(e.presentValue)})]},t)),s.jsxs("tr",{className:"border-b-2 border-gray-300 bg-blue-50",children:[s.jsx("td",{className:"p-3 font-bold",children:"Terminal"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right font-bold",children:x(N.terminalValue)}),s.jsx("td",{className:"p-3 text-right font-bold",children:x(N.presentValueTerminal)})]}),s.jsxs("tr",{className:"bg-gray-100 font-bold",children:[s.jsx("td",{className:"p-3",children:"TOTAL"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right text-lg",children:x(N.enterpriseValue)})]})]})]})})]})]}),"charts"===f&&s.jsx(b,{dcfData:N,sensitivityData:null,scenarioData:null,formatCurrency:x,formatPercent:m}),"wacc"===f&&s.jsx(j,{modelInputs:d,onModelInputChange:o,formatPercent:m}),"assumptions"===f&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Model Assumptions"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Core Assumptions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Rate (WACC) %"}),s.jsx("input",{type:"number",step:"0.1",value:d.dcf.discountRate,onChange:e=>C("discountRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terminal Growth Rate %"}),s.jsx("input",{type:"number",step:"0.1",value:d.dcf.terminalGrowthRate,onChange:e=>C("terminalGrowthRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate %"}),s.jsx("input",{type:"number",step:"0.1",value:d.dcf.taxRate,onChange:e=>C("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Working Capital"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Receivables (Days)"}),s.jsx("input",{type:"number",value:d.dcf.workingCapital?.receivablesDays||45,onChange:e=>w("workingCapital","receivablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Inventory (Days)"}),s.jsx("input",{type:"number",value:d.dcf.workingCapital?.inventoryDays||60,onChange:e=>w("workingCapital","inventoryDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payables (Days)"}),s.jsx("input",{type:"number",value:d.dcf.workingCapital?.payablesDays||30,onChange:e=>w("workingCapital","payablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Capital Expenditure"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capex (% of Revenue)"}),s.jsx("input",{type:"number",step:"0.1",value:d.dcf.capex?.capexAsPercentOfRevenue||3.5,onChange:e=>w("capex","capexAsPercentOfRevenue",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Depreciation Period (Years)"}),s.jsx("input",{type:"number",value:d.dcf.capex?.depreciationRate||7,onChange:e=>w("capex","depreciationRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shares Outstanding (000s)"}),s.jsx("input",{type:"number",value:d.dcf.sharesOutstanding||1e3,onChange:e=>C("sharesOutstanding",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]})]})]})},E=({data:t,onDataChange:a})=>{const[n,p]=e.useState("setup"),[h,g]=e.useState(null),[b,j]=e.useState(!1),[N,A]=e.useState(0),[O,I]=e.useState({iterations:1e4,confidenceLevel:.95,randomSeed:null,enableCorrelation:!1}),[E,T]=e.useState({revenueGrowthRate:{type:"normal",parameters:{mean:.1,stdDev:.03},name:"Revenue Growth Rate",enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.12,mode:.15,max:.18},name:"FCF Margin",enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},name:"WACC",enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},name:"Terminal Growth Rate",enabled:!0}}),[B,L]=e.useState([[1,.3,-.2,.1],[.3,1,-.4,.2],[-.2,-.4,1,-.3],[.1,.2,-.3,1]]),G=[{value:"normal",label:"Normal",parameters:["mean","stdDev"]},{value:"triangular",label:"Triangular",parameters:["min","mode","max"]},{value:"uniform",label:"Uniform",parameters:["min","max"]},{value:"lognormal",label:"Log-Normal",parameters:["mu","sigma"]},{value:"beta",label:"Beta",parameters:["alpha","beta"]}],$=e.useCallback(async()=>{try{j(!0),A(0);const e=Object.fromEntries(Object.entries(E).filter(([e,s])=>s.enabled));if(0===Object.keys(e).length)throw new Error("No distributions are enabled. Please enable at least one variable distribution to run the simulation.");const s={iterations:O.iterations,confidenceLevel:O.confidenceLevel,randomSeed:O.randomSeed,correlationMatrix:O.enableCorrelation?B:null,onProgress:A},a=t?.statements?.incomeStatement,r=t?.periods?.length-1||2,l={currentRevenue:1e3*(a?.totalRevenue?.[r]||1e6),currentPrice:100,sharesOutstanding:1e6,currentOperatingIncome:1e3*(a?.operatingIncome?.[r]||15e4),...Object.fromEntries(Object.entries(e).map(([e,s])=>[e,s.parameters.mean||s.parameters.mode||(s.parameters.min+s.parameters.max)/2]))},i=await v.runDCFSimulation(l,e,s);g(i)}catch(e){alert(`Monte Carlo simulation failed: ${e.message}`)}finally{j(!1),A(0)}},[E,O,B,t]),z=e.useCallback(()=>{v.stopSimulation(),j(!1)},[]),q=e.useCallback((e,s)=>{T(t=>({...t,[e]:{...t[e],...s}}))},[]),U=e.useCallback((e,s,t)=>{L(a=>{const r=a.map(e=>[...e]);return r[e][s]=t,r[s][e]=t,r})},[]),H=e.useMemo(()=>{if(!h?.results)return[];const e=h.results.map(e=>e.pricePerShare),s=Math.min(...e),t=(Math.max(...e)-s)/50,a=Array(50).fill(0).map((e,a)=>({bin:s+a*t,count:0,frequency:0}));return e.forEach(e=>{const r=Math.min(Math.floor((e-s)/t),49);a[r].count++}),a.forEach(s=>{s.frequency=s.count/e.length}),a},[h]),K=e.useMemo(()=>h?.results?h.results.slice(0,1e3).map((e,s)=>({x:100*e.inputs.revenueGrowthRate,y:e.pricePerShare,upside:e.upside})):[],[h]),W=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),Y=[{id:"setup",label:"Setup",icon:l},{id:"run",label:"Run Simulation",icon:d},{id:"results",label:"Results",icon:r},{id:"analysis",label:"Analysis",icon:i}];return s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsx("div",{className:"mb-6",children:s.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsxs("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center",children:[s.jsx(c,{className:"inline-block mr-2"}),"Monte Carlo Simulation"]}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Advanced risk analysis using probabilistic modeling • Generate thousands of scenarios • Measure uncertainty"})]})}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"flex space-x-2",children:Y.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>p(e.id),className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 "+(n===e.id?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[s.jsx(t,{size:16}),e.label]},e.id)})})}),s.jsx("div",{className:"mt-6",children:s.jsxs(f,{mode:"wait",children:["setup"===n&&s.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🎛️ Simulation Settings"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Iterations"}),s.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:O.iterations,onChange:e=>I(s=>({...s,iterations:parseInt(e.target.value)})),min:"1000",max:"100000",step:"1000"}),s.jsx("small",{className:"text-gray-400",children:"Leave empty for random"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Confidence Level"}),s.jsxs("select",{className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:O.confidenceLevel,onChange:e=>I(s=>({...s,confidenceLevel:parseFloat(e.target.value)})),children:[s.jsx("option",{value:.9,children:"90%"}),s.jsx("option",{value:.95,children:"95%"}),s.jsx("option",{value:.99,children:"99%"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Random Seed (Optional)"}),s.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:O.randomSeed||"",onChange:e=>I(s=>({...s,randomSeed:e.target.value?parseInt(e.target.value):null})),placeholder:"Leave empty for random"})]}),s.jsx("div",{className:"space-y-2",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 rounded focus:ring-blue-500",checked:O.enableCorrelation,onChange:e=>I(s=>({...s,enableCorrelation:e.target.checked}))}),s.jsx("span",{children:"Enable Variable Correlation"})]})})]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Variable Distributions"}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Object.entries(E).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded-lg p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",checked:t.enabled,onChange:s=>q(e,{enabled:s.target.checked})}),s.jsx("span",{className:"font-medium",children:t.name})]})}),t.enabled&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Distribution Type"}),s.jsx("select",{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.type,onChange:s=>{const t=s.target.value;G.find(e=>e.value===t);const a={};"normal"===t?(a.mean=.1,a.stdDev=.02):"triangular"===t?(a.min=.05,a.mode=.1,a.max=.15):"uniform"===t&&(a.min=.05,a.max=.15),q(e,{type:t,parameters:a})},children:G.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:G.find(e=>e.value===t.type)?.parameters.map(a=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-300",children:a.charAt(0).toUpperCase()+a.slice(1)}),s.jsx("input",{className:"w-full px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",type:"number",value:t.parameters[a]||"",onChange:s=>q(e,{parameters:{...t.parameters,[a]:parseFloat(s.target.value)}}),step:"0.001"})]},a))})]})]},e))})]}),O.enableCorrelation&&s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🔗 Correlation Matrix"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{}),Object.keys(E).map(e=>s.jsx("th",{children:E[e].name},e))]})}),s.jsx("tbody",{children:Object.keys(E).map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{className:"font-medium text-gray-200 p-2 border border-gray-600",children:E[e].name}),Object.keys(E).map((e,a)=>s.jsx("td",{className:"p-2 border border-gray-600",children:s.jsx("input",{type:"number",value:B[t][a],onChange:e=>U(t,a,parseFloat(e.target.value)),min:"-1",max:"1",step:"0.1",disabled:t===a,className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-700 disabled:text-gray-400"})},a))]},e))})]})})]})]})},"setup"),"run"===n&&s.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{children:"🚀 Simulation Control"}),s.jsx("div",{className:"flex items-center space-x-2",children:b?s.jsxs("button",{onClick:z,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(o,{size:16}),s.jsx("span",{children:"Stop Simulation"})]}):s.jsxs("button",{onClick:$,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",disabled:Object.values(E).every(e=>!e.enabled),children:[s.jsx(d,{size:16}),s.jsx("span",{children:"Run Simulation"})]})})]}),b&&s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${N}%`}})}),s.jsxs("div",{className:"text-sm text-gray-400 text-center",children:[N.toFixed(1),"% Complete (",Math.floor(N*O.iterations/100)," / ",O.iterations," iterations)"]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 mt-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📋 Simulation Preview"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Iterations"}),s.jsx("div",{className:"text-xl font-bold text-white",children:O.iterations.toLocaleString()})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Variables"}),s.jsx("div",{className:"text-xl font-bold text-white",children:Object.values(E).filter(e=>e.enabled).length})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Confidence Level"}),s.jsxs("div",{className:"text-xl font-bold text-white",children:[(100*O.confidenceLevel).toFixed(0),"%"]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Correlation"}),s.jsx("div",{className:"text-xl font-bold text-white",children:O.enableCorrelation?"Enabled":"Disabled"})]})]})]})]})},"run"),"results"===n&&s.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:h?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-xl font-semibold text-white flex items-center",children:"📊 Simulation Results"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(x,{size:16}),"Export Results"]}),s.jsxs("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(m,{size:16}),"Generate Report"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(h.analysis.statistics).map(([e,t])=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"💰 Price per Share":"enterpriseValue"===e?"🏢 Enterprise Value":"📈 Upside %"}),s.jsx("div",{className:"text-2xl font-bold text-green-400 mb-2",children:"upside"===e?`${t.mean.toFixed(1)}%`:W(t.mean)}),s.jsxs("div",{className:"space-y-1 text-sm text-gray-300",children:[s.jsxs("div",{children:["Median: ","upside"===e?`${t.median.toFixed(1)}%`:W(t.median)]}),s.jsxs("div",{children:["Std Dev: ","upside"===e?`${t.stdDev.toFixed(1)}%`:W(t.stdDev)]}),s.jsxs("div",{children:["Min: ","upside"===e?`${t.min.toFixed(1)}%`:W(t.min)]}),s.jsxs("div",{children:["Max: ","upside"===e?`${t.max.toFixed(1)}%`:W(t.max)]})]})]},e))}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"📊 Price Distribution"}),s.jsx(w,{width:"100%",height:300,children:s.jsxs(C,{data:H,children:[s.jsx(R,{strokeDasharray:"3 3"}),s.jsx(S,{dataKey:"bin",tickFormatter:W}),s.jsx(k,{}),s.jsx(M,{formatter:(e,s)=>[`${(100*e).toFixed(2)}%`,"Frequency"],labelFormatter:e=>`Price: ${W(e)}`}),s.jsx(F,{type:"monotone",dataKey:"frequency",stroke:"#3B82F6",fill:"#3B82F6",fillOpacity:.6})]})})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"🎯 Sensitivity Scatter Plot"}),s.jsx(w,{width:"100%",height:300,children:s.jsxs(D,{data:K,children:[s.jsx(R,{strokeDasharray:"3 3"}),s.jsx(S,{dataKey:"x",name:"Revenue Growth Rate",tickFormatter:e=>`${e.toFixed(1)}%`}),s.jsx(k,{dataKey:"y",name:"Price per Share",tickFormatter:W}),s.jsx(M,{formatter:(e,s)=>["Revenue Growth Rate"===s?`${e.toFixed(2)}%`:W(e),s]}),s.jsx(P,{name:"Scenarios",fill:"#10B981",children:K.map((e,t)=>s.jsx(V,{fill:e.upside>0?"#10B981":"#EF4444"},`cell-${t}`))})]})})]})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(u,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Results Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see results here."})]})},"results"),"analysis"===n&&s.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:h?.analysis?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"⚠️ Risk Metrics"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(h.analysis.riskMetrics).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"var95"===e?"Value at Risk (95%)":"cvar95"===e?"Conditional VaR (95%)":"probabilityOfLoss"===e?"Probability of Loss":"Sharpe Ratio"}),s.jsx("div",{className:"text-xl font-bold text-red-400 mb-1",children:"probabilityOfLoss"===e?`${(100*t).toFixed(1)}%`:W(t)}),s.jsx("div",{className:"text-xs text-gray-400",children:"Risk measure"})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:["📊 Confidence Intervals (",(100*h.analysis.confidenceIntervals.pricePerShare?.level).toFixed(0),"%)"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(h.analysis.confidenceIntervals).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Lower Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${t.lowerBound.toFixed(1)}%`:W(t.lowerBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Upper Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${t.upperBound.toFixed(1)}%`:W(t.upperBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Width:"}),s.jsx("span",{className:"font-medium text-blue-400",children:"upside"===e?`${t.width.toFixed(1)}%`:W(t.width)})]})]})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Percentile Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-300",children:"Metric"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"5th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"25th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"50th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"75th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"95th %ile"})]})}),s.jsx("tbody",{children:Object.entries(h.analysis.percentiles).map(([e,t])=>s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("td",{className:"p-3 text-sm text-white",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p5.toFixed(1)}%`:W(t.p5)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p25.toFixed(1)}%`:W(t.p25)}),s.jsx("td",{className:"p-3 text-sm text-right text-blue-400 font-medium",children:"upside"===e?`${t.p50.toFixed(1)}%`:W(t.p50)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p75.toFixed(1)}%`:W(t.p75)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p95.toFixed(1)}%`:W(t.p95)})]},e))})]})})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(u,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Analysis Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see analysis here."})]})},"analysis")]})})]})},T=({data:l,onDataChange:i})=>{const[n,c]=e.useState("inputs"),[d,o]=e.useState(null),[x,m]=e.useState(!1),[u,h]=e.useState({symbol:"COMPANY",companyName:"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,equityContribution:.35,seniorDebtMultiple:4,subordinatedDebtMultiple:1.5,seniorInterestRate:.055,subordinatedInterestRate:.095,ebitdaGrowthRate:.06,capexAsPercentOfRevenue:.03,nwcAsPercentOfRevenue:.02,holdingPeriod:5,exitMultiple:10,transactionFees:.02,managementFees:.02,taxRate:.21}),g=e.useCallback(e=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),b=e.useCallback(e=>`${(100*e).toFixed(1)}%`,[]),j=e.useCallback(async()=>{try{m(!0);const e={symbol:u.symbol,companyName:u.companyName,purchasePrice:u.purchasePrice,ebitda:u.ebitda,revenue:u.revenue,assumptions:{debt:{seniorDebtMultiple:u.seniorDebtMultiple,subordinatedDebtMultiple:u.subordinatedDebtMultiple,seniorInterestRate:u.seniorInterestRate,subordinatedInterestRate:u.subordinatedInterestRate},operating:{ebitdaGrowthRate:u.ebitdaGrowthRate,capexAsPercentOfRevenue:u.capexAsPercentOfRevenue,nwcAsPercentOfRevenue:u.nwcAsPercentOfRevenue,taxRate:u.taxRate},exit:{exitMultiple:u.exitMultiple},transaction:{holdingPeriod:u.holdingPeriod,transactionFees:u.transactionFees}}},s=N.buildLBOModel(e);o(s),i&&i({lboModel:{inputs:u,results:s,timestamp:(new Date).toISOString()}})}catch(e){alert(`Error: ${e.message}`)}finally{m(!1)}},[u,i]),f=e.useCallback((e,s)=>{h(t=>({...t,[e]:"string"==typeof s?parseFloat(s)||0:s}))},[]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(p,{className:"text-blue-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Advanced LBO Modeling"}),s.jsx("p",{className:"text-gray-600",children:"Professional leveraged buyout analysis"})]})]}),s.jsxs(y.button,{onClick:j,disabled:x,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(x?"bg-gray-300 text-gray-500":"bg-blue-600 hover:bg-blue-700 text-white"),children:[s.jsx(t,{size:18}),s.jsx("span",{children:x?"Calculating...":"Calculate LBO"})]})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"inputs",label:"Model Inputs",icon:a},{id:"results",label:"Results & Analysis",icon:r}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>c(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(n===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),"inputs"===n&&s.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Transaction"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Price"}),s.jsx("input",{type:"number",value:u.purchasePrice,onChange:e=>f("purchasePrice",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),s.jsx("p",{className:"text-xs text-gray-500",children:g(u.purchasePrice)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current EBITDA"}),s.jsx("input",{type:"number",value:u.ebitda,onChange:e=>f("ebitda",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Holding Period"}),s.jsx("input",{type:"number",value:u.holdingPeriod,onChange:e=>f("holdingPeriod",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Financing"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Debt Multiple"}),s.jsx("input",{type:"number",step:"0.1",value:u.seniorDebtMultiple,onChange:e=>f("seniorDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sub Debt Multiple"}),s.jsx("input",{type:"number",step:"0.1",value:u.subordinatedDebtMultiple,onChange:e=>f("subordinatedDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Rate (%)"}),s.jsx("input",{type:"number",step:"0.001",value:100*u.seniorInterestRate,onChange:e=>f("seniorInterestRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Operating"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA Growth (%)"}),s.jsx("input",{type:"number",step:"0.01",value:100*u.ebitdaGrowthRate,onChange:e=>f("ebitdaGrowthRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exit Multiple"}),s.jsx("input",{type:"number",step:"0.1",value:u.exitMultiple,onChange:e=>f("exitMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),s.jsx("input",{type:"number",step:"0.01",value:100*u.taxRate,onChange:e=>f("taxRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})]})}),"results"===n&&s.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:d?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:b(d.baseCase?.returnsAnalysis?.irr||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"IRR"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(d.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"MOIC"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[(d.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Leverage"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g(d.baseCase?.exitAnalysis?.equityProceeds||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Exit Value"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Transaction Structure"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Purchase Price:"}),s.jsx("span",{className:"font-medium",children:g(d.transactionStructure?.purchasePrice)})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Total Debt:"}),s.jsx("span",{className:"font-medium",children:g(d.transactionStructure?.totalDebt)})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Equity Investment:"}),s.jsx("span",{className:"font-medium",children:g(d.transactionStructure?.equityContribution)})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Entry Multiple:"}),s.jsxs("span",{className:"font-medium",children:[(d.transactionStructure?.entryMultiple||0).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Debt/EBITDA:"}),s.jsxs("span",{className:"font-medium",children:[(d.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Equity %:"}),s.jsx("span",{className:"font-medium",children:b(d.transactionStructure?.equityPercentage||0)})]})]})]})]}),d.scenarios&&Object.keys(d.scenarios).length>0&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx("th",{className:"text-left py-2",children:"Scenario"}),s.jsx("th",{className:"text-right py-2",children:"IRR"}),s.jsx("th",{className:"text-right py-2",children:"MOIC"}),s.jsx("th",{className:"text-right py-2",children:"Exit Value"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 font-medium",children:"Base Case"}),s.jsx("td",{className:"text-right py-2",children:b(d.baseCase?.returnsAnalysis?.irr||0)}),s.jsxs("td",{className:"text-right py-2",children:[(d.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("td",{className:"text-right py-2",children:g(d.baseCase?.exitAnalysis?.equityProceeds||0)})]}),Object.entries(d.scenarios).map(([e,t])=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2",children:e}),s.jsx("td",{className:"text-right py-2",children:b(t.returnsAnalysis?.irr||0)}),s.jsxs("td",{className:"text-right py-2",children:[(t.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("td",{className:"text-right py-2",children:g(t.exitAnalysis?.equityProceeds||0)})]},e))]})]})})]})]}):s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(r,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Run LBO calculation to see results"})]})})]})},B=({data:t,onDataChange:a,calculateDCF:l,lboModelingEngine:i})=>{const[n,c]=e.useState("scenarios"),[o,x]=e.useState([{id:1,name:"Base Case",probability:40,revenueGrowth:5,marginExpansion:.5,exitMultiple:10,capexIntensity:3,isBase:!0},{id:2,name:"Bull Case",probability:30,revenueGrowth:8,marginExpansion:1.5,exitMultiple:12,capexIntensity:2.5,isBase:!1},{id:3,name:"Bear Case",probability:30,revenueGrowth:2,marginExpansion:-.5,exitMultiple:8,capexIntensity:4,isBase:!1}]),[m,p]=e.useState({modelType:"dcf",outputMetric:"enterpriseValue",includeCorrelations:!1,numSimulations:1e3}),[b,j]=e.useState(null),[f,v]=e.useState(!1),N=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),C=e.useCallback(e=>`${(e||0).toFixed(1)}%`,[]),F=e.useCallback(async()=>{v(!0);try{const e=[];for(const n of o){let s=null;if("dcf"===m.modelType){const e={...t,statements:{...t.statements,incomeStatement:{...t.statements.incomeStatement,totalRevenue:t.statements.incomeStatement.totalRevenue?.map((e,s)=>0===s?e:e*Math.pow(1+n.revenueGrowth/100,s))}}};s=l?l(e):null}else if("lbo"===m.modelType&&i){const e={symbol:t.symbol||"COMPANY",companyName:t.companyName||"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,assumptions:{operating:{ebitdaGrowthRate:n.revenueGrowth/100,capexAsPercentOfRevenue:n.capexIntensity/100},exit:{exitMultiple:n.exitMultiple}}};s=i.buildLBOModel(e)}e.push({...n,result:s,enterpriseValue:s?.enterpriseValue||s?.baseCase?.exitAnalysis?.enterpriseValue||0,equityValue:s?.equityValue||s?.baseCase?.exitAnalysis?.equityProceeds||0,irr:s?.irr||s?.baseCase?.returnsAnalysis?.irr||0,moic:s?.moic||s?.baseCase?.returnsAnalysis?.moic||0})}const s=e.reduce((e,s)=>e+s.enterpriseValue*s.probability/100,0),a={min:Math.min(...e.map(e=>e.enterpriseValue)),max:Math.max(...e.map(e=>e.enterpriseValue)),range:Math.max(...e.map(e=>e.enterpriseValue))-Math.min(...e.map(e=>e.enterpriseValue))},r=Math.sqrt(e.reduce((e,t)=>{const a=t.enterpriseValue-s;return e+a*a*t.probability/100},0));j({scenarios:e,summary:{weightedValue:s,valueRange:a,standardDeviation:r,coefficientOfVariation:r/s,probabilityOfPositiveReturn:e.filter(e=>e.enterpriseValue>(t.currentMarketCap||1e9)).reduce((e,s)=>e+s.probability,0)},chartData:e.map(e=>({name:e.name,value:e.enterpriseValue,probability:e.probability,irr:100*e.irr,moic:e.moic}))})}catch(e){alert(`Error running scenario analysis: ${e.message}`)}finally{v(!1)}},[o,m,t,l,i]),D=e.useCallback(()=>{const e={id:Date.now(),name:`Scenario ${o.length+1}`,probability:Math.max(0,100-o.reduce((e,s)=>e+s.probability,0)),revenueGrowth:5,marginExpansion:0,exitMultiple:10,capexIntensity:3,isBase:!1};x(s=>[...s,e])},[o]),P=e.useCallback((e,s,t)=>{x(a=>a.map(a=>a.id===e?{...a,[s]:parseFloat(t)||t}:a))},[]),V=e.useCallback(e=>{x(s=>s.filter(s=>s.id!==e&&!s.isBase))},[]),I=e.useMemo(()=>o.reduce((e,s)=>e+s.probability,0),[o]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(r,{className:"text-purple-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Scenario Analysis"}),s.jsx("p",{className:"text-gray-600",children:"Cross-model scenario planning & risk assessment"})]})]}),s.jsx("div",{className:"flex space-x-3",children:s.jsxs(y.button,{onClick:F,disabled:f||100!==I,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(f||100!==I?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:f||100!==I?{}:{scale:1.02},children:[s.jsx(d,{size:18}),s.jsx("span",{children:f?"Running...":"Run Analysis"})]})})]}),s.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model Type"}),s.jsxs("select",{value:m.modelType,onChange:e=>p(s=>({...s,modelType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"dcf",children:"DCF Valuation"}),s.jsx("option",{value:"lbo",children:"LBO Analysis"}),s.jsx("option",{value:"3statement",children:"3-Statement Model"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Output Metric"}),s.jsxs("select",{value:m.outputMetric,onChange:e=>p(s=>({...s,outputMetric:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"enterpriseValue",children:"Enterprise Value"}),s.jsx("option",{value:"equityValue",children:"Equity Value"}),s.jsx("option",{value:"irr",children:"IRR"}),s.jsx("option",{value:"moic",children:"MOIC"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulations"}),s.jsx("input",{type:"number",value:m.numSimulations,onChange:e=>p(s=>({...s,numSimulations:parseInt(e.target.value)||1e3})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:m.includeCorrelations,onChange:e=>p(s=>({...s,includeCorrelations:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Include Correlations"})]})})]})}),100!==I&&s.jsxs("div",{className:"mb-6 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center",children:[s.jsx(u,{className:"text-amber-500 mr-2",size:20}),s.jsxs("span",{className:"text-amber-800",children:["Total probability is ",I,"%. Adjust scenarios to sum to 100%."]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Scenarios"}),s.jsxs(y.button,{onClick:D,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(h,{size:16}),s.jsx("span",{children:"Add Scenario"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4",children:"Scenario"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Probability (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Revenue Growth (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Margin Expansion (bps)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Exit Multiple"}),s.jsx("th",{className:"text-right py-3 px-4",children:"CapEx Intensity (%)"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),s.jsx("tbody",{children:o.map(e=>s.jsxs("tr",{className:"border-b border-gray-200 "+(e.isBase?"bg-blue-50":""),children:[s.jsx("td",{className:"py-3 px-4",children:s.jsx("input",{type:"text",value:e.name,onChange:s=>P(e.id,"name",s.target.value),disabled:e.isBase,className:"border border-gray-300 rounded px-2 py-1 "+(e.isBase?"bg-gray-100":"")})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"1",value:e.probability,onChange:s=>P(e.id,"probability",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.revenueGrowth,onChange:s=>P(e.id,"revenueGrowth",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.marginExpansion,onChange:s=>P(e.id,"marginExpansion",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.exitMultiple,onChange:s=>P(e.id,"exitMultiple",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.capexIntensity,onChange:s=>P(e.id,"capexIntensity",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-center py-3 px-4",children:!e.isBase&&s.jsx("button",{onClick:()=>V(e.id),className:"text-red-600 hover:text-red-800",children:s.jsx(g,{size:16})})})]},e.id))})]})})]}),b&&s.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:N(b.summary.weightedValue)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:N(b.summary.valueRange.max)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:N(b.summary.valueRange.min)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:C(b.summary.probabilityOfPositiveReturn)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Success Probability"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Results"}),s.jsx("div",{className:"h-80",children:s.jsx(w,{width:"100%",height:"100%",children:s.jsxs(A,{data:b.chartData,children:[s.jsx(R,{strokeDasharray:"3 3"}),s.jsx(S,{dataKey:"name"}),s.jsx(k,{tickFormatter:e=>N(e)}),s.jsx(M,{formatter:e=>[N(e),"Enterprise Value"]}),s.jsx(O,{dataKey:"value",fill:"#8884d8"})]})})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Risk Metrics"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Standard Deviation:"}),s.jsx("span",{className:"font-medium",children:N(b.summary.standardDeviation)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Coefficient of Variation:"}),s.jsxs("span",{className:"font-medium",children:[(100*b.summary.coefficientOfVariation).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Value at Risk (5%):"}),s.jsx("span",{className:"font-medium",children:N(b.summary.valueRange.min)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Upside Potential:"}),s.jsx("span",{className:"font-medium",children:N(b.summary.valueRange.range)})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Scenario Returns"}),s.jsx("div",{className:"space-y-2 text-sm",children:b.scenarios.map(e=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:[e.name,":"]}),s.jsx("span",{className:"font-medium",children:"irr"===m.outputMetric?C(e.irr):"moic"===m.outputMetric?`${e.moic.toFixed(1)}x`:N(e[m.outputMetric])})]},e.id))})]})]})]}),!b&&s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(r,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Configure scenarios and run analysis to see results"})]})]})};export{I as A,B as E,E as M,T as a};
//# sourceMappingURL=private-analysis-heavy-DbRFEumZ.js.map
