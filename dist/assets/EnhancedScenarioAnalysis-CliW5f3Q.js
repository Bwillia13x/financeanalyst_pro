import{r as e,j as s,o as a,ab as t,T as i,af as r,ah as l}from"./react-core-CeHLCIBw.js";import{b as n}from"./ui-vendor-B5RWaOCb.js";import{ResponsiveContainer as c,BarChart as d,CartesianGrid as o,XAxis as m,YAxis as x,Tooltip as u,Bar as p}from"./recharts-vendor-DQPXk1vH.js";import"./vendor-D2fsnhsW.js";import"./ai-vendor-CuiosWbE.js";import"./advanced-analytics-y00dU25g.js";import"./utils-vendor-DUg4_aAP.js";import"./react-dom-B6lyId6m.js";import"./d3-vendor-DOBQrAlH.js";const h=({data:h,_onDataChange:b,calculateDCF:y,lboModelingEngine:g})=>{const[j,v]=e.useState("scenarios"),[N,f]=e.useState([{id:1,name:"Base Case",probability:40,revenueGrowth:5,marginExpansion:.5,exitMultiple:10,capexIntensity:3,isBase:!0},{id:2,name:"Bull Case",probability:30,revenueGrowth:8,marginExpansion:1.5,exitMultiple:12,capexIntensity:2.5,isBase:!1},{id:3,name:"Bear Case",probability:30,revenueGrowth:2,marginExpansion:-.5,exitMultiple:8,capexIntensity:4,isBase:!1}]),[C,w]=e.useState({modelType:"dcf",outputMetric:"enterpriseValue",includeCorrelations:!1,numSimulations:1e3}),[M,V]=e.useState(null),[S,k]=e.useState(!1),R=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),E=e.useCallback(e=>`${(e||0).toFixed(1)}%`,[]),B=e.useCallback(async()=>{k(!0);try{const e=[];for(const i of N){let s=null;if("dcf"===C.modelType){const e={...h,statements:{...h.statements,incomeStatement:{...h.statements.incomeStatement,totalRevenue:h.statements.incomeStatement.totalRevenue?.map((e,s)=>0===s?e:e*Math.pow(1+i.revenueGrowth/100,s))}}};s=y?y(e):null}else if("lbo"===C.modelType&&g){const e={symbol:h.symbol||"COMPANY",companyName:h.companyName||"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,assumptions:{operating:{ebitdaGrowthRate:i.revenueGrowth/100,capexAsPercentOfRevenue:i.capexIntensity/100},exit:{exitMultiple:i.exitMultiple}}};s=g.buildLBOModel(e)}e.push({...i,result:s,enterpriseValue:s?.enterpriseValue||s?.baseCase?.exitAnalysis?.enterpriseValue||0,equityValue:s?.equityValue||s?.baseCase?.exitAnalysis?.equityProceeds||0,irr:s?.irr||s?.baseCase?.returnsAnalysis?.irr||0,moic:s?.moic||s?.baseCase?.returnsAnalysis?.moic||0})}const s=e.reduce((e,s)=>e+s.enterpriseValue*s.probability/100,0),a={min:Math.min(...e.map(e=>e.enterpriseValue)),max:Math.max(...e.map(e=>e.enterpriseValue)),range:Math.max(...e.map(e=>e.enterpriseValue))-Math.min(...e.map(e=>e.enterpriseValue))},t=Math.sqrt(e.reduce((e,a)=>{const t=a.enterpriseValue-s;return e+t*t*a.probability/100},0));V({scenarios:e,summary:{weightedValue:s,valueRange:a,standardDeviation:t,coefficientOfVariation:t/s,probabilityOfPositiveReturn:e.filter(e=>e.enterpriseValue>(h.currentMarketCap||1e9)).reduce((e,s)=>e+s.probability,0)},chartData:e.map(e=>({name:e.name,value:e.enterpriseValue,probability:e.probability,irr:100*e.irr,moic:e.moic}))})}catch(e){alert(`Error running scenario analysis: ${e.message}`)}finally{k(!1)}},[N,C,h,y,g]),D=e.useCallback(()=>{const e={id:Date.now(),name:`Scenario ${N.length+1}`,probability:Math.max(0,100-N.reduce((e,s)=>e+s.probability,0)),revenueGrowth:5,marginExpansion:0,exitMultiple:10,capexIntensity:3,isBase:!1};f(s=>[...s,e])},[N]),F=e.useCallback((e,s,a)=>{f(t=>t.map(t=>t.id===e?{...t,[s]:parseFloat(a)||a}:t))},[]),I=e.useCallback(e=>{f(s=>s.filter(s=>s.id!==e&&!s.isBase))},[]),A=e.useMemo(()=>N.reduce((e,s)=>e+s.probability,0),[N]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(a,{className:"text-purple-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Scenario Analysis"}),s.jsx("p",{className:"text-gray-600",children:"Cross-model scenario planning & risk assessment"})]})]}),s.jsx("div",{className:"flex space-x-3",children:s.jsxs(n.button,{onClick:B,disabled:S||100!==A,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(S||100!==A?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:S||100!==A?{}:{scale:1.02},children:[s.jsx(t,{size:18}),s.jsx("span",{children:S?"Running...":"Run Analysis"})]})})]}),s.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"modelType",className:"block text-sm font-medium text-gray-700 mb-2",children:"Model Type"}),s.jsxs("select",{id:"modelType",value:C.modelType,onChange:e=>w(s=>({...s,modelType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"dcf",children:"DCF Valuation"}),s.jsx("option",{value:"lbo",children:"LBO Analysis"}),s.jsx("option",{value:"3statement",children:"3-Statement Model"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"outputMetric",className:"block text-sm font-medium text-gray-700 mb-2",children:"Output Metric"}),s.jsxs("select",{id:"outputMetric",value:C.outputMetric,onChange:e=>w(s=>({...s,outputMetric:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"enterpriseValue",children:"Enterprise Value"}),s.jsx("option",{value:"equityValue",children:"Equity Value"}),s.jsx("option",{value:"irr",children:"IRR"}),s.jsx("option",{value:"moic",children:"MOIC"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"simulations",className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulations"}),s.jsx("input",{id:"simulations",type:"number",value:C.numSimulations,onChange:e=>w(s=>({...s,numSimulations:parseInt(e.target.value)||1e3})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:C.includeCorrelations,onChange:e=>w(s=>({...s,includeCorrelations:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Include Correlations"})]})})]})}),100!==A&&s.jsxs("div",{className:"mb-6 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center",children:[s.jsx(i,{className:"text-amber-500 mr-2",size:20}),s.jsxs("span",{className:"text-amber-800",children:["Total probability is ",A,"%. Adjust scenarios to sum to 100%."]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Scenarios"}),s.jsxs(n.button,{onClick:D,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(r,{size:16}),s.jsx("span",{children:"Add Scenario"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4",children:"Scenario"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Probability (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Revenue Growth (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Margin Expansion (bps)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Exit Multiple"}),s.jsx("th",{className:"text-right py-3 px-4",children:"CapEx Intensity (%)"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),s.jsx("tbody",{children:N.map(e=>s.jsxs("tr",{className:"border-b border-gray-200 "+(e.isBase?"bg-blue-50":""),children:[s.jsx("td",{className:"py-3 px-4",children:s.jsx("input",{type:"text",value:e.name,onChange:s=>F(e.id,"name",s.target.value),disabled:e.isBase,className:"border border-gray-300 rounded px-2 py-1 "+(e.isBase?"bg-gray-100":"")})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"1",value:e.probability,onChange:s=>F(e.id,"probability",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.revenueGrowth,onChange:s=>F(e.id,"revenueGrowth",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.marginExpansion,onChange:s=>F(e.id,"marginExpansion",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.exitMultiple,onChange:s=>F(e.id,"exitMultiple",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.capexIntensity,onChange:s=>F(e.id,"capexIntensity",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-center py-3 px-4",children:!e.isBase&&s.jsx("button",{onClick:()=>I(e.id),className:"text-red-600 hover:text-red-800",children:s.jsx(l,{size:16})})})]},e.id))})]})})]}),M&&s.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:R(M.summary.weightedValue)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:R(M.summary.valueRange.max)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:R(M.summary.valueRange.min)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:E(M.summary.probabilityOfPositiveReturn)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Success Probability"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Results"}),s.jsx("div",{className:"h-80",children:s.jsx(c,{width:"100%",height:"100%",children:s.jsxs(d,{data:M.chartData,children:[s.jsx(o,{strokeDasharray:"3 3"}),s.jsx(m,{dataKey:"name"}),s.jsx(x,{tickFormatter:e=>R(e)}),s.jsx(u,{formatter:e=>[R(e),"Enterprise Value"]}),s.jsx(p,{dataKey:"value",fill:"#8884d8"})]})})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Risk Metrics"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Standard Deviation:"}),s.jsx("span",{className:"font-medium",children:R(M.summary.standardDeviation)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Coefficient of Variation:"}),s.jsxs("span",{className:"font-medium",children:[(100*M.summary.coefficientOfVariation).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Value at Risk (5%):"}),s.jsx("span",{className:"font-medium",children:R(M.summary.valueRange.min)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Upside Potential:"}),s.jsx("span",{className:"font-medium",children:R(M.summary.valueRange.range)})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Scenario Returns"}),s.jsx("div",{className:"space-y-2 text-sm",children:M.scenarios.map(e=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:[e.name,":"]}),s.jsx("span",{className:"font-medium",children:"irr"===C.outputMetric?E(e.irr):"moic"===C.outputMetric?`${e.moic.toFixed(1)}x`:R(e[C.outputMetric])})]},e.id))})]})]})]}),!M&&s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(a,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Configure scenarios and run analysis to see results"})]})]})};export{h as default};
//# sourceMappingURL=EnhancedScenarioAnalysis-CliW5f3Q.js.map
