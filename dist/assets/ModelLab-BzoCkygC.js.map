{"version":3,"file":"ModelLab-BzoCkygC.js","sources":["../../src/utils/modelLabCalculations.js","../../src/components/ModelLab/Compare.jsx","../../src/components/ModelLab/DriverInspector.jsx","../../src/services/modelStore.js","../../src/components/ModelLab/EnhancedLibrary.jsx","../../src/components/ModelLab/TemplateGallery.jsx","../../src/components/ModelLab/TestsPanel.jsx","../../src/services/calculators.js","../../src/components/ModelLab/ValidatedAssumptionsForm.jsx","../../src/pages/ModelLab.jsx"],"sourcesContent":["// Model Lab Calculation Utilities\n\nconst clamp = (x, a, b) => Math.max(a, Math.min(b, x));\n\n// Template definitions\nexport const templates = [\n  {\n    kind: 'DCF',\n    title: 'Discounted Cash Flow',\n    description: 'Intrinsic value from projected FCFF and terminal assumptions.',\n    tags: ['intrinsic', 'long‑horizon', 'fundamental'],\n    schema: [\n      { key: 'price', label: 'Market Price', kind: 'number', step: 0.01, min: 0, suffix: '$' },\n      { key: 'shares', label: 'Diluted Shares', kind: 'number', step: 1, min: 1 },\n      { key: 'netDebt', label: 'Net Debt', kind: 'number', step: 1_000_000 },\n      { key: 'rev0', label: 'Revenue₀', kind: 'number', step: 1_000_000, min: 0, suffix: '$' },\n      { key: 'margin', label: 'EBIT Margin', kind: 'percent', step: 0.005, min: 0, max: 0.6 },\n      { key: 'tax', label: 'Tax Rate', kind: 'percent', step: 0.005, min: 0, max: 0.6 },\n      { key: 'g', label: 'Growth (yrs 1‑5)', kind: 'percent', step: 0.005, min: -0.2, max: 0.2 },\n      { key: 'tg', label: 'Terminal g', kind: 'percent', step: 0.001, min: -0.02, max: 0.05 },\n      { key: 'wacc', label: 'WACC', kind: 'percent', step: 0.0025, min: 0.02, max: 0.25 }\n    ]\n  },\n  {\n    kind: 'Comps',\n    title: 'Trading Comps',\n    description: 'Value via market multiple on a chosen metric.',\n    tags: ['relative', 'peer‑set'],\n    schema: [\n      { key: 'price', label: 'Market Price', kind: 'number', step: 0.01, min: 0, suffix: '$' },\n      { key: 'shares', label: 'Diluted Shares', kind: 'number', step: 1, min: 1 },\n      { key: 'netDebt', label: 'Net Debt', kind: 'number', step: 1_000_000 },\n      { key: 'metric', label: 'Metric (EBITDA)', kind: 'number', step: 1_000_000, min: 0, suffix: '$' },\n      { key: 'multiple', label: 'EV/Metric', kind: 'number', step: 0.25, min: 2, max: 40 }\n    ]\n  },\n  {\n    kind: 'EPV',\n    title: 'Earnings Power Value',\n    description: 'Steady‑state value = NOPAT / WACC (g≈0).',\n    tags: ['steady‑state', 'quality'],\n    schema: [\n      { key: 'price', label: 'Market Price', kind: 'number', step: 0.01, min: 0, suffix: '$' },\n      { key: 'shares', label: 'Diluted Shares', kind: 'number', step: 1, min: 1 },\n      { key: 'netDebt', label: 'Net Debt', kind: 'number', step: 1_000_000 },\n      { key: 'ebit', label: 'EBIT (normalized)', kind: 'number', step: 1_000_000, min: 0, suffix: '$' },\n      { key: 'tax', label: 'Tax Rate', kind: 'percent', step: 0.005, min: 0, max: 0.6 },\n      { key: 'wacc', label: 'WACC', kind: 'percent', step: 0.0025, min: 0.02, max: 0.25 }\n    ]\n  },\n  {\n    kind: 'LBO',\n    title: 'LBO Sketch',\n    description: 'Entry/exit multiples with leverage; quick equity IRR view.',\n    tags: ['private‑equity', 'leverage'],\n    schema: [\n      { key: 'ebitda', label: 'EBITDA₀', kind: 'number', step: 1_000_000, min: 0, suffix: '$' },\n      { key: 'entryX', label: 'Entry EV/EBITDA', kind: 'number', step: 0.25, min: 2, max: 30 },\n      { key: 'exitX', label: 'Exit EV/EBITDA', kind: 'number', step: 0.25, min: 2, max: 30 },\n      { key: 'debtPct', label: 'Debt % EV (t₀)', kind: 'percent', step: 0.01, min: 0, max: 0.9 },\n      { key: 'years', label: 'Hold (yrs)', kind: 'number', step: 1, min: 1, max: 10 },\n      { key: 'ebitdaCAGR', label: 'EBITDA CAGR', kind: 'percent', step: 0.005, min: -0.3, max: 0.5 }\n    ]\n  }\n];\n\n// Calculation functions\nexport function calcDCF(a) {\n  const EBIT = a.rev0 * (a.margin ?? 0.15);\n  const NOPAT0 = EBIT * (1 - (a.tax ?? 0.23));\n  const g = a.g ?? 0.05, tg = a.tg ?? 0.02, w = a.wacc ?? 0.09;\n  const years = 5;\n  let pv = 0;\n  let fcff = NOPAT0;\n\n  for (let t = 1; t <= years; t++) {\n    fcff = fcff * (1 + g);\n    pv += fcff / ((1 + w) ** t);\n  }\n\n  const fcff5 = fcff;\n  const tv = (fcff5 * (1 + tg)) / (w - tg);\n  const pvTV = tv / ((1 + w) ** years);\n  const EV = pv + pvTV;\n  const equity = EV - (a.netDebt || 0);\n  const perShare = equity / Math.max(1, (a.shares || 1));\n\n  return { ev: EV, perShare };\n}\n\nexport function calcComps(a) {\n  const EV = (a.multiple || 8) * (a.metric || 0);\n  const equity = EV - (a.netDebt || 0);\n  const perShare = equity / Math.max(1, (a.shares || 1));\n  return { ev: EV, perShare };\n}\n\nexport function calcEPV(a) {\n  const NOPAT = (a.ebit || 0) * (1 - (a.tax || 0.23));\n  const w = Math.max(0.02, (a.wacc || 0.09));\n  const EV = NOPAT / w;\n  const equity = EV - (a.netDebt || 0);\n  const perShare = equity / Math.max(1, (a.shares || 1));\n  return { ev: EV, perShare };\n}\n\nexport function calcLBO(a) {\n  const ebitda0 = a.ebitda || 0;\n  const entryEV = ebitda0 * (a.entryX || 8);\n  const debt0 = entryEV * (a.debtPct || 0.5);\n  const eq0 = Math.max(1, entryEV - debt0);\n  const years = Math.max(1, Math.round(a.years || 5));\n  const ebitdaN = ebitda0 * ((1 + (a.ebitdaCAGR || 0.05)) ** years);\n  const exitEV = ebitdaN * (a.exitX || 8);\n  const debtN = Math.max(0, debt0 * (0.9 ** years));\n  const exitEq = Math.max(1, exitEV - debtN);\n  const moic = exitEq / eq0;\n  const irr = Math.max(-0.99, moic ** (1 / years) - 1);\n  return { irr };\n}\n\nexport function computeOutputs(m) {\n  if (m.kind === 'DCF') return calcDCF(m.assumptions);\n  if (m.kind === 'Comps') return calcComps(m.assumptions);\n  if (m.kind === 'EPV') return calcEPV(m.assumptions);\n  if (m.kind === 'LBO') return calcLBO(m.assumptions);\n  return {};\n}\n\n// Seed model generator\nexport function seedModel(kind, i) {\n  const base = { price: 25, shares: 300_000_000, netDebt: 2_000_000_000 };\n\n  if (kind === 'DCF') Object.assign(base, {\n    rev0: 5_000_000_000, margin: 0.16, tax: 0.23, g: 0.05, tg: 0.02, wacc: 0.09\n  });\n  if (kind === 'Comps') Object.assign(base, {\n    metric: 800_000_000, multiple: 9\n  });\n  if (kind === 'EPV') Object.assign(base, {\n    ebit: 700_000_000, tax: 0.23, wacc: 0.09\n  });\n  if (kind === 'LBO') Object.assign(base, {\n    ebitda: 600_000_000, entryX: 9, exitX: 9, debtPct: 0.55, years: 5, ebitdaCAGR: 0.06\n  });\n\n  return {\n    id: Math.random().toString(36).slice(2),\n    name: `${kind} Model ${i}`,\n    kind,\n    tags: ['demo', kind.toLowerCase()],\n    version: 'v1.0',\n    updated: new Date().toISOString(),\n    assumptions: base,\n    outputs: computeOutputs({ kind, assumptions: base })\n  };\n}\n\n// Test functions\nexport function runTests() {\n  const tests = [];\n\n  // Comps identity\n  const comps = calcComps({ metric: 100, multiple: 10, netDebt: 200, shares: 10 });\n  tests.push({\n    name: 'Comps per‑share = (EV−Debt)/shares',\n    pass: Math.abs(comps.perShare - ((100 * 10 - 200) / 10)) < 1e-9\n  });\n\n  // EPV near NOPAT/W\n  const epv = calcEPV({ ebit: 100, tax: 0.2, wacc: 0.10, netDebt: 0, shares: 10 });\n  tests.push({\n    name: 'EPV EV ≈ NOPAT/W',\n    pass: Math.abs(epv.ev - (100 * (1 - 0.2)) / 0.10) < 1e-6\n  });\n\n  // DCF monotonicity (wacc down -> value up)\n  const d1 = calcDCF({ rev0: 1000, margin: 0.2, tax: 0.2, g: 0.05, tg: 0.02, wacc: 0.10, netDebt: 0, shares: 100 });\n  const d2 = calcDCF({ rev0: 1000, margin: 0.2, tax: 0.2, g: 0.05, tg: 0.02, wacc: 0.09, netDebt: 0, shares: 100 });\n  tests.push({\n    name: 'DCF per‑share ↑ when WACC ↓',\n    pass: (d2.perShare > d1.perShare)\n  });\n\n  return tests;\n}\n","import React from 'react';\n\nimport { computeOutputs } from '../../utils/modelLabCalculations';\n\nconst Card = ({ title, right, children, className = '' }) => (\n  <section className={`rounded-2xl border border-slate-200 bg-white shadow-sm ${className}`}>\n    {(title || right) && (\n      <header className=\"flex items-center justify-between border-b border-slate-200 px-4 py-2.5\">\n        {title && <h3 className=\"text-[13px] font-semibold tracking-wide text-slate-700\">{title}</h3>}\n        {right}\n      </header>\n    )}\n    <div className=\"p-4\">{children}</div>\n  </section>\n);\n\nconst Pill = ({ children, tone = 'slate' }) => {\n  const tones = {\n    slate: 'bg-slate-50 text-slate-700 border-slate-200',\n    blue: 'bg-blue-50 text-blue-700 border-blue-200',\n    amber: 'bg-amber-50 text-amber-700 border-amber-200',\n    green: 'bg-emerald-50 text-emerald-700 border-emerald-200',\n    red: 'bg-rose-50 text-rose-700 border-rose-200'\n  };\n  return (\n    <span className={`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] ${tones[tone]}`}>\n      {children}\n    </span>\n  );\n};\n\nconst Cur = (x, c = 0) => (x >= 1e9 ? `$${(x / 1e9).toFixed(c)}B` : x >= 1e6 ? `$${(x / 1e6).toFixed(c)}M` : `$${x.toFixed(c)}`);\nconst Pct = (x, d = 1) => `${(100 * x).toFixed(d)}%`;\n\nconst Compare = ({ models }) => {\n  const selected = models.filter(m => m.selected);\n  const rows = selected.map(m => ({ id: m.id, name: m.name, kind: m.kind, out: computeOutputs(m) }));\n\n  return (\n    <Card title=\"Cross‑Model Compare\" right={<Pill tone=\"green\">{selected.length} models</Pill>}>\n      {selected.length === 0 ? (\n        <div className=\"text-[12px] text-slate-600\">Select models in the library to compare.</div>\n      ) : (\n        <div className=\"overflow-auto rounded-xl border border-slate-200\">\n          <table className=\"min-w-[640px] text-right text-[12px]\">\n            <thead className=\"bg-slate-50 text-slate-600\">\n              <tr>\n                <th className=\"px-2 py-1 text-left\">Model</th>\n                <th className=\"px-2 py-1\">Kind</th>\n                <th className=\"px-2 py-1\">EV</th>\n                <th className=\"px-2 py-1\">Per‑share</th>\n                <th className=\"px-2 py-1\">IRR (LBO)</th>\n              </tr>\n            </thead>\n            <tbody>\n              {rows.map(r => (\n                <tr key={r.id} className=\"odd:bg-white even:bg-slate-50/40\">\n                  <td className=\"px-2 py-1 text-left\">{r.name}</td>\n                  <td className=\"px-2 py-1\">{r.kind}</td>\n                  <td className=\"px-2 py-1\">{r.out.ev !== undefined ? Cur(r.out.ev, 0) : '—'}</td>\n                  <td className=\"px-2 py-1\">{r.out.perShare !== undefined ? `$${r.out.perShare.toFixed(2)}` : '—'}</td>\n                  <td className=\"px-2 py-1\">{r.out.irr !== undefined ? Pct(r.out.irr, 1) : '—'}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </Card>\n  );\n};\n\nexport default Compare;\n","import React from 'react';\n\nconst Card = ({ title, right, children, className = '' }) => (\n  <section className={`rounded-2xl border border-slate-200 bg-white shadow-sm ${className}`}>\n    {(title || right) && (\n      <header className=\"flex items-center justify-between border-b border-slate-200 px-4 py-2.5\">\n        {title && <h3 className=\"text-[13px] font-semibold tracking-wide text-slate-700\">{title}</h3>}\n        {right}\n      </header>\n    )}\n    <div className=\"p-4\">{children}</div>\n  </section>\n);\n\nconst Pill = ({ children, tone = 'slate' }) => {\n  const tones = {\n    slate: 'bg-slate-50 text-slate-700 border-slate-200',\n    blue: 'bg-blue-50 text-blue-700 border-blue-200',\n    amber: 'bg-amber-50 text-amber-700 border-amber-200',\n    green: 'bg-emerald-50 text-emerald-700 border-emerald-200',\n    red: 'bg-rose-50 text-rose-700 border-rose-200'\n  };\n  return (\n    <span className={`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] ${tones[tone]}`}>\n      {children}\n    </span>\n  );\n};\n\nconst DriverInspector = ({ model }) => {\n  const map = {\n    DCF: [\n      { label: 'Revenue₀', affects: ['EBIT', 'NOPAT', 'FCFF', 'EV', 'Per‑share'] },\n      { label: 'EBIT Margin', affects: ['EBIT', 'NOPAT', 'FCFF', 'EV', 'Per‑share'] },\n      { label: 'Tax Rate', affects: ['NOPAT', 'FCFF', 'EV', 'Per‑share'] },\n      { label: 'WACC', affects: ['PV', 'TV', 'EV', 'Per‑share'] },\n      { label: 'Terminal g', affects: ['TV', 'EV', 'Per‑share'] },\n      { label: 'Net Debt', affects: ['Equity', 'Per‑share'] },\n      { label: 'Shares', affects: ['Per‑share'] }\n    ],\n    Comps: [\n      { label: 'Metric', affects: ['EV', 'Per‑share'] },\n      { label: 'EV/Metric', affects: ['EV', 'Per‑share'] },\n      { label: 'Net Debt', affects: ['Equity', 'Per‑share'] },\n      { label: 'Shares', affects: ['Per‑share'] }\n    ],\n    EPV: [\n      { label: 'EBIT', affects: ['NOPAT', 'EV', 'Per‑share'] },\n      { label: 'Tax Rate', affects: ['NOPAT', 'EV', 'Per‑share'] },\n      { label: 'WACC', affects: ['EV', 'Per‑share'] },\n      { label: 'Net Debt', affects: ['Equity', 'Per‑share'] },\n      { label: 'Shares', affects: ['Per‑share'] }\n    ],\n    LBO: [\n      { label: 'EBITDA₀', affects: ['Entry EV', 'Equity₀', 'IRR'] },\n      { label: 'Entry/Exit multiples', affects: ['IRR'] },\n      { label: 'Debt %', affects: ['Equity₀', 'IRR'] },\n      { label: 'Hold (yrs)', affects: ['IRR'] },\n      { label: 'EBITDA CAGR', affects: ['IRR'] }\n    ]\n  };\n\n  const items = map[model.kind] || [];\n\n  return (\n    <Card title=\"Driver Inspector\" right={<Pill tone=\"amber\">{model.kind}</Pill>}>\n      <ul className=\"space-y-1 text-[12px]\">\n        {items.map((it, i) => (\n          <li key={i} className=\"flex items-center justify-between rounded border border-slate-200 bg-slate-50 px-2 py-1\">\n            <span className=\"text-slate-700\">{it.label}</span>\n            <span className=\"text-slate-500\">{it.affects.join(' • ')}</span>\n          </li>\n        ))}\n      </ul>\n    </Card>\n  );\n};\n\nexport default DriverInspector;\n","// Model Store - localStorage with API capability\n\nconst STORAGE_KEY = 'valor.models';\nconst SCHEMA_VERSION = '1.0';\n\n/**\n * Generate unique ID for models\n */\nfunction generateId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n\n/**\n * Generate semantic version bump\n */\nfunction bumpVersion(currentVersion) {\n  const match = currentVersion.match(/^v(\\d+)\\.(\\d+)$/);\n  if (!match) return 'v1.0';\n\n  const major = parseInt(match[1]);\n  const minor = parseInt(match[2]);\n  return `v${major}.${minor + 1}`;\n}\n\n/**\n * Create default model from template\n */\nfunction createDefaultModel(kind, templateData = {}) {\n  const now = new Date().toISOString();\n  const defaults = {\n    DCF: { rev0: 5_000_000_000, margin: 0.16, tax: 0.23, g: 0.05, tg: 0.02, wacc: 0.09, price: 25, shares: 300_000_000, netDebt: 2_000_000_000 },\n    Comps: { metric: 800_000_000, multiple: 9, price: 25, shares: 300_000_000, netDebt: 2_000_000_000 },\n    EPV: { ebit: 700_000_000, tax: 0.23, wacc: 0.09, price: 25, shares: 300_000_000, netDebt: 2_000_000_000 },\n    LBO: { ebitda: 600_000_000, entryX: 9, exitX: 9, debtPct: 0.55, years: 5, ebitdaCAGR: 0.06 }\n  };\n\n  return {\n    id: generateId(),\n    name: `${kind} Model`,\n    kind,\n    tags: ['demo', kind.toLowerCase()],\n    version: 'v1.0',\n    created: now,\n    updated: now,\n    currency: 'USD',\n    assumptions: { ...defaults[kind], ...templateData },\n    outputs: {},\n    selected: false,\n    ...templateData\n  };\n}\n\n/**\n * ModelStore Implementation\n */\nclass ModelStore {\n  constructor() {\n    this.models = this.loadFromStorage();\n    this.listeners = new Set();\n  }\n\n  /**\n   * Load models from localStorage with migration support\n   */\n  loadFromStorage() {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEY);\n      if (!stored) return [];\n\n      const data = JSON.parse(stored);\n\n      // Handle schema migration\n      if (data.schemaVersion !== SCHEMA_VERSION) {\n        console.log('Migrating model storage schema...');\n        return this.migrateSchema(data);\n      }\n\n      return data.models || [];\n    } catch (error) {\n      console.error('Error loading models from storage:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Save models to localStorage\n   */\n  saveToStorage() {\n    try {\n      const data = {\n        schemaVersion: SCHEMA_VERSION,\n        models: this.models,\n        lastUpdated: new Date().toISOString()\n      };\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n      this.notifyListeners();\n    } catch (error) {\n      console.error('Error saving models to storage:', error);\n      throw new Error('Failed to save models to storage');\n    }\n  }\n\n  /**\n   * Migrate from older schema versions\n   */\n  migrateSchema(oldData) {\n    // Handle migration from simple array format\n    if (Array.isArray(oldData)) {\n      return oldData.map(model => ({\n        ...model,\n        currency: model.currency || 'USD',\n        created: model.created || model.updated || new Date().toISOString()\n      }));\n    }\n\n    return oldData.models || [];\n  }\n\n  /**\n   * Add change listener\n   */\n  subscribe(listener) {\n    this.listeners.add(listener);\n    return () => this.listeners.delete(listener);\n  }\n\n  /**\n   * Notify all listeners of changes\n   */\n  notifyListeners() {\n    this.listeners.forEach(listener => listener(this.models));\n  }\n\n  /**\n   * List all models\n   */\n  list() {\n    return [...this.models];\n  }\n\n  /**\n   * Get model by ID\n   */\n  get(id) {\n    return this.models.find(m => m.id === id);\n  }\n\n  /**\n   * Save or update model\n   */\n  save(model) {\n    const now = new Date().toISOString();\n    const existingIndex = this.models.findIndex(m => m.id === model.id);\n\n    const updatedModel = {\n      ...model,\n      updated: now,\n      // Set created timestamp for new models\n      created: model.created || now\n    };\n\n    if (existingIndex >= 0) {\n      this.models[existingIndex] = updatedModel;\n    } else {\n      this.models.push(updatedModel);\n    }\n\n    this.saveToStorage();\n    return updatedModel;\n  }\n\n  /**\n   * Delete model by ID\n   */\n  delete(id) {\n    const initialLength = this.models.length;\n    this.models = this.models.filter(m => m.id !== id);\n\n    if (this.models.length < initialLength) {\n      this.saveToStorage();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Clone existing model\n   */\n  clone(id) {\n    const original = this.get(id);\n    if (!original) return null;\n\n    const cloned = {\n      ...original,\n      id: generateId(),\n      name: `${original.name} (Copy)`,\n      version: 'v1.0',\n      created: new Date().toISOString(),\n      updated: new Date().toISOString(),\n      selected: false\n    };\n\n    return this.save(cloned);\n  }\n\n  /**\n   * Bump model version\n   */\n  bumpVersion(id, changeReason = '') {\n    const model = this.get(id);\n    if (!model) return null;\n\n    const updated = {\n      ...model,\n      version: bumpVersion(model.version),\n      updated: new Date().toISOString()\n    };\n\n    return this.save(updated);\n  }\n\n  /**\n   * Export models to JSON\n   */\n  export(ids = null) {\n    const modelsToExport = ids ?\n      this.models.filter(m => ids.includes(m.id)) :\n      this.models;\n\n    const exportData = {\n      schemaVersion: SCHEMA_VERSION,\n      exportedAt: new Date().toISOString(),\n      models: modelsToExport\n    };\n\n    const jsonString = JSON.stringify(exportData, null, 2);\n    const blob = new Blob([jsonString], { type: 'application/json' });\n    return blob;\n  }\n\n  /**\n   * Import models from JSON\n   */\n  import(jsonData) {\n    try {\n      const data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;\n\n      // Validate import data\n      if (!data.models || !Array.isArray(data.models)) {\n        throw new Error('Invalid import format: missing models array');\n      }\n\n      const importedModels = [];\n      const now = new Date().toISOString();\n\n      for (const modelData of data.models) {\n        // Generate new ID to avoid conflicts\n        const imported = {\n          ...modelData,\n          id: generateId(),\n          created: now,\n          updated: now,\n          // Mark as imported\n          tags: [...(modelData.tags || []), 'imported']\n        };\n\n        // Validate required fields\n        if (!imported.kind || !imported.name || !imported.assumptions) {\n          console.warn('Skipping invalid model:', imported);\n          continue;\n        }\n\n        this.models.push(imported);\n        importedModels.push(imported);\n      }\n\n      if (importedModels.length > 0) {\n        this.saveToStorage();\n      }\n\n      return importedModels;\n    } catch (error) {\n      console.error('Error importing models:', error);\n      throw new Error(`Import failed: ${error.message}`);\n    }\n  }\n\n  /**\n   * Search models by query\n   */\n  search(query, tag = null) {\n    const lowerQuery = query.toLowerCase();\n    return this.models.filter(model => {\n      const matchesQuery = !query ||\n        model.name.toLowerCase().includes(lowerQuery) ||\n        model.tags.some(t => t.toLowerCase().includes(lowerQuery));\n\n      const matchesTag = !tag || model.tags.includes(tag);\n\n      return matchesQuery && matchesTag;\n    });\n  }\n\n  /**\n   * Get all unique tags\n   */\n  getAllTags() {\n    const tags = new Set();\n    this.models.forEach(model => {\n      model.tags.forEach(tag => tags.add(tag));\n    });\n    return Array.from(tags).sort();\n  }\n\n  /**\n   * Create model from template\n   */\n  createFromTemplate(kind, name = null) {\n    const model = createDefaultModel(kind);\n    if (name) model.name = name;\n    return this.save(model);\n  }\n\n  /**\n   * Clear all models (with confirmation in UI)\n   */\n  clear() {\n    this.models = [];\n    this.saveToStorage();\n  }\n\n  /**\n   * Get storage statistics\n   */\n  getStats() {\n    const totalSize = localStorage.getItem(STORAGE_KEY)?.length || 0;\n    const modelCounts = {};\n\n    this.models.forEach(model => {\n      modelCounts[model.kind] = (modelCounts[model.kind] || 0) + 1;\n    });\n\n    return {\n      totalModels: this.models.length,\n      storageSize: totalSize,\n      modelCounts,\n      lastUpdated: this.models.length > 0 ?\n        Math.max(...this.models.map(m => new Date(m.updated).getTime())) : null\n    };\n  }\n}\n\n// Export singleton instance\nexport const modelStore = new ModelStore();\n\n// Export class for testing\nexport { ModelStore };\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useSearchParams } from 'react-router-dom';\n\nimport { modelStore } from '../../services/modelStore';\n\nconst Card = ({ title, right, children, className = '' }) => (\n  <section className={`rounded-2xl border border-slate-200 bg-white shadow-sm ${className}`}>\n    {(title || right) && (\n      <header className=\"flex items-center justify-between border-b border-slate-200 px-4 py-2.5\">\n        {title && <h3 className=\"text-[13px] font-semibold tracking-wide text-slate-700\">{title}</h3>}\n        {right}\n      </header>\n    )}\n    <div className=\"p-4\">{children}</div>\n  </section>\n);\n\nconst Pill = ({ children, tone = 'slate' }) => {\n  const tones = {\n    slate: 'bg-slate-50 text-slate-700 border-slate-200',\n    blue: 'bg-blue-50 text-blue-700 border-blue-200',\n    amber: 'bg-amber-50 text-amber-700 border-amber-200',\n    green: 'bg-emerald-50 text-emerald-700 border-emerald-200',\n    red: 'bg-rose-50 text-rose-700 border-rose-200'\n  };\n  return (\n    <span className={`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] ${tones[tone]}`}>\n      {children}\n    </span>\n  );\n};\n\nconst EnhancedLibrary = ({ models, setModels, onSelect, selectedModelId }) => {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [q, setQ] = useState(searchParams.get('q') || '');\n  const [tag, setTag] = useState(searchParams.get('tag') || '');\n  const [sortBy, setSortBy] = useState(searchParams.get('sort') || 'updated');\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [deleteConfirm, setDeleteConfirm] = useState(null);\n  const [showImportModal, setShowImportModal] = useState(false);\n\n  const searchInputRef = useRef(null);\n  const modelListRef = useRef(null);\n  const fileInputRef = useRef(null);\n\n  const tags = Array.from(new Set(models.flatMap(m => m.tags))).sort();\n\n  // URL state management\n  useEffect(() => {\n    const params = new URLSearchParams();\n    if (q) params.set('q', q);\n    if (tag) params.set('tag', tag);\n    if (sortBy !== 'updated') params.set('sort', sortBy);\n\n    const selectedIds = models.filter(m => m.selected).map(m => m.id);\n    if (selectedIds.length > 0) params.set('compare', selectedIds.join(','));\n\n    setSearchParams(params, { replace: true });\n  }, [q, tag, sortBy, models, setSearchParams]);\n\n  // Restore compare selection from URL\n  useEffect(() => {\n    const compareIds = searchParams.get('compare')?.split(',') || [];\n    if (compareIds.length > 0) {\n      setModels(models.map(m => ({ ...m, selected: compareIds.includes(m.id) })));\n    }\n  }, []); // Only run once on mount\n\n  // Filter and sort models\n  const filteredModels = models\n    .filter(m => {\n      const matchesQuery = !q || m.name.toLowerCase().includes(q.toLowerCase()) ||\n                          m.tags.some(t => t.toLowerCase().includes(q.toLowerCase()));\n      const matchesTag = !tag || m.tags.includes(tag);\n      return matchesQuery && matchesTag;\n    })\n    .sort((a, b) => {\n      switch (sortBy) {\n        case 'name': return a.name.localeCompare(b.name);\n        case 'kind': return a.kind.localeCompare(b.kind);\n        case 'updated': return new Date(b.updated) - new Date(a.updated);\n        default: return 0;\n      }\n    });\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (document.activeElement === searchInputRef.current) {\n        if (e.key === 'Escape') {\n          searchInputRef.current.blur();\n          setSelectedIndex(0);\n        }\n        return;\n      }\n\n      switch (e.key) {\n        case 'ArrowUp':\n          e.preventDefault();\n          setSelectedIndex(i => Math.max(0, i - 1));\n          break;\n        case 'ArrowDown':\n          e.preventDefault();\n          setSelectedIndex(i => Math.min(filteredModels.length - 1, i + 1));\n          break;\n        case 'Enter':\n          e.preventDefault();\n          if (filteredModels[selectedIndex]) {\n            onSelect(filteredModels[selectedIndex].id);\n          }\n          break;\n        case ' ':\n          e.preventDefault();\n          if (filteredModels[selectedIndex]) {\n            toggleSelection(filteredModels[selectedIndex]);\n          }\n          break;\n        case 'k':\n          if (e.metaKey || e.ctrlKey) {\n            e.preventDefault();\n            searchInputRef.current?.focus();\n          }\n          break;\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [selectedIndex, filteredModels, onSelect]);\n\n  // Actions\n  const toggleSelection = useCallback((model) => {\n    setModels(models.map(m => m.id === model.id ? { ...m, selected: !m.selected } : m));\n  }, [models, setModels]);\n\n  const deleteModel = useCallback((model) => {\n    if (deleteConfirm === model.id) {\n      modelStore.delete(model.id);\n      setModels(models.filter(m => m.id !== model.id));\n      setDeleteConfirm(null);\n    } else {\n      setDeleteConfirm(model.id);\n    }\n  }, [models, setModels, deleteConfirm]);\n\n  const cloneModel = useCallback((model) => {\n    const cloned = modelStore.clone(model.id);\n    if (cloned) {\n      setModels([cloned, ...models]);\n      onSelect(cloned.id);\n    }\n  }, [models, setModels, onSelect]);\n\n  const bumpVersion = useCallback((model) => {\n    const updated = modelStore.bumpVersion(model.id);\n    if (updated) {\n      setModels(models.map(m => m.id === model.id ? updated : m));\n    }\n  }, [models, setModels]);\n\n  const exportModels = useCallback((selectedOnly = false) => {\n    const idsToExport = selectedOnly ?\n      models.filter(m => m.selected).map(m => m.id) :\n      null;\n\n    const blob = modelStore.export(idsToExport);\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `valor-models-${new Date().toISOString().split('T')[0]}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }, [models]);\n\n  const handleImport = useCallback((file) => {\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const imported = modelStore.import(e.target.result);\n        setModels([...imported, ...models]);\n        setShowImportModal(false);\n        // Show success message\n        console.log(`Imported ${imported.length} models successfully`);\n      } catch (error) {\n        console.error('Import failed:', error);\n        alert(`Import failed: ${error.message}`);\n      }\n    };\n    reader.readAsText(file);\n  }, [models, setModels]);\n\n  return (\n    <>\n      <Card\n        title=\"Model Library\"\n        right={\n          <div className=\"flex items-center gap-2\">\n            <Pill tone=\"blue\">{models.filter(m => m.selected).length} selected</Pill>\n            <Pill tone=\"slate\">{filteredModels.length} / {models.length}</Pill>\n          </div>\n        }\n      >\n        {/* Search and Filter Controls */}\n        <div className=\"mb-3 grid grid-cols-4 items-end gap-2\">\n          <label className=\"col-span-2 text-[12px]\">\n            <span className=\"mb-1 block text-slate-600\">Search (⌘K)</span>\n            <input\n              ref={searchInputRef}\n              value={q}\n              onChange={(e) => setQ(e.target.value)}\n              placeholder=\"Name or tag…\"\n              className=\"w-full rounded-md border border-slate-300 bg-white px-2 py-1 focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\n            />\n          </label>\n          <label className=\"text-[12px]\">\n            <span className=\"mb-1 block text-slate-600\">Filter tag</span>\n            <select\n              value={tag}\n              onChange={(e) => setTag(e.target.value)}\n              className=\"w-full rounded-md border border-slate-300 bg-white px-2 py-1\"\n            >\n              <option value=\"\">All</option>\n              {tags.map(t => <option key={t} value={t}>{t}</option>)}\n            </select>\n          </label>\n          <label className=\"text-[12px]\">\n            <span className=\"mb-1 block text-slate-600\">Sort by</span>\n            <select\n              value={sortBy}\n              onChange={(e) => setSortBy(e.target.value)}\n              className=\"w-full rounded-md border border-slate-300 bg-white px-2 py-1\"\n            >\n              <option value=\"updated\">Updated</option>\n              <option value=\"name\">Name</option>\n              <option value=\"kind\">Kind</option>\n            </select>\n          </label>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"mb-3 flex items-center gap-2 text-[12px]\">\n          <button\n            onClick={() => exportModels(false)}\n            className=\"rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50 transition-colors\"\n          >\n            Export All\n          </button>\n          <button\n            onClick={() => exportModels(true)}\n            disabled={models.filter(m => m.selected).length === 0}\n            className=\"rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50 transition-colors disabled:opacity-50\"\n          >\n            Export Selected\n          </button>\n          <button\n            onClick={() => setShowImportModal(true)}\n            className=\"rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50 transition-colors\"\n          >\n            Import\n          </button>\n        </div>\n\n        {/* Model List */}\n        <div className=\"text-[11px] text-slate-500 mb-2\">\n          Use ↑/↓ to navigate, Enter to open, Space to select\n        </div>\n\n        <ul ref={modelListRef} className=\"grid grid-cols-1 gap-2 max-h-96 overflow-y-auto\">\n          {filteredModels.map((m, index) => (\n            <li\n              key={m.id}\n              className={`flex items-center justify-between rounded-xl border p-3 transition-colors\n                ${selectedModelId === m.id ? 'border-blue-500 bg-blue-50' : 'border-slate-200'}\n                ${selectedIndex === index ? 'ring-2 ring-blue-200' : ''}\n                ${deleteConfirm === m.id ? 'border-red-300 bg-red-50' : ''}\n              `}\n            >\n              <div className=\"flex flex-col\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-[13px] font-semibold text-slate-800\">{m.name}</span>\n                  <Pill tone=\"amber\">{m.version}</Pill>\n                  <Pill tone=\"slate\">{m.kind}</Pill>\n                  {m.selected && <Pill tone=\"green\">Compare</Pill>}\n                  {m.tags.includes('imported') && <Pill tone=\"blue\">Imported</Pill>}\n                </div>\n                <div className=\"text-[11px] text-slate-500\">\n                  Updated {new Date(m.updated).toLocaleString()} • {m.tags.map(t => <span key={t} className=\"mr-1\">#{t}</span>)}\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={() => onSelect(m.id)}\n                  className=\"rounded-md border border-slate-200 bg-white px-2 py-1 text-[12px] hover:bg-slate-50 transition-colors\"\n                >\n                  Edit\n                </button>\n                <button\n                  onClick={() => toggleSelection(m)}\n                  className=\"rounded-md border border-slate-200 bg-white px-2 py-1 text-[12px] hover:bg-slate-50 transition-colors\"\n                >\n                  {m.selected ? 'Unselect' : 'Select'}\n                </button>\n                <button\n                  onClick={() => cloneModel(m)}\n                  className=\"rounded-md border border-slate-200 bg-white px-2 py-1 text-[12px] hover:bg-slate-50 transition-colors\"\n                >\n                  Clone\n                </button>\n                <button\n                  onClick={() => bumpVersion(m)}\n                  className=\"rounded-md border border-slate-200 bg-white px-2 py-1 text-[12px] hover:bg-slate-50 transition-colors\"\n                >\n                  Bump\n                </button>\n                <button\n                  onClick={() => deleteModel(m)}\n                  className={`text-[12px] transition-colors ${\n                    deleteConfirm === m.id\n                      ? 'text-red-700 font-semibold'\n                      : 'text-rose-600 hover:text-rose-700'\n                  }`}\n                >\n                  {deleteConfirm === m.id ? 'Confirm?' : 'Delete'}\n                </button>\n              </div>\n            </li>\n          ))}\n        </ul>\n\n        {filteredModels.length === 0 && (\n          <div className=\"text-center text-slate-500 py-8\">\n            {q || tag ? 'No models match your search criteria' : 'No models created yet'}\n          </div>\n        )}\n      </Card>\n\n      {/* Import Modal */}\n      {showImportModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4\">\n            <h3 className=\"text-lg font-semibold mb-4\">Import Models</h3>\n            <p className=\"text-sm text-slate-600 mb-4\">\n              Select a JSON file exported from Model Lab to import models.\n            </p>\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\".json\"\n              onChange={(e) => {\n                const file = e.target.files[0];\n                if (file) handleImport(file);\n              }}\n              className=\"w-full mb-4\"\n            />\n            <div className=\"flex justify-end gap-2\">\n              <button\n                onClick={() => setShowImportModal(false)}\n                className=\"px-4 py-2 text-sm border border-slate-300 rounded-md hover:bg-slate-50\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default EnhancedLibrary;\n","import React from 'react';\n\nimport { templates } from '../../utils/modelLabCalculations';\n\nconst Card = ({ title, right, children, className = '' }) => (\n  <section className={`rounded-2xl border border-slate-200 bg-white shadow-sm ${className}`}>\n    {(title || right) && (\n      <header className=\"flex items-center justify-between border-b border-slate-200 px-4 py-2.5\">\n        {title && <h3 className=\"text-[13px] font-semibold tracking-wide text-slate-700\">{title}</h3>}\n        {right}\n      </header>\n    )}\n    <div className=\"p-4\">{children}</div>\n  </section>\n);\n\nconst Tag = ({ t }) => (\n  <span className=\"rounded-full border border-slate-200 bg-slate-50 px-2 py-[2px] text-[11px] text-slate-700\">\n    {t}\n  </span>\n);\n\nconst TemplateGallery = ({ onUse }) => {\n  return (\n    <Card title=\"Template Gallery\">\n      <div className=\"grid grid-cols-2 gap-3\">\n        {templates.map(t => (\n          <div key={t.kind} className=\"rounded-xl border border-slate-200 p-3\">\n            <div className=\"mb-1 text-[13px] font-semibold text-slate-800\">{t.title}</div>\n            <div className=\"mb-2 text-[12px] text-slate-600\">{t.description}</div>\n            <div className=\"mb-2 flex flex-wrap gap-1\">\n              {t.tags.map(x => <Tag key={x} t={x} />)}\n            </div>\n            <button\n              onClick={() => onUse(t.kind)}\n              className=\"rounded-md border border-slate-200 bg-white px-2 py-1 text-[12px] hover:bg-slate-50 transition-colors\"\n            >\n              Use Template\n            </button>\n          </div>\n        ))}\n      </div>\n    </Card>\n  );\n};\n\nexport default TemplateGallery;\n","import React from 'react';\n\nconst Card = ({ title, right, children, className = '' }) => (\n  <section className={`rounded-2xl border border-slate-200 bg-white shadow-sm ${className}`}>\n    {(title || right) && (\n      <header className=\"flex items-center justify-between border-b border-slate-200 px-4 py-2.5\">\n        {title && <h3 className=\"text-[13px] font-semibold tracking-wide text-slate-700\">{title}</h3>}\n        {right}\n      </header>\n    )}\n    <div className=\"p-4\">{children}</div>\n  </section>\n);\n\nconst TestsPanel = ({ tests }) => {\n  return (\n    <Card title=\"Dev / Sanity Tests\">\n      <ul className=\"space-y-1 text-[13px]\">\n        {tests.map(t => (\n          <li key={t.name} className=\"flex items-center justify-between\">\n            <span className=\"text-slate-700\">{t.name}</span>\n            <span className={`ml-2 ${t.pass ? 'text-emerald-600' : 'text-rose-600'}`}>\n              {t.pass ? 'PASS' : 'FAIL'}\n            </span>\n          </li>\n        ))}\n      </ul>\n    </Card>\n  );\n};\n\nexport default TestsPanel;\n","// Calculator Plugin System for Model Lab\n\n/**\n * DCF Calculator Plugin\n */\nconst DCFCalculator = {\n  kind: 'DCF',\n\n  compute(assumptions, config = {}) {\n    const a = assumptions;\n    const warnings = [];\n\n    // Extract key assumptions with defaults\n    const rev0 = a.rev0 || 0;\n    const margin = a.margin || 0.15;\n    const tax = a.tax || 0.23;\n    const g = a.g || 0.05;\n    const tg = a.tg || 0.02;\n    const wacc = a.wacc || 0.09;\n    const netDebt = a.netDebt || 0;\n    const shares = Math.max(1, a.shares || 1);\n\n    // Gordon growth model guard\n    if (wacc <= tg) {\n      warnings.push('WACC must be greater than terminal growth rate');\n      return { warnings };\n    }\n\n    // Calculate EBIT and NOPAT\n    const EBIT = rev0 * margin;\n    const NOPAT0 = EBIT * (1 - tax);\n\n    // 5-year DCF projection\n    const years = 5;\n    let pv = 0;\n    let fcff = NOPAT0;\n\n    for (let t = 1; t <= years; t++) {\n      fcff = fcff * (1 + g);\n      pv += fcff / Math.pow(1 + wacc, t);\n    }\n\n    // Terminal value calculation\n    const fcff5 = fcff;\n    const tv = (fcff5 * (1 + tg)) / (wacc - tg);\n    const pvTV = tv / Math.pow(1 + wacc, years);\n\n    // Final valuation\n    const ev = pv + pvTV;\n    const equity = ev - netDebt;\n    const perShare = equity / shares;\n\n    // Add warnings for edge cases\n    if (ev < 0) warnings.push('Negative enterprise value - check assumptions');\n    if (perShare < 0) warnings.push('Negative per-share value - high net debt relative to EV');\n    if (tv / ev > 0.8) warnings.push('Terminal value >80% of EV - consider longer projection period');\n\n    return { ev, perShare, warnings };\n  },\n\n  validate(assumptions) {\n    const issues = [];\n    const a = assumptions;\n\n    // Required fields\n    if (!a.rev0 || a.rev0 <= 0) issues.push({ field: 'rev0', level: 'error', message: 'Revenue must be positive' });\n    if (!a.shares || a.shares <= 0) issues.push({ field: 'shares', level: 'error', message: 'Shares outstanding must be positive' });\n\n    // Range validations\n    if (a.margin < 0 || a.margin > 0.6) issues.push({ field: 'margin', level: 'warn', message: 'EBIT margin outside typical range (0-60%)' });\n    if (a.tax < 0 || a.tax > 0.6) issues.push({ field: 'tax', level: 'warn', message: 'Tax rate outside typical range (0-60%)' });\n    if (a.wacc < 0.02 || a.wacc > 0.25) issues.push({ field: 'wacc', level: 'warn', message: 'WACC outside typical range (2-25%)' });\n    if (a.g < -0.2 || a.g > 0.2) issues.push({ field: 'g', level: 'warn', message: 'Growth rate outside typical range (-20% to +20%)' });\n    if (a.tg < -0.02 || a.tg > 0.05) issues.push({ field: 'tg', level: 'warn', message: 'Terminal growth outside typical range (-2% to +5%)' });\n\n    // Domain rules\n    if (a.wacc <= a.tg) issues.push({ field: 'wacc', level: 'error', message: 'WACC must be greater than terminal growth rate' });\n\n    return issues;\n  }\n};\n\n/**\n * Comps Calculator Plugin\n */\nconst CompsCalculator = {\n  kind: 'Comps',\n\n  compute(assumptions, config = {}) {\n    const a = assumptions;\n    const warnings = [];\n\n    const metric = a.metric || 0;\n    const multiple = a.multiple || 8;\n    const netDebt = a.netDebt || 0;\n    const shares = Math.max(1, a.shares || 1);\n\n    if (metric <= 0) {\n      warnings.push('Metric (EBITDA) must be positive for meaningful valuation');\n      return { warnings };\n    }\n\n    const ev = multiple * metric;\n    const equity = ev - netDebt;\n    const perShare = equity / shares;\n\n    if (perShare < 0) warnings.push('Negative per-share value - high net debt relative to EV');\n    if (multiple < 3 || multiple > 30) warnings.push('Multiple outside typical range (3x-30x)');\n\n    return { ev, perShare, warnings };\n  },\n\n  validate(assumptions) {\n    const issues = [];\n    const a = assumptions;\n\n    if (!a.metric || a.metric <= 0) issues.push({ field: 'metric', level: 'error', message: 'Metric must be positive' });\n    if (!a.multiple || a.multiple <= 0) issues.push({ field: 'multiple', level: 'error', message: 'Multiple must be positive' });\n    if (!a.shares || a.shares <= 0) issues.push({ field: 'shares', level: 'error', message: 'Shares outstanding must be positive' });\n\n    if (a.multiple < 2 || a.multiple > 40) issues.push({ field: 'multiple', level: 'warn', message: 'Multiple outside typical range (2x-40x)' });\n\n    return issues;\n  }\n};\n\n/**\n * EPV Calculator Plugin\n */\nconst EPVCalculator = {\n  kind: 'EPV',\n\n  compute(assumptions, config = {}) {\n    const a = assumptions;\n    const warnings = [];\n\n    const ebit = a.ebit || 0;\n    const tax = a.tax || 0.23;\n    const wacc = Math.max(0.02, a.wacc || 0.09);\n    const netDebt = a.netDebt || 0;\n    const shares = Math.max(1, a.shares || 1);\n\n    if (ebit <= 0) {\n      warnings.push('EBIT must be positive for EPV calculation');\n      return { warnings };\n    }\n\n    const nopat = ebit * (1 - tax);\n    const ev = nopat / wacc;\n    const equity = ev - netDebt;\n    const perShare = equity / shares;\n\n    if (perShare < 0) warnings.push('Negative per-share value - high net debt relative to EV');\n    if (wacc < 0.05) warnings.push('Very low WACC may overstate EPV');\n\n    return { ev, perShare, warnings };\n  },\n\n  validate(assumptions) {\n    const issues = [];\n    const a = assumptions;\n\n    if (!a.ebit || a.ebit <= 0) issues.push({ field: 'ebit', level: 'error', message: 'EBIT must be positive' });\n    if (!a.shares || a.shares <= 0) issues.push({ field: 'shares', level: 'error', message: 'Shares outstanding must be positive' });\n\n    if (a.tax < 0 || a.tax > 0.6) issues.push({ field: 'tax', level: 'warn', message: 'Tax rate outside typical range (0-60%)' });\n    if (a.wacc < 0.02 || a.wacc > 0.25) issues.push({ field: 'wacc', level: 'warn', message: 'WACC outside typical range (2-25%)' });\n\n    return issues;\n  }\n};\n\n/**\n * LBO Calculator Plugin\n */\nconst LBOCalculator = {\n  kind: 'LBO',\n\n  compute(assumptions, config = {}) {\n    const a = assumptions;\n    const warnings = [];\n\n    const ebitda0 = a.ebitda || 0;\n    const entryX = a.entryX || 8;\n    const exitX = a.exitX || 8;\n    const debtPct = Math.min(0.9, Math.max(0, a.debtPct || 0.5));\n    const years = Math.max(1, Math.min(10, Math.round(a.years || 5)));\n    const ebitdaCAGR = a.ebitdaCAGR || 0.05;\n\n    if (ebitda0 <= 0) {\n      warnings.push('EBITDA must be positive for LBO analysis');\n      return { warnings };\n    }\n\n    // Entry valuation\n    const entryEV = ebitda0 * entryX;\n    const debt0 = entryEV * debtPct;\n    const equity0 = Math.max(1, entryEV - debt0);\n\n    // Exit valuation\n    const ebitdaN = ebitda0 * Math.pow(1 + ebitdaCAGR, years);\n    const exitEV = ebitdaN * exitX;\n\n    // Simplified debt paydown (10% per year from FCF)\n    const debtN = Math.max(0, debt0 * Math.pow(0.9, years));\n    const exitEquity = Math.max(1, exitEV - debtN);\n\n    // Returns calculation\n    const moic = exitEquity / equity0;\n    const irr = Math.max(-0.99, Math.pow(moic, 1 / years) - 1);\n\n    // Warnings\n    if (irr < 0.15) warnings.push('IRR below typical PE target (15%+)');\n    if (debtPct > 0.7) warnings.push('High leverage ratio may increase risk');\n    if (entryX > exitX + 2) warnings.push('Entry multiple significantly higher than exit - check assumptions');\n\n    return { irr, warnings };\n  },\n\n  validate(assumptions) {\n    const issues = [];\n    const a = assumptions;\n\n    if (!a.ebitda || a.ebitda <= 0) issues.push({ field: 'ebitda', level: 'error', message: 'EBITDA must be positive' });\n    if (!a.entryX || a.entryX <= 0) issues.push({ field: 'entryX', level: 'error', message: 'Entry multiple must be positive' });\n    if (!a.exitX || a.exitX <= 0) issues.push({ field: 'exitX', level: 'error', message: 'Exit multiple must be positive' });\n\n    if (a.debtPct < 0 || a.debtPct > 0.9) issues.push({ field: 'debtPct', level: 'error', message: 'Debt percentage must be between 0-90%' });\n    if (a.years < 1 || a.years > 10) issues.push({ field: 'years', level: 'error', message: 'Hold period must be 1-10 years' });\n\n    if (a.entryX < 2 || a.entryX > 30) issues.push({ field: 'entryX', level: 'warn', message: 'Entry multiple outside typical range (2x-30x)' });\n    if (a.exitX < 2 || a.exitX > 30) issues.push({ field: 'exitX', level: 'warn', message: 'Exit multiple outside typical range (2x-30x)' });\n    if (a.ebitdaCAGR < -0.3 || a.ebitdaCAGR > 0.5) issues.push({ field: 'ebitdaCAGR', level: 'warn', message: 'EBITDA growth outside typical range (-30% to +50%)' });\n\n    return issues;\n  }\n};\n\n/**\n * Plugin Registry\n */\nexport const plugins = {\n  DCF: DCFCalculator,\n  Comps: CompsCalculator,\n  EPV: EPVCalculator,\n  LBO: LBOCalculator\n};\n\n/**\n * Compute outputs for a model using appropriate plugin\n */\nexport function computeModelOutputs(model) {\n  const plugin = plugins[model.kind];\n  if (!plugin) {\n    console.warn(`No calculator plugin found for model kind: ${model.kind}`);\n    return { warnings: [`No calculator available for ${model.kind}`] };\n  }\n\n  try {\n    return plugin.compute(model.assumptions);\n  } catch (error) {\n    console.error(`Calculator error for ${model.kind}:`, error);\n    return { warnings: [`Calculation error: ${error.message}`] };\n  }\n}\n\n/**\n * Validate model assumptions using appropriate plugin\n */\nexport function validateModelAssumptions(model) {\n  const plugin = plugins[model.kind];\n  if (!plugin || !plugin.validate) {\n    return [];\n  }\n\n  try {\n    return plugin.validate(model.assumptions);\n  } catch (error) {\n    console.error(`Validation error for ${model.kind}:`, error);\n    return [{ field: 'general', level: 'error', message: `Validation error: ${error.message}` }];\n  }\n}\n","import React, { useState, useEffect, useCallback, useMemo } from 'react';\n\nimport { validateModelAssumptions } from '../../services/calculators';\nimport { templates } from '../../utils/modelLabCalculations';\n\nconst Card = ({ title, right, children, className = '' }) => (\n  <section className={`rounded-2xl border border-slate-200 bg-white shadow-sm ${className}`}>\n    {(title || right) && (\n      <header className=\"flex items-center justify-between border-b border-slate-200 px-4 py-2.5\">\n        {title && <h3 className=\"text-[13px] font-semibold tracking-wide text-slate-700\">{title}</h3>}\n        {right}\n      </header>\n    )}\n    <div className=\"p-4\">{children}</div>\n  </section>\n);\n\nconst Pill = ({ children, tone = 'slate' }) => {\n  const tones = {\n    slate: 'bg-slate-50 text-slate-700 border-slate-200',\n    blue: 'bg-blue-50 text-blue-700 border-blue-200',\n    amber: 'bg-amber-50 text-amber-700 border-amber-200',\n    green: 'bg-emerald-50 text-emerald-700 border-emerald-200',\n    red: 'bg-rose-50 text-rose-700 border-rose-200'\n  };\n  return (\n    <span className={`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] ${tones[tone]}`}>\n      {children}\n    </span>\n  );\n};\n\nconst clamp = (x, a, b) => Math.max(a, Math.min(b, x));\n\nfunction ValidatedNumberInput({\n  label,\n  value,\n  onChange,\n  suffix,\n  step = 0.01,\n  min,\n  max,\n  fieldKey,\n  validationIssues = [],\n  onFocus,\n  onBlur,\n  isDirty = false\n}) {\n  const [localValue, setLocalValue] = useState(value);\n  const [isFocused, setIsFocused] = useState(false);\n\n  const issues = validationIssues.filter(issue => issue.field === fieldKey);\n  const hasError = issues.some(issue => issue.level === 'error');\n  const hasWarning = issues.some(issue => issue.level === 'warn');\n\n  useEffect(() => {\n    setLocalValue(value);\n  }, [value]);\n\n  const handleChange = (e) => {\n    const newValue = parseFloat(e.target.value || '0');\n    setLocalValue(newValue);\n    const clampedValue = clamp(newValue, min ?? -Infinity, max ?? Infinity);\n    onChange(clampedValue);\n  };\n\n  const handleFocus = () => {\n    setIsFocused(true);\n    onFocus?.(fieldKey);\n  };\n\n  const handleBlur = () => {\n    setIsFocused(false);\n    onBlur?.(fieldKey);\n  };\n\n  const stepUp = () => onChange(clamp((value || 0) + step, min ?? -Infinity, max ?? Infinity));\n  const stepDown = () => onChange(clamp((value || 0) - step, min ?? -Infinity, max ?? Infinity));\n\n  return (\n    <div className=\"relative\">\n      <label className=\"flex items-center justify-between gap-3 text-[13px]\">\n        <span className={`text-slate-600 ${isDirty ? 'font-medium' : ''}`}>\n          {label}\n          {isDirty && <span className=\"ml-1 text-amber-500\">•</span>}\n        </span>\n        <div className=\"flex items-center gap-1\">\n          <div className=\"relative\">\n            <input\n              type=\"number\"\n              className={`w-32 rounded-md border px-2 py-1 text-right transition-colors\n                ${hasError ? 'border-red-300 bg-red-50 focus:border-red-500 focus:ring-red-200' :\n      hasWarning ? 'border-amber-300 bg-amber-50 focus:border-amber-500 focus:ring-amber-200' :\n        'border-slate-300 bg-white focus:border-blue-500 focus:ring-blue-200'}\n                ${isFocused ? 'ring-2' : ''}\n              `}\n              value={Number((localValue ?? 0).toFixed(6))}\n              step={step}\n              min={min}\n              max={max}\n              onChange={handleChange}\n              onFocus={handleFocus}\n              onBlur={handleBlur}\n              onKeyDown={(e) => {\n                if (e.key === 'ArrowUp') {\n                  e.preventDefault();\n                  stepUp();\n                } else if (e.key === 'ArrowDown') {\n                  e.preventDefault();\n                  stepDown();\n                } else if (e.shiftKey && e.key === 'ArrowUp') {\n                  e.preventDefault();\n                  onChange(clamp((value || 0) + step * 10, min ?? -Infinity, max ?? Infinity));\n                } else if (e.shiftKey && e.key === 'ArrowDown') {\n                  e.preventDefault();\n                  onChange(clamp((value || 0) - step * 10, min ?? -Infinity, max ?? Infinity));\n                }\n              }}\n            />\n            {(hasError || hasWarning) && (\n              <div\n                className={`absolute -right-2 -top-2 w-3 h-3 rounded-full\n                ${hasError ? 'bg-red-500' : 'bg-amber-500'}\n              `}\n              />\n            )}\n          </div>\n          {suffix && <span className=\"text-slate-500\">{suffix}</span>}\n        </div>\n      </label>\n\n      {/* Field-level error/warning messages */}\n      {issues.length > 0 && isFocused && (\n        <div className=\"absolute z-10 mt-1 p-2 bg-white border rounded-md shadow-lg text-[11px] min-w-48\">\n          {issues.map((issue, idx) => (\n            <div key={idx} className={`${issue.level === 'error' ? 'text-red-700' : 'text-amber-700'}`}>\n              {issue.message}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst ValidatedAssumptionsForm = ({\n  model,\n  onChange,\n  onValidationChange,\n  autoSave = true,\n  undoStack = [],\n  onUndo\n}) => {\n  const [validationIssues, setValidationIssues] = useState([]);\n  const [dirtyFields, setDirtyFields] = useState(new Set());\n  const [saveTimeout, setSaveTimeout] = useState(null);\n  const [lastSaved, setLastSaved] = useState(null);\n\n  const tmpl = templates.find(t => t.kind === model.kind);\n\n  // Validate on assumptions change\n  useEffect(() => {\n    const issues = validateModelAssumptions(model);\n    setValidationIssues(issues);\n    onValidationChange?.(issues);\n  }, [model, onValidationChange]);\n\n  // Auto-save with debounce\n  useEffect(() => {\n    if (!autoSave || dirtyFields.size === 0) return;\n\n    if (saveTimeout) clearTimeout(saveTimeout);\n\n    const timeout = setTimeout(() => {\n      setLastSaved(new Date());\n      setDirtyFields(new Set());\n      // Auto-save would call modelStore.save(model) here\n    }, 500);\n\n    setSaveTimeout(timeout);\n    return () => clearTimeout(timeout);\n  }, [model.assumptions, autoSave, dirtyFields.size]);\n\n  const set = useCallback((key) => (value) => {\n    setDirtyFields(prev => new Set(prev).add(key));\n    onChange({ ...model.assumptions, [key]: value });\n  }, [model.assumptions, onChange]);\n\n  // Derived hints calculation\n  const derivedHints = useMemo(() => {\n    const hints = [];\n    const a = model.assumptions;\n\n    if (model.kind === 'DCF' && a.rev0 && a.margin) {\n      const ebit = a.rev0 * a.margin;\n      hints.push(`EBIT: $${(ebit / 1e6).toFixed(0)}M`);\n\n      if (a.wacc && a.tg) {\n        const tvMultiple = 1 / (a.wacc - a.tg);\n        hints.push(`TV Multiple: ${tvMultiple.toFixed(1)}x`);\n      }\n    }\n\n    if (model.kind === 'Comps' && a.metric && a.multiple) {\n      const ev = a.metric * a.multiple;\n      hints.push(`Implied EV: $${(ev / 1e9).toFixed(1)}B`);\n    }\n\n    if (model.outputs?.perShare && a.price) {\n      const mos = ((model.outputs.perShare - a.price) / a.price * 100);\n      hints.push(`MOS: ${mos > 0 ? '+' : ''}${mos.toFixed(1)}%`);\n    }\n\n    return hints;\n  }, [model]);\n\n  // Get validation summary\n  const validationSummary = useMemo(() => {\n    const errors = validationIssues.filter(i => i.level === 'error');\n    const warnings = validationIssues.filter(i => i.level === 'warn');\n    return { errors: errors.length, warnings: warnings.length };\n  }, [validationIssues]);\n\n  if (!tmpl) return null;\n\n  return (\n    <Card\n      title=\"Assumptions\"\n      right={\n        <div className=\"flex items-center gap-2\">\n          <Pill tone=\"slate\">Schema‑driven</Pill>\n          {validationSummary.errors > 0 && <Pill tone=\"red\">{validationSummary.errors} errors</Pill>}\n          {validationSummary.warnings > 0 && <Pill tone=\"amber\">{validationSummary.warnings} warnings</Pill>}\n          {dirtyFields.size > 0 && <Pill tone=\"blue\">Unsaved</Pill>}\n        </div>\n      }\n    >\n      {/* Global validation banner */}\n      {validationSummary.errors > 0 && (\n        <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\n          <div className=\"text-[13px] font-medium text-red-800 mb-1\">\n            {validationSummary.errors} validation error(s) found\n          </div>\n          <div className=\"text-[12px] text-red-700\">\n            Fix errors to enable calculations\n          </div>\n        </div>\n      )}\n\n      {/* Undo button */}\n      {undoStack.length > 0 && (\n        <div className=\"mb-3\">\n          <button\n            onClick={onUndo}\n            className=\"text-[12px] text-blue-600 hover:text-blue-700 underline\"\n          >\n            ↶ Undo ({undoStack.length})\n          </button>\n        </div>\n      )}\n\n      {/* Form fields */}\n      <div className=\"grid grid-cols-2 gap-3\">\n        {tmpl.schema.map(f => (\n          <div key={f.key}>\n            {(f.kind === 'number' || f.kind === 'percent') && (\n              <ValidatedNumberInput\n                label={f.label}\n                value={Number(model.assumptions[f.key] || 0)}\n                onChange={set(f.key)}\n                step={f.step}\n                min={f.min}\n                max={f.max}\n                suffix={f.suffix}\n                fieldKey={f.key}\n                validationIssues={validationIssues}\n                isDirty={dirtyFields.has(f.key)}\n              />\n            )}\n            {f.kind === 'select' && (\n              <label className=\"flex items-center justify-between text-[13px]\">\n                <span className=\"text-slate-600\">{f.label}</span>\n                <select\n                  className=\"rounded-md border border-slate-300 bg-white px-2 py-1\"\n                  value={model.assumptions[f.key] || ''}\n                  onChange={(e) => set(f.key)(e.target.value)}\n                >\n                  {(f.options || []).map(opt => (\n                    <option key={opt} value={opt}>{opt}</option>\n                  ))}\n                </select>\n              </label>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {/* Derived hints */}\n      {derivedHints.length > 0 && (\n        <div className=\"mt-4 p-3 bg-slate-50 rounded-lg\">\n          <div className=\"text-[11px] text-slate-600 mb-1\">Derived Metrics</div>\n          <div className=\"flex flex-wrap gap-2\">\n            {derivedHints.map((hint, idx) => (\n              <span key={idx} className=\"text-[11px] bg-white px-2 py-1 rounded border\">\n                {hint}\n              </span>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Auto-save status */}\n      {autoSave && (\n        <div className=\"mt-3 text-[11px] text-slate-500\">\n          {dirtyFields.size > 0 ? 'Auto-saving...' :\n            lastSaved ? `Last saved: ${lastSaved.toLocaleTimeString()}` :\n              'All changes saved'}\n        </div>\n      )}\n    </Card>\n  );\n};\n\nexport default ValidatedAssumptionsForm;\n","import { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { Pill } from 'src/components/ui/UIHelpers.jsx';\n\nimport Compare from '../components/ModelLab/Compare';\nimport DriverInspector from '../components/ModelLab/DriverInspector';\nimport EnhancedLibrary from '../components/ModelLab/EnhancedLibrary';\nimport TemplateGallery from '../components/ModelLab/TemplateGallery';\nimport TestsPanel from '../components/ModelLab/TestsPanel';\nimport ValidatedAssumptionsForm from '../components/ModelLab/ValidatedAssumptionsForm';\nimport Header from '../components/ui/Header';\nimport { computeModelOutputs } from '../services/calculators';\nimport { modelStore } from '../services/modelStore';\nimport { runTests } from '../utils/modelLabCalculations';\n\nconst ModelLab = () => {\n  const [models, setModels] = useState([]);\n  const [activeId, setActiveId] = useState(null);\n  const [validationIssues, setValidationIssues] = useState([]);\n  const [undoStack, setUndoStack] = useState([]);\n\n  const active = useMemo(() => models.find(m => m.id === activeId), [models, activeId]);\n\n  // Load models from store on mount\n  useEffect(() => {\n    const storedModels = modelStore.list();\n    if (storedModels.length === 0) {\n      // Create default models if none exist\n      const defaultModels = [\n        modelStore.createFromTemplate('DCF', 'DCF Model 1'),\n        modelStore.createFromTemplate('Comps', 'Comps Model 1'),\n        modelStore.createFromTemplate('EPV', 'EPV Model 1'),\n        modelStore.createFromTemplate('LBO', 'LBO Model 1')\n      ];\n      setModels(defaultModels);\n      setActiveId(defaultModels[0]?.id);\n    } else {\n      setModels(storedModels);\n      setActiveId(storedModels[0]?.id);\n    }\n  }, []);\n\n  // Subscribe to model store changes\n  useEffect(() => {\n    const unsubscribe = modelStore.subscribe((updatedModels) => {\n      setModels(updatedModels);\n    });\n    return unsubscribe;\n  }, []);\n\n  const onUseTemplate = useCallback((kind) => {\n    const existing = models.filter(m => m.kind === kind).length;\n    const newModel = modelStore.createFromTemplate(kind, `${kind} Model ${existing + 1}`);\n    setModels([newModel, ...models]);\n    setActiveId(newModel.id);\n  }, [models]);\n\n  const updateActiveAssumptions = useCallback((assumptions) => {\n    if (!active) return;\n\n    // Add to undo stack\n    setUndoStack(prev => [...prev.slice(-4), active.assumptions]); // Keep last 5 states\n\n    const updatedModel = {\n      ...active,\n      assumptions,\n      outputs: computeModelOutputs({ ...active, assumptions }),\n      updated: new Date().toISOString()\n    };\n\n    // Update in store\n    modelStore.save(updatedModel);\n\n    // Update local state\n    setModels(models.map(m => m.id === active.id ? updatedModel : m));\n  }, [active, models]);\n\n  const handleUndo = useCallback(() => {\n    if (undoStack.length === 0 || !active) return;\n\n    const previousAssumptions = undoStack[undoStack.length - 1];\n    setUndoStack(prev => prev.slice(0, -1));\n\n    const restoredModel = {\n      ...active,\n      assumptions: previousAssumptions,\n      outputs: computeModelOutputs({ ...active, assumptions: previousAssumptions }),\n      updated: new Date().toISOString()\n    };\n\n    modelStore.save(restoredModel);\n    setModels(models.map(m => m.id === active.id ? restoredModel : m));\n  }, [undoStack, active, models]);\n\n  const handleValidationChange = useCallback((issues) => {\n    setValidationIssues(issues);\n  }, []);\n\n  const tests = useMemo(() => runTests(), []);\n\n  return (\n    <div className=\"min-h-[100dvh] bg-background text-foreground\">\n      <Header />\n\n      {/* Main Content */}\n      <div className=\"pt-[60px]\">\n        {/* Page Header */}\n        <div className=\"border-b border-border bg-card\">\n          <div className=\"flex items-center justify-between p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex h-8 w-8 items-center justify-center rounded-md bg-primary\">\n                <svg viewBox=\"0 0 24 24\" className=\"h-4 w-4 text-white\">\n                  <path\n                    d=\"M4 6h16M4 12h10M4 18h7\" stroke=\"currentColor\" strokeWidth=\"2\"\n                    fill=\"none\" strokeLinecap=\"round\"\n                  />\n                </svg>\n              </div>\n              <div>\n                <div className=\"text-xs tracking-wide text-muted-foreground\">FinanceAnalyst Pro</div>\n                <div className=\"text-[13px] font-semibold text-foreground\">Model Lab</div>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2 text-[12px]\">\n              <Pill tone=\"blue\">{models.length} models</Pill>\n              <Pill tone=\"green\">Route /model-lab</Pill>\n            </div>\n          </div>\n        </div>\n\n        {/* Main Layout */}\n        <div className=\"p-6\">\n          <div className=\"grid grid-cols-12 gap-6\">\n            {/* Left: Library + Templates */}\n            <div className=\"col-span-12 lg:col-span-4 space-y-4\">\n              <EnhancedLibrary\n                models={models}\n                setModels={setModels}\n                onSelect={setActiveId}\n                selectedModelId={activeId}\n              />\n              <TemplateGallery onUse={onUseTemplate} />\n            </div>\n\n            {/* Center: Assumptions editor for active model */}\n            <div className=\"col-span-12 lg:col-span-5 space-y-4\">\n              {active ? (\n                <>\n                  <div className=\"rounded-2xl border border-border bg-card shadow-sm\">\n                    <div className=\"flex items-center justify-between border-b border-border px-4 py-2.5\">\n                      <h3 className=\"text-[13px] font-semibold tracking-wide text-foreground\">Model Header</h3>\n                      <div className=\"flex items-center gap-2\">\n                        <Pill tone=\"amber\">{active.version}</Pill>\n                        {validationIssues.filter(i => i.level === 'error').length > 0 && (\n                          <Pill tone=\"red\">Blocked</Pill>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"p-4\">\n                      <div className=\"grid grid-cols-2 gap-3 text-[13px]\">\n                        <label className=\"flex items-center justify-between gap-3 text-[13px]\">\n                          <span className=\"text-muted-foreground\">Name</span>\n                          <input\n                            className=\"w-48 rounded-md border border-border bg-background px-2 py-1 text-right text-foreground\"\n                            value={active.name}\n                            onChange={(e) => {\n                              const updatedModel = { ...active, name: e.target.value };\n                              modelStore.save(updatedModel);\n                              setModels(models.map(m => m.id === active.id ? updatedModel : m));\n                            }}\n                          />\n                        </label>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-muted-foreground\">Kind</span>\n                          <span className=\"text-[12px] font-semibold text-foreground\">{active.kind}</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  <ValidatedAssumptionsForm\n                    model={active}\n                    onChange={updateActiveAssumptions}\n                    onValidationChange={handleValidationChange}\n                    autoSave={true}\n                    undoStack={undoStack}\n                    onUndo={handleUndo}\n                  />\n                  <div className=\"rounded-2xl border border-border bg-card shadow-sm\">\n                    <div className=\"flex items-center justify-between border-b border-border px-4 py-2.5\">\n                      <h3 className=\"text-[13px] font-semibold tracking-wide text-foreground\">Quick Outputs</h3>\n                      <div className=\"flex items-center gap-2\">\n                        <Pill tone={validationIssues.filter(i => i.level === 'error').length === 0 ? 'green' : 'red'}>\n                          {validationIssues.filter(i => i.level === 'error').length === 0 ? 'Computed' : 'Blocked'}\n                        </Pill>\n                        {active.outputs?.warnings?.length > 0 && (\n                          <Pill tone=\"amber\">{active.outputs.warnings.length} warnings</Pill>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"p-4\">\n                      {validationIssues.filter(i => i.level === 'error').length > 0 ? (\n                        <div className=\"text-center text-muted-foreground py-4\">\n                          Fix validation errors to see outputs\n                        </div>\n                      ) : (\n                        <>\n                          <div className=\"grid grid-cols-2 gap-3 text-[13px]\">\n                            {active.kind !== 'LBO' ? (\n                              <>\n                                <div className=\"rounded-xl border border-border p-3\">\n                                  <div className=\"text-muted-foreground\">Enterprise Value</div>\n                                  <div className=\"text-lg font-semibold\">\n                                    {active.outputs?.ev !== undefined ?\n                                      (active.outputs.ev >= 1e9 ? `$${(active.outputs.ev / 1e9).toFixed(0)}B` :\n                                        active.outputs.ev >= 1e6 ? `$${(active.outputs.ev / 1e6).toFixed(0)}M` :\n                                          `$${active.outputs.ev.toFixed(0)}`) : '—'}\n                                  </div>\n                                </div>\n                                <div className=\"rounded-xl border border-border p-3\">\n                                  <div className=\"text-muted-foreground\">Per‑share</div>\n                                  <div className=\"text-2xl font-bold\">\n                                    {active.outputs?.perShare !== undefined ? `$${active.outputs.perShare.toFixed(2)}` : '—'}\n                                  </div>\n                                </div>\n                              </>\n                            ) : (\n                              <div className=\"rounded-xl border border-border p-3\">\n                                <div className=\"text-muted-foreground\">Equity IRR (sketch)</div>\n                                <div className=\"text-2xl font-bold\">\n                                  {active.outputs?.irr !== undefined ? `${(100 * active.outputs.irr).toFixed(1)}%` : '—'}\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                          {active.outputs?.warnings?.length > 0 && (\n                            <div className=\"mt-3 p-2 bg-amber-50 border border-amber-200 rounded text-[11px]\">\n                              <div className=\"font-medium text-amber-800 mb-1\">Warnings:</div>\n                              {active.outputs.warnings.map((warning, idx) => (\n                                <div key={idx} className=\"text-amber-700\">{warning}</div>\n                              ))}\n                            </div>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  </div>\n                </>\n              ) : (\n                <div className=\"rounded-2xl border border-border bg-card shadow-sm\">\n                  <div className=\"flex items-center justify-between border-b border-border px-4 py-2.5\">\n                    <h3 className=\"text-[13px] font-semibold tracking-wide text-foreground\">Model Editor</h3>\n                  </div>\n                  <div className=\"p-4\">\n                    <div className=\"text-[12px] text-muted-foreground\">Select a model from the library or create one from a template.</div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Right: Inspector + Compare */}\n            <div className=\"col-span-12 lg:col-span-3 space-y-4\">\n              {active && <DriverInspector model={active} />}\n              <Compare models={models} />\n              <TestsPanel tests={tests} />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ModelLab;\n"],"names":["templates","kind","title","description","tags","schema","key","label","step","min","suffix","max","calcDCF","a","NOPAT0","rev0","margin","tax","g","tg","w","wacc","pv","fcff","t","EV","ev","perShare","netDebt","Math","shares","calcComps","multiple","metric","calcEPV","ebit","computeOutputs","m","assumptions","ebitda0","ebitda","entryEV","entryX","debt0","debtPct","eq0","years","round","exitEV","ebitdaCAGR","exitX","debtN","moic","irr","calcLBO","Card","right","children","className","jsxs","jsx","Pill","tone","slate","blue","amber","green","red","Cur","x","c","toFixed","Pct","d","Compare","models","selected","filter","rows","map","id","name","out","length","r","DriverInspector","model","items","DCF","affects","Comps","EPV","LBO","it","i","join","STORAGE_KEY","SCHEMA_VERSION","generateId","Date","now","toString","random","slice","bumpVersion","currentVersion","match","parseInt","modelStore","constructor","this","loadFromStorage","listeners","Set","stored","localStorage","getItem","data","JSON","parse","schemaVersion","migrateSchema","error","saveToStorage","lastUpdated","toISOString","setItem","stringify","notifyListeners","Error","oldData","Array","isArray","currency","created","updated","subscribe","listener","add","delete","forEach","list","get","find","save","existingIndex","findIndex","updatedModel","push","initialLength","clone","original","cloned","version","changeReason","ids","modelsToExport","includes","exportData","exportedAt","jsonString","Blob","type","import","jsonData","importedModels","modelData","imported","message","search","query","tag","lowerQuery","toLowerCase","matchesQuery","some","matchesTag","getAllTags","from","sort","createFromTemplate","templateData","price","outputs","createDefaultModel","clear","getStats","totalSize","modelCounts","totalModels","storageSize","getTime","EnhancedLibrary","setModels","onSelect","selectedModelId","searchParams","setSearchParams","useSearchParams","q","setQ","useState","setTag","sortBy","setSortBy","selectedIndex","setSelectedIndex","deleteConfirm","setDeleteConfirm","showImportModal","setShowImportModal","searchInputRef","useRef","modelListRef","fileInputRef","flatMap","useEffect","params","URLSearchParams","set","selectedIds","replace","compareIds","split","filteredModels","b","localeCompare","handleKeyDown","e","document","activeElement","current","preventDefault","toggleSelection","metaKey","ctrlKey","focus","blur","addEventListener","removeEventListener","useCallback","deleteModel","cloneModel","exportModels","selectedOnly","idsToExport","blob","export","url","URL","createObjectURL","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","handleImport","file","reader","FileReader","onload","target","result","alert","readAsText","Fragment","ref","value","onChange","placeholder","onClick","disabled","index","toLocaleString","accept","files","Tag","TemplateGallery","onUse","TestsPanel","tests","pass","plugins","compute","config","warnings","pow","tv","validate","issues","field","level","equity0","computeModelOutputs","plugin","clamp","ValidatedNumberInput","fieldKey","validationIssues","onFocus","onBlur","isDirty","localValue","setLocalValue","isFocused","setIsFocused","issue","hasError","hasWarning","Number","newValue","parseFloat","clampedValue","Infinity","onKeyDown","shiftKey","idx","ValidatedAssumptionsForm","onValidationChange","autoSave","undoStack","onUndo","setValidationIssues","dirtyFields","setDirtyFields","saveTimeout","setSaveTimeout","lastSaved","setLastSaved","tmpl","validateModelAssumptions","size","timeout","setTimeout","clearTimeout","prev","derivedHints","useMemo","hints","tvMultiple","mos","validationSummary","errors","f","has","options","opt","hint","toLocaleTimeString","ModelLab","activeId","setActiveId","setUndoStack","active","storedModels","defaultModels","updatedModels","onUseTemplate","existing","newModel","updateActiveAssumptions","handleUndo","previousAssumptions","restoredModel","handleValidationChange","comps","abs","epv","d1","d2","runTests","Header","viewBox","stroke","strokeWidth","fill","strokeLinecap","warning"],"mappings":"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"}