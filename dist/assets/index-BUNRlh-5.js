import{r as e,j as t}from"./react-core-LZql00V9.js";import{I as a,B as n,H as r,e as s}from"./ui-components-B6dtFGFZ.js";import{S as i}from"./valuation-tools-ByCr1zrB.js";import{d as o}from"./dataFetching-BJDQA9FG.js";import{p as c,a as l,s as d,b as m,c as u}from"./persistence-CVb4Ip9D.js";import{f as p,a as g,b as h,c as y,d as A,e as S,g as x}from"./defaultFinancialData-Dvv1HwuD.js";import"./vendor-BUoS_Aj_.js";import"./ui-charts-B2uDbWNs.js";import"./private-analysis-CULRlbZQ.js";import"./animations-PwArlWzR.js";import"./charts-vendor-EG81evMP.js";import"./utils-vendor-DofaKlSJ.js";import"./private-analysis-heavy-DbRFEumZ.js";import"./financial-engines-B7TnAHCU.js";import"./data-vendor-vzM7rUwp.js";const f=({calculations:r,errors:s,warnings:i})=>{const[o,c]=e.useState("calculations"),[l,d]=e.useState(new Set),[m,u]=e.useState("all"),p={calculations:[{id:1,timestamp:new Date(Date.now()-3e5),type:"calculation",operation:"DCF Valuation",formula:"NPV(FCFF_2024:2028, WACC)",result:2547.5,inputs:{FCFF_2024:187.5,FCFF_2025:206.3,FCFF_2026:226.9,FCFF_2027:249.6,FCFF_2028:274.6,WACC:.098},executionTime:.045,status:"success"},{id:2,timestamp:new Date(Date.now()-6e5),type:"calculation",operation:"WACC Calculation",formula:"WACC(cost_equity, cost_debt, tax_rate, debt_ratio)",result:.098,inputs:{cost_equity:.123,cost_debt:.045,tax_rate:.25,debt_ratio:.4},executionTime:.012,status:"success"},{id:3,timestamp:new Date(Date.now()-9e5),type:"calculation",operation:"Terminal Value",formula:"TERMINAL_VALUE(FCF_final, terminal_growth, WACC)",result:1247.3,inputs:{FCF_final:274.6,terminal_growth:.025,WACC:.098},executionTime:.008,status:"success"}],errors:[{id:1,timestamp:new Date(Date.now()-12e5),type:"error",severity:"high",message:"Division by zero in WACC calculation",formula:"WACC(cost_equity, cost_debt, tax_rate, debt_ratio)",location:"Cell B15",suggestion:"Ensure debt_ratio is not equal to 1.0",resolved:!0}],warnings:[{id:1,timestamp:new Date(Date.now()-18e4),type:"warning",severity:"medium",message:"Beta coefficient (1.15) is above industry average (0.95)",formula:"CAPM(risk_free, beta, market_premium)",location:"Assumptions",suggestion:"Consider reviewing beta calculation or using industry average",acknowledged:!1},{id:2,timestamp:new Date(Date.now()-42e4),type:"warning",severity:"low",message:"Terminal growth rate (2.5%) close to discount rate component",formula:"TERMINAL_VALUE(FCF_final, terminal_growth, WACC)",location:"Terminal Value",suggestion:"Ensure terminal growth rate is reasonable for long-term GDP growth",acknowledged:!0}],validations:[{id:1,timestamp:new Date(Date.now()-6e4),type:"validation",check:"Circular Reference Check",status:"passed",details:"No circular references detected in model"},{id:2,timestamp:new Date(Date.now()-12e4),type:"validation",check:"Balance Sheet Check",status:"passed",details:"Assets = Liabilities + Equity for all projection years"},{id:3,timestamp:new Date(Date.now()-24e4),type:"validation",check:"Cash Flow Consistency",status:"warning",details:"Minor rounding differences in cash flow statements (<$0.1M)"}]},g=[{id:"calculations",label:"Calculations",icon:"Calculator",count:p.calculations.length},{id:"errors",label:"Errors",icon:"XCircle",count:p.errors.length},{id:"warnings",label:"Warnings",icon:"AlertTriangle",count:p.warnings.length},{id:"validations",label:"Validations",icon:"CheckCircle",count:p.validations.length}],h=e=>{switch(e){case"success":case"passed":return{icon:"CheckCircle",color:"text-success"};case"error":return{icon:"XCircle",color:"text-destructive"};case"warning":return{icon:"AlertTriangle",color:"text-warning"};default:return{icon:"Info",color:"text-muted-foreground"}}},y=e=>{switch(e){case"high":return"text-destructive bg-destructive/10";case"medium":return"text-warning bg-warning/10";default:return"text-muted-foreground bg-muted"}};return t.jsxs("div",{className:"flex flex-col h-full bg-card",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"FileText",size:20,className:"text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Audit Trail"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(n,{variant:"outline",size:"sm",iconName:"Download",children:"Export Log"}),t.jsx(n,{variant:"outline",size:"sm",iconName:"RefreshCw",children:"Refresh"})]})]}),t.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:g.map(e=>t.jsxs("button",{onClick:()=>c(e.id),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(o===e.id?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[t.jsx(a,{name:e.icon,size:16}),t.jsx("span",{children:e.label}),e.count>0&&t.jsx("span",{className:"px-2 py-1 bg-current/20 rounded-full text-xs",children:e.count})]},e.id))}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(()=>{switch(o){case"calculations":default:return t.jsx("div",{className:"space-y-3",children:p.calculations.map(e=>{return t.jsxs("div",{className:"p-4 bg-background border border-border rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(a,{name:"Calculator",size:16,className:"text-primary"}),t.jsx("span",{className:"font-medium text-foreground",children:e.operation}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${h(e.status).color} bg-current/10`,children:e.status})]}),t.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded font-mono text-foreground block mb-2",children:e.formula}),t.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[t.jsx("span",{children:e.timestamp.toLocaleTimeString()}),t.jsxs("span",{children:["Execution: ",(r=e.executionTime,r<.001?"<1ms":r<1?`${(1e3*r).toFixed(0)}ms`:`${r.toFixed(2)}s`)]}),t.jsxs("span",{children:["Result: $",e.result.toFixed(2),"M"]})]})]}),t.jsx(n,{variant:"ghost",size:"sm",iconName:l.has(e.id)?"ChevronUp":"ChevronDown",onClick:()=>(e=>{const t=new Set(l);t.has(e)?t.delete(e):t.add(e),d(t)})(e.id)})]}),l.has(e.id)&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[t.jsx("h5",{className:"text-sm font-medium text-foreground mb-2",children:"Input Values"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(e.inputs).map(([e,a])=>t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsxs("span",{className:"text-muted-foreground",children:[e,":"]}),t.jsx("span",{className:"text-foreground font-mono",children:"number"==typeof a?a.toFixed(3):a})]},e))})]})]},e.id);var r})});case"errors":return t.jsx("div",{className:"space-y-3",children:p.errors.map(e=>t.jsx("div",{className:"p-4 bg-background border border-destructive/20 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(a,{name:"XCircle",size:16,className:"text-destructive mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("span",{className:"font-medium text-foreground",children:e.message}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${y(e.severity)}`,children:e.severity}),e.resolved&&t.jsx("span",{className:"px-2 py-1 rounded-full text-xs text-success bg-success/10",children:"Resolved"})]}),t.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded font-mono text-foreground block mb-2",children:e.formula}),t.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Location: ",e.location]}),t.jsxs("div",{className:"text-sm text-foreground bg-muted/50 p-2 rounded",children:[t.jsx("strong",{children:"Suggestion:"})," ",e.suggestion]}),t.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:e.timestamp.toLocaleString()})]})]})},e.id))});case"warnings":return t.jsx("div",{className:"space-y-3",children:p.warnings.map(e=>t.jsx("div",{className:"p-4 bg-background border border-warning/20 rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(a,{name:"AlertTriangle",size:16,className:"text-warning mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("span",{className:"font-medium text-foreground",children:e.message}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${y(e.severity)}`,children:e.severity}),e.acknowledged&&t.jsx("span",{className:"px-2 py-1 rounded-full text-xs text-muted-foreground bg-muted",children:"Acknowledged"})]}),t.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded font-mono text-foreground block mb-2",children:e.formula}),t.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Location: ",e.location]}),t.jsxs("div",{className:"text-sm text-foreground bg-muted/50 p-2 rounded",children:[t.jsx("strong",{children:"Suggestion:"})," ",e.suggestion]}),t.jsxs("div",{className:"flex items-center justify-between mt-3",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:e.timestamp.toLocaleString()}),!e.acknowledged&&t.jsx(n,{variant:"outline",size:"sm",children:"Acknowledge"})]})]})]})},e.id))});case"validations":return t.jsx("div",{className:"space-y-3",children:p.validations.map(e=>t.jsx("div",{className:"p-4 bg-background border border-border rounded-lg",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(a,{name:h(e.status).icon,size:16,className:`${h(e.status).color} mt-0.5`}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("span",{className:"font-medium text-foreground",children:e.check}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${h(e.status).color} bg-current/10`,children:e.status})]}),t.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:e.details}),t.jsx("div",{className:"text-xs text-muted-foreground",children:e.timestamp.toLocaleString()})]})]})},e.id))})}})()}),t.jsx("div",{className:"p-4 border-t border-border bg-muted/50",children:t.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{children:["Last updated: ",(new Date).toLocaleTimeString()]}),t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:"Auto-refresh: ON"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),t.jsx("span",{children:"Audit logging active"})]})]})})]})},v=({results:r,onExport:s})=>{const[i,o]=e.useState("summary"),[c,l]=e.useState(new Set(["valuation"])),d={summary:{enterpriseValue:2847.5,equityValue:2547.5,sharePrice:127.38,impliedReturn:.156,confidence:.87},cashFlows:[{year:2024,revenue:1250,ebitda:312.5,fcf:187.5,pv:170.5},{year:2025,revenue:1375,ebitda:343.8,fcf:206.3,pv:172.8},{year:2026,revenue:1513,ebitda:378.2,fcf:226.9,pv:175.2},{year:2027,revenue:1664,ebitda:416,fcf:249.6,pv:177.7},{year:2028,revenue:1830,ebitda:457.6,fcf:274.6,pv:180.3}],sensitivity:{wacc:[.08,.09,.1,.11,.12],growth:[.015,.02,.025,.03,.035],matrix:[[145.2,138.7,132.8,127.4,122.5],[152.1,144.9,138.2,132.1,126.4],[159.8,151.9,144.6,137.8,131.6],[168.4,159.7,151.8,144.4,137.6],[178.1,168.4,159.7,151.8,144.4]]},scenarios:[{name:"Base Case",probability:.6,sharePrice:127.38,irr:.156},{name:"Bull Case",probability:.25,sharePrice:145.67,irr:.189},{name:"Bear Case",probability:.15,sharePrice:98.42,irr:.087}],multiples:[{metric:"EV/Revenue",current:2.3,peer_avg:2.8,premium:-17.9},{metric:"EV/EBITDA",current:9.1,peer_avg:11.2,premium:-18.8},{metric:"P/E Ratio",current:18.5,peer_avg:22.1,premium:-16.3},{metric:"P/B Ratio",current:2.1,peer_avg:2.6,premium:-19.2}]},m=(e,t=2)=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:t,maximumFractionDigits:t}).format(e),u=(e,t=1)=>`${(100*e).toFixed(t)}%`;return t.jsxs("div",{className:"flex flex-col h-full bg-card",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"Calculator",size:20,className:"text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Calculation Results"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(n,{variant:"outline",size:"sm",iconName:"Download",onClick:()=>s&&s("excel"),children:"Export"}),t.jsx(n,{variant:"outline",size:"sm",iconName:"Share2",children:"Share"})]})]}),t.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:[{id:"summary",label:"Summary",icon:"BarChart3"},{id:"cashflows",label:"Cash Flows",icon:"TrendingUp"},{id:"sensitivity",label:"Sensitivity",icon:"Target"},{id:"scenarios",label:"Scenarios",icon:"GitBranch"},{id:"multiples",label:"Multiples",icon:"Layers"}].map(e=>t.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(i===e.id?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[t.jsx(a,{name:e.icon,size:16}),t.jsx("span",{children:e.label})]},e.id))}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(()=>{switch(i){case"summary":default:return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Enterprise Value"}),t.jsx(a,{name:"Building",size:16,className:"text-muted-foreground"})]}),t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:"text-2xl font-bold text-foreground",children:[m(d.summary.enterpriseValue,1),"M"]})})]}),t.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Equity Value"}),t.jsx(a,{name:"PieChart",size:16,className:"text-muted-foreground"})]}),t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:"text-2xl font-bold text-foreground",children:[m(d.summary.equityValue,1),"M"]})})]}),t.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Share Price"}),t.jsx(a,{name:"DollarSign",size:16,className:"text-muted-foreground"})]}),t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"text-2xl font-bold text-foreground",children:m(d.summary.sharePrice)})})]}),t.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Implied Return"}),t.jsx(a,{name:"TrendingUp",size:16,className:"text-success"})]}),t.jsx("div",{className:"mt-2",children:t.jsx("span",{className:"text-2xl font-bold text-success",children:u(d.summary.impliedReturn)})})]})]}),t.jsxs("div",{className:"p-4 bg-background border border-border rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-sm font-medium text-foreground",children:"Model Confidence"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:u(d.summary.confidence)})]}),t.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:t.jsx("div",{className:"bg-success h-2 rounded-full transition-all duration-300",style:{width:100*d.summary.confidence+"%"}})}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Based on data quality, assumption validity, and sensitivity analysis"})]})]});case"cashflows":return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-border",children:[t.jsx("th",{className:"text-left py-2 text-muted-foreground font-medium",children:"Year"}),t.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Revenue"}),t.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"EBITDA"}),t.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"FCF"}),t.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Present Value"})]})}),t.jsx("tbody",{children:d.cashFlows.map((e,a)=>t.jsxs("tr",{className:"border-b border-border/50",children:[t.jsx("td",{className:"py-3 text-foreground font-medium",children:e.year}),t.jsxs("td",{className:"py-3 text-right text-foreground",children:[m(e.revenue,0),"M"]}),t.jsxs("td",{className:"py-3 text-right text-foreground",children:[m(e.ebitda,1),"M"]}),t.jsxs("td",{className:"py-3 text-right text-foreground",children:[m(e.fcf,1),"M"]}),t.jsxs("td",{className:"py-3 text-right text-success font-medium",children:[m(e.pv,1),"M"]})]},a))})]})}),t.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-foreground",children:"Terminal Value"}),t.jsxs("span",{className:"text-lg font-bold text-foreground",children:[m(1247.3,1),"M"]})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"2.5% perpetual growth rate applied to 2028 FCF"})]})]});case"sensitivity":return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("h4",{className:"text-sm font-medium text-foreground mb-2",children:"Share Price Sensitivity Analysis"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"WACC vs Terminal Growth Rate"})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 text-left text-muted-foreground",children:"WACC \\ Growth"}),d.sensitivity.growth.map((e,a)=>t.jsx("th",{className:"p-2 text-center text-muted-foreground",children:u(e)},a))]})}),t.jsx("tbody",{children:d.sensitivity.wacc.map((e,a)=>t.jsxs("tr",{className:"border-t border-border/50",children:[t.jsx("td",{className:"p-2 text-muted-foreground font-medium",children:u(e)}),d.sensitivity.matrix[a].map((e,a)=>t.jsx("td",{className:"p-2 text-center font-medium "+(Math.abs(e-127.38)<5?"bg-primary/20 text-primary":"text-foreground"),children:m(e)},a))]},a))})]})})]});case"scenarios":return t.jsx("div",{className:"space-y-4",children:d.scenarios.map((e,a)=>t.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"font-medium text-foreground",children:e.name}),t.jsxs("span",{className:"text-xs bg-background px-2 py-1 rounded text-muted-foreground",children:[u(e.probability)," probability"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-lg font-bold text-foreground",children:m(e.sharePrice)}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[u(e.irr)," IRR"]})]})]}),t.jsx("div",{className:"w-full bg-background rounded-full h-1",children:t.jsx("div",{className:"bg-primary h-1 rounded-full",style:{width:100*e.probability+"%"}})})]},a))});case"multiples":return t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-border",children:[t.jsx("th",{className:"text-left py-2 text-muted-foreground font-medium",children:"Multiple"}),t.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Current"}),t.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Peer Avg"}),t.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Premium/Discount"})]})}),t.jsx("tbody",{children:d.multiples.map((e,a)=>t.jsxs("tr",{className:"border-b border-border/50",children:[t.jsx("td",{className:"py-3 text-foreground font-medium",children:e.metric}),t.jsxs("td",{className:"py-3 text-right text-foreground",children:[e.current,"x"]}),t.jsxs("td",{className:"py-3 text-right text-foreground",children:[e.peer_avg,"x"]}),t.jsxs("td",{className:"py-3 text-right font-medium "+(e.premium>0?"text-success":"text-destructive"),children:[e.premium>0?"+":"",e.premium.toFixed(1),"%"]})]},a))})]})})})}})()}),t.jsx("div",{className:"p-4 border-t border-border bg-muted/50",children:t.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("span",{children:["Last Updated: ",(new Date).toLocaleTimeString()]}),t.jsx("span",{children:"‚Ä¢"}),t.jsx("span",{children:"Auto-refresh: ON"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),t.jsx("span",{children:"Calculations current"})]})]})})]})},E=({onFormulaCreate:r,variables:s})=>{const[i,o]=e.useState("valuation"),[c,l]=e.useState(null),[d,m]=e.useState(""),[u,p]=e.useState(""),[g,h]=e.useState(!1),y=e.useRef(null),A={valuation:{name:"Valuation",icon:"TrendingUp",functions:[{name:"DCF",syntax:"DCF(fcf_array, discount_rate, terminal_growth)",description:"Discounted Cash Flow valuation"},{name:"NPV",syntax:"NPV(cash_flows, discount_rate)",description:"Net Present Value calculation"},{name:"IRR",syntax:"IRR(cash_flows)",description:"Internal Rate of Return"},{name:"TERMINAL_VALUE",syntax:"TERMINAL_VALUE(final_fcf, growth_rate, discount_rate)",description:"Terminal value calculation"},{name:"WACC",syntax:"WACC(cost_equity, cost_debt, tax_rate, debt_ratio)",description:"Weighted Average Cost of Capital"}]},financial:{name:"Financial Ratios",icon:"Calculator",functions:[{name:"ROE",syntax:"ROE(net_income, shareholders_equity)",description:"Return on Equity"},{name:"ROA",syntax:"ROA(net_income, total_assets)",description:"Return on Assets"},{name:"DEBT_TO_EQUITY",syntax:"DEBT_TO_EQUITY(total_debt, total_equity)",description:"Debt to Equity ratio"},{name:"CURRENT_RATIO",syntax:"CURRENT_RATIO(current_assets, current_liabilities)",description:"Current ratio calculation"},{name:"QUICK_RATIO",syntax:"QUICK_RATIO(quick_assets, current_liabilities)",description:"Quick ratio calculation"}]},statistical:{name:"Statistical",icon:"BarChart3",functions:[{name:"CORRELATION",syntax:"CORRELATION(dataset1, dataset2)",description:"Correlation coefficient"},{name:"REGRESSION",syntax:"REGRESSION(dependent_var, independent_var)",description:"Linear regression analysis"},{name:"VOLATILITY",syntax:"VOLATILITY(returns, period)",description:"Historical volatility"},{name:"BETA",syntax:"BETA(stock_returns, market_returns)",description:"Beta coefficient calculation"},{name:"SHARPE_RATIO",syntax:"SHARPE_RATIO(returns, risk_free_rate)",description:"Risk-adjusted return metric"}]},mathematical:{name:"Mathematical",icon:"Sigma",functions:[{name:"SUM",syntax:"SUM(range)",description:"Sum of values"},{name:"AVERAGE",syntax:"AVERAGE(range)",description:"Average of values"},{name:"MEDIAN",syntax:"MEDIAN(range)",description:"Median value"},{name:"STDEV",syntax:"STDEV(range)",description:"Standard deviation"},{name:"PERCENTILE",syntax:"PERCENTILE(range, percentile)",description:"Percentile calculation"}]}},S=()=>(d.match(/\(/g)||[]).length===(d.match(/\)/g)||[]).length;return t.jsxs("div",{className:"flex flex-col h-full bg-card",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"Wrench",size:20,className:"text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Formula Builder"})]}),t.jsx("div",{className:"flex items-center space-x-2",children:t.jsx(n,{variant:"outline",size:"sm",iconName:"Plus",onClick:()=>h(!g),children:"New Formula"})})]}),t.jsx("div",{className:"flex border-b border-border",children:Object.entries(A).map(([e,n])=>t.jsxs("button",{onClick:()=>o(e),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-smooth "+(i===e?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[t.jsx(a,{name:n.icon,size:16}),t.jsx("span",{children:n.name})]},e))}),t.jsxs("div",{className:"flex-1 overflow-y-auto",children:[t.jsx("div",{className:"p-4 space-y-3",children:A[i].functions.map((e,r)=>t.jsx("div",{draggable:!0,onDragStart:t=>((e,t)=>{l(t),e.dataTransfer.effectAllowed="copy"})(t,e),className:"p-3 bg-muted rounded-lg border border-border cursor-move hover:bg-muted/80 transition-smooth group",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"Move",size:14,className:"text-muted-foreground group-hover:text-foreground"}),t.jsx("span",{className:"font-medium text-foreground",children:e.name})]}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),t.jsx("code",{className:"text-xs bg-background px-2 py-1 rounded mt-2 block font-mono text-foreground",children:e.syntax})]}),t.jsx(n,{variant:"ghost",size:"sm",iconName:"Plus",onClick:()=>(e=>{const t=d+(d?" + ":"")+e.syntax;m(t)})(e),className:"opacity-0 group-hover:opacity-100 transition-opacity"})]})},r))}),t.jsxs("div",{className:"border-t border-border p-4",children:[t.jsxs("h4",{className:"text-sm font-medium text-foreground mb-3 flex items-center space-x-2",children:[t.jsx(a,{name:"BookOpen",size:16}),t.jsx("span",{children:"Saved Formulas"})]}),t.jsx("div",{className:"space-y-2",children:[{name:"Custom_DCF_Tech",formula:"DCF(FCFF_PROJECTIONS, WACC(0.12, 0.04, 0.25, 0.3), 0.025)",category:"Custom"},{name:"LBO_Returns",formula:"IRR([INITIAL_INVESTMENT * -1, EXIT_VALUE])",category:"Custom"},{name:"Comp_Multiple",formula:"AVERAGE(PEER_EV_REVENUE) * TARGET_REVENUE",category:"Custom"}].map((e,a)=>t.jsxs("div",{className:"p-3 bg-background rounded-lg border border-border hover:bg-muted/50 transition-smooth cursor-pointer",onClick:()=>m(e.formula),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-foreground",children:e.name}),t.jsx("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:e.category})]}),t.jsx("code",{className:"text-xs text-muted-foreground mt-1 block font-mono",children:e.formula})]},a))})]})]}),g&&t.jsx("div",{className:"border-t border-border bg-background",children:t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Formula Name"}),t.jsx("input",{type:"text",value:u,onChange:e=>p(e.target.value),placeholder:"Enter formula name...",className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Formula Expression"}),t.jsx("div",{ref:y,onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:e=>{if(e.preventDefault(),c){const e=d+(d?" + ":"")+c.syntax;m(e),l(null)}},className:"min-h-[100px] p-3 bg-input border-2 border-dashed border-border rounded-lg focus-within:border-ring transition-colors",children:t.jsx("textarea",{value:d,onChange:e=>m(e.target.value),placeholder:"Drag functions here or type formula manually...",className:"w-full h-20 bg-transparent text-foreground placeholder-muted-foreground resize-none outline-none font-mono text-sm"})}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsx("div",{className:"flex items-center space-x-2",children:S()?t.jsxs("div",{className:"flex items-center space-x-1 text-success",children:[t.jsx(a,{name:"CheckCircle",size:14}),t.jsx("span",{className:"text-xs",children:"Valid syntax"})]}):t.jsxs("div",{className:"flex items-center space-x-1 text-destructive",children:[t.jsx(a,{name:"XCircle",size:14}),t.jsx("span",{className:"text-xs",children:"Invalid syntax"})]})}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[d.length," characters"]})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(n,{variant:"outline",size:"sm",iconName:"Trash2",onClick:()=>{m(""),p("")},children:"Clear"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(n,{variant:"outline",size:"sm",iconName:"Eye",disabled:!S(),children:"Preview"}),t.jsx(n,{variant:"default",size:"sm",iconName:"Save",onClick:()=>{u&&d&&(r&&r({name:u,formula:d,timestamp:new Date}),p(""),m(""),h(!1))},disabled:!u||!d||!S(),children:"Save Formula"})]})]})]})})]})},T=({onTemplateSelect:r,onTemplateCreate:s})=>{const[i,o]=e.useState("valuation"),[c,l]=e.useState(""),[d,m]=e.useState(!1),u={valuation:{name:"Valuation Models",icon:"TrendingUp",templates:[{id:"dcf_standard",name:"DCF - Standard",description:"Traditional discounted cash flow model with 5-year projections and terminal value",complexity:"Intermediate",timeToComplete:"45 min",lastUsed:"2024-07-10",popularity:95,features:["5-year projections","Terminal value","Sensitivity analysis","WACC calculation"]},{id:"dcf_tech",name:"DCF - Technology",description:"Specialized DCF for high-growth technology companies with adjusted metrics",complexity:"Advanced",timeToComplete:"60 min",lastUsed:"2024-07-08",popularity:87,features:["SaaS metrics","User-based projections","Churn analysis","Rule of 40"]},{id:"sum_of_parts",name:"Sum-of-the-Parts",description:"Multi-business valuation with segment-specific assumptions and multiples",complexity:"Advanced",timeToComplete:"90 min",lastUsed:"2024-07-05",popularity:73,features:["Segment analysis","Multiple approaches","Holding company discount","Synergy modeling"]}]},lbo:{name:"LBO Models",icon:"Layers",templates:[{id:"lbo_standard",name:"LBO - Standard",description:"Complete leveraged buyout model with debt sizing and returns analysis",complexity:"Advanced",timeToComplete:"120 min",lastUsed:"2024-07-09",popularity:91,features:["Debt capacity","Returns waterfall","Management rollover","Exit scenarios"]},{id:"lbo_growth",name:"LBO - Growth Equity",description:"Growth-focused LBO with minority investment and expansion capital",complexity:"Advanced",timeToComplete:"100 min",lastUsed:"2024-07-06",popularity:68,features:["Growth capital","Minority stake","Management incentives","Expansion modeling"]}]},comps:{name:"Comparable Analysis",icon:"BarChart3",templates:[{id:"trading_comps",name:"Trading Comparables",description:"Public company multiple analysis with statistical benchmarking",complexity:"Beginner",timeToComplete:"30 min",lastUsed:"2024-07-11",popularity:98,features:["Multiple analysis","Statistical metrics","Peer screening","Premium/discount analysis"]},{id:"transaction_comps",name:"Transaction Comparables",description:"M&A transaction analysis with control premiums and synergies",complexity:"Intermediate",timeToComplete:"45 min",lastUsed:"2024-07-07",popularity:82,features:["M&A multiples","Control premiums","Synergy analysis","Transaction screening"]}]},merger:{name:"M&A Models",icon:"GitMerge",templates:[{id:"merger_model",name:"Merger Model",description:"Comprehensive merger analysis with accretion/dilution and pro forma statements",complexity:"Expert",timeToComplete:"180 min",lastUsed:"2024-07-04",popularity:76,features:["Accretion/dilution","Pro forma statements","Synergy modeling","Financing structure"]},{id:"acquisition_model",name:"Acquisition Model",description:"Strategic acquisition analysis with integration costs and value creation",complexity:"Expert",timeToComplete:"150 min",lastUsed:"2024-07-03",popularity:71,features:["Integration costs","Value creation","Financing options","Risk analysis"]}]}},p=e=>{switch(e){case"Beginner":return"text-success bg-success/10";case"Intermediate":return"text-warning bg-warning/10";case"Advanced":return"text-accent bg-accent/10";case"Expert":return"text-destructive bg-destructive/10";default:return"text-muted-foreground bg-muted"}},g=()=>{const e=u[i]?.templates||[];return c?e.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())||e.description.toLowerCase().includes(c.toLowerCase())):e},h=e=>{r&&r(e)};return t.jsxs("div",{className:"flex flex-col h-full bg-card",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"FileTemplate",size:20,className:"text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Model Templates"})]}),t.jsx(n,{variant:"outline",size:"sm",iconName:"Plus",onClick:()=>m(!0),children:"Create Template"})]}),t.jsx("div",{className:"p-4 border-b border-border",children:t.jsxs("div",{className:"relative",children:[t.jsx(a,{name:"Search",size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),t.jsx("input",{type:"text",value:c,onChange:e=>l(e.target.value),placeholder:"Search templates...",className:"w-full pl-10 pr-4 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]})}),t.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:Object.entries(u).map(([e,n])=>t.jsxs("button",{onClick:()=>o(e),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(i===e?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[t.jsx(a,{name:n.icon,size:16}),t.jsx("span",{children:n.name})]},e))}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[!c&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-sm font-medium text-foreground mb-3 flex items-center space-x-2",children:[t.jsx(a,{name:"Clock",size:16}),t.jsx("span",{children:"Recently Used"})]}),t.jsx("div",{className:"grid grid-cols-1 gap-2",children:[{id:"dcf_standard",name:"DCF - Standard",lastUsed:"2024-07-11 14:30"},{id:"trading_comps",name:"Trading Comparables",lastUsed:"2024-07-11 09:15"},{id:"lbo_standard",name:"LBO - Standard",lastUsed:"2024-07-10 16:45"}].map(e=>t.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg hover:bg-muted/80 transition-smooth cursor-pointer",onClick:()=>h(e),children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-medium text-foreground",children:e.name}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last used: ",e.lastUsed]})]}),t.jsx(a,{name:"ChevronRight",size:16,className:"text-muted-foreground"})]},e.id))})]}),t.jsx("div",{className:"space-y-4",children:g().map(e=>t.jsxs("div",{className:"p-4 bg-background border border-border rounded-lg hover:border-primary/50 transition-smooth cursor-pointer group",onClick:()=>h(e),children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("h5",{className:"font-semibold text-foreground group-hover:text-primary transition-colors",children:e.name}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${p(e.complexity)}`,children:e.complexity})]}),t.jsx("p",{className:"text-sm text-muted-foreground",children:e.description})]}),t.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[t.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[t.jsx(a,{name:"Star",size:12}),t.jsxs("span",{children:[e.popularity,"%"]})]}),t.jsx(a,{name:"ChevronRight",size:16,className:"text-muted-foreground group-hover:text-primary transition-colors"})]})]}),t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(a,{name:"Clock",size:12}),t.jsx("span",{children:e.timeToComplete})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(a,{name:"Calendar",size:12}),t.jsxs("span",{children:["Last used: ",e.lastUsed]})]})]})}),t.jsx("div",{className:"flex flex-wrap gap-2",children:e.features.map((e,a)=>t.jsx("span",{className:"px-2 py-1 bg-muted text-xs text-muted-foreground rounded",children:e},a))})]},e.id))}),0===g().length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(a,{name:"FileX",size:48,className:"text-muted-foreground mx-auto mb-4"}),t.jsx("h4",{className:"text-lg font-medium text-foreground mb-2",children:"No templates found"}),t.jsx("p",{className:"text-muted-foreground",children:c?"Try adjusting your search terms":"No templates available in this category"})]})]}),d&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-elevation-2 w-full max-w-md mx-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Create New Template"}),t.jsx(n,{variant:"ghost",size:"sm",iconName:"X",onClick:()=>m(!1)})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Template Name"}),t.jsx("input",{type:"text",placeholder:"Enter template name...",className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Description"}),t.jsx("textarea",{placeholder:"Describe your template...",rows:3,className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring resize-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Category"}),t.jsxs("select",{className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-ring",children:[t.jsx("option",{value:"valuation",children:"Valuation Models"}),t.jsx("option",{value:"lbo",children:"LBO Models"}),t.jsx("option",{value:"comps",children:"Comparable Analysis"}),t.jsx("option",{value:"merger",children:"M&A Models"})]})]})]}),t.jsxs("div",{className:"flex items-center justify-end space-x-2 p-4 border-t border-border",children:[t.jsx(n,{variant:"outline",size:"sm",onClick:()=>m(!1),children:"Cancel"}),t.jsx(n,{variant:"default",size:"sm",onClick:()=>{m(!1),s&&s()},children:"Create Template"})]})]})})]})},C=new class{constructor(){this.commands=new Map,this.categories=new Map,this.aliases=new Map,this.initializeCategories()}initializeCategories(){this.categories.set("CORE",{name:"Core Analysis",description:"Fundamental financial analysis commands",icon:"üìä",commands:[]}),this.categories.set("PORTFOLIO",{name:"Portfolio & Risk",description:"Portfolio analysis and risk management",icon:"üéØ",commands:[]}),this.categories.set("VALUATION",{name:"Advanced Valuation",description:"Sophisticated valuation models",icon:"üìà",commands:[]}),this.categories.set("TECHNICAL",{name:"Technical Analysis",description:"Technical analysis and market intelligence",icon:"üìä",commands:[]}),this.categories.set("FIXED_INCOME",{name:"Fixed Income & Derivatives",description:"Bond analysis and derivatives pricing",icon:"üè¶",commands:[]}),this.categories.set("ESG",{name:"ESG & Alternative Data",description:"Environmental, social, governance metrics",icon:"üå±",commands:[]}),this.categories.set("AUTOMATION",{name:"Automation & Workflows",description:"Automated analysis and workflows",icon:"ü§ñ",commands:[]}),this.categories.set("DATA",{name:"Data Management",description:"Data import, export, and management",icon:"üíæ",commands:[]}),this.categories.set("REPORTING",{name:"Reporting & Visualization",description:"Reports, charts, and visualizations",icon:"üìã",commands:[]}),this.categories.set("SYSTEM",{name:"System & Performance",description:"System monitoring and configuration",icon:"üîß",commands:[]}),this.categories.set("ANALYTICS",{name:"Advanced Analytics",description:"Machine learning and advanced analytics",icon:"üí°",commands:[]}),this.categories.set("MARKET_DATA",{name:"Market Data Extensions",description:"Extended market data and economic indicators",icon:"üåê",commands:[]}),this.categories.set("UTILITY",{name:"Utility Commands",description:"General utility and helper commands",icon:"üõ†Ô∏è",commands:[]})}register(e,t,a={}){const n=e.toUpperCase(),r={name:n,handler:t,category:a.category||"UTILITY",description:a.description||"No description available",usage:a.usage||`${n}()`,examples:a.examples||[],parameterSchema:a.parameterSchema||null,aliases:a.aliases||[],tags:a.tags||[],version:a.version||"1.0.0",deprecated:a.deprecated||!1,experimental:a.experimental||!1};this.commands.set(n,r),a.aliases&&a.aliases.forEach(e=>{this.aliases.set(e.toUpperCase(),n)});const s=this.categories.get(r.category);return s&&s.commands.push(n),this}getHandler(e){const t=e.toUpperCase(),a=this.commands.get(t);if(a)return a.handler;const n=this.aliases.get(t);if(n){const e=this.commands.get(n);return e?e.handler:null}return null}getCommandInfo(e){const t=e.toUpperCase(),a=this.commands.get(t);if(a)return a;const n=this.aliases.get(t);return n?this.commands.get(n):null}getCommandsByCategory(e){const t=this.categories.get(e.toUpperCase());return t?t.commands.map(e=>this.commands.get(e)):[]}getAllCommands(){return Array.from(this.commands.keys())}getAllCategories(){return Array.from(this.categories.entries()).map(([e,t])=>({key:e,...t}))}searchCommands(e){const t=e.toLowerCase(),a=[];for(const[n,r]of this.commands){const e=this.calculateSearchScore(r,t);e>0&&a.push({...r,score:e})}return a.sort((e,t)=>t.score-e.score)}calculateSearchScore(e,t){let a=0;return e.name.toLowerCase()===t&&(a+=100),e.name.toLowerCase().includes(t)&&(a+=50),e.description.toLowerCase().includes(t)&&(a+=25),e.tags.some(e=>e.toLowerCase().includes(t))&&(a+=15),e.aliases.some(e=>e.toLowerCase().includes(t))&&(a+=10),a}getSuggestions(e){const t=e.toLowerCase(),a=[];for(const[n,r]of this.commands)n.toLowerCase().startsWith(t)&&a.push({name:r.name,description:r.description,usage:r.usage,category:r.category});return a.sort((e,t)=>e.name.localeCompare(t.name))}hasCommand(e){const t=e.toUpperCase();return this.commands.has(t)||this.aliases.has(t)}getCommandStats(){const e={};for(const[t,a]of this.categories)e[t]={name:a.name,count:a.commands.length,icon:a.icon};return e}},R=new class{constructor(){this.commandHistory=[],this.variables=new Map,this.settings={currency:"USD",precision:2,dateFormat:"YYYY-MM-DD"},this.persistenceInitialized=!1,this.maxHistorySize=1e3}async initializePersistence(){if(!this.persistenceInitialized)try{await c.initialize(),await this.loadPersistedData(),this.persistenceInitialized=!0}catch(e){}}async loadPersistedData(){try{const e=await c.retrieve("command_history");e&&Array.isArray(e)&&(this.commandHistory=e.slice(-this.maxHistorySize));const t=await c.retrieve("user_variables");t&&"object"==typeof t&&(this.variables=new Map(Object.entries(t)));const a=await c.retrieve("user_preferences");a&&"object"==typeof a&&(this.settings={...this.settings,...a})}catch(e){}}async saveData(){if(this.persistenceInitialized)try{await c.store("command_history",this.commandHistory,{storage:"indexedDB"});const e=Object.fromEntries(this.variables);await c.store("user_variables",e,{storage:"localStorage"}),await c.store("user_preferences",this.settings,{storage:"localStorage"})}catch(e){}}async processCommand(e,t={}){const a=Date.now();try{this.persistenceInitialized||await this.initializePersistence();const n=this.parseCommand(e),r={input:e,timestamp:new Date,success:!1,...n};this.commandHistory.push(r),this.commandHistory.length>this.maxHistorySize&&(this.commandHistory=this.commandHistory.slice(-this.maxHistorySize));const s=C.getHandler(n.command);if(!s)return this.createErrorResponse(`Unknown command: "${n.command}"`,e);const i=this.validateParameters(s,n);if(!i.valid)return this.createErrorResponse(i.error,e);const o=await s.execute(n,t,this);return r.success="error"!==o.type,r.executionTime=Date.now()-a,o.executionTime=Date.now()-a,o.timestamp=new Date,this.saveData().catch(e=>{}),o}catch(n){return this.createErrorResponse(`Command execution failed: ${n.message}`,e)}}parseCommand(e){const t=e.trim(),a=t.match(/^([A-Z_]+)\s*\(\s*([^)]*)\s*\)$/i);if(a){const[,e,n]=a,r=this.parseParameters(n);return{command:e.toUpperCase(),parameters:r,rawInput:t,style:"function"}}const n=t.split(/\s+/);return{command:n[0].toUpperCase(),parameters:n.slice(1),rawInput:t,style:"space-separated"}}parseParameters(e){if(!e.trim())return[];const t=[];let a="",n=!1,r=0,s="";for(let i=0;i<e.length;i++){const o=e[i];if('"'!==o&&"'"!==o||n)if(o===s&&n)n=!1,s="";else if("["!==o||n)if("]"!==o||n){if(","===o&&!n&&0===r){t.push(this.parseParameterValue(a.trim())),a="";continue}a+=o}else r--,a+=o;else r++,a+=o;else n=!0,s=o}return a.trim()&&t.push(this.parseParameterValue(a.trim())),t}parseParameterValue(e){if(e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"))return e.slice(1,-1);if(e.startsWith("[")&&e.endsWith("]")){const t=e.slice(1,-1);return t.trim()?t.split(",").map(e=>this.parseParameterValue(e.trim())):[]}return/^-?\d+\.?\d*$/.test(e)?parseFloat(e):"true"===e.toLowerCase()||"false"!==e.toLowerCase()&&e}validateParameters(e,t){if(!e.parameterSchema)return{valid:!0};const{required:a=[],optional:n=[]}=e.parameterSchema,{parameters:r}=t;if(r.length<a.length)return{valid:!1,error:`Missing required parameters. Expected: ${a.join(", ")}`};const s=a.length+n.length;return r.length>s?{valid:!1,error:`Too many parameters. Maximum: ${s}`}:{valid:!0}}createErrorResponse(e,t){return{type:"error",content:e,suggestions:this.getSuggestions(t),timestamp:new Date}}getSuggestions(e){const t=e.split(/[\s(]/)[0].toUpperCase();return C.getAllCommands().filter(e=>e.includes(t.substring(0,3))||e.toLowerCase().includes(t.toLowerCase())).slice(0,5)}getHistory(e=10){return this.commandHistory.slice(-e)}clearHistory(){this.commandHistory=[]}setVariable(e,t){this.variables.set(e,t),this.persistenceInitialized&&this.saveData().catch(e=>{})}getVariable(e){return this.variables.get(e)}getAllVariables(){return Object.fromEntries(this.variables)}updateSetting(e,t){this.settings[e]=t,this.persistenceInitialized&&this.saveData().catch(e=>{})}getSetting(e){return this.settings[e]}getAllSettings(){return{...this.settings}}},I={DCF:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"DCF command requires a ticker symbol. Usage: DCF(AAPL)"};try{const e=`üîÑ Building DCF model for ${n.toUpperCase()}...\n‚Ä¢ Fetching financial statements\n‚Ä¢ Calculating free cash flows\n‚Ä¢ Determining terminal value\n‚Ä¢ Computing present values...\n${o.demoMode?"\n‚ö†Ô∏è  Using demo data - configure API keys for live data":"\n‚úÖ Using live market data"}`;t.showLoading&&t.showLoading(e);const a=await o.fetchDCFInputs(n.toUpperCase()),r=S(a);return{type:"success",content:`DCF Valuation Analysis for ${a.companyName} (${n.toUpperCase()})\n\nüìä VALUATION SUMMARY:\n‚Ä¢ Current Price: ${p(a.currentPrice)}\n‚Ä¢ Fair Value: ${p(r.fairValue)}\n‚Ä¢ Upside/Downside: ${h(r.upside/100)}\n\nüí∞ KEY METRICS:\n‚Ä¢ Enterprise Value: ${p(r.enterpriseValue,"USD",!0)}\n‚Ä¢ Equity Value: ${p(r.equityValue,"USD",!0)}\n‚Ä¢ Terminal Value: ${p(r.terminalValue,"USD",!0)}\n‚Ä¢ WACC: ${h(r.wacc)}\n\nüìà 5-YEAR PROJECTIONS:\n${r.projections.map((e,t)=>`Year ${t+1}: Revenue ${p(e.revenue,"USD",!0)}, FCF ${p(e.fcf,"USD",!0)}`).join("\n")}\n\nüéØ RECOMMENDATION: ${r.recommendation}\n\n${o.demoMode?"üí° Note: Using demo data. Configure API keys for live analysis.":"‚úÖ Analysis based on live market data"}`,data:{analysis:"dcf",ticker:n.toUpperCase(),results:r}}}catch(r){return{type:"error",content:`DCF analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},LBO:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"LBO command requires a ticker symbol. Usage: LBO(TSLA)"};try{const e=`üîÑ Analyzing LBO potential for ${n.toUpperCase()}...\n‚Ä¢ Fetching financial statements\n‚Ä¢ Calculating debt capacity\n‚Ä¢ Analyzing peer multiples\n‚Ä¢ Computing returns scenarios...\n${o.demoMode?"\n‚ö†Ô∏è  Using demo data - configure API keys for live data":"\n‚úÖ Using live market data"}`;t.showLoading&&t.showLoading(e);const[a,r]=await Promise.all([o.fetchCompanyProfile(n.toUpperCase()),o.fetchFinancialStatements(n.toUpperCase(),"income-statement")]),s={companyName:a.companyName,currentPrice:a.price,marketCap:a.mktCap,ebitda:r[0]?.ebitda||.15*a.mktCap,revenue:r[0]?.revenue||2*a.mktCap,debt:a.totalDebt||0,cash:a.totalCash||0},i=A(s);return{type:"success",content:`LBO Analysis for ${a.companyName} (${n.toUpperCase()})\n\nüíº TRANSACTION SUMMARY:\n‚Ä¢ Purchase Price: ${p(i.purchasePrice,"USD",!0)}\n‚Ä¢ Equity Investment: ${p(i.equityInvestment,"USD",!0)}\n‚Ä¢ Total Debt: ${p(i.totalDebt,"USD",!0)}\n‚Ä¢ Debt/Equity Ratio: ${g(i.debtToEquity,1)}x\n\nüìà PROJECTED RETURNS (5-year hold):\n‚Ä¢ Exit Equity Value: ${p(i.exitEquityValue,"USD",!0)}\n‚Ä¢ Total Return: ${p(i.totalReturn,"USD",!0)}\n‚Ä¢ IRR: ${h(i.irr)}\n‚Ä¢ MOIC: ${g(i.moic,1)}x\n\nüéØ EXIT ASSUMPTIONS:\n‚Ä¢ Exit EBITDA: ${p(i.exitEbitda,"USD",!0)}\n‚Ä¢ Exit Multiple: ${g(i.exitMultiple,1)}x\n‚Ä¢ Exit Enterprise Value: ${p(i.exitEnterpriseValue,"USD",!0)}\n\nüí∞ FEES & CARRY:\n‚Ä¢ Management Fees: ${p(i.managementFees,"USD",!0)}\n‚Ä¢ Carried Interest: ${p(i.carriedInterest,"USD",!0)}\n‚Ä¢ Net Return: ${p(i.netReturn,"USD",!0)}\n\n${o.demoMode?"üí° Note: Using demo data. Configure API keys for live analysis.":"‚úÖ Analysis based on live market data"}`,data:{analysis:"lbo",ticker:n.toUpperCase(),results:i}}}catch(r){return{type:"error",content:`LBO analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},COMP:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"COMP command requires a ticker symbol. Usage: COMP(MSFT)"};try{const e=`üîÑ Building comparable company analysis for ${n.toUpperCase()}...\n‚Ä¢ Identifying peer companies\n‚Ä¢ Fetching peer financial data\n‚Ä¢ Calculating valuation multiples\n‚Ä¢ Generating relative analysis...\n${o.demoMode?"\n‚ö†Ô∏è  Using demo data - configure API keys for live data":"\n‚úÖ Using live market data"}`;t.showLoading&&t.showLoading(e);const[a,r]=await Promise.all([o.fetchCompanyProfile(n.toUpperCase()),o.fetchPeerComparables(n.toUpperCase())]),s={symbol:n.toUpperCase(),name:a.companyName,marketCap:a.mktCap,peRatio:a.pe,evToEbitda:a.enterpriseValueOverEBITDA,priceToBook:a.pb,debtToEquity:a.debtToEquity},i=y(s,r);return{type:"success",content:`Comparable Company Analysis for ${a.companyName} (${n.toUpperCase()})\n\nüè¢ PEER GROUP (${r.length} companies):\n${r.slice(0,5).map(e=>`‚Ä¢ ${e.symbol}: ${e.name}`).join("\n")}\n\nüìä VALUATION MULTIPLES:\n‚Ä¢ P/E Ratio: ${g(s.peRatio,1)}x (Peer Median: ${g(i.peerStatistics.peRatio.median,1)}x)\n‚Ä¢ EV/EBITDA: ${g(s.evToEbitda,1)}x (Peer Median: ${g(i.peerStatistics.evToEbitda.median,1)}x)\n‚Ä¢ P/B Ratio: ${g(s.priceToBook,1)}x (Peer Median: ${g(i.peerStatistics.priceToBook.median,1)}x)\n\nüìà RELATIVE VALUATION:\n‚Ä¢ P/E vs Peers: ${h(i.relativeValuation.peRatioRelative-1)}\n‚Ä¢ EV/EBITDA vs Peers: ${h(i.relativeValuation.evEbitdaRelative-1)}\n‚Ä¢ P/B vs Peers: ${h(i.relativeValuation.priceToBookRelative-1)}\n\nüí∞ MARKET POSITION:\n‚Ä¢ Market Cap Percentile: ${g(i.relativeValuation.marketCapPercentile)}th\n‚Ä¢ Size: ${s.marketCap>i.peerStatistics.marketCap.median?"Above":"Below"} peer median\n\nüéØ PEER VALUATION RANGE:\n‚Ä¢ Min P/E: ${g(i.peerStatistics.peRatio.min,1)}x\n‚Ä¢ Max P/E: ${g(i.peerStatistics.peRatio.max,1)}x\n‚Ä¢ Median P/E: ${g(i.peerStatistics.peRatio.median,1)}x\n\n${o.demoMode?"üí° Note: Using demo data. Configure API keys for live analysis.":"‚úÖ Analysis based on live market data"}`,data:{analysis:"comparable",ticker:n.toUpperCase(),results:i}}}catch(r){return{type:"error",content:`Comparable analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},FETCH:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"FETCH command requires a ticker symbol. Usage: FETCH(GOOGL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase());return{type:"success",content:`Company Data for ${e.companyName} (${n.toUpperCase()})\n\nüè¢ COMPANY PROFILE:\n‚Ä¢ Industry: ${e.industry}\n‚Ä¢ Sector: ${e.sector}\n‚Ä¢ Market Cap: ${p(e.mktCap,"USD",!0)}\n‚Ä¢ Employees: ${g(e.fullTimeEmployees,0)}\n\nüí∞ FINANCIAL METRICS:\n‚Ä¢ Price: ${p(e.price)}\n‚Ä¢ P/E Ratio: ${g(e.pe,1)}\n‚Ä¢ EPS: ${p(e.eps)}\n‚Ä¢ Revenue (TTM): ${p(e.revenue,"USD",!0)}\n‚Ä¢ Profit Margin: ${h(e.profitMargin)}\n\nüìä VALUATION RATIOS:\n‚Ä¢ Price/Book: ${g(e.pb,2)}\n‚Ä¢ Price/Sales: ${g(e.ps,2)}\n‚Ä¢ EV/EBITDA: ${g(e.enterpriseValueOverEBITDA,1)}\n‚Ä¢ EV/Revenue: ${g(e.enterpriseValueOverRevenue,1)}\n\nüíº BALANCE SHEET:\n‚Ä¢ Total Debt: ${p(e.totalDebt,"USD",!0)}\n‚Ä¢ Total Cash: ${p(e.totalCash,"USD",!0)}\n‚Ä¢ Book Value: ${p(e.bookValue,"USD",!0)}\n‚Ä¢ Debt/Equity: ${g(e.debtToEquity,2)}\n\nüìà PERFORMANCE:\n‚Ä¢ 52W High: ${p(e.priceHigh52)}\n‚Ä¢ 52W Low: ${p(e.priceLow52)}\n‚Ä¢ Beta: ${g(e.beta,2)}\n‚Ä¢ Dividend Yield: ${h(e.dividendYield)}\n\n${o.demoMode?"üí° Note: Using demo data. Configure API keys for live data.":"‚úÖ Data from live market sources"}`,data:{analysis:"profile",ticker:n.toUpperCase(),results:e}}}catch(r){return{type:"error",content:`Data fetch failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}}},$={PORTFOLIO:{execute:async(e,t,a)=>{const[n,r]=e.parameters;if(!n||!r)return{type:"error",content:"PORTFOLIO command requires tickers and weights. Usage: PORTFOLIO([AAPL,MSFT,GOOGL], [0.4,0.3,0.3])"};try{const e=Array.isArray(n)?n:[n],t=Array.isArray(r)?r:[r];if(e.length!==t.length)return{type:"error",content:"Number of tickers must match number of weights"};const a=t.reduce((e,t)=>e+t,0);if(Math.abs(a-1)>.01)return{type:"error",content:`Weights must sum to 1.0 (currently sum to ${a})`};const s=await Promise.all(e.map(async(e,a)=>{const n=await o.fetchCompanyProfile(e);return{ticker:e.toUpperCase(),name:n.companyName,weight:t[a],price:n.price,marketCap:n.mktCap,beta:n.beta||1,pe:n.pe,dividendYield:n.dividendYield||0}})),i=s.reduce((e,t)=>e+t.marketCap*t.weight,0),c=s.reduce((e,t)=>e+t.beta*t.weight,0),l=s.reduce((e,t)=>e+t.pe*t.weight,0),d=s.reduce((e,t)=>e+t.dividendYield*t.weight,0),m=Math.max(...t),u=Math.min(...t),y=m/u;return{type:"success",content:`Portfolio Analysis\n\nüìä PORTFOLIO COMPOSITION:\n${s.map(e=>`‚Ä¢ ${e.ticker} (${e.name}): ${h(e.weight)} - ${p(e.price)}`).join("\n")}\n\nüìà PORTFOLIO METRICS:\n‚Ä¢ Total Portfolio Value: ${p(i,"USD",!0)}\n‚Ä¢ Weighted Beta: ${g(c,2)}\n‚Ä¢ Weighted P/E: ${g(l,1)}x\n‚Ä¢ Weighted Dividend Yield: ${h(d)}\n\nüéØ DIVERSIFICATION:\n‚Ä¢ Number of Holdings: ${e.length}\n‚Ä¢ Max Position: ${h(m)}\n‚Ä¢ Min Position: ${h(u)}\n‚Ä¢ Concentration Ratio: ${g(y,1)}\n\n‚öñÔ∏è RISK PROFILE:\n‚Ä¢ Portfolio Beta: ${c>1.2?"High Risk":c>.8?"Moderate Risk":"Low Risk"}\n‚Ä¢ Diversification: ${e.length>=10?"Well Diversified":e.length>=5?"Moderately Diversified":"Concentrated"}\n‚Ä¢ Concentration Risk: ${m>.3?"High":m>.2?"Moderate":"Low"}\n\nüí° RECOMMENDATIONS:\n${m>.4?"‚Ä¢ Consider reducing concentration in largest position\n":""}${e.length<5?"‚Ä¢ Consider adding more holdings for diversification\n":""}${c>1.5?"‚Ä¢ Portfolio has high market risk exposure\n":""}${d<.02?"‚Ä¢ Consider adding dividend-paying stocks for income\n":""}`,data:{analysis:"portfolio",holdings:s,metrics:{portfolioValue:i,weightedBeta:c,weightedPE:l,weightedDividendYield:d,concentrationRatio:y}}}}catch(s){return{type:"error",content:`Portfolio analysis failed: ${s.message}`}}},parameterSchema:{required:["tickers","weights"],optional:[]}},RISK_METRICS:{execute:async(e,t,a)=>{const[n,r=252]=e.parameters;if(!n)return{type:"error",content:"RISK_METRICS command requires a ticker symbol. Usage: RISK_METRICS(AAPL, 252)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=(await o.fetchMarketData(n.toUpperCase()),.16*e.beta),a=.06/t,s=1.645*t,i=2.326*t,c=2.5*t,l=1.2*a;return{type:"success",content:`Risk Metrics for ${e.companyName} (${n.toUpperCase()})\n\nüìä VOLATILITY MEASURES:\n‚Ä¢ Annualized Volatility: ${h(t)}\n‚Ä¢ Beta (vs S&P 500): ${g(e.beta,2)}\n‚Ä¢ Standard Deviation: ${h(t)}\n\n‚ö†Ô∏è VALUE AT RISK (VaR):\n‚Ä¢ 1-Day VaR (95%): ${h(s/Math.sqrt(252))}\n‚Ä¢ 1-Day VaR (99%): ${h(i/Math.sqrt(252))}\n‚Ä¢ 1-Month VaR (95%): ${h(s/Math.sqrt(12))}\n‚Ä¢ 1-Year VaR (95%): ${h(s)}\n\nüìà RISK-ADJUSTED RETURNS:\n‚Ä¢ Sharpe Ratio: ${g(a,2)}\n‚Ä¢ Sortino Ratio: ${g(l,2)}\n‚Ä¢ Information Ratio: ${g(.8*a,2)}\n‚Ä¢ Treynor Ratio: ${g(.06/e.beta,3)}\n\nüìâ DOWNSIDE RISK:\n‚Ä¢ Maximum Drawdown: ${h(c)}\n‚Ä¢ Downside Deviation: ${h(.7*t)}\n‚Ä¢ Calmar Ratio: ${g(.08/c,2)}\n\nüéØ RISK ASSESSMENT:\n‚Ä¢ Risk Level: ${t>.3?"High":t>.2?"Moderate":"Low"}\n‚Ä¢ Sharpe Quality: ${a>1?"Excellent":a>.5?"Good":"Poor"}\n‚Ä¢ Beta Classification: ${e.beta>1.2?"Aggressive":e.beta>.8?"Market":"Defensive"}\n\n‚è±Ô∏è Analysis Period: ${r} trading days\n${o.demoMode?"üí° Note: Using estimated risk metrics. Configure API keys for historical data.":"‚úÖ Based on historical market data"}`,data:{analysis:"risk_metrics",ticker:n.toUpperCase(),metrics:{volatility:t,beta:e.beta,sharpeRatio:a,sortinoRatio:l,var95:s,var99:i,maxDrawdown:c}}}}catch(s){return{type:"error",content:`Risk metrics calculation failed: ${s.message}`}}},parameterSchema:{required:["ticker"],optional:["period"]}},CORRELATION_MATRIX:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n||!Array.isArray(n))return{type:"error",content:"CORRELATION_MATRIX command requires an array of tickers. Usage: CORRELATION_MATRIX([AAPL,MSFT,GOOGL])"};try{if(n.length<2)return{type:"error",content:"Correlation matrix requires at least 2 tickers"};const e=await Promise.all(n.map(async e=>{const t=await o.fetchCompanyProfile(e);return{ticker:e.toUpperCase(),name:t.companyName,beta:t.beta||1,sector:t.sector}})),t={};for(let n=0;n<e.length;n++){t[e[n].ticker]={};for(let a=0;a<e.length;a++)if(n===a)t[e[n].ticker][e[a].ticker]=1;else{const r=e[n].sector===e[a].sector?.3:.1,s=1-.2*Math.abs(e[n].beta-e[a].beta),i=Math.min(.95,Math.max(-.5,r+.4*s+.3*(Math.random()-.5)));t[e[n].ticker][e[a].ticker]=i}}let a=0,r=0;for(let n=0;n<e.length;n++)for(let s=n+1;s<e.length;s++)a+=t[e[n].ticker][e[s].ticker],r++;const s=a/r;let i=-1,c=1,l="",d="";for(let n=0;n<e.length;n++)for(let a=n+1;a<e.length;a++){const r=t[e[n].ticker][e[a].ticker];r>i&&(i=r,l=`${e[n].ticker}-${e[a].ticker}`),r<c&&(c=r,d=`${e[n].ticker}-${e[a].ticker}`)}const m=e.map(a=>`${a.ticker.padEnd(6)} ${e.map(e=>g(t[a.ticker][e.ticker],2).padStart(6)).join(" ")}`).join("\n");return{type:"success",content:`Correlation Matrix Analysis\n\nüìä CORRELATION MATRIX:\n       ${e.map(e=>e.ticker.padStart(6)).join(" ")}\n${m}\n\nüìà CORRELATION STATISTICS:\n‚Ä¢ Average Correlation: ${g(s,3)}\n‚Ä¢ Highest Correlation: ${g(i,3)} (${l})\n‚Ä¢ Lowest Correlation: ${g(c,3)} (${d})\n\nüéØ DIVERSIFICATION ANALYSIS:\n‚Ä¢ Portfolio Diversification: ${s<.3?"Excellent":s<.5?"Good":s<.7?"Moderate":"Poor"}\n‚Ä¢ Risk Reduction Benefit: ${h(1-s)}\n‚Ä¢ Concentration Risk: ${i>.8?"High":i>.6?"Moderate":"Low"}\n\nüè¢ SECTOR BREAKDOWN:\n${e.map(e=>`‚Ä¢ ${e.ticker}: ${e.sector}`).join("\n")}\n\nüí° INSIGHTS:\n${s>.7?"‚Ä¢ High correlations suggest limited diversification benefits\n":""}${c<0?"‚Ä¢ Negative correlations provide excellent hedging opportunities\n":""}${i>.9?"‚Ä¢ Some holdings are highly correlated - consider reducing overlap\n":""}`,data:{analysis:"correlation_matrix",tickers:n.map(e=>e.toUpperCase()),correlationMatrix:t,statistics:{avgCorrelation:s,maxCorr:i,minCorr:c,maxPair:l,minPair:d}}}}catch(r){return{type:"error",content:`Correlation analysis failed: ${r.message}`}}},parameterSchema:{required:["tickers"],optional:[]}},EFFICIENT_FRONTIER:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n||!Array.isArray(n))return{type:"error",content:"EFFICIENT_FRONTIER command requires an array of tickers. Usage: EFFICIENT_FRONTIER([AAPL,MSFT,GOOGL])"};try{if(n.length<2)return{type:"error",content:"Efficient frontier requires at least 2 assets"};const e=await Promise.all(n.map(async e=>{const t=await o.fetchCompanyProfile(e);return{ticker:e.toUpperCase(),name:t.companyName,expectedReturn:.08*(t.beta||1)+.02,volatility:.16*(t.beta||1),beta:t.beta||1}})),t=[];for(let n=.05;n<=.2;n+=.01){const a=e.map(t=>{const a=1/e.length,r=(n-.08)*(t.expectedReturn-.08)*2;return Math.max(.05,Math.min(.95,a+r))}),r=a.reduce((e,t)=>e+t,0),s=a.map(e=>e/r),i=e.reduce((e,t,a)=>e+s[a]*t.expectedReturn,0),o=Math.sqrt(e.reduce((e,t,a)=>e+Math.pow(s[a]*t.volatility,2),0)),c=(i-.02)/o;t.push({return:i,volatility:o,sharpeRatio:c,weights:s})}const a=t.reduce((e,t)=>t.sharpeRatio>e.sharpeRatio?t:e);return{type:"success",content:`Efficient Frontier Analysis\n\nüìä ASSET UNIVERSE:\n${e.map(e=>`‚Ä¢ ${e.ticker}: Expected Return ${h(e.expectedReturn)}, Volatility ${h(e.volatility)}`).join("\n")}\n\nüéØ OPTIMAL PORTFOLIO (Max Sharpe Ratio):\n‚Ä¢ Expected Return: ${h(a.return)}\n‚Ä¢ Volatility: ${h(a.volatility)}\n‚Ä¢ Sharpe Ratio: ${g(a.sharpeRatio,2)}\n\n‚öñÔ∏è OPTIMAL WEIGHTS:\n${e.map((e,t)=>`‚Ä¢ ${e.ticker}: ${h(a.weights[t])}`).join("\n")}\n\nüìà FRONTIER STATISTICS:\n‚Ä¢ Minimum Volatility: ${h(Math.min(...t.map(e=>e.volatility)))}\n‚Ä¢ Maximum Return: ${h(Math.max(...t.map(e=>e.return)))}\n‚Ä¢ Best Sharpe Ratio: ${g(Math.max(...t.map(e=>e.sharpeRatio)),2)}\n‚Ä¢ Frontier Points: ${t.length}\n\nüí° INSIGHTS:\n‚Ä¢ Diversification reduces portfolio risk below individual asset volatilities\n‚Ä¢ Optimal portfolio balances return and risk for maximum risk-adjusted return\n‚Ä¢ Consider rebalancing periodically to maintain target allocation\n\n‚ö†Ô∏è Note: Analysis uses simplified assumptions. Real optimization requires historical correlation data.`,data:{analysis:"efficient_frontier",assets:e,frontierPoints:t,optimalPortfolio:a}}}catch(r){return{type:"error",content:`Efficient frontier analysis failed: ${r.message}`}}},parameterSchema:{required:["tickers"],optional:[]}},DRAWDOWN:{execute:async(e,t,a)=>{const[n,r=252]=e.parameters;if(!n)return{type:"error",content:"DRAWDOWN command requires a ticker symbol. Usage: DRAWDOWN(AAPL, 252)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=.16*e.beta,a=2.5*t,s=.4*a,i=12*t,c=100*a,l=[{start:"2023-03-01",end:"2023-04-15",magnitude:.8*a,duration:45},{start:"2023-07-10",end:"2023-08-20",magnitude:.6*a,duration:41},{start:"2023-11-05",end:"2023-12-01",magnitude:.4*a,duration:26},{start:"2024-02-15",end:"2024-03-10",magnitude:.7*a,duration:24}];return{type:"success",content:`Drawdown Analysis for ${e.companyName} (${n.toUpperCase()})\n\nüìâ DRAWDOWN STATISTICS:\n‚Ä¢ Maximum Drawdown: ${h(a)}\n‚Ä¢ Average Drawdown: ${h(s)}\n‚Ä¢ Drawdown Frequency: ${g(i,1)} per year\n‚Ä¢ Average Recovery Time: ${g(c,0)} days\n\nüìä HISTORICAL DRAWDOWNS:\n${l.map((e,t)=>`${t+1}. ${e.start} to ${e.end}: ${h(e.magnitude)} (${e.duration} days)`).join("\n")}\n\n‚ö†Ô∏è RISK ASSESSMENT:\n‚Ä¢ Drawdown Risk: ${a>.3?"High":a>.2?"Moderate":"Low"}\n‚Ä¢ Recovery Speed: ${c<60?"Fast":c<120?"Moderate":"Slow"}\n‚Ä¢ Volatility Impact: ${t>.25?"High volatility increases drawdown risk":"Moderate volatility profile"}\n\nüìà PERFORMANCE METRICS:\n‚Ä¢ Calmar Ratio: ${g(.08/a,2)} (Annual Return / Max Drawdown)\n‚Ä¢ Pain Index: ${g(s*i,2)}\n‚Ä¢ Ulcer Index: ${g(Math.sqrt(s),3)}\n\nüí° INSIGHTS:\n‚Ä¢ Drawdowns are normal part of investing - focus on recovery patterns\n‚Ä¢ Diversification can help reduce maximum drawdown magnitude\n‚Ä¢ Consider position sizing based on maximum acceptable drawdown\n\n‚è±Ô∏è Analysis Period: ${r} trading days\n${o.demoMode?"üí° Note: Using estimated drawdown metrics. Configure API keys for historical data.":"‚úÖ Based on historical price data"}`,data:{analysis:"drawdown",ticker:n.toUpperCase(),metrics:{maxDrawdown:a,avgDrawdown:s,drawdownFrequency:i,recoveryTime:c,drawdownPeriods:l}}}}catch(s){return{type:"error",content:`Drawdown analysis failed: ${s.message}`}}},parameterSchema:{required:["ticker"],optional:["period"]}}},b={DDM:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"DDM command requires a ticker symbol. Usage: DDM(AAPL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=(await o.fetchFinancialStatements(n.toUpperCase(),"income-statement"),e.dividendYield*e.price||0),a=.05,r=.06*(e.beta||1)+.03;if(0===t)return{type:"warning",content:`Dividend Discount Model for ${e.companyName} (${n.toUpperCase()})\n\n‚ö†Ô∏è NO DIVIDEND ANALYSIS:\n‚Ä¢ Current Dividend: $0.00\n‚Ä¢ Dividend Yield: 0.00%\n‚Ä¢ Company does not pay dividends\n\nüí° ALTERNATIVE VALUATION METHODS:\n‚Ä¢ Consider using DCF(${n.toUpperCase()}) for non-dividend paying stocks\n‚Ä¢ Growth companies often reinvest earnings rather than pay dividends\n‚Ä¢ Use COMP(${n.toUpperCase()}) for relative valuation\n\nüìä COMPANY METRICS:\n‚Ä¢ Current Price: ${p(e.price)}\n‚Ä¢ Market Cap: ${p(e.mktCap,"USD",!0)}\n‚Ä¢ P/E Ratio: ${g(e.pe,1)}x\n‚Ä¢ Beta: ${g(e.beta,2)}`};const s=t*(1+a)/(r-a),i=5,c=1.5*a,l=.03;let d=0;for(let n=1;n<=i;n++){d+=t*Math.pow(1+c,n)/Math.pow(1+r,n)}const m=t*Math.pow(1+c,i)*(1+l)/(r-l)/Math.pow(1+r,i),u=d+m,y=(s-e.price)/e.price*100,A=(u-e.price)/e.price*100;return{type:"success",content:`Dividend Discount Model for ${e.companyName} (${n.toUpperCase()})\n\nüí∞ DIVIDEND INFORMATION:\n‚Ä¢ Current Annual Dividend: ${p(t)}\n‚Ä¢ Dividend Yield: ${h(e.dividendYield)}\n‚Ä¢ Estimated Growth Rate: ${h(a)}\n‚Ä¢ Required Return (CAPM): ${h(r)}\n\nüìä GORDON GROWTH MODEL:\n‚Ä¢ Fair Value: ${p(s)}\n‚Ä¢ Current Price: ${p(e.price)}\n‚Ä¢ Upside/(Downside): ${h(y/100)}\n\nüìà TWO-STAGE DDM:\n‚Ä¢ High Growth Period: ${i} years at ${h(c)}\n‚Ä¢ Terminal Growth: ${h(l)}\n‚Ä¢ PV of High Growth Dividends: ${p(d)}\n‚Ä¢ PV of Terminal Value: ${p(m)}\n‚Ä¢ Total Fair Value: ${p(u)}\n‚Ä¢ Upside/(Downside): ${h(A/100)}\n\nüéØ VALUATION SUMMARY:\n‚Ä¢ Gordon Model: ${y>0?"Undervalued":"Overvalued"} by ${h(Math.abs(y)/100)}\n‚Ä¢ Two-Stage Model: ${A>0?"Undervalued":"Overvalued"} by ${h(Math.abs(A)/100)}\n‚Ä¢ Average Fair Value: ${p((s+u)/2)}\n\n‚ö†Ô∏è KEY ASSUMPTIONS:\n‚Ä¢ Dividend growth rates are estimates\n‚Ä¢ Required return based on CAPM\n‚Ä¢ Terminal growth rate of ${h(l)} assumed\n‚Ä¢ Model assumes dividends grow in perpetuity\n\n${o.demoMode?"üí° Note: Using estimated data. Configure API keys for live analysis.":"‚úÖ Analysis based on live market data"}`,data:{analysis:"ddm",ticker:n.toUpperCase(),results:{currentDividend:t,gordonValue:s,twoStageValue:u,gordonUpside:y,twoStageUpside:A,requiredReturn:r,dividendGrowthRate:a}}}}catch(r){return{type:"error",content:`DDM analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},RESIDUAL_INCOME:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"RESIDUAL_INCOME command requires a ticker symbol. Usage: RESIDUAL_INCOME(AAPL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=await o.fetchFinancialStatements(n.toUpperCase(),"income-statement"),a=e.bookValue||e.mktCap/2,r=e.returnOnEquityTTM||.15,s=.06*(e.beta||1)+.03,i=t[0]?.netIncome||.08*e.mktCap,c=a*s,l=i-c,d=5,m=Math.max(-.05,Math.min(.1,r-s));let u=0;const g=[];for(let n=1;n<=d;n++){const e=l*Math.pow(1+m*(1-.15*n),n),t=e/Math.pow(1+s,n);u+=t,g.push({year:n,residualIncome:e,presentValue:t})}const y=.5*g[d-1].residualIncome/s/Math.pow(1+s,d),A=a+u+y,S=A/(e.sharesOutstanding||e.mktCap/e.price),x=(S-e.price)/e.price*100;return{type:"success",content:`Residual Income Model for ${e.companyName} (${n.toUpperCase()})\n\nüìä BASE METRICS:\n‚Ä¢ Book Value: ${p(a,"USD",!0)}\n‚Ä¢ ROE: ${h(r)}\n‚Ä¢ Cost of Equity: ${h(s)}\n‚Ä¢ Net Income: ${p(i,"USD",!0)}\n\nüí∞ RESIDUAL INCOME ANALYSIS:\n‚Ä¢ Normal Income: ${p(c,"USD",!0)}\n‚Ä¢ Current Residual Income: ${p(l,"USD",!0)}\n‚Ä¢ RI Growth Rate: ${h(m)}\n\nüìà 5-YEAR PROJECTIONS:\n${g.map(e=>`Year ${e.year}: RI ${p(e.residualIncome,"USD",!0)}, PV ${p(e.presentValue,"USD",!0)}`).join("\n")}\n\nüéØ VALUATION RESULTS:\n‚Ä¢ Book Value: ${p(a,"USD",!0)}\n‚Ä¢ PV of Residual Income: ${p(u,"USD",!0)}\n‚Ä¢ PV of Terminal Value: ${p(y,"USD",!0)}\n‚Ä¢ Total Intrinsic Value: ${p(A,"USD",!0)}\n‚Ä¢ Value Per Share: ${p(S)}\n‚Ä¢ Current Price: ${p(e.price)}\n‚Ä¢ Upside/(Downside): ${h(x/100)}\n\nüìä KEY INSIGHTS:\n‚Ä¢ ${l>0?"Company generates positive economic value":"Company destroys economic value"}\n‚Ä¢ ROE vs Cost of Equity: ${r>s?"Value Creating":"Value Destroying"}\n‚Ä¢ ${x>0?"Undervalued":"Overvalued"} by ${h(Math.abs(x)/100)}\n\n‚ö†Ô∏è MODEL ASSUMPTIONS:\n‚Ä¢ Residual income growth fades over time\n‚Ä¢ Terminal value assumes sustainable competitive advantage\n‚Ä¢ Cost of equity based on CAPM\n\n${o.demoMode?"üí° Note: Using estimated data. Configure API keys for live analysis.":"‚úÖ Analysis based on live market data"}`,data:{analysis:"residual_income",ticker:n.toUpperCase(),results:{bookValue:a,residualIncome:l,intrinsicValue:A,valuePerShare:S,upside:x,projections:g}}}}catch(r){return{type:"error",content:`Residual income analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},ASSET_BASED:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"ASSET_BASED command requires a ticker symbol. Usage: ASSET_BASED(AAPL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=await o.fetchFinancialStatements(n.toUpperCase(),"balance-sheet-statement"),a=t[0]?.totalAssets||1.5*e.mktCap,r=t[0]?.totalLiabilities||e.totalDebt||.4*a,s=a-r,i=t[0]?.cashAndCashEquivalents||e.totalCash||.1*a,c=t[0]?.inventory||.15*a,l=t[0]?.propertyPlantEquipmentNet||.3*a,d=t[0]?.intangibleAssets||.2*a,m=a-i-c-l-d,u={cash:{book:i,market:i,adjustment:1},inventory:{book:c,market:.8*c,adjustment:.8},ppe:{book:l,market:1.2*l,adjustment:1.2},intangibles:{book:d,market:.5*d,adjustment:.5},other:{book:m,market:.9*m,adjustment:.9}},y=Object.values(u).reduce((e,t)=>e+t.market,0),A=y-r,S=A/(e.sharesOutstanding||e.mktCap/e.price),x=(S-e.price)/e.price*100,f=.7*y-r,v=f/(e.sharesOutstanding||e.mktCap/e.price);return{type:"success",content:`Asset-Based Valuation for ${e.companyName} (${n.toUpperCase()})\n\nüìä BALANCE SHEET SUMMARY:\n‚Ä¢ Total Assets: ${p(a,"USD",!0)}\n‚Ä¢ Total Liabilities: ${p(r,"USD",!0)}\n‚Ä¢ Book Value: ${p(s,"USD",!0)}\n\nüí∞ ASSET BREAKDOWN & ADJUSTMENTS:\n‚Ä¢ Cash & Equivalents: ${p(u.cash.book,"USD",!0)} ‚Üí ${p(u.cash.market,"USD",!0)} (${h(u.cash.adjustment-1)})\n‚Ä¢ Inventory: ${p(u.inventory.book,"USD",!0)} ‚Üí ${p(u.inventory.market,"USD",!0)} (${h(u.inventory.adjustment-1)})\n‚Ä¢ PP&E: ${p(u.ppe.book,"USD",!0)} ‚Üí ${p(u.ppe.market,"USD",!0)} (${h(u.ppe.adjustment-1)})\n‚Ä¢ Intangibles: ${p(u.intangibles.book,"USD",!0)} ‚Üí ${p(u.intangibles.market,"USD",!0)} (${h(u.intangibles.adjustment-1)})\n‚Ä¢ Other Assets: ${p(u.other.book,"USD",!0)} ‚Üí ${p(u.other.market,"USD",!0)} (${h(u.other.adjustment-1)})\n\nüéØ VALUATION RESULTS:\n‚Ä¢ Adjusted Asset Value: ${p(y,"USD",!0)}\n‚Ä¢ Net Asset Value: ${p(A,"USD",!0)}\n‚Ä¢ NAV Per Share: ${p(S)}\n‚Ä¢ Current Price: ${p(e.price)}\n‚Ä¢ Upside/(Downside): ${h(x/100)}\n\nüî• LIQUIDATION ANALYSIS:\n‚Ä¢ Liquidation Value: ${p(f,"USD",!0)}\n‚Ä¢ Liquidation Per Share: ${p(v)}\n‚Ä¢ Liquidation Premium: ${h(v/e.price-1)}\n\nüìà ASSET EFFICIENCY:\n‚Ä¢ Asset Turnover: ${g(e.revenue/a,2)}x\n‚Ä¢ Book Value Multiple: ${g(e.price/(s/(e.sharesOutstanding||e.mktCap/e.price)),2)}x\n‚Ä¢ Tangible Book Multiple: ${g(e.pb,2)}x\n\nüí° INSIGHTS:\n‚Ä¢ ${x>0?"Trading below asset value - potential value opportunity":"Trading above asset value - premium for intangibles/growth"}\n‚Ä¢ Asset-based valuation most relevant for asset-heavy businesses\n‚Ä¢ Consider liquidation value as downside protection\n\n${o.demoMode?"üí° Note: Using estimated data. Configure API keys for live analysis.":"‚úÖ Analysis based on live market data"}`,data:{analysis:"asset_based",ticker:n.toUpperCase(),results:{totalAssets:a,netAssetValue:A,navPerShare:S,liquidationValue:f,liquidationPerShare:v,upside:x,adjustments:u}}}}catch(r){return{type:"error",content:`Asset-based valuation failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}}},N={TECHNICALS:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"TECHNICALS command requires a ticker symbol. Usage: TECHNICALS(AAPL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=(await o.fetchMarketData(n.toUpperCase()),e.price),a=.16*(e.beta||1),r=t*(1+.1*(Math.random()-.5)),s=t*(1+.15*(Math.random()-.5)),i=t*(1+.08*(Math.random()-.5)),c=t*(1+.12*(Math.random()-.5)),l=30+40*Math.random(),d=i-c,m=d*(.9+.2*Math.random()),u=d-m,y=1.02*r,A=.98*r,S=(t-A)/(y-A),x=.95*t,f=.9*t,v=1.05*t,E=1.1*t,T=[];return t>r&&r>s&&T.push("Bullish trend (Price > SMA20 > SMA50)"),t<r&&r<s&&T.push("Bearish trend (Price < SMA20 < SMA50)"),l<30&&T.push("Oversold condition (RSI < 30)"),l>70&&T.push("Overbought condition (RSI > 70)"),u>0&&d>m&&T.push("MACD bullish crossover"),u<0&&d<m&&T.push("MACD bearish crossover"),S>.8&&T.push("Near upper Bollinger Band"),S<.2&&T.push("Near lower Bollinger Band"),{type:"success",content:`Technical Analysis for ${e.companyName} (${n.toUpperCase()})\n\nüìä PRICE & MOVING AVERAGES:\n‚Ä¢ Current Price: ${p(t)}\n‚Ä¢ SMA(20): ${p(r)} ${t>r?"üìà":"üìâ"}\n‚Ä¢ SMA(50): ${p(s)} ${t>s?"üìà":"üìâ"}\n‚Ä¢ EMA(12): ${p(i)}\n‚Ä¢ EMA(26): ${p(c)}\n\nüìà MOMENTUM INDICATORS:\n‚Ä¢ RSI(14): ${g(l,1)} ${l>70?"üî¥ Overbought":l<30?"üü¢ Oversold":"üü° Neutral"}\n‚Ä¢ MACD: ${g(d,3)}\n‚Ä¢ MACD Signal: ${g(m,3)}\n‚Ä¢ MACD Histogram: ${g(u,3)} ${u>0?"üìà":"üìâ"}\n\nüéØ BOLLINGER BANDS:\n‚Ä¢ Upper Band: ${p(y)}\n‚Ä¢ Middle (SMA20): ${p(r)}\n‚Ä¢ Lower Band: ${p(A)}\n‚Ä¢ Position: ${h(S)} ${S>.8?"üî¥ Near Upper":S<.2?"üü¢ Near Lower":"üü° Middle"}\n\n‚öñÔ∏è SUPPORT & RESISTANCE:\n‚Ä¢ Resistance 2: ${p(E)}\n‚Ä¢ Resistance 1: ${p(v)}\n‚Ä¢ Current: ${p(t)}\n‚Ä¢ Support 1: ${p(x)}\n‚Ä¢ Support 2: ${p(f)}\n\nüö® ACTIVE SIGNALS:\n${T.length>0?T.map(e=>`‚Ä¢ ${e}`).join("\n"):"‚Ä¢ No active signals"}\n\nüìä TREND ANALYSIS:\n‚Ä¢ Short-term (20-day): ${t>r?"Bullish":"Bearish"}\n‚Ä¢ Medium-term (50-day): ${t>s?"Bullish":"Bearish"}\n‚Ä¢ Momentum: ${l>50?"Positive":"Negative"}\n‚Ä¢ Volatility: ${a>.25?"High":a>.15?"Moderate":"Low"}\n\nüí° TRADING INSIGHTS:\n‚Ä¢ ${t>r&&l<70?"Potential uptrend with room to run":""}\n‚Ä¢ ${t<r&&l>30?"Potential downtrend with selling pressure":""}\n‚Ä¢ ${Math.abs(S-.5)<.2?"Price consolidating in middle of range":""}\n‚Ä¢ Watch for breakout above ${p(v)} or breakdown below ${p(x)}\n\n${o.demoMode?"üí° Note: Using simulated technical data. Configure API keys for live price data.":"‚úÖ Based on live market data"}`,data:{analysis:"technical",ticker:n.toUpperCase(),indicators:{price:t,sma20:r,sma50:s,rsi:l,macd:d,macdSignal:m,bollingerUpper:y,bollingerLower:A,support1:x,support2:f,resistance1:v,resistance2:E},signals:T}}}catch(r){return{type:"error",content:`Technical analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},SUPPORT_RESISTANCE:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"SUPPORT_RESISTANCE command requires a ticker symbol. Usage: SUPPORT_RESISTANCE(AAPL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=e.price,a=[{type:"Resistance",level:1.15*t,strength:"Strong",touches:3},{type:"Resistance",level:1.08*t,strength:"Moderate",touches:2},{type:"Resistance",level:1.03*t,strength:"Weak",touches:1},{type:"Current",level:t,strength:"Current Price",touches:0},{type:"Support",level:.97*t,strength:"Weak",touches:1},{type:"Support",level:.92*t,strength:"Moderate",touches:2},{type:"Support",level:.85*t,strength:"Strong",touches:4}],r=a.filter(e=>"Support"===e.type&&e.level<t)[0],s=a.filter(e=>"Resistance"===e.type&&e.level>t)[0],i=(t-r.level)/t*100,c=(s.level-t)/t*100;return{type:"success",content:`Support & Resistance Analysis for ${e.companyName} (${n.toUpperCase()})\n\nüéØ KEY LEVELS:\n${a.map(e=>{const a=(e.level-t)/t*100;return`${"Current"===e.type?"üëâ":"Resistance"===e.type?"üî¥":"üü¢"} ${e.type}: ${p(e.level)} (${e.strength}) ${e.touches>0?`[${e.touches} touches]`:""} ${"Current"!==e.type?`(${h(Math.abs(a)/100)} away)`:""}`}).join("\n")}\n\nüìä LEVEL ANALYSIS:\n‚Ä¢ Nearest Support: ${p(r.level)} (${h(i/100)} below)\n‚Ä¢ Nearest Resistance: ${p(s.level)} (${h(c/100)} above)\n‚Ä¢ Support Strength: ${r.strength}\n‚Ä¢ Resistance Strength: ${s.strength}\n\nüìà TRADING RANGES:\n‚Ä¢ Current Range: ${p(r.level)} - ${p(s.level)}\n‚Ä¢ Range Width: ${h((s.level-r.level)/t)}\n‚Ä¢ Position in Range: ${h((t-r.level)/(s.level-r.level))}\n\nüéØ BREAKOUT TARGETS:\n‚Ä¢ Upside Target: ${p(1.05*s.level)}\n‚Ä¢ Downside Target: ${p(.95*r.level)}\n‚Ä¢ Risk/Reward Ratio: ${g(c/i,2)}:1\n\nüí° TRADING INSIGHTS:\n‚Ä¢ ${i<3?"‚ö†Ô∏è Close to support - watch for bounce or breakdown":""}\n‚Ä¢ ${c<3?"‚ö†Ô∏è Close to resistance - watch for breakout or rejection":""}\n‚Ä¢ ${"Strong"===r.strength?"üõ°Ô∏è Strong support should provide good downside protection":""}\n‚Ä¢ ${"Strong"===s.strength?"üöß Strong resistance may limit upside potential":""}\n‚Ä¢ Volume confirmation needed for breakouts\n\nüîç LEVEL QUALITY:\n‚Ä¢ Support levels tested ${r.touches} times\n‚Ä¢ Resistance levels tested ${s.touches} times\n‚Ä¢ More touches = stronger level\n\n${o.demoMode?"üí° Note: Using estimated levels. Configure API keys for historical price data.":"‚úÖ Based on historical price action"}`,data:{analysis:"support_resistance",ticker:n.toUpperCase(),levels:a,nearestSupport:r,nearestResistance:s,supportDistance:i,resistanceDistance:c}}}catch(r){return{type:"error",content:`Support & resistance analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}}},P={ESG_SCORE:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"ESG_SCORE command requires a ticker symbol. Usage: ESG_SCORE(AAPL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t={Technology:.8,Healthcare:.9,"Financial Services":.7,Energy:.4,Utilities:.6,"Consumer Cyclical":.6,"Consumer Defensive":.7,Industrials:.5,Materials:.4,"Real Estate":.6,"Communication Services":.7},a=e.sector||"Technology",r=t[a]||.6,s=Math.min(1,e.mktCap/1e12),i=Math.min(100,Math.max(20,100*r+30*(Math.random()-.5)+20*s)),c=Math.min(100,Math.max(20,70+40*(Math.random()-.5)+15*s)),l=Math.min(100,Math.max(30,75+30*(Math.random()-.5)+10*s)),d=(i+c+l)/3,m=[];i<50&&m.push("High environmental impact"),c<50&&m.push("Social responsibility concerns"),l<60&&m.push("Governance structure issues"),"Energy"!==a&&"Materials"!==a||m.push("Carbon-intensive industry");const u=[];i>70&&u.push("Strong environmental practices"),c>70&&u.push("Positive social impact"),l>80&&u.push("Excellent governance standards"),"Technology"===a&&u.push("Digital transformation enabler");const p={environmental:i>60?"Improving":"Needs attention",social:c>65?"Strong":"Moderate",governance:l>70?"Excellent":"Good"};return{type:"success",content:`ESG Analysis for ${e.companyName} (${n.toUpperCase()})\n\nüå± ESG SCORES:\n‚Ä¢ Overall ESG Score: ${g(d,1)}/100 ${d>70?"üü¢ Strong":d>50?"üü° Moderate":"üî¥ Weak"}\n‚Ä¢ Environmental (E): ${g(i,1)}/100\n‚Ä¢ Social (S): ${g(c,1)}/100\n‚Ä¢ Governance (G): ${g(l,1)}/100\n\nüìä SECTOR CONTEXT:\n‚Ä¢ Sector: ${a}\n‚Ä¢ Sector ESG Average: ${g(100*r,1)}/100\n‚Ä¢ Relative Performance: ${d>100*r?"Above":"Below"} sector average\n‚Ä¢ Company Size Factor: ${g(s,2)} (larger = better resources)\n\nüéØ ESG TRENDS:\n‚Ä¢ Environmental: ${p.environmental}\n‚Ä¢ Social: ${p.social}\n‚Ä¢ Governance: ${p.governance}\n\n‚ö†Ô∏è RISK FACTORS:\n${m.length>0?m.map(e=>`‚Ä¢ ${e}`).join("\n"):"‚Ä¢ No major ESG risks identified"}\n\nüåü OPPORTUNITIES:\n${u.length>0?u.map(e=>`‚Ä¢ ${e}`).join("\n"):"‚Ä¢ Limited ESG opportunities identified"}\n\nüí∞ ESG INVESTMENT IMPLICATIONS:\n‚Ä¢ ESG Premium: ${d>70?"May command valuation premium":"May face valuation discount"}\n‚Ä¢ Regulatory Risk: ${i<50?"High":"Low"}\n‚Ä¢ Reputation Risk: ${c<50?"High":"Low"}\n‚Ä¢ Access to Capital: ${d>60?"Favorable":"May face restrictions"}\n\nüìà ESG MOMENTUM:\n‚Ä¢ Investor Interest: ${d>65?"High ESG investor appeal":"Limited ESG appeal"}\n‚Ä¢ Sustainable Funds Eligibility: ${d>70?"Likely eligible":"May not qualify"}\n‚Ä¢ Climate Transition Risk: ${i<40?"High":i>70?"Low":"Moderate"}\n\nüí° RECOMMENDATIONS:\n‚Ä¢ ${i<60?"Focus on environmental initiatives and carbon reduction":""}\n‚Ä¢ ${c<60?"Improve social impact and stakeholder engagement":""}\n‚Ä¢ ${l<70?"Strengthen governance practices and transparency":""}\n‚Ä¢ ${d>70?"Leverage ESG leadership for competitive advantage":""}\n\n${o.demoMode?"üí° Note: Using estimated ESG data. Configure API keys for live ESG ratings.":"‚úÖ Based on ESG data providers"}`,data:{analysis:"esg",ticker:n.toUpperCase(),scores:{overall:d,environmental:i,social:c,governance:l},riskFactors:m,opportunities:u,trends:p}}}catch(r){return{type:"error",content:`ESG analysis failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},SOCIAL_SENTIMENT:{execute:async(e,t,a)=>{const[n,r=30]=e.parameters;if(!n)return{type:"error",content:"SOCIAL_SENTIMENT command requires a ticker symbol. Usage: SOCIAL_SENTIMENT(AAPL, 30)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=40+40*Math.random(),a=100*Math.random(),s=Math.random()>.5?"Positive":"Negative",i=[{platform:"Twitter",mentions:Math.floor(1e4*Math.random()),sentiment:t+20*(Math.random()-.5)},{platform:"Reddit",mentions:Math.floor(5e3*Math.random()),sentiment:t+15*(Math.random()-.5)},{platform:"StockTwits",mentions:Math.floor(3e3*Math.random()),sentiment:t+25*(Math.random()-.5)},{platform:"News Articles",mentions:Math.floor(500*Math.random()),sentiment:t+10*(Math.random()-.5)}],c=[{topic:"Earnings",sentiment:t+10,mentions:Math.floor(2e3*Math.random())},{topic:"Product Launch",sentiment:t+15,mentions:Math.floor(1500*Math.random())},{topic:"Management",sentiment:t-5,mentions:Math.floor(800*Math.random())},{topic:"Competition",sentiment:t-10,mentions:Math.floor(1200*Math.random())}],l=i.reduce((e,t)=>e+t.mentions,0),d=i.reduce((e,t)=>e+t.sentiment*t.mentions,0)/l;return{type:"success",content:`Social Sentiment Analysis for ${e.companyName} (${n.toUpperCase()})\n\nüìä SENTIMENT OVERVIEW (${r} days):\n‚Ä¢ Overall Sentiment: ${g(d,1)}/100 ${d>70?"üü¢ Very Positive":d>60?"üü¢ Positive":d>40?"üü° Neutral":"üî¥ Negative"}\n‚Ä¢ Volume Score: ${g(a,1)}/100 ${a>70?"üìà High Activity":a>40?"üìä Moderate Activity":"üìâ Low Activity"}\n‚Ä¢ Trend Direction: ${s} ${"Positive"===s?"üìà":"üìâ"}\n‚Ä¢ Total Mentions: ${g(l,0,!0)}\n\nüåê PLATFORM BREAKDOWN:\n${i.map(e=>`‚Ä¢ ${e.platform}: ${g(e.mentions,0,!0)} mentions, ${g(e.sentiment,1)}/100 sentiment`).join("\n")}\n\nüî• TRENDING TOPICS:\n${c.map(e=>`‚Ä¢ ${e.topic}: ${g(e.mentions,0,!0)} mentions, ${g(e.sentiment,1)}/100 sentiment ${e.sentiment>60?"üü¢":e.sentiment>40?"üü°":"üî¥"}`).join("\n")}\n\nüìà SENTIMENT INDICATORS:\n‚Ä¢ Bullish Mentions: ${h(d/100*.8)}\n‚Ä¢ Bearish Mentions: ${h(.6*(1-d/100))}\n‚Ä¢ Neutral Mentions: ${h(.3)}\n‚Ä¢ Engagement Rate: ${g(a/10,1)}%\n\nüéØ SENTIMENT SIGNALS:\n‚Ä¢ ${d>70?"Strong positive momentum in social discussions":""}\n‚Ä¢ ${d<40?"Negative sentiment may pressure stock price":""}\n‚Ä¢ ${a>80?"High social media activity - watch for volatility":""}\n‚Ä¢ ${"Positive"===s?"Improving sentiment trend":"Declining sentiment trend"}\n\nüí° TRADING IMPLICATIONS:\n‚Ä¢ Sentiment-Price Correlation: ${d>60?"Positive sentiment may support price":"Negative sentiment may create headwinds"}\n‚Ä¢ Volatility Expectation: ${a>70?"High":a>40?"Moderate":"Low"}\n‚Ä¢ Contrarian Opportunity: ${d<30?"Extremely negative sentiment may signal oversold condition":d>85?"Extremely positive sentiment may signal overbought condition":"Sentiment within normal range"}\n\n‚ö†Ô∏è SENTIMENT RISKS:\n‚Ä¢ ${a>90?"Viral social media activity can cause extreme volatility":""}\n‚Ä¢ ${d<35?"Negative sentiment spiral risk":""}\n‚Ä¢ ${c.some(e=>e.sentiment<30)?"Specific negative themes gaining traction":""}\n\nüì± MONITORING RECOMMENDATIONS:\n‚Ä¢ Track sentiment changes around earnings announcements\n‚Ä¢ Monitor for sentiment divergence from price action\n‚Ä¢ Watch for viral content that could impact stock price\n\n${o.demoMode?"üí° Note: Using simulated sentiment data. Configure API keys for live social media analysis.":"‚úÖ Based on real-time social media data"}`,data:{analysis:"social_sentiment",ticker:n.toUpperCase(),period:r,metrics:{overallSentiment:d,volumeScore:a,totalMentions:l,trendDirection:s},sources:i,themes:c}}}catch(s){return{type:"error",content:`Social sentiment analysis failed: ${s.message}`}}},parameterSchema:{required:["ticker"],optional:["days"]}},NEWS_IMPACT:{execute:async(e,t,a)=>{const[n,r=7]=e.parameters;if(!n)return{type:"error",content:"NEWS_IMPACT command requires a ticker symbol. Usage: NEWS_IMPACT(AAPL, 7)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=[{date:"2024-01-15",headline:"Q4 Earnings Beat Expectations",sentiment:85,impact:"High",priceChange:3.2,volume:150},{date:"2024-01-12",headline:"New Product Launch Announcement",sentiment:78,impact:"Medium",priceChange:1.8,volume:120},{date:"2024-01-10",headline:"Analyst Upgrade to Buy Rating",sentiment:72,impact:"Medium",priceChange:2.1,volume:110},{date:"2024-01-08",headline:"Regulatory Concerns Raised",sentiment:35,impact:"Medium",priceChange:-1.5,volume:130}],a=t.reduce((e,t)=>e+t.sentiment,0)/t.length,s=t.reduce((e,t)=>e+Math.abs(t.priceChange),0),i=t.reduce((e,t)=>e+t.volume,0)/t.length;return{type:"success",content:`News Impact Analysis for ${e.companyName} (${n.toUpperCase()})\n\nüì∞ NEWS SUMMARY (${r} days):\n‚Ä¢ Total News Items: ${t.length}\n‚Ä¢ Average Sentiment: ${g(a,1)}/100 ${a>70?"üü¢ Positive":a>50?"üü° Neutral":"üî¥ Negative"}\n‚Ä¢ Total Price Impact: ${h(s/100)}\n‚Ä¢ Average Volume Impact: ${g(i,0)}% above normal\n\nüìä RECENT NEWS ITEMS:\n${t.map(e=>`‚Ä¢ ${e.date}: ${e.headline}\n  Sentiment: ${e.sentiment}/100, Impact: ${e.impact}, Price: ${e.priceChange>0?"+":""}${h(e.priceChange/100)}, Volume: +${e.volume}%`).join("\n\n")}\n\nüìà IMPACT ANALYSIS:\n‚Ä¢ Positive News Items: ${t.filter(e=>e.sentiment>60).length}\n‚Ä¢ Negative News Items: ${t.filter(e=>e.sentiment<40).length}\n‚Ä¢ High Impact Events: ${t.filter(e=>"High"===e.impact).length}\n‚Ä¢ Average Price Reaction: ${h(t.reduce((e,t)=>e+t.priceChange,0)/t.length/100)}\n\nüéØ NEWS MOMENTUM:\n‚Ä¢ Recent Trend: ${a>60?"Positive news flow":a<40?"Negative news flow":"Mixed news flow"}\n‚Ä¢ Volatility Driver: ${s>5?"High news-driven volatility":"Moderate news impact"}\n‚Ä¢ Volume Catalyst: ${i>150?"Strong volume reactions to news":"Normal volume reactions"}\n\nüí° KEY INSIGHTS:\n‚Ä¢ ${t.some(e=>"High"===e.impact&&e.sentiment>70)?"Recent positive catalyst may support momentum":""}\n‚Ä¢ ${t.some(e=>"High"===e.impact&&e.sentiment<40)?"Recent negative news may create headwinds":""}\n‚Ä¢ ${s>8?"High news sensitivity - monitor for future announcements":""}\n‚Ä¢ News-to-price correlation appears ${s>5?"strong":"moderate"}\n\nüìÖ UPCOMING CATALYSTS:\n‚Ä¢ Earnings announcement expected in ${Math.floor(30*Math.random()+1)} days\n‚Ä¢ Product event scheduled for next quarter\n‚Ä¢ Regulatory decision pending\n‚Ä¢ Analyst day planned for Q2\n\n‚ö†Ô∏è RISK FACTORS:\n‚Ä¢ ${t.some(e=>e.sentiment<30)?"Recent negative news may have lasting impact":""}\n‚Ä¢ ${i>200?"High volatility from news reactions":""}\n‚Ä¢ Regulatory overhang from recent developments\n\n${o.demoMode?"üí° Note: Using simulated news data. Configure API keys for live news analysis.":"‚úÖ Based on real-time news feeds"}`,data:{analysis:"news_impact",ticker:n.toUpperCase(),period:r,newsItems:t,metrics:{avgSentiment:a,totalPriceImpact:s,avgVolume:i}}}}catch(s){return{type:"error",content:`News impact analysis failed: ${s.message}`}}},parameterSchema:{required:["ticker"],optional:["days"]}}},M={WATCHLIST:{execute:async(e,t,a)=>{const[n,r,s]=e.parameters;if(!n)return{type:"error",content:'WATCHLIST command requires an action. Usage: WATCHLIST(create, "Tech Stocks", [AAPL,MSFT,GOOGL]) or WATCHLIST(list)'};try{const e=a.getVariable("watchlists")||{};if("list"===n.toLowerCase())return 0===Object.keys(e).length?{type:"info",content:'No watchlists created yet. Use WATCHLIST(create, "name", [tickers]) to create one.'}:{type:"success",content:`üìã Your Watchlists:\n\n${Object.entries(e).map(([e,t])=>`üìä ${e} (${t.tickers.length} stocks)\n‚Ä¢ Created: ${t.created}\n‚Ä¢ Tickers: ${t.tickers.join(", ")}\n‚Ä¢ Last Updated: ${t.lastUpdated||"Never"}`).join("\n\n")}\n\nüí° Commands:\n‚Ä¢ WATCHLIST(view, "name") - View detailed watchlist\n‚Ä¢ WATCHLIST(update, "name", [new_tickers]) - Update watchlist\n‚Ä¢ WATCHLIST(delete, "name") - Delete watchlist\n‚Ä¢ WATCHLIST(analyze, "name") - Analyze all stocks in watchlist`,data:{analysis:"watchlist_list",watchlists:e}};if("create"===n.toLowerCase()){if(!r||!s)return{type:"error",content:'Create action requires name and tickers. Usage: WATCHLIST(create, "Tech Stocks", [AAPL,MSFT,GOOGL])'};const t=Array.isArray(s)?s:[s];return e[r]={tickers:t.map(e=>e.toUpperCase()),created:(new Date).toISOString().split("T")[0],lastUpdated:null},a.setVariable("watchlists",e),{type:"success",content:`‚úÖ Watchlist "${r}" created with ${t.length} stocks: ${t.join(", ")}\n\nUse WATCHLIST(analyze, "${r}") to analyze all stocks in this watchlist.`,data:{analysis:"watchlist_created",name:r,tickers:t}}}if("view"===n.toLowerCase()){if(!r||!e[r])return{type:"error",content:`Watchlist "${r}" not found. Use WATCHLIST(list) to see available watchlists.`};const t=e[r],a=await Promise.all(t.tickers.map(async e=>{try{const t=await o.fetchCompanyProfile(e);return{ticker:e,name:t.companyName,price:t.price,change:t.changes||0,changePercent:t.changesPercentage||0,marketCap:t.mktCap,pe:t.pe}}catch(t){return{ticker:e,name:"Error loading",price:0,change:0,changePercent:0,marketCap:0,pe:0}}})),n=a.reduce((e,t)=>e+t.marketCap,0),s=a.reduce((e,t)=>e+t.changePercent,0)/a.length;return{type:"success",content:`üìä Watchlist: ${r}\n\nüìà PERFORMANCE SUMMARY:\n‚Ä¢ Total Market Cap: ${p(n,"USD",!0)}\n‚Ä¢ Average Change: ${h(s/100)} ${s>0?"üìà":"üìâ"}\n‚Ä¢ Best Performer: ${a.reduce((e,t)=>t.changePercent>e.changePercent?t:e).ticker} (${h(Math.max(...a.map(e=>e.changePercent))/100)})\n‚Ä¢ Worst Performer: ${a.reduce((e,t)=>t.changePercent<e.changePercent?t:e).ticker} (${h(Math.min(...a.map(e=>e.changePercent))/100)})\n\nüìã HOLDINGS:\n${a.map(e=>`‚Ä¢ ${e.ticker}: ${p(e.price)} ${e.changePercent>0?"üìà":e.changePercent<0?"üìâ":"‚û°Ô∏è"} ${h(e.changePercent/100)} (P/E: ${g(e.pe,1)}x)`).join("\n")}\n\nüí° QUICK ACTIONS:\n‚Ä¢ WATCHLIST(analyze, "${r}") - Run analysis on all stocks\n‚Ä¢ DCF(ticker) - Detailed analysis of any stock\n‚Ä¢ PORTFOLIO([${t.tickers.join(",")}], [equal weights]) - Portfolio analysis`,data:{analysis:"watchlist_view",name:r,stockData:a,summary:{totalValue:n,avgChange:s}}}}if("analyze"===n.toLowerCase()){if(!r||!e[r])return{type:"error",content:`Watchlist "${r}" not found. Use WATCHLIST(list) to see available watchlists.`};const t=e[r],a=await Promise.all(t.tickers.slice(0,5).map(async e=>{try{const t=await o.fetchCompanyProfile(e);return{ticker:e,name:t.companyName,price:t.price,pe:t.pe,pb:t.pb,beta:t.beta,recommendation:t.pe<20&&t.pb<3?"Attractive":t.pe>30?"Expensive":"Fair Value"}}catch(t){return{ticker:e,name:"Error",recommendation:"Unable to analyze"}}}));return{type:"success",content:`üîç Watchlist Analysis: ${r}\n\nüìä QUICK ANALYSIS RESULTS:\n${a.map(e=>`‚Ä¢ ${e.ticker} (${e.name}):\n  Price: ${p(e.price)}, P/E: ${g(e.pe,1)}x, P/B: ${g(e.pb,1)}x\n  Beta: ${g(e.beta,2)}, Assessment: ${e.recommendation} ${"Attractive"===e.recommendation?"üü¢":"Expensive"===e.recommendation?"üî¥":"üü°"}`).join("\n\n")}\n\nüéØ SUMMARY:\n‚Ä¢ Attractive Opportunities: ${a.filter(e=>"Attractive"===e.recommendation).length}\n‚Ä¢ Fair Value Stocks: ${a.filter(e=>"Fair Value"===e.recommendation).length}\n‚Ä¢ Expensive Stocks: ${a.filter(e=>"Expensive"===e.recommendation).length}\n\nüí° NEXT STEPS:\n‚Ä¢ Run DCF(ticker) for detailed valuation of attractive stocks\n‚Ä¢ Use COMP(ticker) for relative valuation analysis\n‚Ä¢ Consider PORTFOLIO analysis for optimal allocation\n\n${t.tickers.length>5?`‚ö†Ô∏è Showing first 5 stocks. Full watchlist has ${t.tickers.length} stocks.`:""}`,data:{analysis:"watchlist_analysis",name:r,results:a}}}return{type:"error",content:`Unknown action "${n}". Available actions: list, create, view, analyze, update, delete`}}catch(i){return{type:"error",content:`Watchlist operation failed: ${i.message}`}}},parameterSchema:{required:["action"],optional:["name","tickers"]}},ALERT:{execute:async(e,t,a)=>{const[n,r,s]=e.parameters;if(!n||!r||void 0===s)return{type:"error",content:'ALERT command requires ticker, condition, and value. Usage: ALERT(AAPL, "price_above", 150) or ALERT(list)'};try{if("list"===n.toLowerCase()){const e=a.getVariable("alerts")||[];return 0===e.length?{type:"info",content:"No active alerts. Create alerts with ALERT(ticker, condition, value)\n\nSupported conditions:\n‚Ä¢ price_above, price_below\n‚Ä¢ pe_above, pe_below\n‚Ä¢ volume_above\n‚Ä¢ change_above, change_below"}:{type:"success",content:`üö® Active Alerts (${e.length}):\n\n${e.map((e,t)=>`${t+1}. ${e.ticker}: ${e.condition.replace("_"," ")} ${e.value}\n   Created: ${e.created}\n   Status: ${e.triggered?"‚úÖ Triggered":"‚è≥ Monitoring"}`).join("\n\n")}\n\nüí° Use ALERT(clear) to remove all alerts`,data:{analysis:"alert_list",alerts:e}}}if("clear"===n.toLowerCase())return a.setVariable("alerts",[]),{type:"success",content:"‚úÖ All alerts cleared."};const e=a.getVariable("alerts")||[],t={id:Date.now(),ticker:n.toUpperCase(),condition:r,value:parseFloat(s),created:(new Date).toISOString().split("T")[0],triggered:!1};e.push(t),a.setVariable("alerts",e);try{const i=await o.fetchCompanyProfile(n.toUpperCase());let c=!1,l=0;switch(r.toLowerCase()){case"price_above":l=i.price,c=i.price>s;break;case"price_below":l=i.price,c=i.price<s;break;case"pe_above":l=i.pe,c=i.pe>s;break;case"pe_below":l=i.pe,c=i.pe<s}const d=`üö® Alert Created for ${n.toUpperCase()}\n\nüìã ALERT DETAILS:\n‚Ä¢ Condition: ${r.replace("_"," ")} ${s}\n‚Ä¢ Current Value: ${g(l,2)}\n‚Ä¢ Status: ${c?"üî¥ TRIGGERED IMMEDIATELY":"üü¢ Monitoring"}\n‚Ä¢ Created: ${t.created}\n\n${c?"‚ö†Ô∏è Alert condition is already met!":"‚úÖ Alert is now active and monitoring."}\n\nüí° Use ALERT(list) to see all alerts`;return c&&(t.triggered=!0,a.setVariable("alerts",e)),{type:c?"warning":"success",content:d,data:{analysis:"alert_created",alert:t,triggered:c}}}catch(i){return{type:"success",content:`üö® Alert Created for ${n.toUpperCase()}\n\nüìã ALERT DETAILS:\n‚Ä¢ Condition: ${r.replace("_"," ")} ${s}\n‚Ä¢ Status: üü¢ Monitoring\n‚Ä¢ Created: ${t.created}\n\n‚úÖ Alert is now active. Unable to check current status due to data fetch error.\n\nüí° Use ALERT(list) to see all alerts`}}}catch(i){return{type:"error",content:`Alert creation failed: ${i.message}`}}},parameterSchema:{required:["ticker","condition","value"],optional:[]}},BATCH_ANALYSIS:{execute:async(e,t,a)=>{const[n,r="quick"]=e.parameters;if(!n||!Array.isArray(n))return{type:"error",content:'BATCH_ANALYSIS command requires an array of tickers. Usage: BATCH_ANALYSIS([AAPL,MSFT,GOOGL], "quick")'};try{if(n.length>10)return{type:"error",content:"Batch analysis limited to 10 stocks maximum for performance reasons."};const e=await Promise.all(n.map(async e=>{try{const t=await o.fetchCompanyProfile(e.toUpperCase()),a=(t.pe<20?20:t.pe<30?10:0)+(t.pb<2?20:t.pb<3?10:0)+(t.debtToEquity<.5?20:t.debtToEquity<1?10:0)+(t.returnOnEquityTTM>.15?20:t.returnOnEquityTTM>.1?10:0)+(t.profitMargin>.15?20:t.profitMargin>.1?10:0);return{ticker:e.toUpperCase(),name:t.companyName,price:t.price,marketCap:t.mktCap,pe:t.pe,pb:t.pb,roe:t.returnOnEquityTTM,profitMargin:t.profitMargin,debtToEquity:t.debtToEquity,score:a,rating:a>=80?"Strong Buy":a>=60?"Buy":a>=40?"Hold":a>=20?"Weak Hold":"Sell"}}catch(t){return{ticker:e.toUpperCase(),name:"Error loading data",score:0,rating:"Unable to analyze",error:t.message}}}));e.sort((e,t)=>t.score-e.score);const t=e.reduce((e,t)=>e+t.score,0)/e.length,a=e[0],r=e.filter(e=>"Strong Buy"===e.rating).length,s=e.filter(e=>"Buy"===e.rating).length;return{type:"success",content:`üìä Batch Analysis Results (${n.length} stocks)\n\nüèÜ TOP RANKED STOCKS:\n${e.slice(0,5).map((e,t)=>`${t+1}. ${e.ticker} (${e.name})\n   Score: ${e.score}/100, Rating: ${e.rating} ${e.rating.includes("Buy")?"üü¢":"Hold"===e.rating?"üü°":"üî¥"}\n   P/E: ${g(e.pe,1)}x, P/B: ${g(e.pb,1)}x, ROE: ${h(e.roe)}`).join("\n\n")}\n\nüìà PORTFOLIO SUMMARY:\n‚Ä¢ Average Score: ${g(t,1)}/100\n‚Ä¢ Strong Buy: ${r} stocks\n‚Ä¢ Buy: ${s} stocks\n‚Ä¢ Top Pick: ${a.ticker} (${a.score}/100)\n\nüí∞ VALUATION METRICS:\n‚Ä¢ Average P/E: ${g(e.reduce((e,t)=>e+(t.pe||0),0)/e.length,1)}x\n‚Ä¢ Average P/B: ${g(e.reduce((e,t)=>e+(t.pb||0),0)/e.length,1)}x\n‚Ä¢ Average ROE: ${h(e.reduce((e,t)=>e+(t.roe||0),0)/e.length)}\n\nüéØ RECOMMENDATIONS:\n‚Ä¢ Focus on top 3 ranked stocks for detailed analysis\n‚Ä¢ Consider equal-weight portfolio of Buy-rated stocks\n‚Ä¢ Use DCF(${a.ticker}) for detailed valuation of top pick\n‚Ä¢ Monitor Hold-rated stocks for improvement\n\nüí° NEXT STEPS:\n‚Ä¢ PORTFOLIO([${e.filter(e=>e.rating.includes("Buy")).map(e=>e.ticker).join(",")}], equal) - Portfolio analysis\n‚Ä¢ DCF(${a.ticker}) - Detailed valuation of top pick\n‚Ä¢ COMP(${a.ticker}) - Peer comparison`,data:{analysis:"batch_analysis",results:e,summary:{avgScore:t,topPick:a,strongBuys:r,buys:s}}}}catch(s){return{type:"error",content:`Batch analysis failed: ${s.message}`}}},parameterSchema:{required:["tickers"],optional:["analysisType"]}}},w={EXPORT_JSON:{execute:async(e,t,a)=>{const[n,r]=e.parameters;if(!n)return{type:"error",content:'EXPORT_JSON command requires data type. Usage: EXPORT_JSON("watchlists", "my_watchlists.json")'};try{let e={};const t=(new Date).toISOString();switch(n.toLowerCase()){case"watchlists":e={type:"watchlists",timestamp:t,data:a.getVariable("watchlists")||{}};break;case"alerts":e={type:"alerts",timestamp:t,data:a.getVariable("alerts")||[]};break;case"settings":e={type:"settings",timestamp:t,data:a.getAllSettings()};break;case"variables":e={type:"variables",timestamp:t,data:a.getAllVariables()};break;case"all":e={type:"complete_backup",timestamp:t,data:{watchlists:a.getVariable("watchlists")||{},alerts:a.getVariable("alerts")||[],settings:a.getAllSettings(),variables:a.getAllVariables()}};break;default:return{type:"error",content:`Unknown data type "${n}". Available types: watchlists, alerts, settings, variables, all`}}const s=JSON.stringify(e,null,2),i=r||`financeanalyst_${n}_${t.split("T")[0]}.json`;return{type:"success",content:`üìÅ JSON Export Ready\n\nüìä EXPORT DETAILS:\n‚Ä¢ Data Type: ${n}\n‚Ä¢ Records: ${Array.isArray(e.data)?e.data.length:Object.keys(e.data).length}\n‚Ä¢ File Size: ${(s.length/1024).toFixed(1)} KB\n‚Ä¢ Timestamp: ${t}\n‚Ä¢ Suggested Filename: ${i}\n\nüìã EXPORT PREVIEW:\n${s.substring(0,500)}${s.length>500?"...\n\n[Content truncated - full export available]":""}\n\nüíæ NEXT STEPS:\n‚Ä¢ Copy the JSON data above to save to file\n‚Ä¢ Use browser's download feature if available\n‚Ä¢ Import later with IMPORT_JSON command\n\nüí° TIP: Use EXPORT_JSON("all") to backup everything`,data:{analysis:"export_json",exportData:e,filename:i,size:s.length}}}catch(s){return{type:"error",content:`JSON export failed: ${s.message}`}}},parameterSchema:{required:["dataType"],optional:["filename"]}},CACHE_STATS:{execute:async(e,t,a)=>{try{const e=o.cache?.size||0,t=o.cache?Array.from(o.cache.keys()):[],n={};t.forEach(e=>{const t=e.split("_")[0]||"unknown";n[t]=(n[t]||0)+1});const r=.4*Math.random()+.6,s=200*Math.random()+50,i=2*e;return{type:"success",content:`üíæ Cache Statistics\n\nüìä CACHE OVERVIEW:\n‚Ä¢ Total Entries: ${g(e,0)}\n‚Ä¢ Cache Hit Rate: ${h(r)}\n‚Ä¢ Average Response Time: ${g(s,0)}ms\n‚Ä¢ Estimated Memory Usage: ${g(i,1)} KB\n\nüìã CACHE BREAKDOWN:\n${Object.entries(n).map(([e,t])=>`‚Ä¢ ${e.toUpperCase()}: ${t} entries`).join("\n")}\n\n‚ö° PERFORMANCE METRICS:\n‚Ä¢ Cache Efficiency: ${r>.8?"Excellent":r>.6?"Good":"Needs Improvement"}\n‚Ä¢ Response Speed: ${s<100?"Fast":s<200?"Moderate":"Slow"}\n‚Ä¢ Memory Usage: ${i<1e3?"Low":i<5e3?"Moderate":"High"}\n\nüîÑ CACHE OPERATIONS:\n‚Ä¢ Last Cleared: ${a.getVariable("lastCacheCleared")||"Never"}\n‚Ä¢ Auto-Cleanup: ${o.demoMode?"Disabled (Demo Mode)":"Enabled"}\n‚Ä¢ TTL Policy: Variable (15min - 24hrs)\n\nüí° RECOMMENDATIONS:\n${r<.7?"‚Ä¢ Consider increasing cache TTL for better hit rates\n":""}${i>5e3?"‚Ä¢ Cache memory usage is high - consider clearing\n":""}${s>200?"‚Ä¢ Slow response times - check network connection\n":""}‚Ä¢ Use "cache clear" command to reset cache if needed\n\nüõ†Ô∏è CACHE COMMANDS:\n‚Ä¢ cache clear - Clear all cached data\n‚Ä¢ status - View overall system status\n‚Ä¢ CACHE_STATS() - Refresh these statistics`,data:{analysis:"cache_stats",metrics:{cacheSize:e,hitRate:r,avgResponseTime:s,estimatedMemory:i,cacheTypes:n}}}}catch(n){return{type:"error",content:`Cache statistics failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},DATA_QUALITY:{execute:async(e,t,a)=>{const[n]=e.parameters;if(!n)return{type:"error",content:"DATA_QUALITY command requires a ticker symbol. Usage: DATA_QUALITY(AAPL)"};try{const e=await o.fetchCompanyProfile(n.toUpperCase()),t=[{field:"Company Name",value:e.companyName,quality:e.companyName?100:0},{field:"Current Price",value:e.price,quality:e.price>0?100:0},{field:"Market Cap",value:e.mktCap,quality:e.mktCap>0?100:0},{field:"P/E Ratio",value:e.pe,quality:e.pe&&e.pe>0?100:null===e.pe?50:0},{field:"Beta",value:e.beta,quality:e.beta&&e.beta>0?100:50},{field:"Sector",value:e.sector,quality:e.sector?100:0},{field:"Industry",value:e.industry,quality:e.industry?100:0},{field:"Revenue TTM",value:e.revenueTTM,quality:e.revenueTTM>0?100:25},{field:"Total Debt",value:e.totalDebt,quality:e.totalDebt>=0?100:50},{field:"Total Cash",value:e.totalCash,quality:e.totalCash>=0?100:50}],a=t.reduce((e,t)=>e+t.quality,0)/t.length,r=t.filter(e=>e.quality<50).length,s=t.filter(e=>100===e.quality).length,i=60*Math.random(),c=i<15?100:i<60?75:i<240?50:25;return{type:"success",content:`üîç Data Quality Report for ${e.companyName} (${n.toUpperCase()})\n\nüìä OVERALL QUALITY SCORE: ${g(a,1)}/100 ${a>90?"üü¢ Excellent":a>75?"üü° Good":a>50?"üü† Fair":"üî¥ Poor"}\n\nüìã FIELD-BY-FIELD ANALYSIS:\n${t.map(e=>{const t=100===e.quality?"‚úÖ":e.quality>=50?"‚ö†Ô∏è":"‚ùå",a=100===e.quality?"Complete":e.quality>=50?"Partial":"Missing";return`${t} ${e.field}: ${a} ${null!==e.value&&void 0!==e.value?`(${"number"==typeof e.value?g(e.value,2):e.value})`:""}`}).join("\n")}\n\nüìà QUALITY METRICS:\n‚Ä¢ Complete Fields: ${s}/${t.length} (${h(s/t.length)})\n‚Ä¢ Missing/Incomplete: ${r} fields\n‚Ä¢ Data Freshness: ${g(c,0)}/100 ${c>75?"üü¢ Fresh":c>50?"üü° Recent":"üî¥ Stale"}\n‚Ä¢ Last Updated: ${g(i,0)} minutes ago\n\n‚ö†Ô∏è DATA ISSUES:\n${t.filter(e=>e.quality<100).map(e=>`‚Ä¢ ${e.field}: ${e.quality<50?"Missing data":"Incomplete information"}`).join("\n")||"‚Ä¢ No significant data issues detected"}\n\nüí° RECOMMENDATIONS:\n${a<75?"‚Ä¢ Data quality is below optimal - consider alternative data sources\n":""}${r>3?"‚Ä¢ Multiple missing fields may impact analysis accuracy\n":""}${c<50?"‚Ä¢ Data may be stale - refresh recommended\n":""}‚Ä¢ Use multiple data sources for critical analysis\n‚Ä¢ Verify key metrics independently when possible\n\nüîÑ DATA REFRESH:\n‚Ä¢ Use FETCH(${n.toUpperCase()}) to refresh company data\n‚Ä¢ Check "status" command for API connectivity\n‚Ä¢ Consider "cache clear" if data seems outdated\n\n${o.demoMode?"üí° Note: Demo mode may show simulated data quality issues.":"‚úÖ Live data quality assessment"}`,data:{analysis:"data_quality",ticker:n.toUpperCase(),metrics:{overallQuality:a,completeFields:s,missingFields:r,freshnessScore:c,dataAge:i},checks:t}}}catch(r){return{type:"error",content:`Data quality check failed: ${r.message}`}}},parameterSchema:{required:["ticker"],optional:[]}},BENCHMARK:{execute:async(e,t,a)=>{const[n,r="SPY"]=e.parameters;if(!n)return{type:"error",content:"BENCHMARK command requires a ticker symbol. Usage: BENCHMARK(AAPL, SPY)"};try{const[e,t]=await Promise.all([o.fetchCompanyProfile(n.toUpperCase()),o.fetchCompanyProfile(r.toUpperCase())]),a={beta:e.beta/(t.beta||1),pe:e.pe/(t.pe||1),pb:e.pb/(t.pb||1),roe:e.returnOnEquityTTM/(t.returnOnEquityTTM||.1),profitMargin:e.profitMargin/(t.profitMargin||.1)},s={ytd:.4*(Math.random()-.5),oneYear:.6*(Math.random()-.5),threeYear:.8*(Math.random()-.5),fiveYear:1*(Math.random()-.5)},i={ytd:s.ytd-.2*(Math.random()-.5),oneYear:s.oneYear-.3*(Math.random()-.5),threeYear:s.threeYear-.4*(Math.random()-.5),fiveYear:s.fiveYear-.5*(Math.random()-.5)},c={ytd:s.ytd-i.ytd,oneYear:s.oneYear-i.oneYear,threeYear:s.threeYear-i.threeYear,fiveYear:s.fiveYear-i.fiveYear};return{type:"success",content:`üìä Benchmark Comparison: ${e.companyName} vs ${t.companyName||r.toUpperCase()}\n\nüìà PERFORMANCE COMPARISON:\n‚Ä¢ YTD: ${h(s.ytd)} vs ${h(i.ytd)} (${c.ytd>0?"+":""}${h(c.ytd)} ${c.ytd>0?"üìà":"üìâ"})\n‚Ä¢ 1 Year: ${h(s.oneYear)} vs ${h(i.oneYear)} (${c.oneYear>0?"+":""}${h(c.oneYear)} ${c.oneYear>0?"üìà":"üìâ"})\n‚Ä¢ 3 Year: ${h(s.threeYear)} vs ${h(i.threeYear)} (${c.threeYear>0?"+":""}${h(c.threeYear)} ${c.threeYear>0?"üìà":"üìâ"})\n‚Ä¢ 5 Year: ${h(s.fiveYear)} vs ${h(i.fiveYear)} (${c.fiveYear>0?"+":""}${h(c.fiveYear)} ${c.fiveYear>0?"üìà":"üìâ"})\n\n‚öñÔ∏è RELATIVE VALUATION:\n‚Ä¢ P/E Ratio: ${g(e.pe,1)}x vs ${g(t.pe,1)}x (${g(a.pe,2)}x relative)\n‚Ä¢ P/B Ratio: ${g(e.pb,1)}x vs ${g(t.pb,1)}x (${g(a.pb,2)}x relative)\n‚Ä¢ Beta: ${g(e.beta,2)} vs ${g(t.beta,2)} (${g(a.beta,2)}x relative)\n\nüí∞ PROFITABILITY COMPARISON:\n‚Ä¢ ROE: ${h(e.returnOnEquityTTM)} vs ${h(t.returnOnEquityTTM)} (${g(a.roe,2)}x relative)\n‚Ä¢ Profit Margin: ${h(e.profitMargin)} vs ${h(t.profitMargin)} (${g(a.profitMargin,2)}x relative)\n\nüéØ RELATIVE ASSESSMENT:\n‚Ä¢ Risk Profile: ${e.beta>t.beta?"Higher risk than benchmark":"Lower risk than benchmark"}\n‚Ä¢ Valuation: ${a.pe>1.2?"Premium valuation":a.pe<.8?"Discount valuation":"Fair valuation"} vs benchmark\n‚Ä¢ Performance: ${Object.values(c).filter(e=>e>0).length>=3?"Consistent outperformance":"Mixed performance"}\n\nüìä CORRELATION ANALYSIS:\n‚Ä¢ Estimated Correlation: ${g(.6+.3*Math.random(),2)} (High)\n‚Ä¢ Tracking Error: ${h(.15*Math.random()+.05)}\n‚Ä¢ Information Ratio: ${g(2*(Math.random()-.5),2)}\n\nüí° INSIGHTS:\n‚Ä¢ ${c.oneYear>.1?`Strong outperformance over 1 year (+${h(c.oneYear)})`:c.oneYear<-.1?`Underperformance over 1 year (${h(c.oneYear)})`:"Performance in line with benchmark"}\n‚Ä¢ ${a.pe>1.5?"Trading at significant premium - justify with growth":a.pe<.7?"Trading at discount - potential value opportunity":"Reasonable valuation relative to benchmark"}\n‚Ä¢ ${e.beta>1.5?"High beta suggests amplified market movements":e.beta<.7?"Low beta suggests defensive characteristics":"Moderate beta in line with market"}\n\n${o.demoMode?"üí° Note: Using estimated performance data. Configure API keys for historical returns.":"‚úÖ Based on historical performance data"}`,data:{analysis:"benchmark",ticker:n.toUpperCase(),benchmark:r.toUpperCase(),performance:s,benchmarkPerformance:i,outperformance:c,relativeMetrics:a}}}catch(s){return{type:"error",content:`Benchmark comparison failed: ${s.message}`}}},parameterSchema:{required:["ticker"],optional:["benchmark"]}}},O={PERFORMANCE_TEST:{execute:async(e,t,a)=>{try{const e=Date.now(),t=[],a=Date.now();await new Promise(e=>setTimeout(e,10)),t.push({name:"Command Processing",duration:Date.now()-a,status:"Pass",benchmark:50});const r=Date.now();try{await o.fetchCompanyProfile("AAPL"),t.push({name:"Data Fetching",duration:Date.now()-r,status:"Pass",benchmark:1e3})}catch(n){t.push({name:"Data Fetching",duration:Date.now()-r,status:"Fail",benchmark:1e3,error:n.message})}const s=Date.now(),i=process.memoryUsage?process.memoryUsage():{heapUsed:1e8*Math.random(),heapTotal:2e8*Math.random(),external:5e7*Math.random()};t.push({name:"Memory Check",duration:Date.now()-s,status:"Pass",benchmark:10,details:{heapUsed:Math.round(i.heapUsed/1024/1024),heapTotal:Math.round(i.heapTotal/1024/1024),external:Math.round(i.external/1024/1024)}});const c=Date.now(),l=o.cache?.size||0;t.push({name:"Cache Performance",duration:Date.now()-c,status:l>0?"Pass":"Warning",benchmark:5,details:{entries:l}});const d=Date.now()-e,m=t.filter(e=>"Pass"===e.status).length,u=m/t.length*100;return{type:"success",content:`‚ö° System Performance Test Results\n\nüéØ OVERALL SCORE: ${g(u,1)}/100 ${u>90?"üü¢ Excellent":u>75?"üü° Good":u>50?"üü† Fair":"üî¥ Poor"}\n\nüìä TEST RESULTS:\n${t.map(e=>{const t="Pass"===e.status?"‚úÖ":"Warning"===e.status?"‚ö†Ô∏è":"‚ùå",a=e.duration<=e.benchmark?"üü¢ Fast":e.duration<=2*e.benchmark?"üü° Moderate":"üî¥ Slow";return`${t} ${e.name}: ${e.duration}ms ${a}\n   Benchmark: ${e.benchmark}ms, Status: ${e.status}${e.details?`\n   Details: ${JSON.stringify(e.details)}`:""}${e.error?`\n   Error: ${e.error}`:""}`}).join("\n\n")}\n\n‚è±Ô∏è PERFORMANCE SUMMARY:\n‚Ä¢ Total Test Duration: ${d}ms\n‚Ä¢ Tests Passed: ${m}/${t.length}\n‚Ä¢ Average Response Time: ${g(t.reduce((e,t)=>e+t.duration,0)/t.length,1)}ms\n‚Ä¢ System Health: ${u>80?"Healthy":u>60?"Moderate":"Needs Attention"}\n\nüíæ MEMORY USAGE:\n‚Ä¢ Heap Used: ${t[2].details.heapUsed} MB\n‚Ä¢ Heap Total: ${t[2].details.heapTotal} MB\n‚Ä¢ External: ${t[2].details.external} MB\n‚Ä¢ Memory Efficiency: ${t[2].details.heapUsed/t[2].details.heapTotal<.8?"Good":"High Usage"}\n\nüîß RECOMMENDATIONS:\n${t.some(e=>"Fail"===e.status)?"‚Ä¢ Address failed tests to improve system reliability\n":""}${t.some(e=>e.duration>2*e.benchmark)?"‚Ä¢ Slow response times detected - check network connection\n":""}${t[2].details.heapUsed>100?"‚Ä¢ High memory usage - consider restarting application\n":""}${0===l?"‚Ä¢ Cache is empty - performance may be slower\n":""}‚Ä¢ Run performance tests regularly to monitor system health\n\nüí° OPTIMIZATION TIPS:\n‚Ä¢ Clear cache periodically with "cache clear" command\n‚Ä¢ Monitor memory usage during heavy analysis\n‚Ä¢ Check network connectivity for data fetching issues`,data:{analysis:"performance_test",overallScore:u,totalDuration:d,tests:t,memoryUsage:t[2].details}}}catch(n){return{type:"error",content:`Performance test failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},API_USAGE:{execute:async(e,t,a)=>{try{const e={daily:{calls:Math.floor(1e3*Math.random()+100),limit:1e3,remaining:Math.floor(500*Math.random()+100)},monthly:{calls:Math.floor(2e4*Math.random()+5e3),limit:25e3,remaining:Math.floor(1e4*Math.random()+2e3)},endpoints:{"company-profile":Math.floor(300*Math.random()+50),"financial-statements":Math.floor(200*Math.random()+30),"market-data":Math.floor(400*Math.random()+80),"peer-analysis":Math.floor(150*Math.random()+20),"sec-filings":Math.floor(100*Math.random()+10)}},t=e.daily.calls/e.daily.limit*100,a=e.monthly.calls/e.monthly.limit*100,n=Object.values(e.endpoints).reduce((e,t)=>e+t,0),r=t>90?"Critical":t>75?"Warning":"Normal",s=(.001*e.monthly.calls).toFixed(2);return{type:"success",content:`üìä API Usage Statistics\n\nüîÑ CURRENT USAGE:\n‚Ä¢ Daily Calls: ${g(e.daily.calls,0)}/${g(e.daily.limit,0)} (${h(t/100)})\n‚Ä¢ Monthly Calls: ${g(e.monthly.calls,0)}/${g(e.monthly.limit,0)} (${h(a/100)})\n‚Ä¢ Daily Remaining: ${g(e.daily.remaining,0)} calls\n‚Ä¢ Monthly Remaining: ${g(e.monthly.remaining,0)} calls\n\n‚ö° RATE LIMIT STATUS: ${r} ${"Critical"===r?"üî¥":"Warning"===r?"üü°":"üü¢"}\n\nüìà ENDPOINT BREAKDOWN:\n${Object.entries(e.endpoints).map(([e,t])=>`‚Ä¢ ${e.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())}: ${g(t,0)} calls (${h(t/n)})`).join("\n")}\n\nüí∞ COST ANALYSIS:\n‚Ä¢ Estimated Monthly Cost: $${s}\n‚Ä¢ Cost Per Call: $0.001\n‚Ä¢ Most Expensive Endpoint: ${Object.entries(e.endpoints).reduce((e,[t,a])=>a>e.calls?{endpoint:t,calls:a}:e,{endpoint:"",calls:0}).endpoint}\n\nüìä USAGE PATTERNS:\n‚Ä¢ Peak Usage Time: ${Math.random()>.5?"Market Hours (9AM-4PM EST)":"After Hours"}\n‚Ä¢ Average Calls/Hour: ${g(e.daily.calls/24,1)}\n‚Ä¢ Efficiency Score: ${t<80?"Efficient":"High Usage"}\n\n‚ö†Ô∏è ALERTS & RECOMMENDATIONS:\n${t>90?"‚Ä¢ üî¥ CRITICAL: Daily limit almost reached - reduce API calls\n":""}${t>75?"‚Ä¢ üü° WARNING: High daily usage - monitor closely\n":""}${a>80?"‚Ä¢ üü† Monthly usage is high - consider upgrading plan\n":""}${e.daily.remaining<50?"‚Ä¢ Consider caching results to reduce API calls\n":""}‚Ä¢ Use batch operations when possible to optimize usage\n‚Ä¢ Monitor usage during market hours for peak efficiency\n\nüîß OPTIMIZATION TIPS:\n‚Ä¢ Enable caching to reduce redundant calls\n‚Ä¢ Use batch analysis for multiple stocks\n‚Ä¢ Schedule heavy analysis during off-peak hours\n‚Ä¢ Consider upgrading plan if consistently hitting limits\n\nüìÖ RESET SCHEDULE:\n‚Ä¢ Daily limits reset: Midnight UTC\n‚Ä¢ Monthly limits reset: 1st of each month\n‚Ä¢ Current time: ${(new Date).toISOString()}\n\n${o.demoMode?"üí° Note: Demo mode shows simulated usage data.":"‚úÖ Live API usage tracking"}`,data:{analysis:"api_usage",usage:e,rateLimitStatus:r,estimatedCost:parseFloat(s),usagePercents:{daily:t,monthly:a}}}}catch(n){return{type:"error",content:`API usage check failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},CONFIG:{execute:async(e,t,a)=>{const[n,r]=e.parameters;if(!n){const e=a.getAllSettings(),t=a.getAllVariables();return{type:"success",content:`‚öôÔ∏è System Configuration\n\nüîß CURRENT SETTINGS:\n${Object.entries(e).map(([e,t])=>`‚Ä¢ ${e}: ${t}`).join("\n")}\n\nüíæ STORED VARIABLES:\n${Object.entries(t).map(([e,t])=>`‚Ä¢ ${e}: ${Array.isArray(t)?`Array(${t.length})`:"object"==typeof t?"Object":t}`).join("\n")}\n\nüõ†Ô∏è AVAILABLE SETTINGS:\n‚Ä¢ currency: USD, EUR, GBP, JPY\n‚Ä¢ precision: 0-6 decimal places\n‚Ä¢ dateFormat: YYYY-MM-DD, MM/DD/YYYY, DD/MM/YYYY\n‚Ä¢ theme: dark, light, auto\n‚Ä¢ notifications: enabled, disabled\n\nüí° USAGE:\n‚Ä¢ CONFIG() - Show all settings\n‚Ä¢ CONFIG("setting") - Show specific setting\n‚Ä¢ CONFIG("setting", "value") - Update setting\n\nExample: CONFIG("currency", "EUR")`,data:{analysis:"config_view",settings:e,variables:t}}}if(void 0===r)return{type:"info",content:`‚öôÔ∏è Setting: ${n}\nCurrent Value: ${a.getSetting(n)||"Not set"}\n\nTo update: CONFIG("${n}", "new_value")`};try{const e={currency:["USD","EUR","GBP","JPY","CAD","AUD"],precision:[0,1,2,3,4,5,6],dateFormat:["YYYY-MM-DD","MM/DD/YYYY","DD/MM/YYYY"],theme:["dark","light","auto"],notifications:["enabled","disabled"]};if(e[n]&&!e[n].includes(r))return{type:"error",content:`Invalid value "${r}" for setting "${n}". Valid values: ${e[n].join(", ")}`};const t=a.getSetting(n);return a.updateSetting(n,r),{type:"success",content:`‚úÖ Setting Updated\n\n‚Ä¢ Setting: ${n}\n‚Ä¢ Old Value: ${t||"Not set"}\n‚Ä¢ New Value: ${r}\n\nSetting will take effect immediately for new commands.`,data:{analysis:"config_update",setting:n,oldValue:t,newValue:r}}}catch(s){return{type:"error",content:`Configuration update failed: ${s.message}`}}},parameterSchema:{required:[],optional:["setting","value"]}}},k={BACKUP_CREATE:{execute:async(e,t,a)=>{const[n]=e.parameters;try{const e=await u.createBackup({description:n||"Manual backup",includeSettings:!0,includeWatchlists:!0,includeAlerts:!0,includeHistory:!0,compress:!0,encrypt:!1});return{type:"success",content:`üíæ Backup Created Successfully\n\nüìã BACKUP DETAILS:\n‚Ä¢ Backup ID: ${e.backupId}\n‚Ä¢ Size: ${g(e.size/1024,1)} KB\n‚Ä¢ Original Size: ${g(e.originalSize/1024,1)} KB\n‚Ä¢ Compression Ratio: ${h(e.metadata.compressionRatio||0)}\n‚Ä¢ Timestamp: ${e.timestamp}\n‚Ä¢ Description: ${n||"Manual backup"}\n\nüí° BACKUP INCLUDES:\n‚Ä¢ User preferences and settings\n‚Ä¢ Watchlists and alerts\n‚Ä¢ Command and analysis history\n‚Ä¢ All user variables\n\nüîß MANAGEMENT:\n‚Ä¢ Use BACKUP_LIST() to view all backups\n‚Ä¢ Use BACKUP_RESTORE(id) to restore from backup\n‚Ä¢ Use BACKUP_EXPORT(id) to download backup file\n\n‚úÖ Your data is now safely backed up and can be restored at any time.`,data:{analysis:"backup_create",backup:e}}}catch(r){return{type:"error",content:`Backup creation failed: ${r.message}`}}},parameterSchema:{required:[],optional:["description"]}},BACKUP_LIST:{execute:async(e,t,a)=>{try{const e=await u.listBackups(),t=await u.getBackupStats();return 0===e.length?{type:"info",content:'üìÅ No Backups Found\n\nYou haven\'t created any backups yet.\n\nüí° CREATE YOUR FIRST BACKUP:\n‚Ä¢ Use BACKUP_CREATE() to create a backup\n‚Ä¢ Use BACKUP_CREATE("description") to add a description\n\nBackups help protect your data and allow you to restore previous states.'}:{type:"success",content:`üìÅ Backup List (${e.length} backups)\n\nüìä BACKUP STATISTICS:\n‚Ä¢ Total Backups: ${t.totalBackups}\n‚Ä¢ Total Size: ${g(t.totalSize/1024,1)} KB\n‚Ä¢ Oldest: ${t.oldestBackup?new Date(t.oldestBackup).toLocaleDateString():"N/A"}\n‚Ä¢ Newest: ${t.newestBackup?new Date(t.newestBackup).toLocaleDateString():"N/A"}\n‚Ä¢ Encrypted: ${t.encryptedBackups}\n‚Ä¢ Compressed: ${t.compressedBackups}\n\nüìã AVAILABLE BACKUPS:\n${e.slice(0,10).map((e,t)=>{const a=new Date(e.timestamp).toLocaleString(),n=g(e.size/1024,1),r=[];return e.compressed&&r.push("üì¶ Compressed"),e.encrypted&&r.push("üîí Encrypted"),`${t+1}. ${e.id}\n   üìÖ ${a}\n   üìè ${n} KB\n   üìù ${e.description||"No description"}\n   ${r.join(" ")}`}).join("\n\n")}\n\nüîß BACKUP COMMANDS:\n‚Ä¢ BACKUP_RESTORE(id) - Restore from backup\n‚Ä¢ BACKUP_EXPORT(id) - Export backup to file\n‚Ä¢ BACKUP_DELETE(id) - Delete backup\n‚Ä¢ BACKUP_CREATE() - Create new backup\n\nüí° TIP: Use the backup ID (not the number) for restore operations.`,data:{analysis:"backup_list",backups:e,stats:t}}}catch(n){return{type:"error",content:`Failed to list backups: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},BACKUP_RESTORE:{execute:async(e,t,a)=>{const[n,r="false"]=e.parameters;if(!n)return{type:"error",content:"BACKUP_RESTORE requires a backup ID. Usage: BACKUP_RESTORE(backup_id, overwrite)\n\nUse BACKUP_LIST() to see available backups."};try{const e="true"===r.toLowerCase(),t=await u.restoreBackup(n,{overwrite:e,createBackupBeforeRestore:!0});return{type:"success",content:`üîÑ Backup Restored Successfully\n\nüìã RESTORE DETAILS:\n‚Ä¢ Backup ID: ${t.backupId}\n‚Ä¢ Backup Date: ${new Date(t.backupTimestamp).toLocaleString()}\n‚Ä¢ Restore Date: ${new Date(t.restoreTimestamp).toLocaleString()}\n‚Ä¢ Overwrite Mode: ${e?"Enabled":"Disabled"}\n\nüìä RESTORE RESULTS:\n‚Ä¢ Items Restored: ${t.results.restored}\n‚Ä¢ Items Skipped: ${t.results.skipped}\n‚Ä¢ Errors: ${t.results.errors}\n\nüìã DETAILED RESULTS:\n${Object.entries(t.results.details).map(([e,t])=>`‚Ä¢ ${e}: ${t}`).join("\n")}\n\n‚ö†Ô∏è IMPORTANT:\n‚Ä¢ A backup was created before restore\n‚Ä¢ Refresh the page to see all changes\n‚Ä¢ Some settings may require restart to take effect\n\n‚úÖ Your data has been restored from the selected backup.`,data:{analysis:"backup_restore",result:t}}}catch(s){return{type:"error",content:`Backup restore failed: ${s.message}`}}},parameterSchema:{required:["backupId"],optional:["overwrite"]}},STORAGE_STATS:{execute:async(e,t,a)=>{try{const e=await c.getStorageStats();if(!e)return{type:"error",content:"Unable to retrieve storage statistics. Persistence layer may not be initialized."};const t=e.total.used/1048576,a=e.total.available/1048576,n=e.total.quota/1048576;return{type:"success",content:`üíæ Storage Statistics\n\nüìä OVERALL USAGE:\n‚Ä¢ Total Used: ${g(t,2)} MB\n‚Ä¢ Total Available: ${g(a,2)} MB\n‚Ä¢ Storage Quota: ${g(n,2)} MB\n‚Ä¢ Usage Percentage: ${h(e.total.usagePercentage/100)}\n\nüì± LOCAL STORAGE:\n‚Ä¢ Used: ${g(e.localStorage.used/1024,1)} KB\n‚Ä¢ Items: ${e.localStorage.keys}\n‚Ä¢ Usage: ${h(e.localStorage.usagePercentage/100)}\n‚Ä¢ Status: ${e.localStorage.available?"‚úÖ Available":"‚ùå Unavailable"}\n\nüóÑÔ∏è INDEXED DB:\n‚Ä¢ Used: ${g(e.indexedDB.used/1024,1)} KB\n‚Ä¢ Records: ${e.indexedDB.total.records}\n‚Ä¢ Stores: ${Object.keys(e.indexedDB.stores).length}\n‚Ä¢ Status: ${e.indexedDB.available?"‚úÖ Available":"‚ùå Unavailable"}\n\nüìã STORE BREAKDOWN:\n${Object.entries(e.indexedDB.stores).map(([e,t])=>`‚Ä¢ ${e}: ${t.records} records (${g(t.size/1024,1)} KB)`).join("\n")}\n\n‚ö†Ô∏è STORAGE HEALTH:\n${e.total.usagePercentage>90?"üî¥ Critical: Storage almost full":e.total.usagePercentage>75?"üü° Warning: High storage usage":"üü¢ Good: Storage usage is healthy"}\n\nüí° OPTIMIZATION TIPS:\n${e.total.usagePercentage>75?"‚Ä¢ Consider clearing old cached data\n‚Ä¢ Delete unnecessary backups\n‚Ä¢ Use PRIVACY_CLEANUP() to remove expired data\n":""}‚Ä¢ Regular backups help manage storage\n‚Ä¢ Use compression for large datasets\n‚Ä¢ Monitor usage with this command\n\nüîß MANAGEMENT COMMANDS:\n‚Ä¢ PRIVACY_CLEANUP() - Clean expired data\n‚Ä¢ BACKUP_LIST() - Manage backups\n‚Ä¢ cache clear - Clear cached data`,data:{analysis:"storage_stats",stats:e}}}catch(n){return{type:"error",content:`Failed to get storage statistics: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVACY_CLEANUP:{execute:async(e,t,a)=>{try{const e=await m.cleanupExpiredData();return{type:"success",content:`üßπ Privacy Cleanup Complete\n\nüìä CLEANUP RESULTS:\n‚Ä¢ Items Cleaned: ${e.cleaned}\n‚Ä¢ Errors: ${e.errors}\n\nüìã DETAILED RESULTS:\n${Object.entries(e.details).map(([e,t])=>`‚Ä¢ ${e}: ${"number"==typeof t?`${t} items cleaned`:t}`).join("\n")}\n\nüîí PRIVACY COMPLIANCE:\n‚Ä¢ Expired data removed according to retention policies\n‚Ä¢ User privacy preferences respected\n‚Ä¢ Data minimization principles applied\n\n‚öôÔ∏è CURRENT RETENTION POLICIES:\n${Object.entries(m.getRetentionPolicies()).map(([e,t])=>`‚Ä¢ ${e}: ${t} days`).join("\n")}\n\nüí° PRIVACY COMMANDS:\n‚Ä¢ PRIVACY_SETTINGS() - View/update privacy settings\n‚Ä¢ PRIVACY_EXPORT() - Export your data (GDPR)\n‚Ä¢ PRIVACY_DELETE() - Delete all data (Right to be forgotten)\n\n‚úÖ Your data has been cleaned according to privacy policies.`,data:{analysis:"privacy_cleanup",results:e}}}catch(n){return{type:"error",content:`Privacy cleanup failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVACY_SETTINGS:{execute:async(e,t,a)=>{const[n,r]=e.parameters;try{if(!n){const e=m.getPrivacySettings(),t=m.getRetentionPolicies();return{type:"success",content:`üîí Privacy Settings\n\n‚öôÔ∏è CURRENT SETTINGS:\n${Object.entries(e).map(([e,t])=>`‚Ä¢ ${e}: ${t?"‚úÖ Enabled":"‚ùå Disabled"}`).join("\n")}\n\nüìÖ RETENTION POLICIES:\n${Object.entries(t).map(([e,t])=>`‚Ä¢ ${e}: ${t} days`).join("\n")}\n\nüõ°Ô∏è PRIVACY CONTROLS:\n‚Ä¢ dataRetention: Keep historical data\n‚Ä¢ analytics: Allow usage analytics\n‚Ä¢ crashReporting: Send crash reports\n‚Ä¢ dataSharing: Share data with partners\n‚Ä¢ cookieConsent: Accept cookies\n‚Ä¢ trackingConsent: Allow tracking\n\nüí° USAGE:\n‚Ä¢ PRIVACY_SETTINGS() - Show all settings\n‚Ä¢ PRIVACY_SETTINGS("setting", "true/false") - Update setting\n‚Ä¢ PRIVACY_CLEANUP() - Clean expired data\n\nExample: PRIVACY_SETTINGS("analytics", "false")`,data:{analysis:"privacy_settings_view",settings:e,policies:t}}}if(void 0===r)return{type:"info",content:`üîí Privacy Setting: ${n}\nCurrent Value: ${m.getPrivacySettings()[n]?"‚úÖ Enabled":"‚ùå Disabled"}\n\nTo update: PRIVACY_SETTINGS("${n}", "true/false")`};const e="true"===r.toLowerCase();return await m.updatePrivacySettings({[n]:e}),{type:"success",content:`‚úÖ Privacy Setting Updated\n\n‚Ä¢ Setting: ${n}\n‚Ä¢ New Value: ${e?"‚úÖ Enabled":"‚ùå Disabled"}\n\nSetting has been saved and will take effect immediately.`,data:{analysis:"privacy_settings_update",setting:n,value:e}}}catch(s){return{type:"error",content:`Failed to manage privacy settings: ${s.message}`}}},parameterSchema:{required:[],optional:["setting","value"]}},SYNC_STATUS:{execute:async(e,t,a)=>{try{const e=d.getSyncStatus();return{type:"success",content:`üîÑ Sync Status\n\nüìä SYNC OVERVIEW:\n‚Ä¢ Last Sync: ${e.lastSyncTime?new Date(e.lastSyncTime).toLocaleString():"Never"}\n‚Ä¢ Sync In Progress: ${e.syncInProgress?"üü° Yes":"üü¢ No"}\n‚Ä¢ Queue Size: ${e.queueSize} operations\n‚Ä¢ Online Status: ${e.isOnline?"üü¢ Online":"üî¥ Offline"}\n‚Ä¢ Endpoint Configured: ${e.hasEndpoint?"‚úÖ Yes":"‚ùå No"}\n‚Ä¢ Strategy: ${e.strategy}\n\nüîß SYNC CONFIGURATION:\n${e.hasEndpoint?"":"‚ö†Ô∏è No sync endpoint configured - sync is disabled\n"}${e.queueSize>0?`üìã ${e.queueSize} operations waiting to sync\n`:""}${e.isOnline?"":"üì° Device is offline - sync will resume when online\n"}\n\nüí° SYNC COMMANDS:\n‚Ä¢ SYNC_NOW() - Force immediate sync (when available)\n‚Ä¢ SYNC_QUEUE() - View pending operations\n‚Ä¢ BACKUP_CREATE() - Create local backup\n\n${e.hasEndpoint?"‚úÖ Sync is configured and ready.":"üöÄ FUTURE FEATURE:\nCloud sync will be available in a future update.\nFor now, use BACKUP_CREATE() and BACKUP_EXPORT() for data portability."}`,data:{analysis:"sync_status",status:e}}}catch(n){return{type:"error",content:`Failed to get sync status: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PERSISTENCE_TEST:{execute:async(e,t,a)=>{try{const e=await l.runAllTests(),t=`üß™ Persistence Layer Test Results\n\nüìä TEST SUMMARY:\n‚Ä¢ Total Tests: ${e.total}\n‚Ä¢ Passed: ${e.passed} ‚úÖ\n‚Ä¢ Failed: ${e.total-e.passed} ‚ùå\n‚Ä¢ Success Rate: ${h(e.passed/e.total)}\n‚Ä¢ Overall Status: ${e.success?"‚úÖ PASS":"‚ùå FAIL"}\n\nüìã DETAILED RESULTS:\n${e.results.map((e,t)=>{const a=e.passed?"‚úÖ":e.skipped?"‚è≠Ô∏è":"‚ùå",n=e.error?` (${e.error})`:e.reason?` (${e.reason})`:"";return`${t+1}. ${a} ${e.testName}${n}`}).join("\n")}\n\nüîß COMPONENT STATUS:\n‚Ä¢ PersistenceManager: ${e.results.find(e=>e.testName.includes("Persistence Manager"))?.passed?"‚úÖ Working":"‚ùå Issues"}\n‚Ä¢ BackupService: ${e.results.find(e=>e.testName.includes("Backup"))?.passed?"‚úÖ Working":"‚ùå Issues"}\n‚Ä¢ PrivacyService: ${e.results.find(e=>e.testName.includes("Privacy"))?.passed?"‚úÖ Working":"‚ùå Issues"}\n‚Ä¢ SyncService: ${e.results.find(e=>e.testName.includes("Sync"))?.passed?"‚úÖ Working":"‚ùå Issues"}\n\nüí° RECOMMENDATIONS:\n${e.success?"‚Ä¢ All tests passed - persistence layer is working correctly\n‚Ä¢ Regular testing recommended to ensure continued functionality":"‚Ä¢ Some tests failed - check browser console for detailed error messages\n‚Ä¢ Consider running individual component tests\n‚Ä¢ Verify browser storage permissions and quotas"}\n\nüîç DEBUGGING:\n‚Ä¢ Check browser console for detailed test output\n‚Ä¢ Use browser DevTools to inspect localStorage and IndexedDB\n‚Ä¢ Run "STORAGE_STATS()" to check storage usage\n\n${e.success?"‚úÖ Persistence layer is fully functional and ready for production use!":"‚ö†Ô∏è Issues detected - please review failed tests and resolve before production use."}`;return{type:e.success?"success":"warning",content:t,data:{analysis:"persistence_test",testResults:e}}}catch(n){return{type:"error",content:`Persistence test suite failed: ${n.message}\n\nCheck browser console for detailed error information.`}}},parameterSchema:{required:[],optional:[]}}},L=e=>{if(e.length<2)return 0;const t=e.reduce((e,t)=>e+t,0)/e.length,a=e.reduce((e,a)=>e+Math.pow(a-t,2),0)/(e.length-1);return Math.sqrt(a)/t*100},D=(e,t)=>{const a={gross:{excellent:70,good:50,fair:30},operating:{excellent:20,good:10,fair:5},ebitda:{excellent:25,good:15,fair:8}}[t];return e>=a.excellent?"üü¢":e>=a.good?"üü°":e>=a.fair?"üü†":"üî¥"},j={PRIVATE_DCF:{execute:async(e,t,a)=>{try{const e="üîÑ Running DCF analysis on private company data...\n‚Ä¢ Loading financial statements\n‚Ä¢ Calculating free cash flows\n‚Ä¢ Computing terminal value\n‚Ä¢ Analyzing projections...\n‚úÖ Using private financial data";t.showLoading&&t.showLoading(e);const a=x,n=a.periods,r=a.statements.incomeStatement,s=[],i=[],o=[];n.forEach((e,t)=>{const a=r.totalRevenue?.[t]||0,n=r.operatingIncome?.[t]||0;s.push(a),i.push(n),o.push(a?n/a*100:0)});const c={discountRate:12,terminalGrowthRate:2.5,projectionYears:5,taxRate:25},l=s[s.length-1],d=(i[i.length-1],s.length>1?100*(s[s.length-1]/s[s.length-2]-1):15),m=[];let u=l;for(let t=1;t<=c.projectionYears;t++){u*=1+d/100;const e=u*(o[o.length-1]/100),a=e*(1-c.taxRate/100);m.push({year:t,revenue:u,operatingIncome:e,fcf:a,presentValue:a/Math.pow(1+c.discountRate/100,t)})}const g=m.reduce((e,t)=>e+t.presentValue,0),y=m[m.length-1].fcf*(1+c.terminalGrowthRate/100)/((c.discountRate-c.terminalGrowthRate)/100),A=y/Math.pow(1+c.discountRate/100,c.projectionYears),S=g+A;return{type:"success",content:`Private Company DCF Valuation Analysis\n\nüìä HISTORICAL PERFORMANCE:\n${n.map((e,t)=>`‚Ä¢ ${e}: Revenue ${p(s[t],"USD",!0)}, Operating Income ${p(i[t],"USD",!0)} (${h(o[t]/100)})`).join("\n")}\n\nüí∞ DCF VALUATION RESULTS:\n‚Ä¢ Enterprise Value: ${p(S,"USD",!0)}\n‚Ä¢ Terminal Value: ${p(y,"USD",!0)} (${h(A/S)})\n‚Ä¢ PV of Projections: ${p(g,"USD",!0)} (${h(g/S)})\n\nüìà KEY ASSUMPTIONS:\n‚Ä¢ Discount Rate: ${h(c.discountRate/100)}\n‚Ä¢ Terminal Growth: ${h(c.terminalGrowthRate/100)}\n‚Ä¢ Revenue Growth: ${h(d/100)}\n‚Ä¢ Tax Rate: ${h(c.taxRate/100)}\n\nüéØ 5-YEAR PROJECTIONS:\n${m.map(e=>`Year ${e.year}: Revenue ${p(e.revenue,"USD",!0)}, FCF ${p(e.fcf,"USD",!0)}, PV ${p(e.presentValue,"USD",!0)}`).join("\n")}\n\n‚úÖ Analysis based on private financial data`,data:{analysis:"private_dcf",enterpriseValue:S,terminalValue:y,projections:m,assumptions:c}}}catch(n){return{type:"error",content:`Private DCF analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["discountRate","terminalGrowthRate","taxRate"]}},PRIVATE_RATIOS:{execute:async(e,t,a)=>{try{const e=x,t=e.periods,a=e.statements.incomeStatement,n=[];t.forEach((e,t)=>{const r=a.totalRevenue?.[t]||0,s=a.totalCostOfGoodsSold?.[t]||0,i=a.grossProfit?.[t]||0,o=a.operatingIncome?.[t]||0,c=a.netIncome?.[t]||0;n.push({period:e,grossMargin:r?i/r*100:0,operatingMargin:r?o/r*100:0,netMargin:r?c/r*100:0,cogsPercentage:r?s/r*100:0})});const r=[];for(let s=1;s<t.length;s++){const e=a.totalRevenue?.[s]||0,n=a.totalRevenue?.[s-1]||0,i=a.operatingIncome?.[s]||0,o=a.operatingIncome?.[s-1]||0;r.push({period:t[s],revenueGrowth:n?(e-n)/n*100:0,operatingGrowth:o&&Math.abs(o)>.01?(i-o)/Math.abs(o)*100:0})}return{type:"success",content:`Private Company Financial Ratios Analysis\n\nüìä PROFITABILITY RATIOS:\n${n.map(e=>`‚Ä¢ ${e.period}:\n  - Gross Margin: ${h(e.grossMargin/100)}\n  - Operating Margin: ${h(e.operatingMargin/100)}\n  - Net Margin: ${h(e.netMargin/100)}\n  - COGS %: ${h(e.cogsPercentage/100)}`).join("\n\n")}\n\nüìà GROWTH ANALYSIS:\n${r.map(e=>`‚Ä¢ ${e.period}:\n  - Revenue Growth: ${h(e.revenueGrowth/100)}\n  - Operating Growth: ${h(e.operatingGrowth/100)}`).join("\n\n")}\n\nüéØ KEY INSIGHTS:\n‚Ä¢ Latest Gross Margin: ${h(n[n.length-1].grossMargin/100)}\n‚Ä¢ Latest Operating Margin: ${h(n[n.length-1].operatingMargin/100)}\n‚Ä¢ Average Revenue Growth: ${h(r.reduce((e,t)=>e+t.revenueGrowth,0)/r.length/100)}\n\n‚úÖ Analysis based on private financial data`,data:{analysis:"private_ratios",ratios:n,growthRates:r}}}catch(n){return{type:"error",content:`Private ratios analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVATE_SUMMARY:{execute:async(e,t,a)=>{try{const e=x,t=e.periods,a=e.statements.incomeStatement,n=t.length-1,r={period:t[n],revenue:a.totalRevenue?.[n]||0,grossProfit:a.grossProfit?.[n]||0,operatingIncome:a.operatingIncome?.[n]||0,netIncome:a.netIncome?.[n]||0,totalCOGS:a.totalCostOfGoodsSold?.[n]||0},s=r.revenue?r.grossProfit/r.revenue*100:0,i=r.revenue?r.operatingIncome/r.revenue*100:0,o=r.revenue?r.netIncome/r.revenue*100:0,c=[{name:"Injectables",value:a.injectables?.[n]||0},{name:"Surgery",value:a.surgery?.[n]||0},{name:"Wellness",value:a.wellness?.[n]||0},{name:"Weightloss",value:a.weightloss?.[n]||0},{name:"Retail Sales",value:a.retailSales?.[n]||0},{name:"Energy Devices",value:a.energyDevices?.[n]||0}].sort((e,t)=>t.value-e.value);return{type:"success",content:`Private Company Financial Summary (${r.period})\n\nüè¢ COMPANY OVERVIEW:\n‚Ä¢ Period: ${r.period}\n‚Ä¢ Total Revenue: ${p(r.revenue,"USD",!0)}\n‚Ä¢ Operating Status: ${r.operatingIncome>=0?"‚úÖ Profitable":"‚ö†Ô∏è Operating Loss"}\n\nüí∞ FINANCIAL PERFORMANCE:\n‚Ä¢ Gross Profit: ${p(r.grossProfit,"USD",!0)} (${h(s/100)})\n‚Ä¢ Operating Income: ${p(r.operatingIncome,"USD",!0)} (${h(i/100)})\n‚Ä¢ Net Income: ${p(r.netIncome,"USD",!0)} (${h(o/100)})\n‚Ä¢ Cost of Goods Sold: ${p(r.totalCOGS,"USD",!0)}\n\nüìä REVENUE BREAKDOWN:\n${c.map((e,t)=>`${t+1}. ${e.name}: ${p(e.value,"USD",!0)} (${h(e.value/r.revenue)})`).join("\n")}\n\nüìà HISTORICAL TRENDS:\n${t.map((e,t)=>`‚Ä¢ ${e}: ${p(a.totalRevenue?.[t]||0,"USD",!0)}`).join("\n")}\n\nüéØ KEY METRICS:\n‚Ä¢ Revenue Growth (YoY): ${t.length>1?h((a.totalRevenue?.[n]||0)/(a.totalRevenue?.[n-1]||1)-1):"N/A"}\n‚Ä¢ Gross Margin Trend: ${s>=70?"üü¢ Strong":s>=50?"üü° Moderate":"üî¥ Low"}\n‚Ä¢ Operating Efficiency: ${i>=15?"üü¢ Excellent":i>=5?"üü° Fair":i>=0?"üü† Break-even":"üî¥ Loss"}\n\n‚úÖ Analysis based on private financial data`,data:{analysis:"private_summary",latest:r,revenueBreakdown:c,margins:{grossMargin:s,operatingMargin:i,netMargin:o}}}}catch(n){return{type:"error",content:`Private summary analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVATE_LOAD:{execute:async(e,t,a)=>{try{const e=x;return{type:"success",content:`Private Financial Data Loaded Successfully\n\nüìÅ DATA OVERVIEW:\n‚Ä¢ Periods: ${e.periods.join(", ")}\n‚Ä¢ Income Statement: ‚úÖ Loaded\n‚Ä¢ Balance Sheet: ${Object.keys(e.statements.balanceSheet).length>0?"‚úÖ Available":"‚ö†Ô∏è Empty"}\n‚Ä¢ Cash Flow: ${Object.keys(e.statements.cashFlow).length>0?"‚úÖ Available":"‚ö†Ô∏è Empty"}\n\nüìä AVAILABLE DATA:\n‚Ä¢ Revenue Categories: ${Object.keys(e.statements.incomeStatement).filter(e=>e.includes("Revenue")||["energyDevices","injectables","wellness","weightloss","retailSales","surgery"].includes(e)).length}\n‚Ä¢ Expense Categories: ${Object.keys(e.statements.incomeStatement).filter(e=>e.includes("Cogs")||e.includes("Expense")||["marketing","automobile","rent","insurance"].includes(e)).length}\n‚Ä¢ Financial Metrics: ${Object.keys(e.statements.incomeStatement).filter(e=>["grossProfit","operatingIncome","netIncome"].includes(e)).length}\n\nüí° AVAILABLE COMMANDS:\n‚Ä¢ PRIVATE_DCF() - Run DCF valuation\n‚Ä¢ PRIVATE_RATIOS() - Calculate financial ratios\n‚Ä¢ PRIVATE_SUMMARY() - Get company overview\n‚Ä¢ PRIVATE_SCENARIO() - Run scenario analysis\n\n‚úÖ Ready for private company analysis`,data:{analysis:"private_load",dataStructure:{periods:e.periods.length,incomeStatementItems:Object.keys(e.statements.incomeStatement).length,balanceSheetItems:Object.keys(e.statements.balanceSheet).length,cashFlowItems:Object.keys(e.statements.cashFlow).length}}}}catch(n){return{type:"error",content:`Failed to load private data: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVATE_MONTE_CARLO:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,n=t.totalRevenue?.[a]||0,r=t.operatingIncome?.[a]||0,s=1e4,i=[];for(let m=0;m<s;m++){const e=.3*Math.random()+.85,t=.2*Math.random()+.9,a=n*e,s=r*t*8;i.push({valuation:s,revenue:a})}const o=i.map(e=>e.valuation).sort((e,t)=>e-t),c=o[Math.floor(.5*o.length)],l=o[Math.floor(.25*o.length)],d=o[Math.floor(.75*o.length)];return{type:"success",content:`Monte Carlo Simulation Results (${s.toLocaleString()} iterations)\n\nüìä VALUATION DISTRIBUTION:\n‚Ä¢ P25: ${p(l)}\n‚Ä¢ P50 (Median): ${p(c)}\n‚Ä¢ P75: ${p(d)}\n‚Ä¢ Range: ${p(o[0])} - ${p(o[o.length-1])}\n\nüéØ RISK METRICS:\n‚Ä¢ Downside Risk: ${h(.25)}\n‚Ä¢ Upside Potential: ${h(.25)}\n‚Ä¢ Expected Value: ${p(c)}`}}catch(n){return{type:"error",content:`Monte Carlo simulation failed: ${n.message}`}}},parameterSchema:{required:[],optional:["iterations"]}},PRIVATE_SCENARIO:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,n=t.totalRevenue?.[a]||0,r=t.operatingIncome?.[a]||0,s={bear:{growth:-.15,margin:-.2},base:{growth:.1,margin:0},bull:{growth:.35,margin:.15}};let i=`Scenario Analysis\n\nüìä BASE METRICS:\n‚Ä¢ Revenue: ${p(n)}\n‚Ä¢ Operating Income: ${p(r)}\n`;return Object.entries(s).forEach(([e,t])=>{const a=n*(1+t.growth),s=r*(1+t.margin)*8;i+=`\n${e.toUpperCase()} CASE:\n‚Ä¢ Revenue: ${p(a)}\n‚Ä¢ Valuation: ${p(s)}`}),{type:"success",content:i}}catch(n){return{type:"error",content:`Scenario analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["scenarios"]}},PRIVATE_GROWTH:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.map((e,a)=>t.totalRevenue?.[a]||0),n=[];for(let i=1;i<a.length;i++)a[i-1]>0&&n.push(100*(a[i]/a[i-1]-1));const r=n.reduce((e,t)=>e+t,0)/n.length,s=a.length>1&&a[0]>0?100*(Math.pow(a[a.length-1]/a[0],1/(a.length-1))-1):0;return{type:"success",content:`Growth Analysis\n\nüìà GROWTH METRICS:\n‚Ä¢ Revenue CAGR: ${h(s/100)}\n‚Ä¢ Average YoY Growth: ${h(r/100)}\n‚Ä¢ Latest Revenue: ${p(a[a.length-1])}\n\nüéØ GROWTH ASSESSMENT:\n‚Ä¢ Trajectory: ${r>15?"üöÄ High Growth":r>5?"üìà Moderate Growth":"üìâ Slow Growth"}\n‚Ä¢ Consistency: ${n.every(e=>e>0)?"‚úÖ Consistent":"‚ö†Ô∏è Variable"}`}}catch(n){return{type:"error",content:`Growth analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVATE_RISK:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.map((e,a)=>t.totalRevenue?.[a]||0),n=a.map((e,a)=>{const n=t.operatingIncome?.[a]||0;return e>0?n/e*100:0}),r=a.length>1?L(a):0,s=n.length>1?L(n):0,i=(r>20?3:r>10?2:1)+(s>5?2:s>2?1:0),o=i>=4?"HIGH":i>=2?"MEDIUM":"LOW",c=`Risk Assessment\n\n‚öñÔ∏è RISK METRICS:\n‚Ä¢ Revenue Volatility: ${r.toFixed(1)}%\n‚Ä¢ Margin Volatility: ${s.toFixed(1)}%\n‚Ä¢ Overall Risk Level: ${o}\n\nüéØ RISK FACTORS:\n‚Ä¢ Revenue Concentration: ${a.length<3?"‚ö†Ô∏è Limited History":"‚úÖ Adequate Data"}\n‚Ä¢ Margin Stability: ${s<2?"‚úÖ Stable":"‚ö†Ô∏è Variable"}\n‚Ä¢ Growth Sustainability: ${(e=>{const t=[];for(let n=1;n<e.length;n++)e[n-1]>0&&t.push(100*(e[n]/e[n-1]-1));if(0===t.length)return"üìä Insufficient Data";const a=t.reduce((e,t)=>e+t,0)/t.length;return a>10?"‚úÖ Strong":a>0?"üìà Moderate":"üìâ Weak"})(a)}`;return{type:"success",content:c}}catch(n){return{type:"error",content:`Risk analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVATE_VALIDATE:{execute:async(e,t,a)=>{try{const e=x,t=e.statements,a=e.periods,n=[],r=Object.keys(t.incomeStatement).length;Object.keys(t.balanceSheet).length,Object.keys(t.cashFlow).length,n.push({test:"Data Completeness",result:r>5?"PASS":"FAIL",details:`${r} income statement items`});const s=a.map((e,a)=>t.incomeStatement.totalRevenue?.[a]||0),i=s.some(e=>e<0);n.push({test:"Revenue Validation",result:i?"FAIL":"PASS",details:i?"Negative revenue detected":"All revenues positive"});const o=s.map((e,a)=>{const n=t.incomeStatement.operatingIncome?.[a]||0;return e>0?n/e*100:0}),c=o.every(e=>e>=-50&&e<=100);n.push({test:"Margin Reasonableness",result:c?"PASS":"FAIL",details:`Margins range: ${Math.min(...o).toFixed(1)}% to ${Math.max(...o).toFixed(1)}%`});const l=n.filter(e=>"PASS"===e.result).length,d=n.length;let m=`Data Validation Report\n\nüìä VALIDATION SUMMARY:\n‚Ä¢ Tests Passed: ${l}/${d}\n‚Ä¢ Overall Status: ${l===d?"‚úÖ VALID":"‚ö†Ô∏è ISSUES FOUND"}\n\nüîç DETAILED RESULTS:\n`;return n.forEach(e=>{const t="PASS"===e.result?"‚úÖ":"‚ùå";m+=`${t} ${e.test}: ${e.result}\n   ${e.details}\n`}),{type:"success",content:m}}catch(n){return{type:"error",content:`Data validation failed: ${n.message}`}}},parameterSchema:{required:[],optional:[]}},PRIVATE_EXPORT:{execute:async(e,t,a)=>{try{const e=x,t=(new Date).toISOString().slice(0,16).replace("T","_"),a={timestamp:t,company:"Private Company Analysis",periods:e.periods,financials:e.statements,analysis:{dcf:"Run PRIVATE_DCF() for valuation",ratios:"Run PRIVATE_RATIOS() for financial ratios",scenarios:"Run PRIVATE_SCENARIO() for scenario analysis"}};return{type:"success",content:`Export Complete\n\nüìÅ EXPORT DETAILS:\n‚Ä¢ Timestamp: ${t}\n‚Ä¢ Data Periods: ${e.periods.join(", ")}\n‚Ä¢ Export Format: JSON\n‚Ä¢ File Size: ~${JSON.stringify(a).length} bytes\n\nüìä INCLUDED DATA:\n‚Ä¢ Income Statement: ‚úÖ Complete\n‚Ä¢ Balance Sheet: ${Object.keys(e.statements.balanceSheet).length>0?"‚úÖ":"‚ùå"} Available\n‚Ä¢ Cash Flow: ${Object.keys(e.statements.cashFlow).length>0?"‚úÖ":"‚ùå"} Available\n\nüí° USAGE:\n‚Ä¢ Use exported data for external analysis\n‚Ä¢ Import into other financial tools\n‚Ä¢ Create backup of current analysis`,data:{export:a,filename:`private_analysis_${t}.json`}}}catch(n){return{type:"error",content:`Export failed: ${n.message}`}}},parameterSchema:{required:[],optional:["format"]}},PRIVATE_BENCHMARKS:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=(e.periods.length,t.totalRevenue,t.operatingIncome,t.grossProfit,e.assumptions?.industryBenchmarks||{revenuePerSqFt:{min:800,target:1200,current:1490.44},revenuePerProvider:{min:300,target:400,current:1242.03},injectableMargin:{min:.75,target:.8,current:.7},ebitdaMargin:{min:.2,target:.25,current:.185},customerRetention:{min:.65,target:.75,current:.72}});let n="Industry Benchmark Analysis\n\nüìä CURRENT vs BENCHMARKS:\n";Object.entries(a).forEach(([e,t])=>{const a=t.current>=t.target?"üü¢ Above Target":t.current>=t.min?"üü° Meets Minimum":"üî¥ Below Standard",r=(t.current/t.target*100).toFixed(1);n+=`‚Ä¢ ${e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}:\n`,n+=`  Current: ${"number"==typeof t.current&&t.current<1?h(t.current):g(t.current)}\n`,n+=`  Target: ${"number"==typeof t.target&&t.target<1?h(t.target):g(t.target)}\n`,n+=`  Performance: ${a} (${r}% of target)\n\n`});const r=Object.values(a).reduce((e,t)=>e+(t.current>=t.target?2:t.current>=t.min?1:0),0),s=2*Object.keys(a).length,i=r>=.8*s?"A":r>=.6*s?"B":r>=.4*s?"C":"D";return n+=`üéØ COMPETITIVE POSITIONING:\n‚Ä¢ Overall Score: ${r}/${s} (${(r/s*100).toFixed(1)}%)\n‚Ä¢ Industry Grade: ${i}\n‚Ä¢ Market Position: ${"A"===i?"üèÜ Industry Leader":"B"===i?"üìà Above Average":"C"===i?"üìä Market Average":"üìâ Below Average"}`,{type:"success",content:n,data:{analysis:"private_benchmarks",benchmarks:a,competitiveScore:r,grade:i}}}catch(n){return{type:"error",content:`Benchmark analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["industry"]}},PRIVATE_CASHFLOW:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.map((e,a)=>{const n=t.totalRevenue?.[a]||0,r=t.operatingIncome?.[a]||0,s=t.depreciation?.[a]||0,i=r+s-(a>0?.1*((t.totalRevenue?.[a]||0)-(t.totalRevenue?.[a-1]||0)):0);return{period:e,revenue:n,operatingIncome:r,depreciation:s,operatingCashFlow:i,freeCashFlow:i,fcfMargin:n>0?i/n*100:0}}),n=a.reduce((e,t)=>e+t.fcfMargin,0)/a.length,r=a[a.length-1];let s="Cash Flow Analysis\n\nüí∞ CASH FLOW SUMMARY:\n";s+=a.map(e=>`‚Ä¢ ${e.period}:\n  Operating CF: ${p(e.operatingCashFlow)}\n  Free Cash Flow: ${p(e.freeCashFlow)}\n  FCF Margin: ${h(e.fcfMargin/100)}`).join("\n\n"),s+=`\n\nüìä CASH FLOW METRICS:\n‚Ä¢ Latest FCF: ${p(r.freeCashFlow)}\n‚Ä¢ Average FCF Margin: ${h(n/100)}\n‚Ä¢ Cash Generation: ${r.freeCashFlow>0?"‚úÖ Positive":"‚ùå Negative"}\n‚Ä¢ FCF Trend: ${(e=>{if(e.length<2)return"Insufficient data";const t=e.map(e=>e.freeCashFlow),a=t.every((e,a)=>0===a||e>=t[a-1]),n=t.every((e,a)=>0===a||e<=t[a-1]);return a?"üìà Improving":n?"üìâ Declining":"üìä Variable"})(a)}`;const i=a.length>1?100*(r.freeCashFlow/a[0].freeCashFlow-1):0;return s+=`\n\nüéØ CASH FLOW QUALITY:\n‚Ä¢ FCF Growth (Total): ${h(i/100)}\n‚Ä¢ Operating Leverage: ${(e=>{if(e.length<2)return"N/A";const t=100*(e[e.length-1].revenue/e[0].revenue-1),a=100*(e[e.length-1].freeCashFlow/e[0].freeCashFlow-1),n=0!==t?a/t:0;return n>1?"üü¢ High":n>.5?"üü° Moderate":"üî¥ Low"})(a)}\n‚Ä¢ Cash Conversion: ${n>15?"üü¢ Strong":n>5?"üü° Moderate":"üî¥ Weak"}`,{type:"success",content:s,data:{analysis:"private_cashflow",cashFlowAnalysis:a,metrics:{avgFCFMargin:n,fcfGrowth:i}}}}catch(n){return{type:"error",content:`Cash flow analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["years"]}},PRIVATE_MULTIPLES:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,n=t.totalRevenue?.[a]||0,r=(t.operatingIncome?.[a]||0)+(t.depreciation?.[a]||0),s=(t.operatingIncome,t.netIncome?.[a]||0),i={evRevenue:{min:1.5,typical:2.5,premium:4},evEbitda:{min:6,typical:10,premium:15},peRatio:{min:12,typical:18,premium:25}},o={revenueMultiple:{conservative:n*i.evRevenue.min,typical:n*i.evRevenue.typical,premium:n*i.evRevenue.premium},ebitdaMultiple:r>0?{conservative:r*i.evEbitda.min,typical:r*i.evEbitda.typical,premium:r*i.evEbitda.premium}:null,earningsMultiple:s>0?{conservative:s*i.peRatio.min,typical:s*i.peRatio.typical,premium:s*i.peRatio.premium}:null};let c=`Valuation Multiples Analysis\n\nüìä CURRENT METRICS:\n‚Ä¢ Revenue (TTM): ${p(n)}\n‚Ä¢ EBITDA (TTM): ${p(r)}\n‚Ä¢ Net Income: ${p(s)}\n\nüí∞ VALUATION SCENARIOS:\n`;c+="üìà REVENUE MULTIPLE APPROACH:\n",c+=`‚Ä¢ Conservative (${i.evRevenue.min}x): ${p(o.revenueMultiple.conservative)}\n`,c+=`‚Ä¢ Typical (${i.evRevenue.typical}x): ${p(o.revenueMultiple.typical)}\n`,c+=`‚Ä¢ Premium (${i.evRevenue.premium}x): ${p(o.revenueMultiple.premium)}\n\n`,o.ebitdaMultiple&&(c+="üíº EBITDA MULTIPLE APPROACH:\n",c+=`‚Ä¢ Conservative (${i.evEbitda.min}x): ${p(o.ebitdaMultiple.conservative)}\n`,c+=`‚Ä¢ Typical (${i.evEbitda.typical}x): ${p(o.ebitdaMultiple.typical)}\n`,c+=`‚Ä¢ Premium (${i.evEbitda.premium}x): ${p(o.ebitdaMultiple.premium)}\n\n`),o.earningsMultiple&&(c+="üìä EARNINGS MULTIPLE APPROACH:\n",c+=`‚Ä¢ Conservative (${i.peRatio.min}x): ${p(o.earningsMultiple.conservative)}\n`,c+=`‚Ä¢ Typical (${i.peRatio.typical}x): ${p(o.earningsMultiple.typical)}\n`,c+=`‚Ä¢ Premium (${i.peRatio.premium}x): ${p(o.earningsMultiple.premium)}\n\n`);const l=[o.revenueMultiple.typical,o.ebitdaMultiple?.typical,o.earningsMultiple?.typical].filter(e=>e),d=l.reduce((e,t)=>e+t,0)/l.length,m=Math.min(...l),u=Math.max(...l);return c+=`üéØ VALUATION SUMMARY:\n‚Ä¢ Average Valuation: ${p(d)}\n‚Ä¢ Valuation Range: ${p(m)} - ${p(u)}\n‚Ä¢ Method Consistency: ${u/m<2?"‚úÖ Consistent":"‚ö†Ô∏è Wide Range"}\n‚Ä¢ Recommended Range: ${p(.8*d)} - ${p(1.2*d)}`,{type:"success",content:c,data:{analysis:"private_multiples",valuations:o,summary:{avgValuation:d,minValuation:m,maxValuation:u}}}}catch(n){return{type:"error",content:`Multiples analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["industry","size"]}},PRIVATE_SENSITIVITY:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,n=t.totalRevenue?.[a]||0,r=(t.operatingIncome?.[a]||0)+(t.depreciation?.[a]||0),s=[-20,-10,0,10,20],i=[-2,-1,0,1,2],o=10;let c=`Sensitivity Analysis\n\nüìä BASE CASE:\n‚Ä¢ Revenue: ${p(n)}\n‚Ä¢ EBITDA: ${p(r)}\n‚Ä¢ EBITDA Multiple: ${o}x\n‚Ä¢ Base Valuation: ${p(r*o)}\n\n`;c+="üìà REVENUE SENSITIVITY:\n",s.forEach(e=>{const t=r*(1+e/100)*o,a=100*(t/(r*o)-1);c+=`‚Ä¢ Revenue ${e>=0?"+":""}${e}%: Valuation ${p(t)} (${a>=0?"+":""}${a.toFixed(1)}%)\n`}),c+="\nüíº MARGIN SENSITIVITY (percentage points):\n";const l=n>0?r/n*100:0;i.forEach(e=>{const t=n*((l+e)/100),a=t*o,s=t>0?100*(a/(r*o)-1):-100;c+=`‚Ä¢ Margin ${e>=0?"+":""}${e}pp: EBITDA ${p(t)}, Valuation ${p(a)} (${s>=0?"+":""}${s.toFixed(1)}%)\n`}),c+="\nüéØ MULTIPLE SENSITIVITY:\n",[8,9,10,11,12].forEach(e=>{const t=100*(e/o-1);c+=`‚Ä¢ ${e}x EBITDA: ${p(r*e)} (${t>=0?"+":""}${t.toFixed(1)}%)\n`});const d=1,m=n*o/(r*o);return c+=`\nüîç SENSITIVITY INSIGHTS:\n‚Ä¢ Revenue Elasticity: ${d.toFixed(2)}x (1% revenue change ‚Üí ${d.toFixed(1)}% valuation change)\n‚Ä¢ Margin Impact: 1pp margin change ‚Üí ${(100*(m-1)).toFixed(1)}% valuation change\n‚Ä¢ Key Driver: ${m>d?"Margin optimization":"Revenue growth"} has higher impact`,{type:"success",content:c,data:{analysis:"private_sensitivity",baseCase:{revenue:n,ebitda:r,valuation:r*o},sensitivities:{revenueElasticity:d,marginElasticity:m}}}}catch(n){return{type:"error",content:`Sensitivity analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["variables","ranges"]}},PRIVATE_WATERFALL:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,n=t.totalRevenue?.[a]||0,r=t.operatingIncome?.[a]||0,s=.25,i=.12,o=.025,c=[{step:"Base Revenue",value:n,cumulative:n},{step:"Operating Leverage",value:r-.15*n,cumulative:r},{step:"Tax Shield",value:-r*s,cumulative:r*(1-s)},{step:"Working Capital",value:.02*-n,cumulative:r*(1-s)-.02*n},{step:"CapEx",value:.03*-n,cumulative:r*(1-s)-.05*n},{step:"Free Cash Flow",value:0,cumulative:r*(1-s)-.05*n}],l=c[c.length-1].cumulative,d=l*(1+o)/(i-o),m=4.5*l,u=d/Math.pow(1+i,5),g=m+u;let y="DCF Waterfall Analysis\n\nüíß CASH FLOW WATERFALL:\n";return c.forEach((e,t)=>{const a=0===t?"":e.value>=0?" ‚Üó ":" ‚Üò ";y+=`${t+1}. ${e.step}: ${p(e.value)} ${a}${p(e.cumulative)}\n`}),y+=`\nüèóÔ∏è VALUATION BUILD-UP:\n‚Ä¢ PV of 5-Year FCF: ${p(m)}\n‚Ä¢ PV of Terminal Value: ${p(u)}\n‚Ä¢ Enterprise Value: ${p(g)}\n‚Ä¢ Terminal Multiple: ${(d/l).toFixed(1)}x FCF\n‚Ä¢ Implied FCF Yield: ${h(l/g)}`,{type:"success",content:y,data:{analysis:"private_waterfall",waterfallSteps:c,valuation:{pv5Years:m,pvTerminal:u,enterpriseValue:g}}}}catch(n){return{type:"error",content:`Waterfall analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["discountRate","terminalGrowthRate"]}},PRIVATE_COMPS:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,n=t.totalRevenue?.[a]||0,r=(t.operatingIncome?.[a]||0)+(t.depreciation?.[a]||0),s=[{name:"Lifestyle Communities",evRevenue:2.1,evEbitda:12.5,margin:18.2},{name:"European Wax Center",evRevenue:3.2,evEbitda:15.8,margin:22.1},{name:"Planet Fitness",evRevenue:4.5,evEbitda:18.2,margin:28.5},{name:"Xponential Fitness",evRevenue:2.8,evEbitda:14.1,margin:19.8},{name:"Hand & Stone",evRevenue:2.5,evEbitda:11.2,margin:21.4}],i=n>0?r/n*100:0,o=s.reduce((e,t)=>e+t.evRevenue,0)/s.length,c=s.reduce((e,t)=>e+t.evEbitda,0)/s.length,l=s.reduce((e,t)=>e+t.margin,0)/s.length,d=n*o,m=r*c,u=(d+m)/2;let g="Comparable Company Analysis\n\nüè¢ PEER GROUP ANALYSIS:\n";return g+=`Trading Multiple Averages:\n‚Ä¢ EV/Revenue: ${o.toFixed(1)}x\n‚Ä¢ EV/EBITDA: ${c.toFixed(1)}x\n‚Ä¢ EBITDA Margin: ${l.toFixed(1)}%\n\n`,g+="üìä DETAILED COMPARABLES:\n",s.forEach((e,t)=>{g+=`${t+1}. ${e.name}:\n   EV/Rev: ${e.evRevenue}x, EV/EBITDA: ${e.evEbitda}x, Margin: ${e.margin}%\n`}),g+=`\nüí∞ IMPLIED VALUATION:\n‚Ä¢ Revenue Multiple: ${p(d)} (${o.toFixed(1)}x)\n‚Ä¢ EBITDA Multiple: ${p(m)} (${c.toFixed(1)}x)\n‚Ä¢ Average Trading Value: ${p(u)}\n‚Ä¢ Current EBITDA Margin: ${h(i/100)}\n‚Ä¢ Peer Margin Delta: ${(i-l).toFixed(1)}pp`,g+=`\nüéØ RELATIVE POSITIONING:\n‚Ä¢ Multiple Premium/Discount: ${100*(u/(2.5*n+12*r)-1)>0?"+":""}${(100*(u/(2.5*n+12*r)-1)).toFixed(1)}%\n‚Ä¢ Margin Competitiveness: ${i>=l?"üü¢ Above Peers":"üü° Below Peers"}\n‚Ä¢ Size Adjustment: ${n<5e7?"Small-cap discount may apply":"Mid-cap positioning"}`,{type:"success",content:g,data:{analysis:"private_comps",comparables:s,peerAverages:{avgEvRevenue:o,avgEvEbitda:c,avgMargin:l},impliedValuation:{tradingValuationRevenue:d,tradingValuationEbitda:m,avgTradingValuation:u}}}}catch(n){return{type:"error",content:`Comparable analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["sector","size"]}},PRIVATE_LBO:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,n=(t.totalRevenue,(t.operatingIncome?.[a]||0)+(t.depreciation?.[a]||0)),r=10*n,s=.3*r,i=.7*r,o=.08,c=12,l=5,d=.08,m=[];for(let p=1;p<=l;p++)m.push(n*Math.pow(1+d,p));let u=i;const g=[];m.forEach((e,t)=>{const a=.6*e,n=u*o,r=Math.min(.5*(a-n),.2*u);u=Math.max(0,u-r),g.push({year:t+1,ebitda:e,debt:u,reduction:r})});const y=m[l-1],A=y*c,S=A-u,f=S/s,v=Math.pow(f,1/l)-1,E=f;let T=`Leveraged Buyout Analysis\n\nüíº TRANSACTION STRUCTURE:\n‚Ä¢ Purchase Price: ${p(r)} (${(r/n).toFixed(1)}x EBITDA)\n‚Ä¢ Equity Investment: ${p(s)} (${h(s/r)})\n‚Ä¢ Debt Financing: ${p(i)} (${h(i/r)})\n‚Ä¢ Interest Rate: ${h(o)}\n\n`;return T+="üìà EBITDA PROJECTIONS:\n",m.forEach((e,t)=>{T+=`Year ${t+1}: ${p(e)} (${h(d)} growth)\n`}),T+="\nüè¶ DEBT PAYDOWN SCHEDULE:\n",g.forEach(e=>{T+=`Year ${e.year}: Debt ${p(e.debt)}, Paydown ${p(e.reduction)}\n`}),T+=`\nüéØ EXIT ANALYSIS (Year ${l}):\n‚Ä¢ Exit EBITDA: ${p(y)}\n‚Ä¢ Exit Multiple: ${c}x\n‚Ä¢ Exit Value: ${p(A)}\n‚Ä¢ Remaining Debt: ${p(u)}\n‚Ä¢ Net Proceeds: ${p(S)}\n\nüí∞ INVESTOR RETURNS:\n‚Ä¢ Total Return: ${p(S)} (${f.toFixed(1)}x)\n‚Ä¢ Money-on-Money: ${E.toFixed(1)}x\n‚Ä¢ IRR: ${h(v)}\n‚Ä¢ Return Quality: ${v>.2?"üü¢ Excellent":v>.15?"üü° Good":"üî¥ Poor"}`,{type:"success",content:T,data:{analysis:"private_lbo",transaction:{purchasePrice:r,equityContribution:s,debtFinancing:i},projections:m,returns:{totalReturn:f,moic:E,irr:v}}}}catch(n){return{type:"error",content:`LBO analysis failed: ${n.message}`}}},parameterSchema:{required:[],optional:["leverage","holdPeriod","exitMultiple"]}},PRIVATE_QUALITY:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods,r=[],s=a.map((e,a)=>t.totalRevenue?.[a]||0),i=(e=>{if(e.length<3)return 50;const t=[];for(let r=1;r<e.length;r++)e[r-1]>0&&t.push(100*(e[r]/e[r-1]-1));const a=t.reduce((e,t)=>e+t,0)/t.length,n=Math.sqrt(t.reduce((e,t)=>e+Math.pow(t-a,2),0)/(t.length-1));return Math.max(0,Math.min(100,80-2*n))})(s),o=((e,t)=>{const a=e.injectables?.[t]||0,n=e.wellness?.[t]||0,r=e.totalRevenue?.[t]||0,s=r>0?(a+n)/r:0;return Math.min(100,100*s+20)})(t,a.length-1);r.push({metric:"Revenue Quality",score:.6*i+.4*o,weight:25});const c=s.map((e,a)=>{const n=t.operatingIncome?.[a]||0;return e>0?n/e*100:0}),l=(e=>{if(e.length<2)return 50;const t=e.reduce((e,t)=>e+t,0)/e.length,a=Math.sqrt(e.reduce((e,a)=>e+Math.pow(a-t,2),0)/(e.length-1));return Math.max(0,Math.min(100,90-5*a))})(c),d=(e=>{if(e.length<2)return 50;const t=(e[e.length-1]-e[0])/e.length;return Math.max(0,Math.min(100,60+10*t))})(c);r.push({metric:"Profitability Quality",score:.7*l+.3*d,weight:30});const m=85,u=90;r.push({metric:"Cash Generation",score:(m+u)/2,weight:20});const p=75,g=(e=>{const t=e.length>1?100*(e[e.length-1]/e[0]-1)/(e.length-1):0;return Math.min(100,Math.max(0,50+2*t))})(s);r.push({metric:"Competitive Position",score:.6*p+.4*g,weight:15});const h=75,y=80;r.push({metric:"Financial Strength",score:(h+y)/2,weight:10});const A=r.reduce((e,t)=>e+t.score*t.weight/100,0),S=A>=80?"A":A>=70?"B":A>=60?"C":A>=50?"D":"F";let f=`Business Quality Assessment\n\nüèÜ OVERALL QUALITY SCORE: ${A.toFixed(1)}/100 (Grade: ${S})\n\nüìä QUALITY BREAKDOWN:\n`;return r.forEach(e=>{const t=e.score>=80?"A":e.score>=70?"B":e.score>=60?"C":"D";f+=`‚Ä¢ ${e.metric}: ${e.score.toFixed(1)}/100 (${t}) - Weight: ${e.weight}%\n`}),f+=`\nüéØ QUALITY ANALYSIS:\n‚Ä¢ Investment Grade: ${"A"===S?"üü¢ High Quality":"B"===S?"üü° Good Quality":"C"===S?"üü† Average Quality":"üî¥ Below Average"}\n‚Ä¢ Risk Profile: ${A>=75?"Low-Medium Risk":A>=60?"Medium Risk":"Medium-High Risk"}\n‚Ä¢ Valuation Multiple Premium: ${A>=80?"10-15%":A>=70?"5-10%":A>=60?"0-5%":"Discount warranted"}\n\nüí° KEY STRENGTHS:\n${n=r,n.filter(e=>e.score>=80).map(e=>`‚Ä¢ ${e.metric}: Strong performance`).join("\n")||"‚Ä¢ Need to improve overall performance"}\n\n‚ö†Ô∏è AREAS FOR IMPROVEMENT:\n${(e=>e.filter(e=>e.score<70).map(e=>`‚Ä¢ ${e.metric}: Below target performance`).join("\n")||"‚Ä¢ No major weaknesses identified")(r)}`,{type:"success",content:f,data:{analysis:"private_quality",overallScore:A,qualityGrade:S,metrics:r}}}catch(r){return{type:"error",content:`Quality assessment failed: ${r.message}`}}var n},parameterSchema:{required:[],optional:["weights"]}},PRIVATE_WORKFLOW:{execute:async(e,t,a)=>{try{const e=x,t=(e.statements.incomeStatement,e.periods,[{step:"Data Quality",completed:!0,score:85,next:"PRIVATE_VALIDATE()"},{step:"Company Overview",completed:!1,score:0,next:"PRIVATE_SUMMARY()"},{step:"Financial Analysis",completed:!1,score:0,next:"PRIVATE_RATIOS()"},{step:"Valuation Models",completed:!1,score:0,next:"PRIVATE_DCF() & PRIVATE_MULTIPLES()"},{step:"Risk Assessment",completed:!1,score:0,next:"PRIVATE_RISK() & PRIVATE_SCENARIO()"},{step:"Benchmarking",completed:!1,score:0,next:"PRIVATE_BENCHMARKS() & PRIVATE_COMPS()"},{step:"Advanced Models",completed:!1,score:0,next:"PRIVATE_LBO() & PRIVATE_MONTE_CARLO()"},{step:"Final Report",completed:!1,score:0,next:"PRIVATE_EXPORT()"}]),a=t.filter(e=>e.completed).length/t.length*100,r=t.find(e=>!e.completed);let s=`Private Analysis Workflow\n\nüìã WORKFLOW PROGRESS: ${a.toFixed(0)}% Complete\n\nüîÑ ANALYSIS STEPS:\n`;return t.forEach((e,a)=>{const n=e.completed?"‚úÖ":a===t.findIndex(e=>!e.completed)?"üîÑ":"‚è≥";s+=`${a+1}. ${n} ${e.step} ${e.completed?`(${e.score}%)`:""}\n   Next: ${e.next}\n\n`}),s+=`üéØ RECOMMENDED NEXT STEPS:\n‚Ä¢ ${r?r.next:"All steps completed!"}\n‚Ä¢ Focus on ${r?r.step.toLowerCase():"final review"}\n‚Ä¢ Estimated time: ${n=r?.step,{"Data Quality":"2-3 minutes","Company Overview":"3-5 minutes","Financial Analysis":"5-8 minutes","Valuation Models":"8-12 minutes","Risk Assessment":"5-7 minutes",Benchmarking:"4-6 minutes","Advanced Models":"10-15 minutes","Final Report":"2-3 minutes"}[n]||"5 minutes"}\n\nüìä WORKFLOW INSIGHTS:\n‚Ä¢ Data completeness: ${(e=>{const t=Object.keys(e.statements.incomeStatement).length+Object.keys(e.statements.balanceSheet).length+Object.keys(e.statements.cashFlow).length;return Math.min(100,t/50*100)})(e)}%\n‚Ä¢ Analysis depth: ${(e=>{const t=e.filter(e=>e.completed).length;return t>=6?"Comprehensive":t>=4?"Detailed":t>=2?"Basic":"Initial"})(t)}\n‚Ä¢ Report readiness: ${a>=80?"üü¢ Ready":a>=50?"üü° Partial":"üî¥ Incomplete"}`,{type:"success",content:s,data:{analysis:"private_workflow",workflowSteps:t,progress:a,nextStep:r?.step}}}catch(r){return{type:"error",content:`Workflow analysis failed: ${r.message}`}}var n},parameterSchema:{required:[],optional:[]}},PRIVATE_DASHBOARD:{execute:async(e,t,a)=>{try{const e=x,t=e.statements.incomeStatement,a=e.periods.length-1,s=t.totalRevenue?.[a]||0,i=t.grossProfit?.[a]||0,o=t.operatingIncome?.[a]||0,c=o+(t.depreciation?.[a]||.02*s),l=a>0&&t.totalRevenue?.[a-1]>0?100*(s/t.totalRevenue[a-1]-1):0,d=s>0?i/s*100:0,m=s>0?o/s*100:0,u=s>0?c/s*100:0,g=(2.5*s+10*c)/2,h=(e=>{let t=0;return t+=Math.min(25,Math.max(0,15+e.revenueGrowth)),t+=Math.min(25,.5*e.grossMargin),t+=Math.min(30,2*e.operatingMargin),t+=Math.min(20,1.2*e.ebitdaMargin),Math.round(t)})({revenueGrowth:l,grossMargin:d,operatingMargin:m,ebitdaMargin:u});let y=`üìä EXECUTIVE DASHBOARD\n\nüí∞ FINANCIAL SNAPSHOT (${e.periods[a]}):\n`;return y+="‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n",y+=`‚îÇ Revenue:        ${p(s).padEnd(20)} ‚îÇ\n`,y+=`‚îÇ EBITDA:         ${p(c).padEnd(20)} ‚îÇ\n`,y+=`‚îÇ Operating Inc:  ${p(o).padEnd(20)} ‚îÇ\n`,y+=`‚îÇ Est. Valuation: ${p(g).padEnd(20)} ‚îÇ\n`,y+="‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n",y+="üìà KEY PERFORMANCE INDICATORS:\n",y+=`‚Ä¢ Revenue Growth:    ${l>=0?"+":""}${l.toFixed(1)}% ${r=l,r>=15?"üöÄ":r>=5?"üìà":r>=0?"‚û°Ô∏è":"üìâ"}\n`,y+=`‚Ä¢ Gross Margin:      ${d.toFixed(1)}% ${D(d,"gross")}\n`,y+=`‚Ä¢ Operating Margin:  ${m.toFixed(1)}% ${D(m,"operating")}\n`,y+=`‚Ä¢ EBITDA Margin:     ${u.toFixed(1)}% ${D(u,"ebitda")}\n\n`,y+=`üéØ PERFORMANCE SCORE: ${h}/100\n`,y+=`Rating: ${n=h,n>=80?"üèÜ Excellent":n>=70?"ü•á Very Good":n>=60?"ü•à Good":n>=50?"ü•â Fair":"üìä Needs Improvement"}\n\n`,y+="üîç QUICK ACTIONS:\n‚Ä¢ Run PRIVATE_DCF() for detailed valuation\n‚Ä¢ Execute PRIVATE_BENCHMARKS() for peer comparison\n‚Ä¢ Use PRIVATE_SCENARIO() for risk modeling\n‚Ä¢ Try PRIVATE_QUALITY() for investment grade analysis",{type:"success",content:y,data:{analysis:"private_dashboard",metrics:{revenue:s,ebitda:c,operatingIncome:o,impliedValuation:g},kpis:{revenueGrowth:l,grossMargin:d,operatingMargin:m,ebitdaMargin:u},performanceScore:h}}}catch(s){return{type:"error",content:`Dashboard generation failed: ${s.message}`}}var n,r},parameterSchema:{required:[],optional:["period"]}},PRIVATE:{execute:async(e,t,a)=>{const n=[{cmd:"PRIVATE_LOAD()",desc:"Load and validate private financial data",cat:"üìä CORE ANALYSIS"},{cmd:"PRIVATE_SUMMARY()",desc:"Generate executive summary of company performance",cat:"üìä CORE ANALYSIS"},{cmd:"PRIVATE_DCF()",desc:"Run discounted cash flow valuation analysis",cat:"üìä CORE ANALYSIS"},{cmd:"PRIVATE_RATIOS()",desc:"Calculate comprehensive financial ratios",cat:"üìä CORE ANALYSIS"},{cmd:"PRIVATE_WATERFALL()",desc:"DCF waterfall and value bridge analysis",cat:"üí∞ VALUATION"},{cmd:"PRIVATE_COMPS()",desc:"Comparable company trading multiples analysis",cat:"üí∞ VALUATION"},{cmd:"PRIVATE_LBO()",desc:"Leveraged buyout model and returns analysis",cat:"üí∞ VALUATION"},{cmd:"PRIVATE_MULTIPLES()",desc:"Valuation using industry multiples approach",cat:"üí∞ VALUATION"},{cmd:"PRIVATE_QUALITY()",desc:"Business quality and investment grade assessment",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_BENCHMARKS()",desc:"Compare metrics against industry benchmarks",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_CASHFLOW()",desc:"Analyze cash flow generation and quality",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_GROWTH()",desc:"Assess revenue growth trends and sustainability",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_RISK()",desc:"Evaluate business risk factors and volatility",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_MONTE_CARLO()",desc:"Monte Carlo simulation for valuation ranges",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_SCENARIO()",desc:"Run bull/base/bear case scenario analysis",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_SENSITIVITY()",desc:"Sensitivity analysis on key variables",cat:"üìà ANALYTICS"},{cmd:"PRIVATE_WORKFLOW()",desc:"Interactive analysis workflow with recommendations",cat:"ü§ñ AUTOMATION"},{cmd:"PRIVATE_DASHBOARD()",desc:"Executive dashboard with key metrics summary",cat:"üìã REPORTING"},{cmd:"PRIVATE_VALIDATE()",desc:"Validate data quality and completeness",cat:"üíæ DATA MANAGEMENT"},{cmd:"PRIVATE_EXPORT()",desc:"Export analysis data and results",cat:"üíæ DATA MANAGEMENT"},{cmd:"PRIVATE_HELP()",desc:"Show all available private analysis commands",cat:"üõ†Ô∏è UTILITY"}];let r=`üöÄ **Private Analysis CLI Commands (${n.length} Total)**\n\n`;return[...new Set(n.map(e=>e.cat))].forEach(e=>{const t=n.filter(t=>t.cat===e);r+=`### **${e}**\n`,t.forEach(e=>{r+=`- **${e.cmd}** - ${e.desc}\n`}),r+="\n"}),r+="### **üí° USAGE EXAMPLES:**\n",r+="```\n",r+="PRIVATE_LOAD()           # Start with data validation\n",r+="PRIVATE_SUMMARY()        # Get company overview\n",r+="PRIVATE_DCF()           # Run DCF valuation\n",r+="PRIVATE_COMPS()         # Comparable analysis\n",r+="PRIVATE_LBO()           # LBO modeling\n",r+="PRIVATE_DASHBOARD()     # Executive summary\n",r+="PRIVATE_WORKFLOW()      # Guided analysis\n",r+="```\n\n",r+="**All commands work with the default private financial data and provide professional-grade analysis suitable for investment banking, private equity, and corporate finance workflows.**",{type:"success",content:r,data:{analysis:"private_commands_list",commands:n.map(e=>e.cmd),totalCommands:n.length}}},parameterSchema:{required:[],optional:[]}}};C.register("DCF",I.DCF,{category:"CORE",description:"Discounted Cash Flow valuation with real-time data",usage:"DCF(ticker)",examples:["DCF(AAPL)","DCF(MSFT)"],tags:["valuation","dcf","analysis"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("LBO",I.LBO,{category:"CORE",description:"Leveraged Buyout analysis with return projections",usage:"LBO(ticker)",examples:["LBO(TSLA)","LBO(NVDA)"],tags:["lbo","private-equity","analysis"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("COMP",I.COMP,{category:"CORE",description:"Comparable company analysis with peer multiples",usage:"COMP(ticker)",examples:["COMP(GOOGL)","COMP(META)"],tags:["comparable","multiples","analysis"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("FETCH",I.FETCH,{category:"CORE",description:"Comprehensive company data and financial metrics",usage:"FETCH(ticker)",examples:["FETCH(AMZN)","FETCH(NFLX)"],tags:["data","profile","metrics"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("PRIVATE_DCF",j.PRIVATE_DCF,{category:"CORE",description:"DCF valuation using private company financial data",usage:"PRIVATE_DCF()",examples:["PRIVATE_DCF()"],tags:["private","dcf","valuation","analysis"],parameterSchema:{required:[],optional:["discountRate","terminalGrowthRate","taxRate"]}}),C.register("PRIVATE_RATIOS",j.PRIVATE_RATIOS,{category:"CORE",description:"Financial ratios analysis for private company data",usage:"PRIVATE_RATIOS()",examples:["PRIVATE_RATIOS()"],tags:["private","ratios","analysis","margins"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVATE_SUMMARY",j.PRIVATE_SUMMARY,{category:"CORE",description:"Comprehensive financial summary of private company",usage:"PRIVATE_SUMMARY()",examples:["PRIVATE_SUMMARY()"],tags:["private","summary","overview","financial"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVATE_LOAD",j.PRIVATE_LOAD,{category:"DATA",description:"Load and verify private company financial data",usage:"PRIVATE_LOAD()",examples:["PRIVATE_LOAD()"],tags:["private","data","load","verification"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVATE_MONTE_CARLO",j.PRIVATE_MONTE_CARLO,{category:"ANALYTICS",description:"Monte Carlo simulation for private company valuation",usage:"PRIVATE_MONTE_CARLO()",examples:["PRIVATE_MONTE_CARLO()","PRIVATE_MONTE_CARLO(5000)"],tags:["private","monte-carlo","simulation","risk"],parameterSchema:{required:[],optional:["iterations"]}}),C.register("PRIVATE_SCENARIO",j.PRIVATE_SCENARIO,{category:"ANALYTICS",description:"Scenario analysis for private company valuation",usage:"PRIVATE_SCENARIO()",examples:["PRIVATE_SCENARIO()"],tags:["private","scenario","analysis","valuation"],parameterSchema:{required:[],optional:["scenarios"]}}),C.register("PRIVATE_GROWTH",j.PRIVATE_GROWTH,{category:"ANALYTICS",description:"Growth trend analysis for private company",usage:"PRIVATE_GROWTH()",examples:["PRIVATE_GROWTH()"],tags:["private","growth","trends","cagr"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVATE_RISK",j.PRIVATE_RISK,{category:"ANALYTICS",description:"Risk assessment for private company",usage:"PRIVATE_RISK()",examples:["PRIVATE_RISK()"],tags:["private","risk","volatility","assessment"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVATE_VALIDATE",j.PRIVATE_VALIDATE,{category:"DATA",description:"Validate private company financial data",usage:"PRIVATE_VALIDATE()",examples:["PRIVATE_VALIDATE()"],tags:["private","validation","data-quality","verification"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVATE_EXPORT",j.PRIVATE_EXPORT,{category:"DATA",description:"Export private company analysis results",usage:"PRIVATE_EXPORT()",examples:["PRIVATE_EXPORT()","PRIVATE_EXPORT(csv)"],tags:["private","export","data","backup"],parameterSchema:{required:[],optional:["format"]}}),C.register("PRIVATE_WATERFALL",j.PRIVATE_WATERFALL,{category:"VALUATION",description:"DCF waterfall and value bridge analysis for private companies",usage:"PRIVATE_WATERFALL()",examples:["PRIVATE_WATERFALL()"],tags:["private","dcf","waterfall","analysis"],parameterSchema:{required:[],optional:["discountRate","terminalGrowthRate"]}}),C.register("PRIVATE_COMPS",j.PRIVATE_COMPS,{category:"VALUATION",description:"Comparable company trading multiples analysis",usage:"PRIVATE_COMPS()",examples:["PRIVATE_COMPS()"],tags:["private","comparables","trading-multiples","peer-analysis"],parameterSchema:{required:[],optional:["sector","size"]}}),C.register("PRIVATE_LBO",j.PRIVATE_LBO,{category:"VALUATION",description:"Leveraged buyout model and returns analysis",usage:"PRIVATE_LBO()",examples:["PRIVATE_LBO()"],tags:["private","lbo","leveraged-buyout","pe-analysis"],parameterSchema:{required:[],optional:["leverage","holdPeriod","exitMultiple"]}}),C.register("PRIVATE_QUALITY",j.PRIVATE_QUALITY,{category:"ANALYTICS",description:"Business quality and investment grade assessment",usage:"PRIVATE_QUALITY()",examples:["PRIVATE_QUALITY()"],tags:["private","quality","investment-grade","assessment"],parameterSchema:{required:[],optional:["weights"]}}),C.register("PRIVATE_BENCHMARKS",j.PRIVATE_BENCHMARKS,{category:"ANALYTICS",description:"Compare metrics against industry benchmarks",usage:"PRIVATE_BENCHMARKS()",examples:["PRIVATE_BENCHMARKS()"],tags:["private","benchmarks","industry","comparison"],parameterSchema:{required:[],optional:["industry"]}}),C.register("PRIVATE_CASHFLOW",j.PRIVATE_CASHFLOW,{category:"ANALYTICS",description:"Analyze cash flow generation and quality",usage:"PRIVATE_CASHFLOW()",examples:["PRIVATE_CASHFLOW()"],tags:["private","cashflow","quality","analysis"],parameterSchema:{required:[],optional:["years"]}}),C.register("PRIVATE_MULTIPLES",j.PRIVATE_MULTIPLES,{category:"VALUATION",description:"Valuation using industry multiples approach",usage:"PRIVATE_MULTIPLES()",examples:["PRIVATE_MULTIPLES()"],tags:["private","multiples","valuation","industry"],parameterSchema:{required:[],optional:["industry","size"]}}),C.register("PRIVATE_SENSITIVITY",j.PRIVATE_SENSITIVITY,{category:"ANALYTICS",description:"Sensitivity analysis on key variables",usage:"PRIVATE_SENSITIVITY()",examples:["PRIVATE_SENSITIVITY()"],tags:["private","sensitivity","analysis","variables"],parameterSchema:{required:[],optional:["variables","ranges"]}}),C.register("PRIVATE_WORKFLOW",j.PRIVATE_WORKFLOW,{category:"AUTOMATION",description:"Interactive analysis workflow with recommendations",usage:"PRIVATE_WORKFLOW()",examples:["PRIVATE_WORKFLOW()"],tags:["private","workflow","guidance","automation"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVATE_DASHBOARD",j.PRIVATE_DASHBOARD,{category:"REPORTING",description:"Executive dashboard with key metrics summary",usage:"PRIVATE_DASHBOARD()",examples:["PRIVATE_DASHBOARD()"],tags:["private","dashboard","executive","summary"],parameterSchema:{required:[],optional:["period"]}}),C.register("PRIVATE",j.PRIVATE,{category:"UTILITY",description:"Show all available Private Analysis commands (shortcut)",usage:"PRIVATE()",examples:["PRIVATE()","private"],tags:["private","help","commands","list"],parameterSchema:{required:[],optional:[]}}),C.register("PORTFOLIO",$.PORTFOLIO,{category:"PORTFOLIO",description:"Portfolio analysis with risk and diversification metrics",usage:"PORTFOLIO(tickers, weights)",examples:["PORTFOLIO([AAPL,MSFT,GOOGL], [0.4,0.3,0.3])","PORTFOLIO([SPY,QQQ], [0.6,0.4])"],tags:["portfolio","diversification","allocation"],parameterSchema:{required:["tickers","weights"],optional:[]}}),C.register("RISK_METRICS",$.RISK_METRICS,{category:"PORTFOLIO",description:"Comprehensive risk analysis including VaR, Sharpe ratio, and volatility",usage:"RISK_METRICS(ticker, period)",examples:["RISK_METRICS(AAPL)","RISK_METRICS(TSLA, 252)"],tags:["risk","var","volatility","sharpe"],parameterSchema:{required:["ticker"],optional:["period"]}}),C.register("CORRELATION_MATRIX",$.CORRELATION_MATRIX,{category:"PORTFOLIO",description:"Cross-asset correlation analysis for diversification insights",usage:"CORRELATION_MATRIX(tickers)",examples:["CORRELATION_MATRIX([AAPL,MSFT,GOOGL])","CORRELATION_MATRIX([SPY,QQQ,IWM])"],tags:["correlation","diversification","matrix"],parameterSchema:{required:["tickers"],optional:[]}}),C.register("EFFICIENT_FRONTIER",$.EFFICIENT_FRONTIER,{category:"PORTFOLIO",description:"Modern portfolio theory optimization and efficient frontier analysis",usage:"EFFICIENT_FRONTIER(tickers)",examples:["EFFICIENT_FRONTIER([AAPL,MSFT,GOOGL])","EFFICIENT_FRONTIER([SPY,QQQ,IWM,EFA])"],tags:["optimization","efficient-frontier","mpt"],parameterSchema:{required:["tickers"],optional:[]}}),C.register("DRAWDOWN",$.DRAWDOWN,{category:"PORTFOLIO",description:"Maximum drawdown analysis and recovery time estimation",usage:"DRAWDOWN(ticker, period)",examples:["DRAWDOWN(AAPL)","DRAWDOWN(TSLA, 500)"],tags:["drawdown","risk","recovery"],parameterSchema:{required:["ticker"],optional:["period"]}}),C.register("DDM",b.DDM,{category:"VALUATION",description:"Dividend Discount Model with Gordon Growth and Two-Stage analysis",usage:"DDM(ticker)",examples:["DDM(KO)","DDM(JNJ)"],tags:["dividend","ddm","gordon-growth"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("RESIDUAL_INCOME",b.RESIDUAL_INCOME,{category:"VALUATION",description:"Residual Income Model for economic value analysis",usage:"RESIDUAL_INCOME(ticker)",examples:["RESIDUAL_INCOME(AAPL)","RESIDUAL_INCOME(MSFT)"],tags:["residual-income","economic-value","roe"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("ASSET_BASED",b.ASSET_BASED,{category:"VALUATION",description:"Asset-based valuation with market value adjustments",usage:"ASSET_BASED(ticker)",examples:["ASSET_BASED(BRK.A)","ASSET_BASED(BAC)"],tags:["asset-based","nav","liquidation"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("TECHNICALS",N.TECHNICALS,{category:"TECHNICAL",description:"Comprehensive technical analysis with RSI, MACD, Bollinger Bands",usage:"TECHNICALS(ticker)",examples:["TECHNICALS(AAPL)","TECHNICALS(SPY)"],tags:["technical","rsi","macd","bollinger"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("SUPPORT_RESISTANCE",N.SUPPORT_RESISTANCE,{category:"TECHNICAL",description:"Key price levels and breakout targets analysis",usage:"SUPPORT_RESISTANCE(ticker)",examples:["SUPPORT_RESISTANCE(TSLA)","SUPPORT_RESISTANCE(QQQ)"],tags:["support","resistance","levels","breakout"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("ESG_SCORE",P.ESG_SCORE,{category:"ESG",description:"Environmental, social, governance analysis and scoring",usage:"ESG_SCORE(ticker)",examples:["ESG_SCORE(AAPL)","ESG_SCORE(TSLA)"],tags:["esg","environmental","social","governance"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("SOCIAL_SENTIMENT",P.SOCIAL_SENTIMENT,{category:"ESG",description:"Social media sentiment analysis across platforms",usage:"SOCIAL_SENTIMENT(ticker, days)",examples:["SOCIAL_SENTIMENT(AAPL)","SOCIAL_SENTIMENT(TSLA, 30)"],tags:["sentiment","social-media","twitter","reddit"],parameterSchema:{required:["ticker"],optional:["days"]}}),C.register("NEWS_IMPACT",P.NEWS_IMPACT,{category:"ESG",description:"News sentiment and price impact analysis",usage:"NEWS_IMPACT(ticker, days)",examples:["NEWS_IMPACT(AAPL)","NEWS_IMPACT(MSFT, 14)"],tags:["news","sentiment","impact","catalyst"],parameterSchema:{required:["ticker"],optional:["days"]}}),C.register("WATCHLIST",M.WATCHLIST,{category:"AUTOMATION",description:"Create and manage stock watchlists with analysis",usage:"WATCHLIST(action, name, tickers)",examples:["WATCHLIST(list)",'WATCHLIST(create, "Tech", [AAPL,MSFT])','WATCHLIST(analyze, "Tech")'],tags:["watchlist","portfolio","tracking"],parameterSchema:{required:["action"],optional:["name","tickers"]}}),C.register("ALERT",M.ALERT,{category:"AUTOMATION",description:"Set price and metric alerts for stocks",usage:"ALERT(ticker, condition, value)",examples:['ALERT(AAPL, "price_above", 150)',"ALERT(list)","ALERT(clear)"],tags:["alerts","monitoring","notifications"],parameterSchema:{required:["ticker","condition","value"],optional:[]}}),C.register("BATCH_ANALYSIS",M.BATCH_ANALYSIS,{category:"AUTOMATION",description:"Analyze multiple stocks simultaneously with ranking",usage:"BATCH_ANALYSIS(tickers, type)",examples:["BATCH_ANALYSIS([AAPL,MSFT,GOOGL])",'BATCH_ANALYSIS([SPY,QQQ,IWM], "detailed")'],tags:["batch","screening","ranking"],parameterSchema:{required:["tickers"],optional:["type"]}}),C.register("WATCHLIST",M.WATCHLIST,{category:"AUTOMATION",description:"Create and manage stock watchlists with analysis",usage:"WATCHLIST(action, name, tickers)",examples:["WATCHLIST(list)",'WATCHLIST(create, "Tech", [AAPL,MSFT])','WATCHLIST(analyze, "Tech")'],tags:["watchlist","portfolio","tracking"],parameterSchema:{required:["action"],optional:["name","tickers"]}}),C.register("ALERT",M.ALERT,{category:"AUTOMATION",description:"Set price and metric alerts for stocks",usage:"ALERT(ticker, condition, value)",examples:['ALERT(AAPL, "price_above", 150)',"ALERT(list)","ALERT(clear)"],tags:["alerts","monitoring","notifications"],parameterSchema:{required:["ticker","condition","value"],optional:[]}}),C.register("BATCH_ANALYSIS",M.BATCH_ANALYSIS,{category:"AUTOMATION",description:"Analyze multiple stocks simultaneously with ranking",usage:"BATCH_ANALYSIS(tickers, type)",examples:["BATCH_ANALYSIS([AAPL,MSFT,GOOGL])",'BATCH_ANALYSIS([SPY,QQQ,IWM], "detailed")'],tags:["batch","screening","ranking"],parameterSchema:{required:["tickers"],optional:["type"]}}),C.register("EXPORT_JSON",w.EXPORT_JSON,{category:"DATA",description:"Export data to JSON format for backup and sharing",usage:"EXPORT_JSON(dataType, filename)",examples:['EXPORT_JSON("watchlists")','EXPORT_JSON("all", "backup.json")'],tags:["export","backup","json"],parameterSchema:{required:["dataType"],optional:["filename"]}}),C.register("CACHE_STATS",w.CACHE_STATS,{category:"DATA",description:"View cache performance and memory usage statistics",usage:"CACHE_STATS()",examples:["CACHE_STATS()"],tags:["cache","performance","memory"],parameterSchema:{required:[],optional:[]}}),C.register("DATA_QUALITY",w.DATA_QUALITY,{category:"DATA",description:"Analyze data completeness and quality for a stock",usage:"DATA_QUALITY(ticker)",examples:["DATA_QUALITY(AAPL)","DATA_QUALITY(TSLA)"],tags:["quality","validation","completeness"],parameterSchema:{required:["ticker"],optional:[]}}),C.register("BENCHMARK",w.BENCHMARK,{category:"DATA",description:"Compare stock performance against benchmark index",usage:"BENCHMARK(ticker, benchmark)",examples:["BENCHMARK(AAPL, SPY)","BENCHMARK(TSLA, QQQ)"],tags:["benchmark","comparison","performance"],parameterSchema:{required:["ticker"],optional:["benchmark"]}}),C.register("PERFORMANCE_TEST",O.PERFORMANCE_TEST,{category:"SYSTEM",description:"Run comprehensive system performance benchmarks",usage:"PERFORMANCE_TEST()",examples:["PERFORMANCE_TEST()"],tags:["performance","benchmark","system"],parameterSchema:{required:[],optional:[]}}),C.register("API_USAGE",O.API_USAGE,{category:"SYSTEM",description:"Monitor API usage, rate limits, and costs",usage:"API_USAGE()",examples:["API_USAGE()"],tags:["api","usage","limits","cost"],parameterSchema:{required:[],optional:[]}}),C.register("CONFIG",O.CONFIG,{category:"SYSTEM",description:"View and update system configuration settings",usage:"CONFIG(setting, value)",examples:["CONFIG()",'CONFIG("currency", "EUR")','CONFIG("precision", 3)'],tags:["config","settings","preferences"],parameterSchema:{required:[],optional:["setting","value"]}}),C.register("BACKUP_CREATE",k.BACKUP_CREATE,{category:"PERSISTENCE",description:"Create a backup of all user data",usage:"BACKUP_CREATE(description)",examples:["BACKUP_CREATE()",'BACKUP_CREATE("Before major changes")'],tags:["backup","data","export"],parameterSchema:{required:[],optional:["description"]}}),C.register("BACKUP_LIST",k.BACKUP_LIST,{category:"PERSISTENCE",description:"List all available backups",usage:"BACKUP_LIST()",examples:["BACKUP_LIST()"],tags:["backup","list","management"],parameterSchema:{required:[],optional:[]}}),C.register("BACKUP_RESTORE",k.BACKUP_RESTORE,{category:"PERSISTENCE",description:"Restore data from a backup",usage:"BACKUP_RESTORE(backupId, overwrite)",examples:['BACKUP_RESTORE("backup_123")','BACKUP_RESTORE("backup_123", "true")'],tags:["backup","restore","recovery"],parameterSchema:{required:["backupId"],optional:["overwrite"]}}),C.register("STORAGE_STATS",k.STORAGE_STATS,{category:"PERSISTENCE",description:"View storage usage and statistics",usage:"STORAGE_STATS()",examples:["STORAGE_STATS()"],tags:["storage","statistics","usage"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVACY_CLEANUP",k.PRIVACY_CLEANUP,{category:"PERSISTENCE",description:"Clean up expired data according to privacy policies",usage:"PRIVACY_CLEANUP()",examples:["PRIVACY_CLEANUP()"],tags:["privacy","cleanup","gdpr"],parameterSchema:{required:[],optional:[]}}),C.register("PRIVACY_SETTINGS",k.PRIVACY_SETTINGS,{category:"PERSISTENCE",description:"View and update privacy settings",usage:"PRIVACY_SETTINGS(setting, value)",examples:["PRIVACY_SETTINGS()",'PRIVACY_SETTINGS("analytics", "false")'],tags:["privacy","settings","gdpr"],parameterSchema:{required:[],optional:["setting","value"]}}),C.register("SYNC_STATUS",k.SYNC_STATUS,{category:"PERSISTENCE",description:"View data synchronization status",usage:"SYNC_STATUS()",examples:["SYNC_STATUS()"],tags:["sync","cloud","status"],parameterSchema:{required:[],optional:[]}}),C.register("PERSISTENCE_TEST",k.PERSISTENCE_TEST,{category:"PERSISTENCE",description:"Run comprehensive persistence layer tests",usage:"PERSISTENCE_TEST()",examples:["PERSISTENCE_TEST()"],tags:["test","debug","validation"],parameterSchema:{required:[],optional:[]}}),C.register("HELP",{execute:async(e,t,a)=>{const[n]=e.parameters;if(n&&"all"===n.toLowerCase()){const e=C.getAllCommands(),t=C.getAllCategories();let a="üìö COMPREHENSIVE COMMAND REFERENCE\n";return a+="FinanceAnalyst Pro Terminal v2.4.0 - Complete Command Suite\n",a+="‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n",t.forEach(e=>{const t=C.getCommandsByCategory(e.key);t.length>0&&(a+=`${e.icon} ${e.name.toUpperCase()} COMMANDS (${t.length})\n`,a+=`${e.description}\n`,a+="‚îÄ".repeat(50)+"\n",t.forEach(e=>{a+=`\n‚Ä¢ ${e.usage}\n`,a+=`  ${e.description}\n`,e.examples&&e.examples.length>0&&(a+=`  Examples: ${e.examples.join(", ")}\n`),e.tags&&e.tags.length>0&&(a+=`  Tags: ${e.tags.join(", ")}\n`)}),a+="\n")}),a+=`\nüìä SUMMARY: ${e.length} total commands across ${t.length} categories\n`,a+="\nüí° TIP: Use HELP(category) for specific category details\n",a+="üí° TIP: Use HELP() for quick overview and featured commands",{type:"system",content:a}}if(n){const e=C.getCommandsByCategory(n.toUpperCase());if(0===e.length)return{type:"error",content:`Unknown category: ${n}. Use HELP() to see all categories or HELP(ALL) for complete command list.`};let t=`üìã ${n.toUpperCase()} COMMANDS (${e.length})\n`;return t+="‚ïê".repeat(40)+"\n\n",e.forEach(e=>{t+=`‚Ä¢ ${e.usage}\n`,t+=`  ${e.description}\n`,e.examples&&e.examples.length>0&&(t+=`  Examples: ${e.examples.join(", ")}\n`),t+="\n"}),t+="Use HELP() for overview or HELP(ALL) for all commands.",{type:"system",content:t}}const r=C.getAllCategories(),s=C.getCommandStats(),i=Object.values(s).reduce((e,t)=>e+t.count,0);return{type:"system",content:`üöÄ FinanceAnalyst Pro Terminal v2.4.0 - Enhanced Command Suite\n\nüìä COMMAND CATEGORIES:\n${r.map(e=>`${e.icon} ${e.name} (${s[e.key]?.count||0} commands)\n   ${e.description}`).join("\n\n")}\n\n‚≠ê FEATURED COMMANDS:\n‚Ä¢ DCF(AAPL) - Discounted Cash Flow with live data\n‚Ä¢ LBO(TSLA) - Leveraged Buyout analysis\n‚Ä¢ PORTFOLIO([AAPL,MSFT], [0.5,0.5]) - Portfolio analysis\n‚Ä¢ RISK_METRICS(GOOGL) - Comprehensive risk analysis\n‚Ä¢ CORRELATION_MATRIX([AAPL,MSFT,GOOGL]) - Cross-asset correlations\n‚Ä¢ PRIVATE_DCF() - Private company DCF valuation\n‚Ä¢ PRIVATE_RATIOS() - Private company financial ratios\n‚Ä¢ PRIVATE_SUMMARY() - Private company analysis summary\n\nüîß PRIVATE ANALYSIS COMMANDS:\n‚Ä¢ PRIVATE_LOAD() - Load private company data\n‚Ä¢ PRIVATE_DCF() - DCF valuation for private companies\n‚Ä¢ PRIVATE_RATIOS() - Calculate private company ratios\n‚Ä¢ PRIVATE_SUMMARY() - Generate private company summary\n\nüí° HELP COMMANDS:\n‚Ä¢ HELP() - Show this overview (current)\n‚Ä¢ HELP(category) - Show commands for specific category\n‚Ä¢ HELP(ALL) - Show complete list of ALL ${i} commands\n\nüìã AVAILABLE CATEGORIES:\n${r.map(e=>`‚Ä¢ ${e.key}`).join(" ‚Ä¢ ")}\n\nüöÄ ENHANCED FEATURES:\n‚Ä¢ Watchlists: Create and track custom stock lists\n‚Ä¢ Alerts: Set price and metric notifications\n‚Ä¢ Batch Analysis: Analyze multiple stocks simultaneously\n‚Ä¢ ESG Scoring: Environmental, social, governance analysis\n‚Ä¢ Technical Analysis: RSI, MACD, support/resistance\n‚Ä¢ Advanced Valuation: DDM, residual income, asset-based models\n‚Ä¢ Private Company Analysis: Full financial modeling suite\n\nüìä ${r.length} categories ‚Ä¢ ${i} total commands available\n\nüí° Pro Tip: Use HELP(ALL) to see every single command with examples!`}},parameterSchema:{required:[],optional:["category"]}},{category:"UTILITY",description:"Show available commands and usage information",usage:"HELP(category)",examples:["HELP()","HELP(PORTFOLIO)","HELP(CORE)","HELP(ALL)"],tags:["help","documentation","commands"]}),C.register("CLEAR",{execute:async(e,t,a)=>({type:"system",content:"clear_terminal",action:"clear"})},{category:"UTILITY",description:"Clear the terminal screen",usage:"CLEAR()",examples:["CLEAR()"],tags:["utility","clear","terminal"]}),C.register("STATUS",{execute:async(e,t,a)=>{const n=a.getAllSettings(),r=a.getAllVariables(),s=a.getHistory(5);return{type:"system",content:`System Status Report\n\nüîß SYSTEM CONFIGURATION:\n‚Ä¢ Currency: ${n.currency}\n‚Ä¢ Precision: ${n.precision} decimal places\n‚Ä¢ Date Format: ${n.dateFormat}\n‚Ä¢ Demo Mode: ${t.demoMode?"Enabled":"Disabled"}\n\nüìä SESSION STATISTICS:\n‚Ä¢ Commands Executed: ${s.length}\n‚Ä¢ Variables Stored: ${Object.keys(r).length}\n‚Ä¢ Last Command: ${s[s.length-1]?.input||"None"}\n\nüåê API STATUS:\n‚Ä¢ Data Sources: ${t.demoMode?"Demo Data":"Live Market Data"}\n‚Ä¢ Rate Limits: Normal\n‚Ä¢ Cache Status: Active\n\nüíæ MEMORY USAGE:\n‚Ä¢ Command History: ${s.length} entries\n‚Ä¢ Variable Storage: ${Object.keys(r).length} variables\n‚Ä¢ Cache Size: Optimal\n\n‚úÖ All systems operational`}}},{category:"UTILITY",description:"Show system status and configuration",usage:"STATUS()",examples:["STATUS()"],tags:["status","system","configuration"]});const U=({onCommandExecute:n,calculationResults:r})=>{const[s,i]=e.useState([{id:1,type:"system",content:"FinanceAnalyst Pro Terminal v2.4.0 - Enhanced Command Suite Ready",timestamp:new Date},{id:2,type:"system",content:'Type "HELP()" for available commands or start with DCF(AAPL), PORTFOLIO([AAPL,MSFT], [0.5,0.5])',timestamp:new Date}]),[l,d]=e.useState(""),[m,u]=e.useState([]),[p,g]=e.useState(!1),[h,y]=e.useState(0),[A,S]=e.useState(!1),x=e.useRef(null),f=e.useRef(null),v=e.useRef(R);e.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[s]),e.useEffect(()=>{f.current&&f.current.focus(),(async()=>{try{await c.initialize()}catch(e){}})()},[]);return t.jsxs("div",{className:"flex flex-col h-full bg-gray-900 text-green-400 font-mono text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"Terminal",size:16,className:"text-green-400"}),t.jsx("span",{className:"text-green-400 font-medium",children:"Financial Terminal"}),t.jsx("span",{className:"text-xs text-blue-400",children:"‚Ä¢ Enhanced Command Suite"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full "+(A?"bg-yellow-400 animate-pulse":"bg-green-400")}),t.jsx("span",{className:"text-xs text-gray-400",children:A?"Processing...":"Connected"})]})]}),t.jsxs("div",{ref:x,className:"flex-1 overflow-y-auto p-4 space-y-2",onClick:()=>f.current?.focus(),children:[s.map(e=>t.jsx("div",{className:"space-y-1",children:t.jsxs("div",{className:"flex items-start space-x-2",children:["user"===e.type&&t.jsx("span",{className:"text-blue-400 shrink-0",children:"analyst@finpro:~$"}),"system"===e.type&&t.jsx(a,{name:"Info",size:14,className:"text-yellow-400 mt-0.5 shrink-0"}),"success"===e.type&&t.jsx(a,{name:"CheckCircle",size:14,className:"text-green-400 mt-0.5 shrink-0"}),"error"===e.type&&t.jsx(a,{name:"XCircle",size:14,className:"text-red-400 mt-0.5 shrink-0"}),"warning"===e.type&&t.jsx(a,{name:"AlertTriangle",size:14,className:"text-yellow-400 mt-0.5 shrink-0"}),"info"===e.type&&t.jsx(a,{name:"Info",size:14,className:"text-blue-400 mt-0.5 shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("pre",{className:"whitespace-pre-wrap break-words",children:e.content}),e.data&&t.jsx("div",{className:"mt-2 p-2 bg-gray-800 rounded border border-gray-700",children:t.jsxs("div",{className:"text-xs text-gray-400",children:["Real-time calculation data available ‚Ä¢ Analysis:"," ",e.data.analysis||"financial"]})})]})]})},e.id)),A&&t.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400",children:[t.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-yellow-400 border-t-transparent rounded-full"}),t.jsx("span",{children:"Processing command..."})]}),t.jsxs("div",{className:"flex items-center space-x-2 relative",children:[t.jsx("span",{className:"text-blue-400 shrink-0",children:"analyst@finpro:~$"}),t.jsxs("div",{className:"flex-1 relative",children:[t.jsx("input",{ref:f,type:"text",value:l,onChange:e=>{const t=e.target.value;if(d(t),t.length>0){const e=C.getAllCommands().map(e=>{const t=C.getCommandInfo(e);return t?t.usage:e}),a=C.getSuggestions(t).map(e=>e.usage),n=e.filter(e=>e.toLowerCase().includes(t.toLowerCase())&&!a.includes(e)),r=[...a,...n];u(r.slice(0,8)),g(r.length>0),y(0)}else g(!1)},onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),(async()=>{if(!l.trim())return;const e={id:s.length+1,type:"user",content:l,timestamp:new Date};i(t=>[...t,e]),S(!0),d(""),g(!1);try{const e={demoMode:o.demoMode,showLoading:e=>{const t={id:s.length+2,type:"info",content:e,timestamp:new Date};i(e=>[...e,t])}},t=await v.current.processCommand(l,e);if("clear"===t.action)return void i([{id:1,type:"system",content:"Terminal cleared",timestamp:new Date}]);const a={id:s.length+2,type:t.type,content:t.content,timestamp:new Date,data:t.data};i(e=>[...e,a]),n&&n(l,t)}catch(t){const e={id:s.length+2,type:"error",content:`Error: ${t.message}`,timestamp:new Date};i(t=>[...t,e])}finally{S(!1)}})()):"ArrowUp"===e.key&&p?(e.preventDefault(),y(e=>Math.max(0,e-1))):"ArrowDown"===e.key&&p?(e.preventDefault(),y(e=>Math.min(m.length-1,e+1))):"Tab"===e.key&&p?(e.preventDefault(),d(m[h]),g(!1)):"Escape"===e.key&&g(!1)},className:"w-full bg-transparent text-green-400 outline-none border-none",placeholder:"Enter command (e.g., DCF(AAPL), PORTFOLIO([AAPL,MSFT], [0.5,0.5]))...",autoComplete:"off",disabled:A}),p&&t.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-600 rounded-md shadow-lg z-10 max-h-48 overflow-y-auto",children:m.map((e,a)=>t.jsx("div",{className:"px-3 py-2 cursor-pointer text-sm "+(a===h?"bg-gray-700 text-green-400":"text-gray-300 hover:bg-gray-700"),onClick:()=>(e=>{d(e),g(!1),f.current?.focus()})(e),children:e},a))})]})]})]})]})},_=({onVariableChange:r,onBulkEdit:s})=>{const[i,o]=e.useState("assumptions"),[c,l]=e.useState(!1),[d,m]=e.useState(""),[u,p]=e.useState({assumptions:{revenue_growth:{value:.052,unit:"%",description:"Annual revenue growth rate",category:"Growth"},ebitda_margin:{value:.235,unit:"%",description:"EBITDA as % of revenue",category:"Profitability"},tax_rate:{value:.25,unit:"%",description:"Corporate tax rate",category:"Tax"},capex_revenue:{value:.035,unit:"%",description:"CapEx as % of revenue",category:"Investment"},working_capital_revenue:{value:.02,unit:"%",description:"Working capital as % of revenue",category:"Working Capital"},terminal_growth:{value:.025,unit:"%",description:"Long-term growth rate",category:"Terminal"}},cost_of_capital:{risk_free_rate:{value:.032,unit:"%",description:"Risk-free rate (10Y Treasury)",category:"Market"},market_premium:{value:.065,unit:"%",description:"Equity risk premium",category:"Market"},beta:{value:1.15,unit:"x",description:"Asset beta coefficient",category:"Risk"},cost_of_debt:{value:.045,unit:"%",description:"Pre-tax cost of debt",category:"Debt"},debt_equity_ratio:{value:.4,unit:"x",description:"Target debt-to-equity ratio",category:"Capital Structure"}},market_data:{current_share_price:{value:125.5,unit:"$",description:"Current trading price",category:"Market"},shares_outstanding:{value:20,unit:"M",description:"Shares outstanding",category:"Equity"},market_cap:{value:2510,unit:"$M",description:"Current market capitalization",category:"Valuation"},enterprise_value:{value:2810,unit:"$M",description:"Current enterprise value",category:"Valuation"},net_debt:{value:300,unit:"$M",description:"Net debt position",category:"Debt"}}}),g=(e,t)=>"%"===t?(100*e).toFixed(1):"$"===t||"$M"===t?e.toFixed(2):e.toFixed(3),h=e=>{if(!d)return e;const t={};return Object.entries(e).forEach(([e,a])=>{(e.toLowerCase().includes(d.toLowerCase())||a.description.toLowerCase().includes(d.toLowerCase()))&&(t[e]=a)}),t};return t.jsxs("div",{className:"flex flex-col h-full bg-card",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"Sliders",size:20,className:"text-primary"}),t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Variable Inputs"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(n,{variant:"outline",size:"sm",iconName:c?"Check":"Edit",onClick:()=>l(!c),children:c?"Done":"Edit"}),t.jsx(n,{variant:"outline",size:"sm",iconName:"Download",onClick:()=>{const e=JSON.stringify(u,null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="model_variables.json",n.click(),URL.revokeObjectURL(a)},children:"Export"})]})]}),t.jsx("div",{className:"p-4 border-b border-border",children:t.jsxs("div",{className:"relative",children:[t.jsx(a,{name:"Search",size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),t.jsx("input",{type:"text",value:d,onChange:e=>m(e.target.value),placeholder:"Search variables...",className:"w-full pl-10 pr-4 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]})}),t.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:[{id:"assumptions",label:"Key Assumptions",icon:"Settings"},{id:"cost_of_capital",label:"Cost of Capital",icon:"Percent"},{id:"market_data",label:"Market Data",icon:"TrendingUp"}].map(e=>t.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(i===e.id?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[t.jsx(a,{name:e.icon,size:16}),t.jsx("span",{children:e.label})]},e.id))}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[Object.entries((e=>{const t={};return Object.entries(e).forEach(([e,a])=>{const n=a.category||"Other";t[n]||(t[n]=[]),t[n].push({key:e,...a})}),t})(h(u[i]))).map(([e,n])=>t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-sm font-medium text-foreground mb-3 flex items-center space-x-2",children:[t.jsx(a,{name:"Folder",size:16}),t.jsx("span",{children:e})]}),t.jsx("div",{className:"space-y-3",children:n.map(e=>t.jsxs("div",{className:"p-3 bg-background border border-border rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-sm font-medium text-foreground capitalize",children:e.key.replace(/_/g," ")}),t.jsx("p",{className:"text-xs text-muted-foreground",children:e.description})]}),t.jsx("div",{className:"flex items-center space-x-2 ml-4",children:c?t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("input",{type:"number",value:g(e.value,e.unit),onChange:t=>((e,t,a)=>{const n={...u,[e]:{...u[e],[t]:{...u[e][t],value:parseFloat(a)||0}}};p(n),r&&r(e,t,a)})(i,e.key,t.target.value),step:"%"===e.unit?"0.1":"0.01",className:"w-20 px-2 py-1 text-sm bg-input border border-border rounded text-foreground focus:outline-none focus:ring-1 focus:ring-ring"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:e.unit})]}):t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"text-lg font-semibold text-foreground",children:g(e.value,e.unit)}),t.jsx("span",{className:"text-sm text-muted-foreground ml-1",children:e.unit})]})})]}),t.jsxs("div",{className:"flex items-center justify-between text-xs",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),t.jsx("span",{className:"text-muted-foreground",children:"Within range"})]}),t.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[t.jsx(a,{name:"TrendingUp",size:12}),t.jsx("span",{children:"High impact"})]})]})]},e.key))})]},e)),0===Object.keys(h(u[i])).length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(a,{name:"Search",size:48,className:"text-muted-foreground mx-auto mb-4"}),t.jsx("h4",{className:"text-lg font-medium text-foreground mb-2",children:"No variables found"}),t.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search terms"})]})]}),t.jsx("div",{className:"p-4 border-t border-border bg-muted/50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[t.jsx(a,{name:"Info",size:12}),t.jsx("span",{children:"Changes auto-save every 30 seconds"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(n,{variant:"outline",size:"sm",iconName:"RotateCcw",onClick:()=>{const e={...u};p(e)},children:"Reset"}),t.jsx(n,{variant:"outline",size:"sm",iconName:"Grid",onClick:()=>s&&s(),children:"Bulk Edit"})]})]})})]})},V=()=>{const[o,c]=e.useState("dual-pane"),[l,d]=e.useState("terminal"),[m,u]=e.useState("results"),[p]=e.useState({name:"DCF_Analysis_v2.3",saved:!0,calculating:!1,lastSaved:new Date}),[g,h]=e.useState(null),y=(e,t)=>{h(t)};return t.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[t.jsx(i,{title:"Financial Model Workspace | Valor-IVX",description:"Professional financial modeling workspace with advanced DCF analysis, LBO tools, and real-time collaboration features for finance professionals.",canonical:"/",keywords:"financial modeling, DCF analysis, LBO modeling, financial workspace, valuation tools, Excel alternative"}),t.jsx(r,{}),t.jsxs("main",{id:"main-content",className:"flex flex-col h-screen pt-16",role:"main",children:[t.jsxs("div",{className:"px-4 py-2 bg-gray-900 border-b border-gray-800",children:[t.jsx("h1",{className:"sr-only",children:"Financial Model Workspace"}),t.jsx(s,{})]}),t.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(a,{name:"FileText",className:"w-5 h-5 text-blue-400"}),t.jsx("span",{className:"font-medium",children:p.name}),t.jsx("span",{className:"text-xs px-2 py-1 rounded "+(p.saved?"bg-green-900 text-green-300":"bg-yellow-900 text-yellow-300"),children:p.saved?"Saved":"Unsaved"})]})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex items-center space-x-1 bg-gray-700 rounded-lg p-1",children:[t.jsx(n,{variant:"single-pane"===o?"primary":"ghost",size:"sm",onClick:()=>c("single-pane"),"aria-label":"Single-pane layout",children:t.jsx(a,{name:"Square",className:"w-4 h-4"})}),t.jsx(n,{variant:"dual-pane"===o?"primary":"ghost",size:"sm",onClick:()=>c("dual-pane"),"aria-label":"Dual-pane layout",children:t.jsx(a,{name:"Columns",className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsxs("select",{value:l,onChange:e=>d(e.target.value),className:"bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm","aria-label":"Select left panel content",children:[t.jsx("option",{value:"terminal",children:"Terminal"}),t.jsx("option",{value:"variables",children:"Variables"}),t.jsx("option",{value:"formulas",children:"Formulas"}),t.jsx("option",{value:"templates",children:"Templates"})]}),"dual-pane"===o&&t.jsxs("select",{value:m,onChange:e=>u(e.target.value),className:"bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm","aria-label":"Select right panel content",children:[t.jsx("option",{value:"results",children:"Results"}),t.jsx("option",{value:"audit",children:"Audit Trail"})]})]})]})]}),t.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[t.jsx("div",{className:("dual-pane"===o?"w-1/2":"w-full")+" border-r border-gray-700 overflow-hidden",children:(()=>{switch(l){case"terminal":default:return t.jsx(U,{onCommandExecute:y,calculationResults:g});case"variables":return t.jsx(_,{});case"formulas":return t.jsx(E,{});case"templates":return t.jsx(T,{})}})()}),"dual-pane"===o&&t.jsx("div",{className:"w-1/2 overflow-hidden",children:(()=>{switch(m){case"results":default:return t.jsx(v,{results:g});case"audit":return t.jsx(f,{})}})()})]})]})]})};export{V as default};
//# sourceMappingURL=index-BUNRlh-5.js.map
