import{r as e,R as t,j as s,af as a,ag as r,K as i,D as l,y as n,ah as o,ad as c,ai as d,a4 as m,ab as x,F as u,a8 as h,n as p,a5 as g,p as b,m as y,a6 as f,o as j,aj as v,ak as N,Z as w,al as C,T as k,E as S,am as R,an as M,z as I,l as E,ao as A,X as F,b as D,a9 as P,ap as O,aq as T,a as V,v as B,J as _,x as L,ar as U,as as q,at as z,au as G,av as $,aw as W,ax as K,ac as Y,c as H,ay as Q,az as J,g as X,aA as Z,H as ee,aB as te,w as se,C as ae}from"./react-vendor-veQMdy8Q.js";import{a as re}from"./apiLogger-BNPwdfUB.js";import{l as ie}from"./lboModelingEngine-BU3g5hW3.js";import{b as le,A as ne}from"./ui-vendor-zTucAtCH.js";import{ResponsiveContainer as oe,LineChart as ce,CartesianGrid as de,XAxis as me,YAxis as xe,Tooltip as ue,Line as he,BarChart as pe,Bar as ge,PieChart as be,Pie as ye,Cell as fe,Legend as je,AreaChart as ve,Area as Ne,ScatterChart as we,Scatter as Ce}from"./charts-vendor-YB5D2y8T.js";import{u as ke,a as Se,b as Re}from"./index-Ch9xuoCy.js";import{S as Me}from"./SEOHead-ZhZ9pYW7.js";import{c as Ie,B as Ee}from"./advanced-analytics-BnJTTEAv.js";import{W as Ae}from"./vendor-COg1wW2x.js";import{H as Fe}from"./Header-BueyHpBK.js";import{S as De}from"./SecondaryNav-BP081x8M.js";import{d as Pe}from"./defaultFinancialData-CL3DkgK1.js";import{b as Oe}from"./dcfCalculations-gqpk9y-a.js";import"./ai-vendor-D2oz74m-.js";import"./utils-vendor-DUg4_aAP.js";import"./data-vendor-DpIj8wd6.js";import"./state-vendor-DFlCI_nm.js";import"./businessIntelligenceService-DTE7ncSd.js";const Te="1.0.0",Ve="financeanalyst_",Be={enabled:!0,threshold:1024},_e={maxSize:52428800,cleanupThreshold:.8},Le={dcfModel:{version:"1.0",required:["symbol","assumptions","projections","valuation"],structure:{symbol:"string",assumptions:"object",projections:"object",valuation:"object",metadata:"object"}},lboModel:{version:"1.0",required:["symbol","transaction","financing","returns"],structure:{symbol:"string",transaction:"object",financing:"object",returns:"object",metadata:"object"}},monteCarloResults:{version:"1.0",required:["modelType","iterations","results","statistics"],structure:{modelType:"string",iterations:"number",results:"array",statistics:"object",metadata:"object"}},userPreferences:{version:"1.0",required:["theme","layout"],structure:{theme:"string",layout:"object",notifications:"object",privacy:"object"}},marketData:{version:"1.0",required:["symbol","data","timestamp"],structure:{symbol:"string",data:"object",timestamp:"number",source:"string"}}};const Ue=new class{constructor(){this.isAvailable=this.checkStorageAvailability(),this.compressionWorker=null,this.initializeCompression(),this.setupQuotaMonitoring()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return re.log("ERROR","localStorage not available",{error:e.message}),!1}}initializeCompression(){"CompressionStream"in window?this.compressionAvailable=!0:this.compressionAvailable=!1}setupQuotaMonitoring(){"storage"in navigator&&"estimate"in navigator.storage&&this.monitorQuota()}async monitorQuota(){try{const e=await navigator.storage.estimate(),t=e.usage/e.quota;t>_e.cleanupThreshold&&(re.log("WARN","Storage quota threshold exceeded",{usage:e.usage,quota:e.quota,ratio:t}),await this.performCleanup())}catch(e){re.log("ERROR","Failed to monitor storage quota",{error:e.message})}}generateKey(e,t){return`${Ve}${e}_${t}`}validateData(e,t){const s=Le[t];if(!s)throw new Error(`Unknown schema type: ${t}`);for(const a of s.required)if(!(a in e))throw new Error(`Missing required field: ${a}`);for(const[a,r]of Object.entries(s.structure))if(a in e){const t=Array.isArray(e[a])?"array":typeof e[a];if(t!==r)throw new Error(`Invalid type for ${a}: expected ${r}, got ${t}`)}return!0}async compressData(e){const t=JSON.stringify(e);if(t.length<Be.threshold||!this.compressionAvailable)return{data:t,compressed:!1};try{return{data:await this.simpleCompress(t),compressed:!0}}catch(s){return re.log("WARN","Compression failed, storing uncompressed",{error:s.message}),{data:t,compressed:!1}}}async simpleCompress(e){return btoa(encodeURIComponent(e))}async decompressData(e,t){if(!t)return e;try{return decodeURIComponent(atob(e))}catch(s){throw re.log("ERROR","Decompression failed",{error:s.message}),new Error("Failed to decompress data")}}async setItem(e,t,s,a={}){if(!this.isAvailable)throw new Error("Storage not available");try{Le[e]&&this.validateData(s,e);const r={version:Te,schemaVersion:Le[e]?.version||"1.0",timestamp:Date.now(),data:s,metadata:{type:e,identifier:t,size:JSON.stringify(s).length,...a.metadata}},{data:i,compressed:l}=await this.compressData(r),n={compressed:l,data:i},o=this.generateKey(e,t);return localStorage.setItem(o,JSON.stringify(n)),re.log("DEBUG","Data stored successfully",{key:o,type:e,identifier:t,compressed:l,size:i.length}),!0}catch(r){throw re.log("ERROR","Failed to store data",{type:e,identifier:t,error:r.message}),r}}async getItem(e,t){if(!this.isAvailable)return null;try{const s=this.generateKey(e,t),a=localStorage.getItem(s);if(!a)return null;const r=JSON.parse(a),i=await this.decompressData(r.data,r.compressed),l=JSON.parse(i);return l.version!==Te&&re.log("WARN","Version mismatch detected",{stored:l.version,current:Te}),re.log("DEBUG","Data retrieved successfully",{key:s,type:e,identifier:t,age:Date.now()-l.timestamp}),l.data}catch(s){return re.log("ERROR","Failed to retrieve data",{type:e,identifier:t,error:s.message}),null}}removeItem(e,t){if(!this.isAvailable)return!1;try{const s=this.generateKey(e,t);return localStorage.removeItem(s),re.log("DEBUG","Data removed successfully",{key:s,type:e,identifier:t}),!0}catch(s){return re.log("ERROR","Failed to remove data",{type:e,identifier:t,error:s.message}),!1}}listItems(e){if(!this.isAvailable)return[];const t=this.generateKey(e,""),s=[];for(let a=0;a<localStorage.length;a++){const e=localStorage.key(a);if(e&&e.startsWith(t)){const a=e.replace(t,"");s.push(a)}}return s}async performCleanup(){const e=Date.now()-2592e6;let t=0;for(let s=localStorage.length-1;s>=0;s--){const a=localStorage.key(s);if(a&&a.startsWith(Ve))try{const s=localStorage.getItem(a),r=JSON.parse(s),i=await this.decompressData(r.data,r.compressed);JSON.parse(i).timestamp<e&&(localStorage.removeItem(a),t++)}catch{localStorage.removeItem(a),t++}}return re.log("INFO","Storage cleanup completed",{cleanedCount:t}),t}async getStorageStats(){let e=0,t=0;const s={};for(let r=0;r<localStorage.length;r++){const a=localStorage.key(r);if(a&&a.startsWith(Ve)){e+=localStorage.getItem(a).length,t++;const r=a.split("_")[1];r&&(s[r]=(s[r]||0)+1)}}const a=await this.getQuotaInfo();return{totalSize:e,itemCount:t,typeStats:s,quota:a,usageRatio:a?e/a.quota:0}}async getQuotaInfo(){if("storage"in navigator&&"estimate"in navigator.storage)try{return await navigator.storage.estimate()}catch(e){re.log("ERROR","Failed to get quota info",{error:e.message})}return null}clearAll(){if(!this.isAvailable)return!1;const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&s.startsWith(Ve)&&e.push(s)}return e.forEach(e=>localStorage.removeItem(e)),re.log("INFO","All application data cleared",{clearedCount:e.length}),!0}};const qe=new class{constructor(){this.storage=Ue}async saveDCFModel(e,t){try{const s={symbol:e.toUpperCase(),assumptions:t.assumptions||{},projections:t.projections||{},valuation:t.valuation||{},metadata:{createdAt:Date.now(),lastModified:Date.now(),version:"1.0",modelType:"DCF",...t.metadata}};return await this.storage.setItem("dcfModel",e.toUpperCase(),s),re.log("INFO","DCF model saved",{symbol:e,valuation:s.valuation.intrinsicValue}),!0}catch(s){throw re.log("ERROR","Failed to save DCF model",{symbol:e,error:s.message}),s}}async getDCFModel(e){try{const t=await this.storage.getItem("dcfModel",e.toUpperCase());return t&&re.log("DEBUG","DCF model retrieved",{symbol:e}),t}catch(t){return re.log("ERROR","Failed to retrieve DCF model",{symbol:e,error:t.message}),null}}async listDCFModels(){return this.storage.listItems("dcfModel")}async deleteDCFModel(e){return this.storage.removeItem("dcfModel",e.toUpperCase())}async saveLBOModel(e,t){try{const s={symbol:e.toUpperCase(),transaction:t.transaction||{},financing:t.financing||{},returns:t.returns||{},metadata:{createdAt:Date.now(),lastModified:Date.now(),version:"1.0",modelType:"LBO",...t.metadata}};return await this.storage.setItem("lboModel",e.toUpperCase(),s),re.log("INFO","LBO model saved",{symbol:e,irr:s.returns.irr,moic:s.returns.moic}),!0}catch(s){throw re.log("ERROR","Failed to save LBO model",{symbol:e,error:s.message}),s}}async getLBOModel(e){try{const t=await this.storage.getItem("lboModel",e.toUpperCase());return t&&re.log("DEBUG","LBO model retrieved",{symbol:e}),t}catch(t){return re.log("ERROR","Failed to retrieve LBO model",{symbol:e,error:t.message}),null}}async listLBOModels(){return this.storage.listItems("lboModel")}async deleteLBOModel(e){return this.storage.removeItem("lboModel",e.toUpperCase())}async saveMonteCarloResults(e,t){try{const s={modelType:t.modelType||"DCF",iterations:t.iterations||1e4,results:t.results||[],statistics:t.statistics||{},metadata:{createdAt:Date.now(),modelId:e,symbol:t.symbol,version:"1.0",...t.metadata}};return await this.storage.setItem("monteCarloResults",e,s),re.log("INFO","Monte Carlo results saved",{modelId:e,iterations:s.iterations,mean:s.statistics.mean}),!0}catch(s){throw re.log("ERROR","Failed to save Monte Carlo results",{modelId:e,error:s.message}),s}}async getMonteCarloResults(e){try{const t=await this.storage.getItem("monteCarloResults",e);return t&&re.log("DEBUG","Monte Carlo results retrieved",{modelId:e}),t}catch(t){return re.log("ERROR","Failed to retrieve Monte Carlo results",{modelId:e,error:t.message}),null}}async listMonteCarloResults(){return this.storage.listItems("monteCarloResults")}async deleteMonteCarloResults(e){return this.storage.removeItem("monteCarloResults",e)}async saveMarketData(e,t,s=15){try{const a={symbol:e.toUpperCase(),data:t,timestamp:Date.now(),source:t.source||"unknown",expiresAt:Date.now()+60*s*1e3};return await this.storage.setItem("marketData",e.toUpperCase(),a),re.log("DEBUG","Market data cached",{symbol:e,source:a.source,ttlMinutes:s}),!0}catch(a){throw re.log("ERROR","Failed to cache market data",{symbol:e,error:a.message}),a}}async getMarketData(e){try{const t=await this.storage.getItem("marketData",e.toUpperCase());return t&&t.expiresAt>Date.now()?(re.log("DEBUG","Market data cache hit",{symbol:e}),t.data):(t&&(await this.deleteMarketData(e),re.log("DEBUG","Market data cache expired",{symbol:e})),null)}catch(t){return re.log("ERROR","Failed to retrieve market data",{symbol:e,error:t.message}),null}}async deleteMarketData(e){return this.storage.removeItem("marketData",e.toUpperCase())}async saveUserPreferences(e){try{const t={theme:e.theme||"light",layout:e.layout||{},notifications:e.notifications||{},privacy:e.privacy||{},metadata:{lastUpdated:Date.now(),version:"1.0"}};return await this.storage.setItem("userPreferences","default",t),re.log("INFO","User preferences saved",{theme:t.theme}),!0}catch(t){throw re.log("ERROR","Failed to save user preferences",{error:t.message}),t}}async getUserPreferences(){try{const e=await this.storage.getItem("userPreferences","default");return e&&re.log("DEBUG","User preferences retrieved"),e}catch(e){return re.log("ERROR","Failed to retrieve user preferences",{error:e.message}),null}}async saveWatchlist(e,t){try{const s={name:e,symbols:t.map(e=>e.toUpperCase()),metadata:{createdAt:Date.now(),lastModified:Date.now(),symbolCount:t.length}};return await this.storage.setItem("watchlist",e,s),re.log("INFO","Watchlist saved",{name:e,symbolCount:t.length}),!0}catch(s){throw re.log("ERROR","Failed to save watchlist",{name:e,error:s.message}),s}}async getWatchlist(e){try{const t=await this.storage.getItem("watchlist",e);return t&&re.log("DEBUG","Watchlist retrieved",{name:e}),t}catch(t){return re.log("ERROR","Failed to retrieve watchlist",{name:e,error:t.message}),null}}async listWatchlists(){return this.storage.listItems("watchlist")}async deleteWatchlist(e){return this.storage.removeItem("watchlist",e)}async exportAllData(){try{const e={timestamp:Date.now(),version:"1.0",data:{dcfModels:{},lboModels:{},monteCarloResults:{},watchlists:{},userPreferences:null}},t=await this.listDCFModels();for(const i of t)e.data.dcfModels[i]=await this.getDCFModel(i);const s=await this.listLBOModels();for(const i of s)e.data.lboModels[i]=await this.getLBOModel(i);const a=await this.listMonteCarloResults();for(const i of a)e.data.monteCarloResults[i]=await this.getMonteCarloResults(i);const r=await this.listWatchlists();for(const i of r)e.data.watchlists[i]=await this.getWatchlist(i);return e.data.userPreferences=await this.getUserPreferences(),re.log("INFO","Data export completed",{dcfCount:t.length,lboCount:s.length,mcCount:a.length,watchlistCount:r.length}),e}catch(e){throw re.log("ERROR","Failed to export data",{error:e.message}),e}}async importData(e){try{let t=0;if(e.data.dcfModels)for(const[s,a]of Object.entries(e.data.dcfModels))await this.saveDCFModel(s,a),t++;if(e.data.lboModels)for(const[s,a]of Object.entries(e.data.lboModels))await this.saveLBOModel(s,a),t++;if(e.data.monteCarloResults)for(const[s,a]of Object.entries(e.data.monteCarloResults))await this.saveMonteCarloResults(s,a),t++;if(e.data.watchlists)for(const[s,a]of Object.entries(e.data.watchlists))await this.saveWatchlist(s,a.symbols),t++;return e.data.userPreferences&&(await this.saveUserPreferences(e.data.userPreferences),t++),re.log("INFO","Data import completed",{importCount:t}),t}catch(t){throw re.log("ERROR","Failed to import data",{error:t.message}),t}}async getFinancialDataStats(){return{...await this.storage.getStorageStats(),financialData:{dcfModels:(await this.listDCFModels()).length,lboModels:(await this.listLBOModels()).length,monteCarloResults:(await this.listMonteCarloResults()).length,watchlists:(await this.listWatchlists()).length}}}async cleanupExpiredMarketData(){const e=this.storage.listItems("marketData");let t=0;for(const s of e){const e=await this.storage.getItem("marketData",s);e&&e.expiresAt<=Date.now()&&(await this.deleteMarketData(s),t++)}return re.log("INFO","Expired market data cleaned",{cleanedCount:t}),t}},ze=[{id:1,name:"Standard 3-Statement Model",category:"General",lastUsed:"2024-01-15",uses:42},{id:2,name:"SaaS DCF Template",category:"Technology",lastUsed:"2024-01-10",uses:28},{id:3,name:"LBO Analysis Template",category:"Private Equity",lastUsed:"2024-01-05",uses:35}],Ge=({data:h,onDataChange:p,savedAnalyses:g,onAnalysesChange:b,onClose:y,className:f})=>{const[j,v]=e.useState("excel"),[N,w]=e.useState(!1),[C,k]=e.useState(!1),[S,R]=e.useState(null),[M,I]=e.useState(null),[E,A]=e.useState(null),[F,D]=e.useState(ze),[P,O]=e.useState([{id:1,name:"John Smith",email:"john@company.com",role:"Analyst",lastActive:"2 min ago",avatar:"JS"},{id:2,name:"Sarah Johnson",email:"sarah@company.com",role:"VP",lastActive:"1 hour ago",avatar:"SJ"}]);t.useEffect(()=>{T()},[]);const T=async()=>{try{const e=await qe.getFinancialDataStats();A(e)}catch(e){re.log("ERROR","Failed to load storage stats",{error:e.message})}},V=async()=>{w(!0),R(null);try{const e=await qe.exportAllData(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`financeanalyst_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),R({type:"success",message:"Data exported successfully",details:{dcfModels:Object.keys(e.data.dcfModels).length,lboModels:Object.keys(e.data.lboModels).length,monteCarloResults:Object.keys(e.data.monteCarloResults).length,watchlists:Object.keys(e.data.watchlists).length}}),re.log("INFO","Data export completed",{totalItems:Object.keys(e.data.dcfModels).length+Object.keys(e.data.lboModels).length+Object.keys(e.data.monteCarloResults).length+Object.keys(e.data.watchlists).length})}catch(e){R({type:"error",message:"Export failed",details:e.message}),re.log("ERROR","Data export failed",{error:e.message})}finally{w(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Data Management"}),s.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"×"})]}),s.jsx("div",{className:"border-b border-gray-200",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"excel",label:"Excel Integration",icon:a},{id:"templates",label:"Templates",icon:r},{id:"collaboration",label:"Collaboration",icon:i},{id:"export",label:"Export",icon:l},{id:"import",label:"Import",icon:n},{id:"stats",label:"Statistics",icon:o}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>v(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(j===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(t,{className:"w-4 h-4"}),s.jsx("span",{children:e.label})]},e.id)})})}),s.jsxs("div",{className:"p-6",children:["excel"===j&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(c,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Excel Integration"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Connect your Excel spreadsheets to FinanceAnalyst for seamless data synchronization."})]})]})}),s.jsx("button",{onClick:V,disabled:N,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:N?s.jsxs(s.Fragment,{children:[s.jsx(d,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):s.jsxs(s.Fragment,{children:[s.jsx(l,{className:"w-4 h-4 mr-2"}),"Export All Data"]})}),S&&s.jsx("div",{className:"border rounded-lg p-4 "+("success"===S.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:s.jsxs("div",{className:"flex items-start",children:["success"===S.type?s.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):s.jsx(x,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium "+("success"===S.type?"text-green-900":"text-red-900"),children:S.message}),"success"===S.type&&S.details&&s.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[s.jsx("p",{children:"Exported items:"}),s.jsxs("ul",{className:"list-disc list-inside ml-4",children:[s.jsxs("li",{children:[S.details.dcfModels," DCF Models"]}),s.jsxs("li",{children:[S.details.lboModels," LBO Models"]}),s.jsxs("li",{children:[S.details.monteCarloResults," Monte Carlo Results"]}),s.jsxs("li",{children:[S.details.watchlists," Watchlists"]})]})]}),"error"===S.type&&s.jsx("p",{className:"text-sm text-red-700 mt-1",children:S.details})]})]})})]}),"templates"===j&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Templates"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:F.map(e=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.category}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Last used: ",e.lastUsed]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Uses: ",e.uses]})]},e.id))})]}),"collaboration"===j&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Collaboration"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:P.map(e=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.email}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Role: ",e.role]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Last active: ",e.lastActive]})]},e.id))})]}),"export"===j&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(c,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Export Your Data"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Download all your financial models, analysis results, and preferences as a backup file."})]})]})}),s.jsx("button",{onClick:V,disabled:N,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:N?s.jsxs(s.Fragment,{children:[s.jsx(d,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):s.jsxs(s.Fragment,{children:[s.jsx(l,{className:"w-4 h-4 mr-2"}),"Export All Data"]})}),S&&s.jsx("div",{className:"border rounded-lg p-4 "+("success"===S.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:s.jsxs("div",{className:"flex items-start",children:["success"===S.type?s.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):s.jsx(x,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium "+("success"===S.type?"text-green-900":"text-red-900"),children:S.message}),"success"===S.type&&S.details&&s.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[s.jsx("p",{children:"Exported items:"}),s.jsxs("ul",{className:"list-disc list-inside ml-4",children:[s.jsxs("li",{children:[S.details.dcfModels," DCF Models"]}),s.jsxs("li",{children:[S.details.lboModels," LBO Models"]}),s.jsxs("li",{children:[S.details.monteCarloResults," Monte Carlo Results"]}),s.jsxs("li",{children:[S.details.watchlists," Watchlists"]})]})]}),"error"===S.type&&s.jsx("p",{className:"text-sm text-red-700 mt-1",children:S.details})]})]})})]}),"import"===j&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(x,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-amber-900",children:"Import Data"}),s.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"Import data from a backup file. This will add to your existing data."})]})]})}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[s.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsxs("label",{className:"cursor-pointer",children:[s.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Choose backup file"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Select a JSON backup file to import"}),s.jsx("input",{type:"file",accept:".json",onChange:async e=>{const t=e.target.files[0];if(t){k(!0),I(null);try{const e=await t.text(),s=JSON.parse(e);if(!s.data||!s.version)throw new Error("Invalid backup file format");const a=await qe.importData(s);I({type:"success",message:"Data imported successfully",details:{importCount:a,timestamp:new Date(s.timestamp).toLocaleString()}}),await T(),re.log("INFO","Data import completed",{importCount:a})}catch(s){I({type:"error",message:"Import failed",details:s.message}),re.log("ERROR","Data import failed",{error:s.message})}finally{k(!1),e.target.value=""}}},disabled:C,className:"hidden"})]})]}),C&&s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx(d,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Importing data..."})]}),M&&s.jsx("div",{className:"border rounded-lg p-4 "+("success"===M.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:s.jsxs("div",{className:"flex items-start",children:["success"===M.type?s.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):s.jsx(x,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium "+("success"===M.type?"text-green-900":"text-red-900"),children:M.message}),"success"===M.type&&M.details&&s.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[s.jsxs("p",{children:["Imported ",M.details.importCount," items"]}),s.jsxs("p",{children:["Backup created: ",M.details.timestamp]})]}),"error"===M.type&&s.jsx("p",{className:"text-sm text-red-700 mt-1",children:M.details})]})]})})]}),"stats"===j&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Storage Statistics"}),E?s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Storage Usage"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Size:"}),s.jsx("span",{className:"font-medium",children:(e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]})(E.totalSize)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Items:"}),s.jsx("span",{className:"font-medium",children:E.itemCount})]}),E.quota&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Usage:"}),s.jsxs("span",{className:"font-medium",children:[(100*E.usageRatio).toFixed(1),"%"]})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Financial Data"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"DCF Models:"}),s.jsx("span",{className:"font-medium",children:E.financialData.dcfModels})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"LBO Models:"}),s.jsx("span",{className:"font-medium",children:E.financialData.lboModels})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Monte Carlo Results:"}),s.jsx("span",{className:"font-medium",children:E.financialData.monteCarloResults})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Watchlists:"}),s.jsx("span",{className:"font-medium",children:E.financialData.watchlists})]})]})]})]}):s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx(d,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Loading statistics..."})]})]})]})]})})},$e=({data:t,onDataChange:a})=>{const[r,i]=e.useState("inputs"),[l,n]=e.useState(null),[o,c]=e.useState(!1),[d,m]=e.useState({symbol:"COMPANY",companyName:"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,equityContribution:.35,seniorDebtMultiple:4,subordinatedDebtMultiple:1.5,seniorInterestRate:.055,subordinatedInterestRate:.095,ebitdaGrowthRate:.06,capexAsPercentOfRevenue:.03,nwcAsPercentOfRevenue:.02,holdingPeriod:5,exitMultiple:10,transactionFees:.02,managementFees:.02,taxRate:.21}),x=e.useCallback(e=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),u=e.useCallback(e=>`${(100*e).toFixed(1)}%`,[]),y=e.useCallback(async()=>{try{c(!0);const e={symbol:d.symbol,companyName:d.companyName,purchasePrice:d.purchasePrice,ebitda:d.ebitda,revenue:d.revenue,assumptions:{debt:{seniorDebtMultiple:d.seniorDebtMultiple,subordinatedDebtMultiple:d.subordinatedDebtMultiple,seniorInterestRate:d.seniorInterestRate,subordinatedInterestRate:d.subordinatedInterestRate},operating:{ebitdaGrowthRate:d.ebitdaGrowthRate,capexAsPercentOfRevenue:d.capexAsPercentOfRevenue,nwcAsPercentOfRevenue:d.nwcAsPercentOfRevenue,taxRate:d.taxRate},exit:{exitMultiple:d.exitMultiple},transaction:{holdingPeriod:d.holdingPeriod,transactionFees:d.transactionFees}}},t=ie.buildLBOModel(e);n(t),a&&a({lboModel:{inputs:d,results:t,timestamp:(new Date).toISOString()}})}catch(e){alert(`Error: ${e.message}`)}finally{c(!1)}},[d,a]),f=e.useCallback((e,t)=>{m(s=>({...s,[e]:"string"==typeof t?parseFloat(t)||0:t}))},[]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(h,{className:"text-blue-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Advanced LBO Modeling"}),s.jsx("p",{className:"text-gray-600",children:"Professional leveraged buyout analysis"})]})]}),s.jsxs(le.button,{onClick:y,disabled:o,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(o?"bg-gray-300 text-gray-500":"bg-blue-600 hover:bg-blue-700 text-white"),children:[s.jsx(p,{size:18}),s.jsx("span",{children:o?"Calculating...":"Calculate LBO"})]})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"inputs",label:"Model Inputs",icon:g},{id:"results",label:"Results & Analysis",icon:b}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>i(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(r===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),"inputs"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Transaction"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"purchase-price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Price"}),s.jsx("input",{id:"purchase-price",type:"number",value:d.purchasePrice,onChange:e=>f("purchasePrice",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),s.jsx("p",{className:"text-xs text-gray-500",children:x(d.purchasePrice)})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"current-ebitda",className:"block text-sm font-medium text-gray-700 mb-1",children:"Current EBITDA"}),s.jsx("input",{id:"current-ebitda",type:"number",value:d.ebitda,onChange:e=>f("ebitda",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"holding-period",className:"block text-sm font-medium text-gray-700 mb-1",children:"Holding Period"}),s.jsx("input",{id:"holding-period",type:"number",value:d.holdingPeriod,onChange:e=>f("holdingPeriod",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Financing"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"senior-debt",className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Debt Multiple"}),s.jsx("input",{id:"senior-debt",type:"number",step:"0.1",value:d.seniorDebtMultiple,onChange:e=>f("seniorDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"sub-debt",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sub Debt Multiple"}),s.jsx("input",{id:"sub-debt",type:"number",step:"0.1",value:d.subordinatedDebtMultiple,onChange:e=>f("subordinatedDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"lbo-senior-rate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Rate (%)"}),s.jsx("input",{id:"lbo-senior-rate",type:"number",step:"0.001",value:100*d.seniorInterestRate,onChange:e=>f("seniorInterestRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Operating"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"lbo-ebitda-growth",className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA Growth (%)"}),s.jsx("input",{id:"lbo-ebitda-growth",type:"number",step:"0.01",value:100*d.ebitdaGrowthRate,onChange:e=>f("ebitdaGrowthRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"lbo-exit-multiple",className:"block text-sm font-medium text-gray-700 mb-1",children:"Exit Multiple"}),s.jsx("input",{id:"lbo-exit-multiple",type:"number",step:"0.1",value:d.exitMultiple,onChange:e=>f("exitMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"lbo-tax-rate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),s.jsx("input",{id:"lbo-tax-rate",type:"number",step:"0.01",value:100*d.taxRate,onChange:e=>f("taxRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})]})}),"results"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:l?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u(l.baseCase?.returnsAnalysis?.irr||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"IRR"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(l.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"MOIC"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[(l.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Leverage"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:x(l.baseCase?.exitAnalysis?.equityProceeds||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Exit Value"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Transaction Structure"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Purchase Price:"}),s.jsx("span",{className:"font-medium",children:x(l.transactionStructure?.purchasePrice)})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Total Debt:"}),s.jsx("span",{className:"font-medium",children:x(l.transactionStructure?.totalDebt)})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Equity Investment:"}),s.jsx("span",{className:"font-medium",children:x(l.transactionStructure?.equityContribution)})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Entry Multiple:"}),s.jsxs("span",{className:"font-medium",children:[(l.transactionStructure?.entryMultiple||0).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Debt/EBITDA:"}),s.jsxs("span",{className:"font-medium",children:[(l.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Equity %:"}),s.jsx("span",{className:"font-medium",children:u(l.transactionStructure?.equityPercentage||0)})]})]})]})]}),l.scenarios&&Object.keys(l.scenarios).length>0&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx("th",{className:"text-left py-2",children:"Scenario"}),s.jsx("th",{className:"text-right py-2",children:"IRR"}),s.jsx("th",{className:"text-right py-2",children:"MOIC"}),s.jsx("th",{className:"text-right py-2",children:"Exit Value"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 font-medium",children:"Base Case"}),s.jsx("td",{className:"text-right py-2",children:u(l.baseCase?.returnsAnalysis?.irr||0)}),s.jsxs("td",{className:"text-right py-2",children:[(l.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("td",{className:"text-right py-2",children:x(l.baseCase?.exitAnalysis?.equityProceeds||0)})]}),Object.entries(l.scenarios).map(([e,t])=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2",children:e}),s.jsx("td",{className:"text-right py-2",children:u(t.returnsAnalysis?.irr||0)}),s.jsxs("td",{className:"text-right py-2",children:[(t.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("td",{className:"text-right py-2",children:x(t.exitAnalysis?.equityProceeds||0)})]},e))]})]})})]})]}):s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(b,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Run LBO calculation to see results"})]})})]})},We=({data:t,adjustedValues:a,modelInputs:r,calculateDCF:l,formatCurrency:n,formatPercentage:o})=>{const c=e.useMemo(()=>{try{if(!t?.statements?.incomeStatement)return null;const s=t.statements.incomeStatement,r=Object.keys(s.totalRevenue||{}).sort((e,t)=>parseInt(e)-parseInt(t));if(r.length<2)return null;const i=r[r.length-1],o=r[r.length-2],c=r[0],d=a?.totalRevenue||s.totalRevenue?.[i]||0,m=s.totalRevenue?.[o]||0,x=s.totalRevenue?.[c]||0,u=a?.grossProfit||s.grossProfit?.[i]||0,h=s.grossProfit?.[o]||0,p=a?.operatingIncome||s.operatingIncome?.[i]||0,g=s.operatingIncome?.[o]||0,k=(a?.totalCostOfGoodsSold||s.totalCostOfGoodsSold,s.totalCostOfGoodsSold,m?(d-m)/m*100:0),S=x&&r.length>2?100*(Math.pow(d/x,1/(r.length-1))-1):0,R=g?(p-g)/g*100:0,M=d&&0!==d?u/d*100:0,I=m&&0!==m?h/m*100:0,E=d&&0!==d?p/d*100:0,A=m&&0!==m?g/m*100:0,F=isFinite(M)&&isFinite(I)?M-I:0,D=isFinite(E)&&isFinite(A)?E-A:0;let P=null;if(l)try{P=l(t)}catch(e){}const O=[{name:"Energy Devices",value:Number(s.energyDevices?.[i])||0},{name:"Injectables",value:Number(s.injectables?.[i])||0},{name:"Wellness",value:Number(s.wellness?.[i])||0},{name:"Weightloss",value:Number(s.weightloss?.[i])||0},{name:"Retail Sales",value:Number(s.retailSales?.[i])||0},{name:"Surgery",value:Number(s.surgery?.[i])||0}].filter(e=>e.value>0&&isFinite(e.value)),T=s.totalAssets?.[i]||1.2*d,V=s.totalEquity?.[i]||.6*T,B=s.totalDebt?.[i]||.3*T,_=s.currentAssets?.[i]||.4*T,L=s.currentLiabilities?.[i]||.2*T,U=s.inventory?.[i]||.15*d,q=s.accountsReceivable?.[i]||.1*d,z=s.cashAndEquivalents?.[i]||.1*T,G=T&&0!==T?p/T*100:0,$=V&&0!==V?p/V*100:0,W=V&&0!==V?B/V:0,K=L&&0!==L?_/L:0,Y=L&&0!==L?(_-U)/L:0,H=T&&0!==T?d/T:0,Q=U&&0!==U?.7*d/U:0,J=q&&0!==q?d/q:0,X=L&&0!==L?z/L:0,Z=_-L,ee=d&&0!==d?Z/d:0,te=Q>0&&J>0?365/Q+365/J:0,se=te>0?te-30:0,ae=0!==h?R/k:0,re=100*(E-A),ie=V&&0!==V?T/V:0,le=s.interestExpense?.[i]?p/s.interestExpense[i]:0,ne=s.debtService?.[i]?p/s.debtService[i]:0,oe=s.employeeCount?.[i]?d/s.employeeCount[i]:0,ce=s.sharesOutstanding?.[i]?d/s.sharesOutstanding[i]:0,de=s.sharesOutstanding?.[i]&&V?V/s.sharesOutstanding[i]:0,me={grossMargin:65,operatingMargin:18,returnOnAssets:8,returnOnEquity:15,currentRatio:2.5,debtToEquity:.4,assetTurnover:.8,revenueGrowth:8},xe={grossMargin:M-me.grossMargin,operatingMargin:E-me.operatingMargin,returnOnAssets:G-me.returnOnAssets,returnOnEquity:$-me.returnOnEquity,currentRatio:K-me.currentRatio,debtToEquity:me.debtToEquity-W,assetTurnover:H-me.assetTurnover,revenueGrowth:k-me.revenueGrowth},ue=[{title:"Revenue Growth",value:`${k>0?"+":""}${isFinite(k)?k.toFixed(1):"0.0"}%`,trend:k>0?"up":"down",description:"Year-over-year revenue growth rate",icon:y,benchmark:me.revenueGrowth,performance:xe.revenueGrowth},{title:"Gross Margin",value:`${isFinite(M)?M.toFixed(1):"0.0"}%`,trend:F>0?"up":"down",description:`${F>0?"+":""}${isFinite(F)?F.toFixed(1):"0.0"}% vs prior year`,icon:f,benchmark:me.grossMargin,performance:xe.grossMargin},{title:"Operating Margin",value:`${isFinite(E)?E.toFixed(1):"0.0"}%`,trend:D>0?"up":"down",description:`${D>0?"+":""}${isFinite(D)?D.toFixed(1):"0.0"}% vs prior year`,icon:b,benchmark:me.operatingMargin,performance:xe.operatingMargin},{title:"Return on Assets",value:`${isFinite(G)?G.toFixed(1):"0.0"}%`,trend:G>me.returnOnAssets?"up":"down",description:"Asset utilization efficiency",icon:j,benchmark:me.returnOnAssets,performance:xe.returnOnAssets},{title:"Return on Equity",value:`${isFinite($)?$.toFixed(1):"0.0"}%`,trend:$>me.returnOnEquity?"up":"down",description:"Shareholder value generation",icon:v,benchmark:me.returnOnEquity,performance:xe.returnOnEquity},{title:"Current Ratio",value:`${isFinite(K)?K.toFixed(1):"0.0"}x`,trend:K>2?"up":K>1.5?"neutral":"down",description:"Short-term liquidity strength",icon:N,benchmark:me.currentRatio,performance:xe.currentRatio},{title:"Asset Turnover",value:`${isFinite(H)?H.toFixed(1):"0.0"}x`,trend:H>me.assetTurnover?"up":"down",description:"Revenue per dollar of assets",icon:w,benchmark:me.assetTurnover,performance:xe.assetTurnover},{title:"Debt-to-Equity",value:`${isFinite(W)?W.toFixed(1):"0.0"}x`,trend:W<me.debtToEquity?"up":"down",description:"Financial leverage position",icon:C,benchmark:me.debtToEquity,performance:xe.debtToEquity}],he=[{name:"Current Ratio",value:K,formatted:`${K.toFixed(2)}x`,benchmark:2.5,status:K>=2.5?"excellent":K>=2?"good":K>=1.5?"fair":"poor"},{name:"Quick Ratio",value:Y,formatted:`${Y.toFixed(2)}x`,benchmark:1.5,status:Y>=1.5?"excellent":Y>=1?"good":Y>=.8?"fair":"poor"},{name:"Cash Ratio",value:X,formatted:`${X.toFixed(2)}x`,benchmark:.5,status:X>=.5?"excellent":X>=.3?"good":X>=.2?"fair":"poor"},{name:"Working Capital",value:Z,formatted:n(Z),benchmark:.15*d,status:Z>=.15*d?"excellent":Z>=0?"good":"poor"}],pe=[{name:"Asset Turnover",value:H,formatted:`${H.toFixed(2)}x`,description:"Revenue generation per asset dollar"},{name:"Inventory Turnover",value:Q,formatted:`${Q.toFixed(1)}x`,description:"Inventory management efficiency"},{name:"Receivables Turnover",value:J,formatted:`${J.toFixed(1)}x`,description:"Collection efficiency"},{name:"Operating Cycle",value:te,formatted:`${te.toFixed(0)} days`,description:"Cash-to-cash cycle duration"}],ge=[{name:"Financial Leverage",value:ie,formatted:`${ie.toFixed(1)}x`,level:ie<2?"low":ie<3?"moderate":"high"},{name:"Debt-to-Equity",value:W,formatted:`${W.toFixed(2)}x`,level:W<.3?"low":W<.6?"moderate":"high"},{name:"Interest Coverage",value:le,formatted:`${le.toFixed(1)}x`,level:le>10?"low":le>5?"moderate":"high"}];return{periods:r,latest:i,previous:o,revenue:{latest:d,previous:m,growth:k,cagr:S},profitability:{grossMargin:M,grossMarginChange:F,operatingMargin:E,operatingMarginChange:D,operatingLeverage:ae,profitabilityTrend:re},financial:{returnOnAssets:G,returnOnEquity:$,assetTurnover:H,totalAssets:T,totalEquity:V,totalDebt:B,workingCapital:Z,workingCapitalRatio:ee},liquidity:{currentRatio:K,quickRatio:Y,cashRatio:X,cashAndEquivalents:z,currentAssets:_,currentLiabilities:L},efficiency:{inventoryTurnover:Q,receivablesTurnover:J,operatingCycle:te,cashConversionCycle:se},risk:{debtToEquity:W,financialLeverage:ie,interestCoverage:le,debtServiceCoverage:ne},market:{revenuePerEmployee:oe,revenuePerShare:ce,bookValuePerShare:de},benchmarks:{industry:me,comparison:xe},dcf:P,revenueBreakdown:O,kpis:ue,liquidityMetrics:he,efficiencyMetrics:pe,riskMetrics:ge}}catch(e){return null}},[t,l]);if(!c)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx(k,{className:"mx-auto h-12 w-12 text-yellow-400 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Insufficient Data"}),s.jsx("p",{className:"text-gray-500",children:"Please ensure financial data is loaded to generate analysis results."})]})});const d=({title:e,value:t,trend:a,description:r,icon:i,benchmark:l,performance:n})=>s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 hover:border-gray-600 transition-all duration-200",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg "+("up"===a?"bg-green-900/30 text-green-400":"down"===a?"bg-red-900/30 text-red-400":"bg-gray-700 text-gray-400"),children:s.jsx(i,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-300",children:e}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:r})]})]}),"up"===a&&s.jsx(y,{className:"h-5 w-5 text-green-400 flex-shrink-0"}),"down"===a&&s.jsx(A,{className:"h-5 w-5 text-red-400 flex-shrink-0"})]}),s.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:t}),l&&s.jsxs("div",{className:"border-t border-gray-700 pt-3 mt-3",children:[s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsx("span",{className:"text-gray-400",children:"Industry Avg:"}),s.jsx("span",{className:"text-gray-300",children:"number"==typeof l?l.toFixed(1)+(e.includes("%")?"%":e.includes("x")?"x":""):l})]}),s.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[s.jsx("span",{className:"text-gray-400",children:"vs Industry:"}),s.jsxs("span",{className:"font-medium "+(n>0?"text-green-400":n<0?"text-red-400":"text-gray-300"),children:[n>0?"+":"",n?.toFixed(1)||"0.0"]})]})]})]});return s.jsxs("div",{className:"space-y-6 p-6 bg-gray-900 text-white h-full",children:[s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center",children:[s.jsx(b,{className:"h-6 w-6 text-blue-400 mr-3"}),"Financial Analysis Results"]}),s.jsx("p",{className:"text-gray-400",children:"Comprehensive analysis of your company's financial performance and valuation"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.kpis.map((e,t)=>s.jsx(d,{...e},t))}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",children:[s.jsxs("div",{className:"flex border-b border-gray-700",children:[s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-white bg-blue-600 border-r border-gray-700",children:"Liquidity Analysis"}),s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white border-r border-gray-700",children:"Efficiency Metrics"}),s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white border-r border-gray-700",children:"Risk Assessment"}),s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white",children:"Benchmarking"})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(N,{className:"h-5 w-5 text-blue-400 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Liquidity Position Analysis"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.liquidityMetrics.map((e,t)=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-200",children:e.name}),s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+("excellent"===e.status?"bg-green-900/30 text-green-400":"good"===e.status?"bg-blue-900/30 text-blue-400":"fair"===e.status?"bg-yellow-900/30 text-yellow-400":"bg-red-900/30 text-red-400"),children:e.status})]}),s.jsx("div",{className:"text-xl font-bold text-white mb-1",children:e.formatted}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Benchmark: ","number"==typeof e.benchmark?e.benchmark.toFixed(1)+"x":n(e.benchmark)]})]},t))}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-750 rounded-lg border border-gray-600",children:[s.jsxs("h4",{className:"font-medium text-gray-200 mb-3 flex items-center",children:[s.jsx(S,{className:"h-4 w-4 text-blue-400 mr-2"}),"Liquidity Analysis Summary"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Working Capital:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.financial.workingCapital)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Cash Position:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.liquidity.cashAndEquivalents)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Current Assets:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.liquidity.currentAssets)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Current Liabilities:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.liquidity.currentLiabilities)})]})]})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx(w,{className:"h-5 w-5 text-orange-400 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Operational Efficiency Metrics"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.efficiencyMetrics.map((e,t)=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[s.jsx("div",{className:"text-sm font-medium text-gray-200 mb-2",children:e.name}),s.jsx("div",{className:"text-xl font-bold text-white mb-1",children:e.formatted}),s.jsx("div",{className:"text-xs text-gray-400",children:e.description})]},t))}),s.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(R,{className:"h-4 w-4 text-orange-400 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Cash Conversion"})]}),s.jsxs("div",{className:"text-lg font-bold text-white",children:[c.efficiency.cashConversionCycle.toFixed(0)," days"]}),s.jsx("div",{className:"text-xs text-gray-400",children:"Time to convert inventory to cash"})]}),s.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(M,{className:"h-4 w-4 text-orange-400 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Asset Productivity"})]}),s.jsxs("div",{className:"text-lg font-bold text-white",children:[c.financial.assetTurnover.toFixed(2),"x"]}),s.jsx("div",{className:"text-xs text-gray-400",children:"Revenue per dollar of assets"})]}),s.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(i,{className:"h-4 w-4 text-orange-400 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Revenue/Employee"})]}),s.jsx("div",{className:"text-lg font-bold text-white",children:c.market.revenuePerEmployee>0?n(c.market.revenuePerEmployee):"N/A"}),s.jsx("div",{className:"text-xs text-gray-400",children:"Productivity per employee"})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx(k,{className:"h-5 w-5 text-red-400 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Financial Risk Assessment"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:c.riskMetrics.map((e,t)=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-200",children:e.name}),s.jsxs("span",{className:"px-2 py-1 rounded text-xs font-medium "+("low"===e.level?"bg-green-900/30 text-green-400":"moderate"===e.level?"bg-yellow-900/30 text-yellow-400":"bg-red-900/30 text-red-400"),children:[e.level," risk"]})]}),s.jsx("div",{className:"text-xl font-bold text-white",children:e.formatted})]},t))}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-750 rounded-lg border border-gray-600",children:[s.jsxs("h4",{className:"font-medium text-gray-200 mb-3 flex items-center",children:[s.jsx(N,{className:"h-4 w-4 text-red-400 mr-2"}),"Risk Analysis Summary"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Financial Leverage:"}),s.jsxs("span",{className:"ml-2 font-medium "+(c.risk.financialLeverage<2?"text-green-400":c.risk.financialLeverage<3?"text-yellow-400":"text-red-400"),children:[c.risk.financialLeverage.toFixed(1),"x"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Interest Coverage:"}),s.jsxs("span",{className:"ml-2 font-medium "+(c.risk.interestCoverage>10?"text-green-400":c.risk.interestCoverage>5?"text-yellow-400":"text-red-400"),children:[c.risk.interestCoverage.toFixed(1),"x"]})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(I,{className:"h-5 w-5 text-purple-400 mr-2"}),"Performance Trends"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-3",children:"Revenue Analysis"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Latest Period:"}),s.jsx("span",{className:"font-semibold text-white",children:n(c.revenue.latest)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"YoY Growth:"}),s.jsxs("span",{className:"font-semibold "+(c.revenue.growth>0?"text-green-400":"text-red-400"),children:[c.revenue.growth>0?"+":"",c.revenue.growth.toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"CAGR:"}),s.jsxs("span",{className:"font-semibold text-gray-200",children:[c.revenue.cagr.toFixed(1),"%"]})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-3",children:"Profitability Margins"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Gross Margin:"}),s.jsxs("span",{className:"font-semibold text-white",children:[c.profitability.grossMargin.toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Operating Margin:"}),s.jsxs("span",{className:"font-semibold text-white",children:[c.profitability.operatingMargin.toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Margin Change:"}),s.jsxs("span",{className:"font-semibold "+(c.profitability.grossMarginChange>0?"text-green-400":"text-red-400"),children:[c.profitability.grossMarginChange>0?"+":"",c.profitability.grossMarginChange.toFixed(1),"pp"]})]})]})]})]})]}),c.dcf&&s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(g,{className:"h-5 w-5 text-green-400 mr-2"}),"DCF Valuation Summary"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center p-4 bg-green-900/30 border border-green-700 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-green-400",children:n(c.dcf.enterpriseValue)}),s.jsx("div",{className:"text-sm text-green-300",children:"Enterprise Value"})]}),s.jsxs("div",{className:"text-center p-4 bg-blue-900/30 border border-blue-700 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-400",children:n(c.dcf.sharePrice)}),s.jsx("div",{className:"text-sm text-blue-300",children:"Price per Share"})]}),s.jsxs("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-300",children:n(c.dcf.terminalValue)}),s.jsx("div",{className:"text-sm text-gray-400",children:"Terminal Value"})]})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(E,{className:"h-5 w-5 text-orange-400 mr-2"}),"Business Unit Performance"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.revenueBreakdown.map((e,t)=>{const a=c.revenue.latest?e.value/c.revenue.latest*100:0;return s.jsxs("div",{className:"p-4 bg-gray-700 border border-gray-600 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"font-medium text-gray-200",children:e.name}),s.jsxs("span",{className:"text-sm text-gray-400",children:[a.toFixed(1),"%"]})]}),s.jsx("div",{className:"text-lg font-semibold text-white mb-1",children:n(e.value)}),s.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${Math.min(a,100)}%`}})})]},t)})})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(m,{className:"h-5 w-5 text-green-400 mr-2"}),"Key Financial Insights"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-2",children:"Strengths"}),s.jsxs("ul",{className:"space-y-1 text-sm text-gray-400",children:[c.revenue.growth>0&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(m,{className:"h-4 w-4 text-green-500 mr-2"}),"Positive revenue growth trajectory"]}),c.profitability.grossMargin>60&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(m,{className:"h-4 w-4 text-green-500 mr-2"}),"Strong gross margin above 60%"]}),c.profitability.grossMarginChange>0&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(m,{className:"h-4 w-4 text-green-500 mr-2"}),"Improving profitability margins"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(m,{className:"h-4 w-4 text-green-500 mr-2"}),"Diversified healthcare revenue streams"]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-2",children:"Areas for Focus"}),s.jsxs("ul",{className:"space-y-1 text-sm text-gray-400",children:[c.revenue.growth<5&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(k,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Revenue growth below industry benchmarks"]}),c.profitability.operatingMargin<20&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(k,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Operating margin optimization opportunities"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(k,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Monitor competitive positioning in key segments"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(k,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Consider strategic initiatives for growth acceleration"]})]})]})]})]})]})},Ke=({financialData:t,currentMetric:a,analysisContext:r="general",onInsightClick:l,isVisible:n=!0,onToggle:o})=>{const[d,m]=e.useState({assumptions:!0,benchmarks:!0,insights:!0,suggestions:!1});e.useMemo(()=>({healthcare:{revenueGrowth:{min:8,median:15,max:25,unit:"%"},ebitdaMargin:{min:18,median:28,max:40,unit:"%"},grossMargin:{min:65,median:75,max:85,unit:"%"},roe:{min:12,median:18,max:25,unit:"%"}},technology:{revenueGrowth:{min:15,median:25,max:50,unit:"%"},ebitdaMargin:{min:20,median:35,max:50,unit:"%"},grossMargin:{min:70,median:80,max:90,unit:"%"},roe:{min:15,median:22,max:35,unit:"%"}},manufacturing:{revenueGrowth:{min:3,median:8,max:15,unit:"%"},ebitdaMargin:{min:10,median:18,max:25,unit:"%"},grossMargin:{min:25,median:35,max:45,unit:"%"},roe:{min:8,median:15,max:22,unit:"%"}}}),[]);const x=(()=>{const e=[];if(!t?.statements?.incomeStatement)return[{type:"info",title:"Getting Started",content:"Import financial data to see contextual insights and benchmarks.",action:"Import Data"}];const s=t.statements.incomeStatement,i=s.totalRevenue?.[2]||0,l=s.operatingIncome?.[2]||0;if(i>0){const t=l/i*100;e.push({type:"benchmark",title:"Operating Margin Analysis",content:`Current operating margin of ${t.toFixed(1)}% compares to healthcare industry median of 28%.`,metric:t,benchmark:28,status:t>=28?"above":t>=20?"within":"below"})}return"dcf"===r&&e.push({type:"assumption",title:"DCF Model Assumptions",content:"Consider industry-specific discount rates and terminal growth assumptions.",suggestions:["Healthcare companies typically use 8-12% WACC","Terminal growth rates should reflect long-term GDP growth (2-3%)","Consider regulatory risks in discount rate adjustments"]}),a?.includes("revenue")&&e.push({type:"insight",title:"Revenue Growth Drivers",content:"Analyze revenue composition and growth sustainability.",suggestions:["Break down revenue by service line","Assess recurring vs. one-time revenue","Evaluate market expansion opportunities"]}),e})(),u=e=>{m(t=>({...t,[e]:!t[e]}))},h=(e,t,a,r)=>{const i=r-a,l=Math.max(0,Math.min(100,(e-a)/i*100)),n=Math.max(0,Math.min(100,(t-a)/i*100));return s.jsxs("div",{className:"relative h-2 bg-slate-200 rounded-full overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 h-full bg-blue-200 rounded-full",style:{width:`${n}%`}}),s.jsx("div",{className:"absolute top-0 h-full w-1 bg-blue-600 rounded-full",style:{left:`${n}%`}}),s.jsx("div",{className:"absolute top-0 h-full w-1 bg-amber-500 rounded-full",style:{left:`${l}%`}})]})};return n?s.jsxs(le.div,{initial:{x:320,opacity:0},animate:{x:0,opacity:1},exit:{x:320,opacity:0},className:"fixed right-0 top-16 bottom-0 w-80 bg-slate-50 border-l border-slate-200 shadow-xl z-40 overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:s.jsx(b,{size:16,className:"text-blue-600"})}),s.jsx("h3",{className:"font-semibold text-slate-900",children:"Contextual Insights"})]}),o&&s.jsx("button",{onClick:o,className:"p-1.5 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx(F,{size:16,className:"text-slate-500"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[s.jsxs("button",{onClick:()=>u("assumptions"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(j,{size:16,className:"text-amber-600"}),s.jsx("span",{className:"font-medium text-slate-900",children:"Key Assumptions"})]}),d.assumptions?s.jsx(D,{size:16,className:"text-slate-400"}):s.jsx(P,{size:16,className:"text-slate-400"})]}),s.jsx(ne,{children:d.assumptions&&s.jsx(le.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Discount Rate"}),s.jsx("span",{className:"font-mono text-slate-900",children:"10.0%"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Terminal Growth"}),s.jsx("span",{className:"font-mono text-slate-900",children:"2.5%"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Tax Rate"}),s.jsx("span",{className:"font-mono text-slate-900",children:"25.0%"})]})]})})})]}),s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[s.jsxs("button",{onClick:()=>u("benchmarks"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(i,{size:16,className:"text-emerald-600"}),s.jsx("span",{className:"font-medium text-slate-900",children:"Industry Benchmarks"})]}),d.benchmarks?s.jsx(D,{size:16,className:"text-slate-400"}):s.jsx(P,{size:16,className:"text-slate-400"})]}),s.jsx(ne,{children:d.benchmarks&&s.jsx(le.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-slate-600",children:"Revenue Growth"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Healthcare Industry"})]}),s.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[s.jsx("span",{children:"8%"}),s.jsx("span",{className:"font-medium",children:"15% (median)"}),s.jsx("span",{children:"25%"})]}),h(12,15,8,25)]}),s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-slate-600",children:"EBITDA Margin"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Healthcare Industry"})]}),s.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[s.jsx("span",{children:"18%"}),s.jsx("span",{className:"font-medium",children:"28% (median)"}),s.jsx("span",{children:"40%"})]}),h(24,28,18,40)]})]})})})]}),s.jsx("div",{className:"space-y-3",children:x.map((e,t)=>((e,t)=>{const a={info:"text-blue-500 bg-blue-50",benchmark:"text-emerald-500 bg-emerald-50",assumption:"text-amber-500 bg-amber-50",insight:"text-purple-500 bg-purple-50"},r={info:c,benchmark:j,assumption:k,insight:O}[e.type]||c,i=a[e.type]||a.info;return s.jsx(le.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"p-4 bg-white rounded-lg border border-slate-200 hover:border-slate-300 transition-colors",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${i}`,children:s.jsx(r,{size:16})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-semibold text-slate-900 text-sm mb-2",children:e.title}),s.jsx("p",{className:"text-sm text-slate-600 mb-3",children:e.content}),void 0!==e.metric&&void 0!==e.benchmark&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[s.jsxs("span",{children:["Current: ",e.metric.toFixed(1),"%"]}),s.jsxs("span",{children:["Benchmark: ",e.benchmark,"%"]})]}),h(e.metric,e.benchmark,0,Math.max(1.5*e.benchmark,1.2*e.metric))]}),e.suggestions&&s.jsx("div",{className:"mt-3",children:s.jsx("div",{className:"space-y-1",children:e.suggestions.map((e,t)=>s.jsxs("div",{className:"flex items-start gap-2 text-xs text-slate-600",children:[s.jsx(P,{size:12,className:"text-slate-400 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:e})]},t))})}),e.action&&s.jsx("button",{onClick:()=>l?.(e),className:"mt-3 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 text-xs font-medium rounded-md transition-colors",children:e.action})]})]})},t)})(e,t))}),s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[s.jsxs("button",{onClick:()=>u("suggestions"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(O,{size:16,className:"text-purple-600"}),s.jsx("span",{className:"font-medium text-slate-900",children:"Smart Suggestions"})]}),d.suggestions?s.jsx(D,{size:16,className:"text-slate-400"}):s.jsx(P,{size:16,className:"text-slate-400"})]}),s.jsx(ne,{children:d.suggestions&&s.jsx(le.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg",children:[s.jsx(b,{size:14,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-blue-900 mb-1",children:"Create Revenue vs CapEx Chart"}),s.jsx("div",{className:"text-xs text-blue-700",children:"Visualize the relationship between revenue growth and capital expenditure"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-emerald-50 rounded-lg",children:[s.jsx(y,{size:14,className:"text-emerald-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-emerald-900 mb-1",children:"Add Sensitivity Analysis"}),s.jsx("div",{className:"text-xs text-emerald-700",children:"Test how valuation changes with different assumptions"})]})]})]})})})]})]})})]}):null},Ye=({data:t,onDataChange:a})=>{const[r,i]=e.useState("overview"),[l,n]=e.useState([{symbol:"SPY",name:"SPDR S&P 500 ETF",price:445.67,change:2.34,changePercent:.53,category:"index"},{symbol:"QQQ",name:"Invesco QQQ Trust",price:378.91,change:-1.45,changePercent:-.38,category:"index"},{symbol:"VIX",name:"CBOE Volatility Index",price:18.45,change:.87,changePercent:4.95,category:"volatility"},{symbol:"DXY",name:"US Dollar Index",price:102.45,change:-.23,changePercent:-.22,category:"currency"},{symbol:"^TNX",name:"10-Year Treasury Yield",price:4.25,change:.05,changePercent:1.19,category:"rates"}]),[o]=e.useState({indices:{"S&P 500":{value:4456.78,change:23.45,changePercent:.53},NASDAQ:{value:13789.45,change:-45.67,changePercent:-.33},DOW:{value:34567.89,change:156.78,changePercent:.46},"Russell 2000":{value:1987.65,change:12.34,changePercent:.63}},sectors:[{name:"Technology",change:1.2,weight:23.5},{name:"Healthcare",change:.8,weight:13.2},{name:"Financial",change:-.4,weight:12.8},{name:"Consumer Disc.",change:.6,weight:10.9},{name:"Communication",change:-.2,weight:9.1},{name:"Industrials",change:.9,weight:8.7}],economicIndicators:{"Fed Funds Rate":{value:5.25,change:0,unit:"%"},"10Y Treasury":{value:4.25,change:.05,unit:"%"},"Inflation (CPI)":{value:3.1,change:-.2,unit:"%"},Unemployment:{value:3.8,change:.1,unit:"%"},"GDP Growth":{value:2.4,change:.1,unit:"%"}}}),[c]=e.useState([{id:1,type:"price",symbol:"SPY",condition:"above",value:450,active:!0},{id:2,type:"volatility",symbol:"VIX",condition:"above",value:20,active:!0}]),[d,u]=e.useState(""),[h,p]=e.useState(!1),g=e.useCallback(e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),[]),f=e.useCallback(e=>`${e>=0?"+":""}${e.toFixed(2)}%`,[]),j=e.useCallback(e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",[]),v=e.useCallback(e=>e>0?y:e<0?A:T,[]);e.useEffect(()=>{const e=setInterval(()=>{n(e=>e.map(e=>({...e,price:e.price+2*(Math.random()-.5),change:e.change+.5*(Math.random()-.5),changePercent:e.changePercent+.1*(Math.random()-.5)})))},5e3);return()=>clearInterval(e)},[]);const N=e.useCallback(async()=>{if(d.trim()){p(!0);try{await new Promise(e=>setTimeout(e,1e3));const e={symbol:d.toUpperCase(),name:`${d.toUpperCase()} Inc.`,price:200*Math.random()+50,change:10*(Math.random()-.5),changePercent:5*(Math.random()-.5),category:"stock"};n(t=>[...t,e]),u("")}catch(e){}finally{p(!1)}}},[d]),w=e.useCallback(e=>{n(t=>t.filter(t=>t.symbol!==e))},[]),C=e.useMemo(()=>{const e=new Date;return Array.from({length:30},(t,s)=>({time:new Date(e.getTime()-24*(29-s)*60*60*1e3).toLocaleDateString(),SPY:440+10*Math.sin(.2*s)+5*Math.random(),QQQ:370+15*Math.sin(.25*s)+8*Math.random(),VIX:20+5*Math.sin(.3*s)+3*Math.random()}))},[]),k=e.useMemo(()=>[{pair:"SPY vs QQQ",correlation:.85,strength:"Strong Positive"},{pair:"SPY vs VIX",correlation:-.72,strength:"Strong Negative"},{pair:"QQQ vs VIX",correlation:-.68,strength:"Moderate Negative"},{pair:"SPY vs DXY",correlation:-.45,strength:"Moderate Negative"}],[]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(I,{className:"text-blue-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Market Data Dashboard"}),s.jsx("p",{className:"text-gray-600",children:"Real-time market insights & valuation integration"})]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs(le.button,{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(V,{size:16}),s.jsx("span",{children:"Sync Data"})]}),s.jsxs(le.button,{className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(B,{size:16}),s.jsx("span",{children:"Settings"})]})]})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Market Overview",icon:_},{id:"watchlist",label:"Watchlist",icon:b},{id:"charts",label:"Charts & Analysis",icon:L},{id:"alerts",label:"Alerts",icon:U}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>i(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(r===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),"overview"===r&&s.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Major Indices"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(o.indices).map(([e,t])=>{const a=v(t.change);return s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:e}),s.jsx("div",{className:"text-xl font-bold text-gray-800",children:t.value.toLocaleString()}),s.jsxs("div",{className:`flex items-center space-x-1 text-sm ${j(t.change)}`,children:[s.jsx(a,{size:14}),s.jsxs("span",{children:[t.change>0?"+":"",t.change.toFixed(2)]}),s.jsxs("span",{children:["(",f(t.changePercent),")"]})]})]},e)})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sector Performance"}),s.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:o.sectors.map(e=>s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-600",children:[e.weight,"% weight"]})]}),s.jsx("div",{className:`font-semibold ${j(e.change)}`,children:f(e.change)})]},e.name))})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Economic Indicators"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(o.economicIndicators).map(([e,t])=>s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:e}),s.jsxs("div",{className:"text-lg font-bold text-gray-800",children:[t.value,t.unit]}),s.jsxs("div",{className:`text-sm ${j(t.change)}`,children:[t.change>0?"+":"",t.change,t.unit]})]},e))})]})]}),"watchlist"===r&&s.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("div",{className:"flex-1",children:s.jsx("input",{type:"text",placeholder:"Enter symbol (e.g., AAPL, MSFT)",value:d,onChange:e=>u(e.target.value.toUpperCase()),onKeyPress:e=>"Enter"===e.key&&N(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),s.jsxs(le.button,{onClick:N,disabled:h||!d.trim(),className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(h||!d.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"),whileHover:!h&&d.trim()?{scale:1.02}:{},children:[s.jsx(q,{size:16}),s.jsx("span",{children:h?"Adding...":"Add"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4",children:"Symbol"}),s.jsx("th",{className:"text-left py-3 px-4",children:"Name"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Price"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Change"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Change %"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Category"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),s.jsx("tbody",{children:l.map(e=>{const t=v(e.change);return s.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[s.jsx("td",{className:"py-3 px-4 font-medium text-gray-800",children:e.symbol}),s.jsx("td",{className:"py-3 px-4 text-gray-600",children:e.name}),s.jsx("td",{className:"text-right py-3 px-4 font-medium",children:g(e.price)}),s.jsx("td",{className:`text-right py-3 px-4 ${j(e.change)}`,children:s.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[s.jsx(t,{size:14}),s.jsxs("span",{children:[e.change>0?"+":"",e.change.toFixed(2)]})]})}),s.jsx("td",{className:`text-right py-3 px-4 font-medium ${j(e.changePercent)}`,children:f(e.changePercent)}),s.jsx("td",{className:"text-center py-3 px-4",children:s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("index"===e.category?"bg-blue-100 text-blue-800":"stock"===e.category?"bg-green-100 text-green-800":"volatility"===e.category?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.category})}),s.jsx("td",{className:"text-center py-3 px-4",children:s.jsx("button",{onClick:()=>w(e.symbol),className:"text-red-600 hover:text-red-800",children:s.jsx(T,{size:16})})})]},e.symbol)})})]})})]}),"charts"===r&&s.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"30-Day Price Performance"}),s.jsx("div",{className:"h-80",children:s.jsx(oe,{width:"100%",height:"100%",children:s.jsxs(ce,{data:C,children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"time"}),s.jsx(xe,{}),s.jsx(ue,{}),s.jsx(he,{type:"monotone",dataKey:"SPY",stroke:"#3B82F6",strokeWidth:2,name:"S&P 500"}),s.jsx(he,{type:"monotone",dataKey:"QQQ",stroke:"#10B981",strokeWidth:2,name:"NASDAQ"}),s.jsx(he,{type:"monotone",dataKey:"VIX",stroke:"#EF4444",strokeWidth:2,name:"VIX"})]})})})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Correlation Analysis"}),s.jsx("div",{className:"space-y-3",children:k.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:e.pair}),s.jsx("div",{className:"text-sm text-gray-600",children:e.strength})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"text-lg font-bold "+(Math.abs(e.correlation)>.7?"text-red-600":Math.abs(e.correlation)>.4?"text-yellow-600":"text-green-600"),children:e.correlation.toFixed(2)}),s.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"h-2 rounded-full "+(Math.abs(e.correlation)>.7?"bg-red-600":Math.abs(e.correlation)>.4?"bg-yellow-600":"bg-green-600"),style:{width:100*Math.abs(e.correlation)+"%"}})})]})]},t))})]})]}),"alerts"===r&&s.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Active Alerts"}),s.jsx("div",{className:"space-y-3",children:c.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(U,{className:"text-yellow-600",size:20}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-gray-800",children:[e.symbol," ",e.type," alert"]}),s.jsxs("div",{className:"text-sm text-gray-600",children:["Notify when ",e.type," goes ",e.condition," ",e.value]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(e.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.active?"Active":"Inactive"}),s.jsx("button",{className:"text-red-600 hover:text-red-800",children:s.jsx(T,{size:16})})]})]},e.id))})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Market Status"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[s.jsx(m,{className:"text-green-600",size:20}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:"US Markets"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Open (6h 23m remaining)"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[s.jsx(x,{className:"text-yellow-600",size:20}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:"European Markets"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Closed"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[s.jsx(x,{className:"text-red-600",size:20}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:"Asian Markets"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Closed"})]})]})]})]})]})]})},He=({data:t,_onDataChange:a,calculateDCF:r,lboModelingEngine:i})=>{const[l,n]=e.useState("scenarios"),[o,c]=e.useState([{id:1,name:"Base Case",probability:40,revenueGrowth:5,marginExpansion:.5,exitMultiple:10,capexIntensity:3,isBase:!0},{id:2,name:"Bull Case",probability:30,revenueGrowth:8,marginExpansion:1.5,exitMultiple:12,capexIntensity:2.5,isBase:!1},{id:3,name:"Bear Case",probability:30,revenueGrowth:2,marginExpansion:-.5,exitMultiple:8,capexIntensity:4,isBase:!1}]),[d,m]=e.useState({modelType:"dcf",outputMetric:"enterpriseValue",includeCorrelations:!1,numSimulations:1e3}),[x,u]=e.useState(null),[h,p]=e.useState(!1),g=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),y=e.useCallback(e=>`${(e||0).toFixed(1)}%`,[]),f=e.useCallback(async()=>{p(!0);try{const e=[];for(const n of o){let s=null;if("dcf"===d.modelType){const e={...t,statements:{...t.statements,incomeStatement:{...t.statements.incomeStatement,totalRevenue:t.statements.incomeStatement.totalRevenue?.map((e,t)=>0===t?e:e*Math.pow(1+n.revenueGrowth/100,t))}}};s=r?r(e):null}else if("lbo"===d.modelType&&i){const e={symbol:t.symbol||"COMPANY",companyName:t.companyName||"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,assumptions:{operating:{ebitdaGrowthRate:n.revenueGrowth/100,capexAsPercentOfRevenue:n.capexIntensity/100},exit:{exitMultiple:n.exitMultiple}}};s=i.buildLBOModel(e)}e.push({...n,result:s,enterpriseValue:s?.enterpriseValue||s?.baseCase?.exitAnalysis?.enterpriseValue||0,equityValue:s?.equityValue||s?.baseCase?.exitAnalysis?.equityProceeds||0,irr:s?.irr||s?.baseCase?.returnsAnalysis?.irr||0,moic:s?.moic||s?.baseCase?.returnsAnalysis?.moic||0})}const s=e.reduce((e,t)=>e+t.enterpriseValue*t.probability/100,0),a={min:Math.min(...e.map(e=>e.enterpriseValue)),max:Math.max(...e.map(e=>e.enterpriseValue)),range:Math.max(...e.map(e=>e.enterpriseValue))-Math.min(...e.map(e=>e.enterpriseValue))},l=Math.sqrt(e.reduce((e,t)=>{const a=t.enterpriseValue-s;return e+a*a*t.probability/100},0));u({scenarios:e,summary:{weightedValue:s,valueRange:a,standardDeviation:l,coefficientOfVariation:l/s,probabilityOfPositiveReturn:e.filter(e=>e.enterpriseValue>(t.currentMarketCap||1e9)).reduce((e,t)=>e+t.probability,0)},chartData:e.map(e=>({name:e.name,value:e.enterpriseValue,probability:e.probability,irr:100*e.irr,moic:e.moic}))})}catch(e){alert(`Error running scenario analysis: ${e.message}`)}finally{p(!1)}},[o,d,t,r,i]),j=e.useCallback(()=>{const e={id:Date.now(),name:`Scenario ${o.length+1}`,probability:Math.max(0,100-o.reduce((e,t)=>e+t.probability,0)),revenueGrowth:5,marginExpansion:0,exitMultiple:10,capexIntensity:3,isBase:!1};c(t=>[...t,e])},[o]),v=e.useCallback((e,t,s)=>{c(a=>a.map(a=>a.id===e?{...a,[t]:parseFloat(s)||s}:a))},[]),N=e.useCallback(e=>{c(t=>t.filter(t=>t.id!==e&&!t.isBase))},[]),w=e.useMemo(()=>o.reduce((e,t)=>e+t.probability,0),[o]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(b,{className:"text-purple-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Scenario Analysis"}),s.jsx("p",{className:"text-gray-600",children:"Cross-model scenario planning & risk assessment"})]})]}),s.jsx("div",{className:"flex space-x-3",children:s.jsxs(le.button,{onClick:f,disabled:h||100!==w,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(h||100!==w?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:h||100!==w?{}:{scale:1.02},children:[s.jsx(z,{size:18}),s.jsx("span",{children:h?"Running...":"Run Analysis"})]})})]}),s.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"modelType",className:"block text-sm font-medium text-gray-700 mb-2",children:"Model Type"}),s.jsxs("select",{id:"modelType",value:d.modelType,onChange:e=>m(t=>({...t,modelType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"dcf",children:"DCF Valuation"}),s.jsx("option",{value:"lbo",children:"LBO Analysis"}),s.jsx("option",{value:"3statement",children:"3-Statement Model"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"outputMetric",className:"block text-sm font-medium text-gray-700 mb-2",children:"Output Metric"}),s.jsxs("select",{id:"outputMetric",value:d.outputMetric,onChange:e=>m(t=>({...t,outputMetric:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"enterpriseValue",children:"Enterprise Value"}),s.jsx("option",{value:"equityValue",children:"Equity Value"}),s.jsx("option",{value:"irr",children:"IRR"}),s.jsx("option",{value:"moic",children:"MOIC"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"simulations",className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulations"}),s.jsx("input",{id:"simulations",type:"number",value:d.numSimulations,onChange:e=>m(t=>({...t,numSimulations:parseInt(e.target.value)||1e3})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:d.includeCorrelations,onChange:e=>m(t=>({...t,includeCorrelations:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Include Correlations"})]})})]})}),100!==w&&s.jsxs("div",{className:"mb-6 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center",children:[s.jsx(k,{className:"text-amber-500 mr-2",size:20}),s.jsxs("span",{className:"text-amber-800",children:["Total probability is ",w,"%. Adjust scenarios to sum to 100%."]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Scenarios"}),s.jsxs(le.button,{onClick:j,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(q,{size:16}),s.jsx("span",{children:"Add Scenario"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4",children:"Scenario"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Probability (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Revenue Growth (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Margin Expansion (bps)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Exit Multiple"}),s.jsx("th",{className:"text-right py-3 px-4",children:"CapEx Intensity (%)"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),s.jsx("tbody",{children:o.map(e=>s.jsxs("tr",{className:"border-b border-gray-200 "+(e.isBase?"bg-blue-50":""),children:[s.jsx("td",{className:"py-3 px-4",children:s.jsx("input",{type:"text",value:e.name,onChange:t=>v(e.id,"name",t.target.value),disabled:e.isBase,className:"border border-gray-300 rounded px-2 py-1 "+(e.isBase?"bg-gray-100":"")})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"1",value:e.probability,onChange:t=>v(e.id,"probability",t.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.revenueGrowth,onChange:t=>v(e.id,"revenueGrowth",t.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.marginExpansion,onChange:t=>v(e.id,"marginExpansion",t.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.exitMultiple,onChange:t=>v(e.id,"exitMultiple",t.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.capexIntensity,onChange:t=>v(e.id,"capexIntensity",t.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-center py-3 px-4",children:!e.isBase&&s.jsx("button",{onClick:()=>N(e.id),className:"text-red-600 hover:text-red-800",children:s.jsx(G,{size:16})})})]},e.id))})]})})]}),x&&s.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g(x.summary.weightedValue)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:g(x.summary.valueRange.max)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:g(x.summary.valueRange.min)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:y(x.summary.probabilityOfPositiveReturn)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Success Probability"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Results"}),s.jsx("div",{className:"h-80",children:s.jsx(oe,{width:"100%",height:"100%",children:s.jsxs(pe,{data:x.chartData,children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"name"}),s.jsx(xe,{tickFormatter:e=>g(e)}),s.jsx(ue,{formatter:e=>[g(e),"Enterprise Value"]}),s.jsx(ge,{dataKey:"value",fill:"#8884d8"})]})})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Risk Metrics"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Standard Deviation:"}),s.jsx("span",{className:"font-medium",children:g(x.summary.standardDeviation)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Coefficient of Variation:"}),s.jsxs("span",{className:"font-medium",children:[(100*x.summary.coefficientOfVariation).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Value at Risk (5%):"}),s.jsx("span",{className:"font-medium",children:g(x.summary.valueRange.min)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Upside Potential:"}),s.jsx("span",{className:"font-medium",children:g(x.summary.valueRange.range)})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Scenario Returns"}),s.jsx("div",{className:"space-y-2 text-sm",children:x.scenarios.map(e=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:[e.name,":"]}),s.jsx("span",{className:"font-medium",children:"irr"===d.outputMetric?y(e.irr):"moic"===d.outputMetric?`${e.moic.toFixed(1)}x`:g(e[d.outputMetric])})]},e.id))})]})]})]}),!x&&s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(b,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Configure scenarios and run analysis to see results"})]})]})},Qe=({_data:t,_onDataChange:a})=>{const[r,i]=e.useState("income"),[l,n]=e.useState({revenue:[1e5,105e3,110250,115763,121551],costOfGoodsSold:[6e4,63e3,66150,69458,72931],grossProfit:[4e4,42e3,44100,46305,48620],operatingExpenses:[25e3,26250,27563,28941,30388],ebitda:[15e3,15750,16538,17364,18232],depreciation:[3e3,3150,3308,3473,3647],ebit:[12e3,12600,13230,13891,14585],interestExpense:[2e3,1800,1580,1340,1080],ebt:[1e4,10800,11650,12551,13505],taxes:[2100,2268,2447,2636,2836],netIncome:[7900,8532,9203,9915,10669],cash:[5e3,8532,12735,17650,23319],accountsReceivable:[8333,8750,9188,9647,10129],inventory:[1e4,10500,11025,11576,12155],totalCurrentAssets:[23333,27782,32948,38873,45603],ppe:[5e4,51850,53543,55070,56423],totalAssets:[73333,79632,86491,93943,102026],accountsPayable:[5e3,5250,5513,5789,6078],shortTermDebt:[3e3,2e3,1e3,0,0],totalCurrentLiabilities:[8e3,7250,6513,5789,6078],longTermDebt:[25e3,23e3,21e3,19e3,17e3],totalLiabilities:[33e3,30250,27513,24789,23078],shareholderEquity:[40333,49382,58978,69154,78948],totalLiabilitiesEquity:[73333,79632,86491,93943,102026],operatingCashFlow:[8567,10233,11345,12464,13584],capex:[-5e3,-4850,-5e3,-5e3,-5e3],investingCashFlow:[-5e3,-4850,-5e3,-5e3,-5e3],debtRepayment:[-2e3,-2e3,-2e3,-2e3,-2e3],financingCashFlow:[-2e3,-2e3,-2e3,-2e3,-2e3],netCashFlow:[1567,3383,4345,5464,6584],endingCash:[5e3,8383,12728,18192,24776]}),[o,c]=e.useState({revenueGrowthRate:.05,cogsPercentOfRevenue:.6,opexGrowthRate:.05,taxRate:.21,depreciationRate:.06,capexPercentOfRevenue:.05,debtPaydown:2e3}),[d,h]=e.useState([]),g=["Year 1","Year 2","Year 3","Year 4","Year 5"],b=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(1e3*e):"$0",[]),f=e.useCallback(()=>{const e={...l};for(let s=1;s<5;s++){e.revenue[s]=e.revenue[s-1]*(1+o.revenueGrowthRate),e.costOfGoodsSold[s]=e.revenue[s]*o.cogsPercentOfRevenue,e.grossProfit[s]=e.revenue[s]-e.costOfGoodsSold[s],e.operatingExpenses[s]=e.operatingExpenses[s-1]*(1+o.opexGrowthRate),e.ebitda[s]=e.grossProfit[s]-e.operatingExpenses[s],e.depreciation[s]=e.ppe[s-1]*o.depreciationRate,e.ebit[s]=e.ebitda[s]-e.depreciation[s],e.interestExpense[s]=.06*e.longTermDebt[s-1],e.ebt[s]=e.ebit[s]-e.interestExpense[s],e.taxes[s]=Math.max(0,e.ebt[s]*o.taxRate),e.netIncome[s]=e.ebt[s]-e.taxes[s];const t=e.revenue[s]*o.capexPercentOfRevenue;e.ppe[s]=e.ppe[s-1]+t-e.depreciation[s],e.longTermDebt[s]=Math.max(0,e.longTermDebt[s-1]-o.debtPaydown),e.shortTermDebt[s]=Math.max(0,e.shortTermDebt[s-1]-1e3),e.accountsReceivable[s]=.083*e.revenue[s],e.inventory[s]=.1*e.costOfGoodsSold[s],e.accountsPayable[s]=.05*e.costOfGoodsSold[s];const a=e.accountsReceivable[s]-e.accountsReceivable[s-1]+(e.inventory[s]-e.inventory[s-1])-(e.accountsPayable[s]-e.accountsPayable[s-1]);e.operatingCashFlow[s]=e.netIncome[s]+e.depreciation[s]-a,e.capex[s]=-t,e.investingCashFlow[s]=e.capex[s],e.debtRepayment[s]=-o.debtPaydown,e.financingCashFlow[s]=e.debtRepayment[s],e.netCashFlow[s]=e.operatingCashFlow[s]+e.investingCashFlow[s]+e.financingCashFlow[s],e.endingCash[s]=e.cash[s-1]+e.netCashFlow[s],e.cash[s]=e.endingCash[s],e.totalCurrentAssets[s]=e.cash[s]+e.accountsReceivable[s]+e.inventory[s],e.totalAssets[s]=e.totalCurrentAssets[s]+e.ppe[s],e.totalCurrentLiabilities[s]=e.accountsPayable[s]+e.shortTermDebt[s],e.totalLiabilities[s]=e.totalCurrentLiabilities[s]+e.longTermDebt[s],e.shareholderEquity[s]=e.totalAssets[s]-e.totalLiabilities[s],e.totalLiabilitiesEquity[s]=e.totalLiabilities[s]+e.shareholderEquity[s]}n(e);const t=[];for(let s=0;s<5;s++){Math.abs(e.totalAssets[s]-e.totalLiabilitiesEquity[s])>1&&t.push(`Balance sheet doesn't balance in ${g[s]}`)}h(t)},[l,o,g]),j=e.useCallback((e,t)=>{c(s=>({...s,[e]:parseFloat(t)||0}))},[]),v=[{id:"income",label:"Income Statement",icon:y},{id:"balance",label:"Balance Sheet",icon:$},{id:"cashflow",label:"Cash Flow",icon:I},{id:"assumptions",label:"Assumptions",icon:p}];return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(u,{className:"text-green-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"3-Statement Financial Model"}),s.jsx("p",{className:"text-gray-600",children:"Integrated Income Statement, Balance Sheet & Cash Flow"})]})]}),s.jsxs(le.button,{onClick:f,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(V,{size:16}),s.jsx("span",{children:"Recalculate"})]})]}),0===d.length?s.jsxs("div",{className:"mb-6 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center",children:[s.jsx(m,{className:"text-green-500 mr-2",size:20}),s.jsx("span",{className:"text-green-800 font-medium",children:"Model is balanced and consistent"})]}):s.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(x,{className:"text-red-500 mr-2",size:20}),s.jsx("h3",{className:"font-semibold text-red-800",children:"Validation Errors"})]}),s.jsx("ul",{className:"text-sm text-red-700",children:d.map((e,t)=>s.jsxs("li",{children:["• ",e]},t))})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:v.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>i(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(r===e.id?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),"income"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Income Statement ($000s)"}),g.map(e=>s.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:e},e))]})}),s.jsx("tbody",{children:[{label:"Revenue",key:"revenue"},{label:"Cost of Goods Sold",key:"costOfGoodsSold"},{label:"Gross Profit",key:"grossProfit"},{label:"Operating Expenses",key:"operatingExpenses"},{label:"EBITDA",key:"ebitda"},{label:"Depreciation",key:"depreciation"},{label:"EBIT",key:"ebit"},{label:"Interest Expense",key:"interestExpense"},{label:"EBT",key:"ebt"},{label:"Taxes",key:"taxes"},{label:"Net Income",key:"netIncome"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4 font-medium",children:e.label}),l[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key))})]})})}),"balance"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Balance Sheet ($000s)"}),g.map(e=>s.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:e},e))]})}),s.jsxs("tbody",{children:[s.jsx("tr",{className:"bg-gray-100",children:s.jsx("td",{colSpan:6,className:"py-2 px-4 font-semibold",children:"ASSETS"})}),[{label:"Cash",key:"cash"},{label:"Accounts Receivable",key:"accountsReceivable"},{label:"Inventory",key:"inventory"},{label:"Total Current Assets",key:"totalCurrentAssets"},{label:"PP&E",key:"ppe"},{label:"Total Assets",key:"totalAssets"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4",children:e.label}),l[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key)),s.jsx("tr",{className:"bg-gray-100",children:s.jsx("td",{colSpan:6,className:"py-2 px-4 font-semibold",children:"LIABILITIES & EQUITY"})}),[{label:"Accounts Payable",key:"accountsPayable"},{label:"Short-term Debt",key:"shortTermDebt"},{label:"Total Current Liabilities",key:"totalCurrentLiabilities"},{label:"Long-term Debt",key:"longTermDebt"},{label:"Total Liabilities",key:"totalLiabilities"},{label:"Shareholder Equity",key:"shareholderEquity"},{label:"Total Liab. & Equity",key:"totalLiabilitiesEquity"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4",children:e.label}),l[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key))]})]})})}),"cashflow"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Cash Flow Statement ($000s)"}),g.map(e=>s.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:e},e))]})}),s.jsx("tbody",{children:[{label:"Operating Cash Flow",key:"operatingCashFlow"},{label:"CapEx",key:"capex"},{label:"Investing Cash Flow",key:"investingCashFlow"},{label:"Debt Repayment",key:"debtRepayment"},{label:"Financing Cash Flow",key:"financingCashFlow"},{label:"Net Cash Flow",key:"netCashFlow"},{label:"Ending Cash",key:"endingCash"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4",children:e.label}),l[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key))})]})})}),"assumptions"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"Key Assumptions"}),s.jsx("div",{className:"space-y-3",children:[{label:"Revenue Growth Rate (%)",key:"revenueGrowthRate",isPercent:!0},{label:"COGS % of Revenue",key:"cogsPercentOfRevenue",isPercent:!0},{label:"OpEx Growth Rate (%)",key:"opexGrowthRate",isPercent:!0},{label:"Tax Rate (%)",key:"taxRate",isPercent:!0},{label:"CapEx % of Revenue",key:"capexPercentOfRevenue",isPercent:!0},{label:"Annual Debt Paydown ($000s)",key:"debtPaydown",isPercent:!1}].map(e=>s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e.label}),s.jsx("input",{type:"number",step:"0.01",value:e.isPercent?100*o[e.key]:o[e.key],onChange:t=>j(e.key,e.isPercent?(t.target.value||0)/100:t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]},e.key))})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"Model Metrics"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"5-Year Revenue CAGR:"}),s.jsxs("span",{className:"font-medium",children:[(100*(Math.pow(l.revenue[4]/l.revenue[0],1/4)-1)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"5-Year EBITDA CAGR:"}),s.jsxs("span",{className:"font-medium",children:[(100*(Math.pow(l.ebitda[4]/l.ebitda[0],1/4)-1)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Exit EBITDA Margin:"}),s.jsxs("span",{className:"font-medium",children:[(l.ebitda[4]/l.revenue[4]*100).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Exit Debt/EBITDA:"}),s.jsxs("span",{className:"font-medium",children:[(l.longTermDebt[4]/l.ebitda[4]).toFixed(1),"x"]})]})]})]})]})})]})},Je=({data:a,onDataChange:r,onAdjustedValuesChange:i})=>{const[l,n]=e.useState("incomeStatement"),[o,c]=e.useState({});ke("spreadsheet");const[d,m]=e.useState({revenue:!0,costOfGoodsSold:!0,operatingExpenses:!0,salariesBenefits:!0,grossProfit:!0,operatingIncome:!0,incomeBeforeTax:!0,otherIncomeExpense:!0,currentAssets:!0,nonCurrentAssets:!0,currentLiabilities:!0,nonCurrentLiabilities:!0,equity:!0,operatingActivities:!0,investingActivities:!0,financingActivities:!0}),[x,h]=e.useState(null),[g,b]=e.useState(""),f=e.useRef(null);e.useEffect(()=>{if(a?.statements?.incomeStatement&&0===Object.keys(o).length){const e={},t=a.statements.incomeStatement;Object.keys(t).forEach(s=>{t[s]&&void 0!==t[s][2]&&(e[s]=t[s][2])}),c(e),i&&i(e)}},[a,o,i]);const j={revenue:{title:"Revenue",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"energyDevices",label:"Energy Devices",level:1},{key:"injectables",label:"Injectables",level:1},{key:"wellness",label:"Wellness",level:1},{key:"weightloss",label:"Weightloss",level:1},{key:"retailSales",label:"Retail Sales",level:1},{key:"surgery",label:"Surgery",level:1},{key:"totalRevenue",label:"Total Revenue",level:0,bold:!0,formula:!0}]},costOfGoodsSold:{title:"Cost of Goods Sold",color:"bg-red-50 border-red-300",headerBg:"bg-red-600",textColor:"text-red-900",items:[{key:"energyDeviceSupplies",label:"Energy Device Supplies",level:1},{key:"injectablesCogs",label:"Injectables",level:1},{key:"wellnessCogs",label:"Wellness",level:1},{key:"weightlossCogs",label:"Weightloss",level:1},{key:"retailProducts",label:"Retail Products",level:1},{key:"surgicalSupplies",label:"Surgical Supplies",level:1},{key:"totalCostOfGoodsSold",label:"Total Cost of Goods Sold",level:0,bold:!0,formula:!0}]},grossProfit:{title:"Gross Profit",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"grossProfit",label:"Gross Profit",level:0,bold:!0,formula:!0}]},salariesBenefits:{title:"Salaries & Benefits",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"employeeBenefits",label:"Employee Benefits",level:1},{key:"payroll",label:"Payroll",level:1},{key:"payrollTaxes",label:"Payroll Taxes",level:1},{key:"totalSalariesBenefits",label:"Total Salaries & Benefits",level:0,bold:!0,formula:!0}]},operatingExpenses:{title:"Operating Expenses",color:"bg-orange-50 border-orange-300",headerBg:"bg-orange-600",textColor:"text-orange-900",items:[{key:"marketing",label:"Marketing",level:1},{key:"automobile",label:"Automobile",level:1},{key:"creditCardBankCharges",label:"Credit Card and Bank Charges",level:1},{key:"donations",label:"Donations",level:1},{key:"computerTelephoneUtilities",label:"Computer, Telephone, and Utilities",level:1},{key:"depreciation",label:"Depreciation",level:1},{key:"duesSubscriptions",label:"Dues & Subscriptions",level:1},{key:"education",label:"Education",level:1},{key:"equipmentRental",label:"Equipment Rental",level:1},{key:"insurance",label:"Insurance",level:1},{key:"interestExpense",label:"Interest Expense",level:1},{key:"travelMealsEntertainment",label:"Travel, Meals, and Entertainment",level:1},{key:"rent",label:"Rent",level:1},{key:"officeExpenses",label:"Office Expenses",level:1},{key:"professionalFees",label:"Professional Fees",level:1},{key:"repairsMaintenance",label:"Repairs & Maintenance",level:1},{key:"localTax",label:"Local Tax",level:1},{key:"stateTax",label:"State Tax",level:1},{key:"totalOperatingExpense",label:"Total Operating Expense",level:0,bold:!0,formula:!0}]},operatingIncome:{title:"Operating Income",color:"bg-teal-50 border-teal-300",headerBg:"bg-teal-600",textColor:"text-teal-900",items:[{key:"operatingIncome",label:"Operating Income",level:0,bold:!0}]},otherIncomeExpense:{title:"Other Income / (Expense)",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-600",textColor:"text-slate-900",items:[{key:"gainOnAssetSale",label:"Gain (Loss) On Asset Sale",level:1},{key:"interestIncome",label:"Interest Income",level:1},{key:"otherExpenses",label:"Other Expenses",level:1},{key:"totalOtherIncomeExpense",label:"Total Other Income / (Expenses)",level:0,bold:!0,formula:!0}]},incomeBeforeTax:{title:"Net Income Before Taxes",color:"bg-amber-50 border-amber-300",headerBg:"bg-amber-600",textColor:"text-amber-900",items:[{key:"incomeBeforeTax",label:"Net Income Before Taxes",level:0,bold:!0}]}},v={currentAssets:{title:"Current Assets",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"cash",label:"Cash and Cash Equivalents",level:1},{key:"receivables",label:"Accounts Receivable",level:1},{key:"inventory",label:"Inventory",level:1},{key:"prepaidExpenses",label:"Prepaid Expenses",level:1},{key:"otherCurrentAssets",label:"Other Current Assets",level:1},{key:"totalCurrentAssets",label:"Total Current Assets",level:0,formula:!0,bold:!0}]},nonCurrentAssets:{title:"Non-Current Assets",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"ppe",label:"Property, Plant & Equipment",level:1},{key:"accumulatedDepreciation",label:"Less: Accumulated Depreciation",level:1},{key:"netPPE",label:"Net Property, Plant & Equipment",level:1,formula:!0},{key:"intangibleAssets",label:"Intangible Assets",level:1},{key:"goodwill",label:"Goodwill",level:1},{key:"otherNonCurrentAssets",label:"Other Non-Current Assets",level:1},{key:"totalNonCurrentAssets",label:"Total Non-Current Assets",level:0,formula:!0,bold:!0}]},totalAssets:{title:"Total Assets",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalAssets",label:"Total Assets",level:0,formula:!0,bold:!0}]},currentLiabilities:{title:"Current Liabilities",color:"bg-red-50 border-red-300",headerBg:"bg-red-600",textColor:"text-red-900",items:[{key:"accountsPayable",label:"Accounts Payable",level:1},{key:"accruedExpenses",label:"Accrued Expenses",level:1},{key:"shortTermDebt",label:"Short-term Debt",level:1},{key:"currentPortionLongTermDebt",label:"Current Portion of Long-term Debt",level:1},{key:"otherCurrentLiabilities",label:"Other Current Liabilities",level:1},{key:"totalCurrentLiabilities",label:"Total Current Liabilities",level:0,formula:!0,bold:!0}]},nonCurrentLiabilities:{title:"Non-Current Liabilities",color:"bg-orange-50 border-orange-300",headerBg:"bg-orange-600",textColor:"text-orange-900",items:[{key:"longTermDebt",label:"Long-term Debt",level:1},{key:"deferredTaxLiabilities",label:"Deferred Tax Liabilities",level:1},{key:"otherNonCurrentLiabilities",label:"Other Non-Current Liabilities",level:1},{key:"totalNonCurrentLiabilities",label:"Total Non-Current Liabilities",level:0,formula:!0,bold:!0}]},totalLiabilities:{title:"Total Liabilities",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalLiabilities",label:"Total Liabilities",level:0,formula:!0,bold:!0}]},equity:{title:"Shareholders' Equity",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"commonStock",label:"Common Stock",level:1},{key:"retainedEarnings",label:"Retained Earnings",level:1},{key:"otherEquity",label:"Other Comprehensive Income",level:1},{key:"totalEquity",label:"Total Shareholders' Equity",level:0,formula:!0,bold:!0}]},totalLiabilitiesEquity:{title:"Total Liabilities and Equity",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalLiabilitiesEquity",label:"Total Liabilities and Shareholders' Equity",level:0,formula:!0,bold:!0}]}},N={operatingActivities:{title:"Operating Activities",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"netIncome",label:"Net Income",level:1},{key:"depreciation",label:"Depreciation and Amortization",level:1},{key:"receivablesChange",label:"Change in Accounts Receivable",level:1},{key:"inventoryChange",label:"Change in Inventory",level:1},{key:"payablesChange",label:"Change in Accounts Payable",level:1},{key:"otherOperatingChanges",label:"Other Operating Changes",level:1},{key:"netCashFromOperating",label:"Net Cash from Operating Activities",level:0,formula:!0,bold:!0}]},investingActivities:{title:"Investing Activities",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"capex",label:"Capital Expenditures",level:1},{key:"acquisitions",label:"Acquisitions",level:1},{key:"assetSales",label:"Asset Sales",level:1},{key:"otherInvestingActivities",label:"Other Investing Activities",level:1},{key:"netCashFromInvesting",label:"Net Cash from Investing Activities",level:0,formula:!0,bold:!0}]},financingActivities:{title:"Financing Activities",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"debtIssuance",label:"Debt Issuance",level:1},{key:"debtRepayment",label:"Debt Repayment",level:1},{key:"equityIssuance",label:"Equity Issuance",level:1},{key:"dividends",label:"Dividends Paid",level:1},{key:"otherFinancingActivities",label:"Other Financing Activities",level:1},{key:"netCashFromFinancing",label:"Net Cash from Financing Activities",level:0,formula:!0,bold:!0}]},netCashFlow:{title:"Net Cash Flow",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"netCashFlow",label:"Net Change in Cash",level:0,formula:!0,bold:!0},{key:"beginningCash",label:"Cash at Beginning of Period",level:1},{key:"endingCash",label:"Cash at End of Period",level:0,formula:!0,bold:!0}]}},w=(()=>{switch(l){case"balanceSheet":return v;case"cashFlow":return N;default:return j}})(),C=(e,t,s=!1)=>{h({rowKey:e,periodIndex:t,isAdjusted:s});let r="";r=s?o[e]||"":a.statements.incomeStatement[e]?.[t]||"",b(r.toString())},k=()=>{if(x){const{rowKey:e,periodIndex:t,isAdjusted:s}=x,l=parseFloat(g)||0;if(s){const t={...o,[e]:l};c(t),i&&i(t)}else{const s={...a};s.statements.incomeStatement[e]||(s.statements.incomeStatement[e]={}),s.statements.incomeStatement[e][t]=l,r(s)}h(null),b("")}},S=e=>{"Enter"===e.key?(e.preventDefault(),k()):"Escape"===e.key?(e.preventDefault(),h(null),b("")):"Tab"===e.key&&(e.preventDefault(),k())},R=e=>/^-?\d*\.?\d*$/.test(e)||""===e,M=e=>{if(!e&&0!==e)return"";const t="string"==typeof e?parseFloat(e):e;if(isNaN(t))return"";const s=Math.abs(t);let a;return s>=1e6?(a=new Intl.NumberFormat("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}).format(t/1e6),a+="M"):a=s>=1e3?new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(t):new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t),a};e.useEffect(()=>{x&&f.current&&(f.current.focus(),f.current.select())},[x]);return s.jsxs("div",{className:"bg-slate-900 rounded-lg shadow-lg",children:[s.jsx("div",{className:"p-4 sm:p-6 border-b border-slate-700",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:"Financial Statements"}),s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 flex-wrap",children:[s.jsxs("button",{onClick:()=>{const e=prompt('Enter period label (e.g., "Year 5"):');if(e){const t={...a};t.periods=[...t.periods,e],r(t)}},className:"px-3 py-2 sm:px-4 sm:py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium text-sm sm:text-base",children:[s.jsx(q,{size:14,className:"sm:w-4 sm:h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Add Period"}),s.jsx("span",{className:"sm:hidden",children:"Add"})]}),s.jsxs("select",{value:l,onChange:e=>n(e.target.value),className:"px-3 py-2 sm:px-4 sm:py-2.5 bg-white border border-slate-300 rounded-lg text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium shadow-sm text-sm sm:text-base",children:[s.jsx("option",{value:"incomeStatement",children:"Income Statement"}),s.jsx("option",{value:"balanceSheet",children:"Balance Sheet"}),s.jsx("option",{value:"cashFlow",children:"Cash Flow Statement"})]})]})]})}),s.jsxs("div",{className:"max-w-full mx-auto p-4 sm:p-6 lg:p-8",children:[s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 shadow-lg",children:s.jsx("div",{className:"overflow-x-auto scrollbar-thin scrollbar-thumb-slate-300 scrollbar-track-slate-100",children:s.jsxs("table",{className:"w-full",role:"table","aria-label":`Financial ${"incomeStatement"===l?"Income Statement":"balanceSheet"===l?"Balance Sheet":"Cash Flow Statement"} with editable cells`,children:[s.jsxs("thead",{className:"bg-gradient-to-r from-slate-800 to-slate-900 text-white",children:[s.jsx("tr",{className:"sr-only",children:s.jsx("td",{colSpan:a.periods.length+4,children:s.jsx("div",{className:"p-2 text-sm",children:"Financial spreadsheet table. Use arrow keys to navigate between cells. Press Enter or Space to edit values. Press Tab to move to next editable cell. Formula cells are calculated automatically and cannot be edited."})})}),s.jsxs("tr",{role:"row",children:[s.jsx("th",{className:"min-w-[320px] px-6 py-4 text-left text-sm font-semibold tracking-wider",scope:"col",id:"account-header","aria-label":"Financial account descriptions and line items",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{size:16,className:"text-slate-300"}),"Account Description"]})}),s.jsx("th",{className:"w-20 px-4 py-4 text-center text-sm font-semibold",scope:"col",id:"units-header","aria-label":"Units of measurement, typically thousands of dollars",children:"Units"}),a.periods.map((e,t)=>s.jsx("th",{className:"min-w-[140px] px-4 py-4 text-center text-sm font-semibold",scope:"col",id:`period-${t}-header`,"aria-label":`Financial data for ${e}, actual values, editable`,children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{children:e}),s.jsx("span",{className:"text-xs text-slate-300 font-normal",children:"Actual"})]})},t)),s.jsx("th",{className:"min-w-[140px] px-4 py-4 text-center text-sm font-semibold bg-gradient-to-r from-amber-600 to-yellow-600 border-l-2 border-amber-400",scope:"col",id:"adjusted-header","aria-label":"Adjusted financial values, user-modified scenarios and projections, editable",children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{children:"Adjusted"}),s.jsx("span",{className:"text-xs text-amber-100 font-normal",children:"Modified"})]})}),s.jsx("th",{className:"w-28 px-4 py-4 text-center text-sm font-semibold",scope:"col",id:"type-header","aria-label":"Cell type: manual entry or automatic calculation",children:s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx(p,{size:14}),"Type"]})})]})]}),s.jsx("tbody",{className:"divide-y divide-slate-100",children:Object.entries(w).map(([e,i])=>s.jsxs(t.Fragment,{children:[s.jsx("tr",{className:`${i.headerBg||"bg-slate-600"} border-b-2 border-slate-300`,role:"rowheader","aria-label":`${i.title} section header`,children:s.jsx("td",{colSpan:a.periods.length+4,className:"py-4 px-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-white w-full text-left group",children:[s.jsxs("button",{onClick:()=>(e=>{m(t=>({...t,[e]:!t[e]}))})(e),className:"flex items-center gap-3 text-white hover:text-slate-200 transition-colors flex-1",children:[s.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-white/20 group-hover:bg-white/30 transition-colors",children:d[e]?s.jsx(D,{size:14}):s.jsx(P,{size:14})}),s.jsx("span",{className:"font-bold text-lg",children:i.title})]}),s.jsx("button",{onClick:e=>{e.stopPropagation(),(()=>{if(prompt("Enter row label:")){const e={...a};r(e)}})()},className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"Add custom row",children:s.jsx(q,{size:16})})]})})}),d[e]&&i.items.map(e=>(e=>{const{key:t,label:r,level:i,formula:l,bold:n}=e,c=1===i?"pl-8":2===i?"pl-12":"pl-4",d=n?"font-bold":0===i?"font-semibold":"font-medium",m=0===i?"text-slate-900":"text-slate-700",u=0===i?"bg-slate-50/70":"bg-white",y=0===i?"border-slate-200":"border-slate-100",j=0===i?`${r}, total or summary line item${l?", calculated automatically":""}`:`${r}, detail line item${l?", calculated automatically":", editable"}`;return s.jsxs("tr",{className:`${u} border-b ${y} hover:bg-slate-50 transition-all duration-150 group`,role:"row","aria-label":j,children:[s.jsxs("td",{className:`px-6 py-4 ${c} ${d} text-sm ${m}`,scope:0===i?"rowgroup":"row",headers:"account-header","aria-describedby":l?"formula-description":"manual-description",children:[s.jsx("div",{id:"formula-description",className:"sr-only",children:"This is an automatically calculated field based on other line items"}),s.jsx("div",{id:"manual-description",className:"sr-only",children:"This field can be edited by clicking or pressing Enter"}),s.jsxs("div",{className:"flex items-center gap-3",children:[0===i&&s.jsx("div",{className:"w-1.5 h-4 bg-gradient-to-b from-blue-500 to-blue-600 rounded-full flex-shrink-0 shadow-sm"}),s.jsx("span",{className:"leading-tight",children:r}),l&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(p,{size:14,className:"text-blue-500/80 flex-shrink-0"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium px-1.5 py-0.5 bg-blue-50 rounded-md",children:"AUTO"})]})]})]}),s.jsx("td",{className:"px-4 py-4 text-center",headers:"units-header","aria-label":"Values are in thousands of dollars",children:s.jsx("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-100 px-2 py-1 rounded-md",children:"$ 000s"})}),a.periods.map((e,i)=>{const n=a.statements.incomeStatement[t]?.[i],o=M(n),c=`${r} for ${e}: ${o||"no value"} thousand dollars${l?", calculated automatically":", click to edit"}`;return s.jsx("td",{className:"px-4 py-4 text-right",headers:`period-${i}-header account-header`,"aria-label":c,children:x?.rowKey!==t||x?.periodIndex!==i||x?.isAdjusted?s.jsxs("div",{onClick:()=>!l&&C(t,i),className:"px-3 py-2.5 rounded-lg font-mono text-sm transition-all duration-200 min-h-[40px] flex items-center justify-end "+(l?"bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800 font-semibold border border-blue-200 shadow-sm":"hover:bg-slate-100 text-slate-800 cursor-pointer border border-transparent hover:border-slate-200 hover:shadow-sm group-hover:bg-slate-50"),role:l?"cell":"button",tabIndex:l?-1:0,"aria-label":c,"aria-readonly":l,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||l||(e.preventDefault(),C(t,i))},children:[s.jsx("span",{className:l?"text-blue-900":"text-slate-700",children:M(a.statements.incomeStatement[t]?.[i])||"—"}),!l&&s.jsx(W,{size:12,className:"ml-2 opacity-0 group-hover:opacity-40 text-slate-400 transition-opacity"})]}):s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:f,type:"text",value:n,onChange:e=>{const t=e.target.value;R(t)&&b(t)},onBlur:k,onKeyDown:S,className:"w-full px-3 py-2.5 bg-white border-2 border-blue-400 rounded-lg text-slate-900 text-right font-mono text-sm focus:outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-500 shadow-lg",placeholder:"0.00"}),s.jsxs("div",{className:"absolute -top-2 -right-2 flex gap-1",children:[s.jsx("button",{onClick:k,className:"w-5 h-5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"✓"}),s.jsx("button",{onClick:()=>{h(null),b("")},className:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"×"})]})]})},i)}),s.jsx("td",{className:"px-4 py-4 text-right bg-gradient-to-r from-amber-50 to-yellow-50 border-l-2 border-amber-300",headers:"adjusted-header account-header","aria-label":`${r} adjusted value: ${M(o[t]||0)||"no value"} thousand dollars${l?", calculated automatically":", click to edit"}`,children:x?.rowKey===t&&x?.isAdjusted?s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:f,type:"text",value:g,onChange:e=>{const t=e.target.value;R(t)&&b(t)},onBlur:k,onKeyDown:S,className:"w-full px-3 py-2.5 bg-white border-2 border-amber-400 rounded-lg text-slate-900 text-right font-mono text-sm focus:outline-none focus:ring-4 focus:ring-amber-100 focus:border-amber-500 shadow-lg",placeholder:"0.00"}),s.jsxs("div",{className:"absolute -top-2 -right-2 flex gap-1",children:[s.jsx("button",{onClick:k,className:"w-5 h-5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"✓"}),s.jsx("button",{onClick:()=>{h(null),b("")},className:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"×"})]})]}):s.jsxs("div",{onClick:()=>!l&&C(t,null,!0),className:"px-3 py-2.5 rounded-lg font-mono text-sm transition-all duration-200 min-h-[40px] flex items-center justify-end "+(l?"bg-gradient-to-r from-amber-100 to-yellow-100 text-amber-800 font-semibold border border-amber-300 shadow-sm":"hover:bg-amber-100 text-slate-800 cursor-pointer border border-transparent hover:border-amber-300 hover:shadow-sm"),role:l?"cell":"button",tabIndex:l?-1:0,"aria-label":`${r} adjusted value: ${M(o[t]||0)||"no value"} thousand dollars${l?", calculated automatically":", click to edit"}`,"aria-readonly":l,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||l||(e.preventDefault(),C(t,null,!0))},children:[s.jsx("span",{className:l?"text-amber-900":"text-slate-700",children:M(o[t]||0)||"—"}),!l&&s.jsx(W,{size:12,className:"ml-2 opacity-0 group-hover:opacity-40 text-amber-500 transition-opacity"})]})}),s.jsx("td",{className:"px-4 py-4 text-center",headers:"type-header","aria-label":`${r} is ${l?"automatically calculated":"manually editable"}`,children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium "+(l?"bg-blue-100 text-blue-800 border border-blue-200":"bg-slate-100 text-slate-700 border border-slate-200"),children:l?s.jsxs(s.Fragment,{children:[s.jsx(p,{size:10,className:"mr-1"}),"Auto"]}):s.jsxs(s.Fragment,{children:[s.jsx(W,{size:10,className:"mr-1"}),"Manual"]})})}),s.jsx("td",{className:"px-4 py-4 text-center",headers:"type-header","aria-label":`${r} is ${l?"automatically calculated":"manually editable"}`,children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium "+(l?"bg-blue-100 text-blue-800 border border-blue-200":"bg-slate-100 text-slate-700 border border-slate-200"),children:l?s.jsxs(s.Fragment,{children:[s.jsx(p,{size:10,className:"mr-1"}),"Auto"]}):s.jsxs(s.Fragment,{children:[s.jsx(W,{size:10,className:"mr-1"}),"Manual"]})})})]},t)})(e))]},e))})]})})}),s.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl p-6 border border-slate-200 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(p,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h3",{className:"font-bold text-slate-900",children:"How to Use"})]}),s.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Click any editable cell to modify values with enhanced input controls"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Use Enter to save changes or Escape to cancel editing"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Expand/collapse sections using the arrow controls"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Formula cells automatically calculate based on inputs"]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl p-6 border border-slate-200 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(y,{className:"w-5 h-5 text-green-600"})}),s.jsx("h3",{className:"font-bold text-slate-900",children:"Professional Features"})]}),s.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Color-coded sections for easy visual navigation"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Adjusted column for scenario analysis and modifications"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Professional number formatting with proper alignment"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Enhanced editing experience with save/cancel controls"]})]})]})]})]})]})},Xe=({dcfData:t,sensitivityData:a,scenarioData:r,formatCurrency:i,formatPercent:l})=>{const[n,o]=e.useState("dcf-waterfall"),[c,d]=e.useState(!0),m=[{id:"dcf-waterfall",label:"DCF Waterfall",icon:b,category:"dcf"},{id:"cashflow-trend",label:"Cash Flow Trend",icon:y,category:"dcf"},{id:"sensitivity-tornado",label:"Sensitivity Tornado",icon:I,category:"sensitivity"},{id:"scenario-distribution",label:"Scenario Distribution",icon:E,category:"scenario"},{id:"valuation-bridge",label:"Valuation Bridge",icon:b,category:"combined"}],x=e.useMemo(()=>{if(!t?.years)return[];let e=0;const s=[];t.years.forEach((t,a)=>{const r=e;e+=t.presentValue,s.push({name:`Year ${t.year}`,value:t.presentValue,cumulative:e,start:r,freeCashFlow:t.freeCashFlow,category:"operations"})});const a=e;return e+=t.presentValueTerminal,s.push({name:"Terminal Value",value:t.presentValueTerminal,cumulative:e,start:a,category:"terminal"}),s},[t]),u=e.useMemo(()=>t?.years?t.years.map((e,t)=>({year:`Year ${e.year}`,freeCashFlow:e.freeCashFlow,presentValue:e.presentValue,revenue:e.revenue,operatingIncome:e.operatingIncome,workingCapitalChange:e.workingCapitalChange,capex:Math.abs(e.capex)})):[],[t]),h=e.useMemo(()=>a?Object.entries(a).map(([e,t])=>{const s=Math.max(...t.dataPoints.map(e=>e.changeFromBase)),a=Math.min(...t.dataPoints.map(e=>e.changeFromBase));return{variable:t.definition.name,upside:s,downside:Math.abs(a),range:s-a}}).sort((e,t)=>t.range-e.range):[],[a]),p=e.useMemo(()=>r?.length?r.map((e,t)=>({name:e.name,value:e.enterpriseValue,probability:e.probability,weightedValue:e.weightedValue,fill:`hsl(${137.5*t%360}, 70%, 50%)`})):[],[r]),g=({active:e,payload:t,label:a,chartType:r})=>{if(!e||!t||!t.length)return null;return s.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[s.jsx("p",{className:"font-medium text-gray-800",children:a}),t.map((e,t)=>{return s.jsx("p",{style:{color:e.color},className:"text-sm",children:`${e.dataKey}: ${a=e.value,r=e.dataKey,r?.includes("Percent")||r?.includes("Rate")?l(a):i(a)}`},t);var a,r})]})},f=()=>s.jsx(oe,{width:"100%",height:400,children:s.jsxs(pe,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"name"}),s.jsx(xe,{tickFormatter:e=>i(e)}),s.jsx(ue,{content:s.jsx(g,{chartType:"waterfall"})}),s.jsx(ge,{dataKey:"value",fill:"#3B82F6"})]})}),j=()=>s.jsx(oe,{width:"100%",height:400,children:s.jsxs(ce,{data:u,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"year"}),s.jsx(xe,{tickFormatter:e=>i(e)}),s.jsx(ue,{content:s.jsx(g,{chartType:"trend"})}),s.jsx(je,{}),s.jsx(he,{type:"monotone",dataKey:"freeCashFlow",stroke:"#10B981",strokeWidth:3,name:"Free Cash Flow"}),s.jsx(he,{type:"monotone",dataKey:"presentValue",stroke:"#3B82F6",strokeWidth:2,name:"Present Value"}),s.jsx(he,{type:"monotone",dataKey:"revenue",stroke:"#8B5CF6",strokeWidth:2,name:"Revenue"})]})}),v=()=>s.jsx(oe,{width:"100%",height:400,children:s.jsxs(pe,{data:h,layout:"horizontal",margin:{top:20,right:30,left:100,bottom:5},children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{type:"number",tickFormatter:e=>`${e.toFixed(1)}%`}),s.jsx(xe,{type:"category",dataKey:"variable"}),s.jsx(ue,{formatter:(e,t)=>[`${e.toFixed(1)}%`,t],labelFormatter:e=>`Variable: ${e}`}),s.jsx(ge,{dataKey:"upside",fill:"#10B981",name:"Upside Impact"}),s.jsx(ge,{dataKey:"downside",fill:"#EF4444",name:"Downside Impact"})]})}),N=()=>s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsx(oe,{width:"100%",height:300,children:s.jsxs(be,{children:[s.jsx(ye,{data:p,cx:"50%",cy:"50%",outerRadius:80,dataKey:"probability",label:({name:e,probability:t})=>`${e}: ${t}%`,children:p.map((e,t)=>s.jsx(fe,{fill:e.fill},`cell-${t}`))}),s.jsx(ue,{formatter:e=>`${e}%`})]})}),s.jsx(oe,{width:"100%",height:300,children:s.jsxs(pe,{data:p,children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"name"}),s.jsx(xe,{tickFormatter:e=>i(e)}),s.jsx(ue,{content:s.jsx(g,{chartType:"scenario"})}),s.jsx(ge,{dataKey:"value",fill:"#8B5CF6",name:"Enterprise Value"})]})})]}),w=()=>{const e=[{name:"PV of Operations",value:t?.cumulativePV||0,type:"positive"},{name:"PV of Terminal",value:t?.presentValueTerminal||0,type:"positive"},{name:"Enterprise Value",value:t?.enterpriseValue||0,type:"total"}];return s.jsx(oe,{width:"100%",height:400,children:s.jsxs(pe,{data:e,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"name"}),s.jsx(xe,{tickFormatter:e=>i(e)}),s.jsx(ue,{content:s.jsx(g,{chartType:"bridge"})}),s.jsx(ge,{dataKey:"value",fill:e=>"total"===e.type?"#1F2937":"#3B82F6"})]})})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(b,{size:20}),"Data Visualization"]}),s.jsx("p",{className:"text-gray-600",children:"Interactive charts and graphs to visualize valuation results and sensitivity analysis."})]}),s.jsxs("button",{onClick:()=>d(!c),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 "+(c?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:[c?s.jsx(K,{size:14}):s.jsx(S,{size:14}),c?"Hide Details":"Show Details"]})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:m.map(e=>{const t=e.icon;return s.jsxs(le.button,{onClick:()=>o(e.id),className:"p-3 rounded-lg border-2 transition-all text-center "+(n===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(t,{size:20,className:"mx-auto mb-2"}),s.jsx("div",{className:"text-xs font-medium",children:e.label})]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h4",{className:"font-semibold text-lg",children:m.find(e=>e.id===n)?.label}),c&&s.jsx("span",{className:"text-sm text-gray-500",children:(()=>{switch(n){case"dcf-waterfall":return"Shows the contribution of each year's cash flows and terminal value to total enterprise value.";case"cashflow-trend":return"Displays the trend of free cash flows, present values, and key financial metrics over time.";case"sensitivity-tornado":return"Illustrates how changes in key variables impact enterprise value, ranked by sensitivity.";case"scenario-distribution":return"Compares different scenarios by probability weights and resulting enterprise values.";case"valuation-bridge":return"Breaks down enterprise value into operating value and terminal value components.";default:return""}})()})]}),s.jsx("div",{className:"min-h-[400px]",children:(()=>{switch(n){case"dcf-waterfall":default:return s.jsx(f,{});case"cashflow-trend":return s.jsx(j,{});case"sensitivity-tornado":return s.jsx(v,{});case"scenario-distribution":return s.jsx(N,{});case"valuation-bridge":return s.jsx(w,{})}})()})]}),c&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Key Insights"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:["dcf-waterfall"===n&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Operations Contribution"}),s.jsx("div",{className:"text-lg font-bold text-blue-800",children:t?.cumulativePV?`${(t.cumulativePV/t.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),s.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Terminal Contribution"}),s.jsx("div",{className:"text-lg font-bold text-purple-800",children:t?.presentValueTerminal?`${(t.presentValueTerminal/t.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Avg. Annual FCF"}),s.jsx("div",{className:"text-lg font-bold text-green-800",children:t?.freeCashFlows?i(t.freeCashFlows.reduce((e,t)=>e+t,0)/t.freeCashFlows.length):"N/A"})]})]}),"sensitivity-tornado"===n&&h.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Highest Risk Variable"}),s.jsx("div",{className:"text-lg font-bold text-red-800",children:h[0]?.variable}),s.jsxs("div",{className:"text-sm text-red-600",children:["±",h[0]?.range.toFixed(1),"% impact"]})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-yellow-600 font-medium",children:"Medium Risk Variables"}),s.jsx("div",{className:"text-lg font-bold text-yellow-800",children:h.slice(1,3).map(e=>e.variable).join(", ")})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Lowest Risk Variable"}),s.jsx("div",{className:"text-lg font-bold text-green-800",children:h[h.length-1]?.variable})]})]})]})]})]})},Ze=({modelInputs:t,onModelInputChange:a,formatPercent:r})=>{const[i,l]=e.useState(!0),[n,o]=e.useState("inputs"),d=t.dcf.wacc||{riskFreeRate:4.5,marketRiskPremium:6,beta:1.2,smallCompanyPremium:3,companySpecificRisk:2,debtInterestRate:6.5,taxRate:25,marketValueEquity:1e5,marketValueDebt:3e4,buildUpMethod:{riskFreeRate:4.5,equityRiskPremium:6,sizeRiskPremium:3,industryRiskPremium:2,companySpecificRisk:2},industryWACC:10.5,industryBeta:1.1,industryDebtEquityRatio:.3},m=e.useMemo(()=>{const e={...d,...t.dcf.wacc},s=e.riskFreeRate+e.beta*e.marketRiskPremium+e.smallCompanyPremium+e.companySpecificRisk,a=e.buildUpMethod.riskFreeRate+e.buildUpMethod.equityRiskPremium+e.buildUpMethod.sizeRiskPremium+e.buildUpMethod.industryRiskPremium+e.buildUpMethod.companySpecificRisk,r=e.debtInterestRate*(1-e.taxRate/100),i=e.marketValueEquity+e.marketValueDebt,l=e.marketValueEquity/i,n=e.marketValueDebt/i,o=s/100*l+r/100*n,c=a/100*l+r/100*n;return{costOfEquityCAPM:s,costOfEquityBuildUp:a,costOfDebtAfterTax:r,equityWeight:100*l,debtWeight:100*n,waccCAPM:100*o,waccBuildUp:100*c,finalWACC:100*((o+c)/2),totalCapital:i,debtToEquityRatio:e.marketValueDebt/e.marketValueEquity}},[d,t.dcf.wacc]),x=(e,s)=>{const r={...d,...t.dcf.wacc,[e]:parseFloat(s)||0};a("dcf","wacc",r)},u=[{id:"inputs",label:"Inputs",icon:B},{id:"calculation",label:"Calculation",icon:p},{id:"benchmarks",label:"Benchmarks",icon:y}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(p,{size:20}),"WACC Calculator"]}),s.jsx("p",{className:"text-gray-600",children:"Professional weighted average cost of capital calculation using CAPM and build-up methods."})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{return e=m.finalWACC,void a("dcf","discountRate",e);var e},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Apply to DCF"}),s.jsx("button",{onClick:()=>l(!i),className:"px-3 py-2 rounded-lg text-sm transition-colors "+(i?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-600"),children:i?"Hide Details":"Show Details"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(le.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(f,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"FINAL WACC"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-800",children:r(m.finalWACC)}),s.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Risk-adjusted average"})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(y,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"COST OF EQUITY"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:r(m.costOfEquityCAPM)}),s.jsx("div",{className:"text-sm text-green-600 mt-1",children:"CAPM method"})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(g,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"COST OF DEBT"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-800",children:r(m.costOfDebtAfterTax)}),s.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"After-tax"})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(c,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"DEBT/EQUITY"})]}),s.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[m.debtToEquityRatio.toFixed(2),"x"]}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Capital structure"})]})]}),s.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:u.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>o(e.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(n===e.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[s.jsx(t,{size:16}),e.label]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["inputs"===n&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"WACC Input Parameters"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"Cost of Equity (CAPM Method)"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"riskFreeRate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Risk-Free Rate (%)"}),s.jsx("input",{id:"riskFreeRate",type:"number",step:"0.1",value:t.dcf.wacc?.riskFreeRate||d.riskFreeRate,onChange:e=>x("riskFreeRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"10-year Treasury rate"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketRiskPremium",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Risk Premium (%)"}),s.jsx("input",{id:"marketRiskPremium",type:"number",step:"0.1",value:t.dcf.wacc?.marketRiskPremium||d.marketRiskPremium,onChange:e=>x("marketRiskPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Expected market return - risk-free rate"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"beta",className:"block text-sm font-medium text-gray-700 mb-1",children:"Beta (β)"}),s.jsx("input",{id:"beta",type:"number",step:"0.1",value:t.dcf.wacc?.beta||d.beta,onChange:e=>x("beta",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Systematic risk relative to market"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"smallCompanyPremium",className:"block text-sm font-medium text-gray-700 mb-1",children:"Small Company Premium (%)"}),s.jsx("input",{id:"smallCompanyPremium",type:"number",step:"0.1",value:t.dcf.wacc?.smallCompanyPremium||d.smallCompanyPremium,onChange:e=>x("smallCompanyPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Size-related risk premium"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"companySpecificRisk",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company-Specific Risk (%)"}),s.jsx("input",{id:"companySpecificRisk",type:"number",step:"0.1",value:t.dcf.wacc?.companySpecificRisk||d.companySpecificRisk,onChange:e=>x("companySpecificRisk",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Unsystematic risk premium"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4 text-purple-800",children:"Capital Structure & Cost of Debt"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketValueEquity",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Equity ($000s)"}),s.jsx("input",{id:"marketValueEquity",type:"number",value:t.dcf.wacc?.marketValueEquity||d.marketValueEquity,onChange:e=>x("marketValueEquity",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketValueDebt",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Debt ($000s)"}),s.jsx("input",{id:"marketValueDebt",type:"number",value:t.dcf.wacc?.marketValueDebt||d.marketValueDebt,onChange:e=>x("marketValueDebt",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"debtInterestRate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre-Tax Cost of Debt (%)"}),s.jsx("input",{id:"debtInterestRate",type:"number",step:"0.1",value:t.dcf.wacc?.debtInterestRate||d.debtInterestRate,onChange:e=>x("debtInterestRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Interest rate on debt"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"taxRate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),s.jsx("input",{id:"taxRate",type:"number",step:"0.1",value:t.dcf.wacc?.taxRate||t.dcf.taxRate,onChange:e=>x("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Corporate tax rate"})]}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-2",children:"Capital Structure"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Equity Weight:"}),s.jsx("span",{className:"font-medium",children:r(m.equityWeight)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Debt Weight:"}),s.jsx("span",{className:"font-medium",children:r(m.debtWeight)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2",children:[s.jsx("span",{children:"Total Capital:"}),s.jsxs("span",{className:"font-medium",children:["$",(m.totalCapital/1e3).toFixed(0),"M"]})]})]})]})]})]})]})]}),"calculation"===n&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"WACC Calculation Breakdown"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"CAPM Method"}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Risk-Free Rate:"}),s.jsx("span",{className:"font-medium",children:r(t.dcf.wacc?.riskFreeRate||d.riskFreeRate)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta × Market Risk Premium:"}),s.jsx("span",{className:"font-medium",children:r((t.dcf.wacc?.beta||d.beta)*(t.dcf.wacc?.marketRiskPremium||d.marketRiskPremium))})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Small Company Premium:"}),s.jsx("span",{className:"font-medium",children:r(t.dcf.wacc?.smallCompanyPremium||d.smallCompanyPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Company-Specific Risk:"}),s.jsx("span",{className:"font-medium",children:r(t.dcf.wacc?.companySpecificRisk||d.companySpecificRisk)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[s.jsx("span",{children:"Cost of Equity (CAPM):"}),s.jsx("span",{children:r(m.costOfEquityCAPM)})]})]})]}),s.jsxs("div",{className:"p-6 bg-green-50 rounded-lg border border-green-200",children:[s.jsx("h5",{className:"font-medium mb-4 text-green-800",children:"Build-up Method"}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Risk-Free Rate:"}),s.jsx("span",{className:"font-medium",children:r(d.buildUpMethod.riskFreeRate)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Equity Risk Premium:"}),s.jsx("span",{className:"font-medium",children:r(d.buildUpMethod.equityRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Size Risk Premium:"}),s.jsx("span",{className:"font-medium",children:r(d.buildUpMethod.sizeRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Industry Risk Premium:"}),s.jsx("span",{className:"font-medium",children:r(d.buildUpMethod.industryRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Company-Specific Risk:"}),s.jsx("span",{className:"font-medium",children:r(d.buildUpMethod.companySpecificRisk)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[s.jsx("span",{children:"Cost of Equity (Build-up):"}),s.jsx("span",{children:r(m.costOfEquityBuildUp)})]})]})]})]}),s.jsxs("div",{className:"p-6 bg-gray-50 rounded-lg border",children:[s.jsx("h5",{className:"font-medium mb-4",children:"Final WACC Calculation"}),s.jsxs("div",{className:"space-y-4 text-sm",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"WACC (CAPM Method):"}),s.jsx("span",{className:"font-medium",children:r(m.waccCAPM)})]}),s.jsxs("div",{className:"text-xs text-gray-600",children:["[",r(m.costOfEquityCAPM)," × ",r(m.equityWeight),"] + [",r(m.costOfDebtAfterTax)," × ",r(m.debtWeight),"]"]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"WACC (Build-up Method):"}),s.jsx("span",{className:"font-medium",children:r(m.waccBuildUp)})]}),s.jsxs("div",{className:"text-xs text-gray-600",children:["[",r(m.costOfEquityBuildUp)," × ",r(m.equityWeight),"] + [",r(m.costOfDebtAfterTax)," × ",r(m.debtWeight),"]"]})]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-lg font-semibold",children:"Risk-Adjusted WACC:"}),s.jsx("span",{className:"text-2xl font-bold text-blue-600",children:r(m.finalWACC)})]}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Average of CAPM and Build-up methods"})]})]})]})]}),"benchmarks"===n&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Industry Benchmarks & Validation"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Your Company"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC:"}),s.jsx("span",{className:"font-semibold",children:r(m.finalWACC)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta:"}),s.jsx("span",{className:"font-semibold",children:(t.dcf.wacc?.beta||d.beta).toFixed(2)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"D/E Ratio:"}),s.jsxs("span",{className:"font-semibold",children:[m.debtToEquityRatio.toFixed(2),"x"]})]})]})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-green-800 mb-2",children:"Industry Average"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC:"}),s.jsx("span",{className:"font-semibold",children:r(d.industryWACC)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta:"}),s.jsx("span",{className:"font-semibold",children:d.industryBeta.toFixed(2)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"D/E Ratio:"}),s.jsxs("span",{className:"font-semibold",children:[d.industryDebtEquityRatio.toFixed(2),"x"]})]})]})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-2",children:"Variance"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC Diff:"}),s.jsxs("span",{className:"font-semibold "+(m.finalWACC>d.industryWACC?"text-red-600":"text-green-600"),children:[m.finalWACC>d.industryWACC?"+":"",r(m.finalWACC-d.industryWACC)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta Diff:"}),s.jsxs("span",{className:"font-semibold "+((t.dcf.wacc?.beta||d.beta)>d.industryBeta?"text-red-600":"text-green-600"),children:[(t.dcf.wacc?.beta||d.beta)>d.industryBeta?"+":"",((t.dcf.wacc?.beta||d.beta)-d.industryBeta).toFixed(2)]})]})]})]})]}),s.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(Y,{size:16,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Validation Guidelines"}),s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"• WACC should be within ±2% of industry average for similar companies"}),s.jsx("li",{children:"• Beta should reflect business risk relative to market (typically 0.8-1.5 for most companies)"}),s.jsx("li",{children:"• Cost of equity should exceed risk-free rate by at least 4-6% for private companies"}),s.jsx("li",{children:"• Debt/equity ratio should align with industry norms and company strategy"}),s.jsx("li",{children:"• Consider economic conditions and company-specific factors"})]})]})]})})]})]})]})},et=({data:t,modelInputs:a,onModelInputChange:r,formatCurrency:i,formatPercent:l})=>{const[n,o]=e.useState(!1),[d,m]=e.useState(!0),[x,u]=e.useState("results"),h=e.useMemo(()=>{const{discountRate:e,terminalGrowthRate:s,projectionYears:r,taxRate:i}=a.dcf,l=t.statements,n=a.dcf.workingCapital||{receivablesDays:45,inventoryDays:60,payablesDays:30},o=a.dcf.capex||{capexAsPercentOfRevenue:3.5,depreciationRate:7},c={years:[],freeCashFlows:[],presentValues:[],workingCapitalChanges:[],capexAmounts:[],unleveredFreeCashFlow:[],cumulativePV:0,terminalValue:0,presentValueTerminal:0,enterpriseValue:0,equityValue:0,impliedShare:0},d=l.incomeStatement.totalRevenue?.[0]||1e5;for(let t=1;t<=r;t++){const s={year:t,revenue:l.incomeStatement.totalRevenue?.[t]||0,operatingIncome:l.incomeStatement.operatingIncome?.[t]||0,nopat:0,workingCapitalChange:0,capex:0,depreciation:0,freeCashFlow:0,presentValue:0};s.nopat=s.operatingIncome*(1-i/100);const a=s.revenue,r=t>1?l.incomeStatement.totalRevenue?.[t-1]||0:d,m=a*n.receivablesDays/365,x=a*n.inventoryDays/365,u=a*n.payablesDays/365,h=m-r*n.receivablesDays/365,p=x-r*n.inventoryDays/365,g=u-r*n.payablesDays/365;s.workingCapitalChange=-(h+p-g),s.capex=-a*o.capexAsPercentOfRevenue/100,s.depreciation=Math.abs(s.capex)/o.depreciationRate,s.freeCashFlow=s.nopat+s.depreciation+s.capex+s.workingCapitalChange;const b=Math.pow(1+e/100,t);s.presentValue=s.freeCashFlow/b,c.years.push(s),c.freeCashFlows.push(s.freeCashFlow),c.presentValues.push(s.presentValue),c.workingCapitalChanges.push(s.workingCapitalChange),c.capexAmounts.push(s.capex),c.unleveredFreeCashFlow.push(s.freeCashFlow),c.cumulativePV+=s.presentValue}const m=(c.years[c.years.length-1]?.freeCashFlow||0)*(1+s/100);c.terminalValue=m/((e-s)/100);const x=Math.pow(1+e/100,r);c.presentValueTerminal=c.terminalValue/x,c.enterpriseValue=c.cumulativePV+c.presentValueTerminal;c.equityValue=c.enterpriseValue-0;const u=a.dcf.sharesOutstanding||1e3;return c.impliedShare=c.equityValue/u,c},[t,a]),f=(e,t,s)=>{const i={...a.dcf,[e]:{...a.dcf[e],[t]:parseFloat(s)||0}};r("dcf",e,i[e])},j=(e,t)=>{r("dcf",e,parseFloat(t)||0)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(p,{size:20}),"Advanced DCF Valuation"]}),s.jsx("p",{className:"text-gray-600",children:"Professional-grade DCF with working capital analysis, capex modeling, and detailed cash flow projections."})]}),s.jsx("div",{className:"flex gap-2",children:["results","charts","wacc","assumptions"].map(e=>s.jsxs("button",{onClick:()=>u(e),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 "+(x===e?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:["results"===e&&s.jsx(g,{size:14}),"charts"===e&&s.jsx(b,{size:14}),"wacc"===e&&s.jsx(p,{size:14}),"assumptions"===e&&s.jsx(B,{size:14}),e.charAt(0).toUpperCase()+e.slice(1)]},e))})]}),"results"===x&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(le.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(g,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"ENTERPRISE VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:i(h.enterpriseValue)}),s.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["PV Operations: ",i(h.cumulativePV)]})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(y,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EQUITY VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-800",children:i(h.equityValue)}),s.jsxs("div",{className:"text-sm text-blue-600 mt-1",children:["Per Share: ",i(h.impliedShare)]})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(b,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"TERMINAL VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-800",children:i(h.terminalValue)}),s.jsxs("div",{className:"text-sm text-purple-600 mt-1",children:["PV: ",i(h.presentValueTerminal)]})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(c,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"IMPLIED MULTIPLE"})]}),s.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[(h.enterpriseValue/(t.statements.incomeStatement.totalRevenue?.[1]||1)).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"EV/Revenue (Year 1)"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Detailed Cash Flow Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b bg-gray-50",children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Year"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Operating Income"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"NOPAT"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Depreciation"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Capex"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"ΔWorking Capital"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Free Cash Flow"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Present Value"})]})}),s.jsxs("tbody",{children:[h.years.map((e,t)=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3 font-medium",children:e.year}),s.jsx("td",{className:"p-3 text-right",children:i(e.revenue)}),s.jsx("td",{className:"p-3 text-right",children:i(e.operatingIncome)}),s.jsx("td",{className:"p-3 text-right",children:i(e.nopat)}),s.jsxs("td",{className:"p-3 text-right text-green-600",children:["+",i(e.depreciation)]}),s.jsx("td",{className:"p-3 text-right text-red-600",children:i(e.capex)}),s.jsxs("td",{className:"p-3 text-right "+(e.workingCapitalChange>=0?"text-green-600":"text-red-600"),children:[e.workingCapitalChange>=0?"+":"",i(e.workingCapitalChange)]}),s.jsx("td",{className:"p-3 text-right font-medium",children:i(e.freeCashFlow)}),s.jsx("td",{className:"p-3 text-right font-medium",children:i(e.presentValue)})]},t)),s.jsxs("tr",{className:"border-b-2 border-gray-300 bg-blue-50",children:[s.jsx("td",{className:"p-3 font-bold",children:"Terminal"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right font-bold",children:i(h.terminalValue)}),s.jsx("td",{className:"p-3 text-right font-bold",children:i(h.presentValueTerminal)})]}),s.jsxs("tr",{className:"bg-gray-100 font-bold",children:[s.jsx("td",{className:"p-3",children:"TOTAL"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right text-lg",children:i(h.enterpriseValue)})]})]})]})})]})]}),"charts"===x&&s.jsx(Xe,{dcfData:h,sensitivityData:null,scenarioData:null,formatCurrency:i,formatPercent:l}),"wacc"===x&&s.jsx(Ze,{modelInputs:a,onModelInputChange:r,formatPercent:l}),"assumptions"===x&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Model Assumptions"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Core Assumptions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-discount-rate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Rate (WACC) %"}),s.jsx("input",{id:"dcf-discount-rate",type:"number",step:"0.1",value:a.dcf.discountRate,onChange:e=>j("discountRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-terminal-growth",className:"block text-sm font-medium text-gray-700 mb-1",children:"Terminal Growth Rate %"}),s.jsx("input",{id:"dcf-terminal-growth",type:"number",step:"0.1",value:a.dcf.terminalGrowthRate,onChange:e=>j("terminalGrowthRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-tax-rate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate %"}),s.jsx("input",{id:"dcf-tax-rate",type:"number",step:"0.1",value:a.dcf.taxRate,onChange:e=>j("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Working Capital"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-receivables-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Receivables (Days)"}),s.jsx("input",{id:"dcf-receivables-days",type:"number",value:a.dcf.workingCapital?.receivablesDays||45,onChange:e=>f("workingCapital","receivablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-inventory-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Inventory (Days)"}),s.jsx("input",{id:"dcf-inventory-days",type:"number",value:a.dcf.workingCapital?.inventoryDays||60,onChange:e=>f("workingCapital","inventoryDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-payables-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payables (Days)"}),s.jsx("input",{id:"dcf-payables-days",type:"number",value:a.dcf.workingCapital?.payablesDays||30,onChange:e=>f("workingCapital","payablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Capital Expenditure"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-capex-percent",className:"block text-sm font-medium text-gray-700 mb-1",children:"Capex (% of Revenue)"}),s.jsx("input",{id:"dcf-capex-percent",type:"number",step:"0.1",value:a.dcf.capex?.capexAsPercentOfRevenue||3.5,onChange:e=>f("capex","capexAsPercentOfRevenue",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-depreciation-period",className:"block text-sm font-medium text-gray-700 mb-1",children:"Depreciation Period (Years)"}),s.jsx("input",{id:"dcf-depreciation-period",type:"number",value:a.dcf.capex?.depreciationRate||7,onChange:e=>f("capex","depreciationRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-shares-outstanding",className:"block text-sm font-medium text-gray-700 mb-1",children:"Shares Outstanding (000s)"}),s.jsx("input",{id:"dcf-shares-outstanding",type:"number",value:a.dcf.sharesOutstanding||1e3,onChange:e=>j("sharesOutstanding",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]})]})]})},tt=({data:t,formatCurrency:a,formatPercent:r})=>{const[l,n]=e.useState("multiples"),[o,c]=e.useState("ev_revenue"),[d,m]=e.useState(!1),[x,u]=e.useState([{id:1,name:"MedSpa Corp",ticker:"MSPA",marketCap:45e4,enterpriseValue:52e4,revenue:18e4,ebitda:45e3,netIncome:28e3,employees:1200,founded:2015,geography:"US",businessModel:"B2C Medical Spa Chain"},{id:2,name:"Wellness Holdings",ticker:"WELL",marketCap:68e4,enterpriseValue:75e4,revenue:22e4,ebitda:55e3,netIncome:35e3,employees:1800,founded:2012,geography:"US",businessModel:"Integrated Wellness Platform"},{id:3,name:"Aesthetic Solutions Inc",ticker:"AEST",marketCap:32e4,enterpriseValue:38e4,revenue:125e3,ebitda:32e3,netIncome:18e3,employees:850,founded:2018,geography:"US",businessModel:"Medical Device & Services"},{id:4,name:"Premium Health Group",ticker:"PHG",marketCap:92e4,enterpriseValue:105e4,revenue:31e4,ebitda:78e3,netIncome:48e3,employees:2500,founded:2010,geography:"US",businessModel:"Premium Healthcare Services"}]),h=e.useMemo(()=>x.map(e=>({...e,multiples:{ev_revenue:e.enterpriseValue/e.revenue,ev_ebitda:e.enterpriseValue/e.ebitda,pe_ratio:e.marketCap/e.netIncome,revenue_per_employee:e.revenue/e.employees,market_cap_revenue:e.marketCap/e.revenue}})),[x]),p=e.useMemo(()=>{const e=h.map(e=>e.multiples),t=e=>({mean:e.reduce((e,t)=>e+t,0)/e.length,median:e.sort((e,t)=>e-t)[Math.floor(e.length/2)],min:Math.min(...e),max:Math.max(...e),p25:e.sort((e,t)=>e-t)[Math.floor(.25*e.length)],p75:e.sort((e,t)=>e-t)[Math.floor(.75*e.length)]});return{ev_revenue:t(e.map(e=>e.ev_revenue)),ev_ebitda:t(e.map(e=>e.ev_ebitda)),pe_ratio:t(e.map(e=>e.pe_ratio)),revenue_per_employee:t(e.map(e=>e.revenue_per_employee)),market_cap_revenue:t(e.map(e=>e.market_cap_revenue))}},[h]),f=e.useMemo(()=>{const e=t.statements.incomeStatement.totalRevenue?.[1]||1e5,s=1.15*(t.statements.incomeStatement.operatingIncome?.[1]||5e4),a=.7*(t.statements.incomeStatement.operatingIncome?.[1]||5e4);return{ev_revenue:{mean:e*p.ev_revenue.mean,median:e*p.ev_revenue.median,p25:e*p.ev_revenue.p25,p75:e*p.ev_revenue.p75},ev_ebitda:{mean:s*p.ev_ebitda.mean,median:s*p.ev_ebitda.median,p25:s*p.ev_ebitda.p25,p75:s*p.ev_ebitda.p75},pe_ratio:{mean:a*p.pe_ratio.mean,median:a*p.pe_ratio.median,p25:a*p.pe_ratio.p25,p75:a*p.pe_ratio.p75}}},[t,p]),v={ev_revenue:{name:"EV/Revenue",description:"Enterprise Value / Annual Revenue"},ev_ebitda:{name:"EV/EBITDA",description:"Enterprise Value / EBITDA"},pe_ratio:{name:"P/E Ratio",description:"Market Cap / Net Income"},revenue_per_employee:{name:"Revenue/Employee",description:"Revenue per Employee"},market_cap_revenue:{name:"Market Cap/Revenue",description:"Market Cap / Revenue"}},N=[{id:"multiples",label:"Trading Multiples",icon:b},{id:"analysis",label:"Valuation Analysis",icon:j},{id:"companies",label:"Comparable Set",icon:i}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(i,{size:20}),"Comparable Company Analysis"]}),s.jsx("p",{className:"text-gray-600",children:"Market-based valuation using trading multiples from similar public companies."})]}),s.jsx("div",{className:"flex gap-2",children:s.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[s.jsx(q,{size:16}),"Add Comparable"]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(le.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(b,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EV/REVENUE"})]}),s.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[p.ev_revenue.median.toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Median multiple"})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(y,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"IMPLIED VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:a(f.ev_revenue.median)}),s.jsx("div",{className:"text-sm text-green-600 mt-1",children:"EV/Revenue basis"})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(g,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"VALUATION RANGE"})]}),s.jsxs("div",{className:"text-lg font-bold text-purple-800",children:[a(f.ev_revenue.p25)," - ",a(f.ev_revenue.p75)]}),s.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"25th - 75th percentile"})]}),s.jsxs(le.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(i,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"PEER COUNT"})]}),s.jsx("div",{className:"text-2xl font-bold text-orange-800",children:x.length}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Comparable companies"})]})]}),s.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:N.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>n(e.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(l===e.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[s.jsx(t,{size:16}),e.label]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["multiples"===l&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Trading Multiples Analysis"}),s.jsx("select",{value:o,onChange:e=>c(e.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(v).map(([e,t])=>s.jsx("option",{value:e,children:t.name},e))})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b bg-gray-50",children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Company"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Market Cap"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Enterprise Value"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"EV/Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"EV/EBITDA"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"P/E Ratio"})]})}),s.jsxs("tbody",{children:[h.map((e,t)=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3",children:s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.name}),s.jsx("div",{className:"text-xs text-gray-500",children:e.ticker})]})}),s.jsx("td",{className:"p-3 text-right",children:a(e.marketCap)}),s.jsx("td",{className:"p-3 text-right",children:a(e.enterpriseValue)}),s.jsx("td",{className:"p-3 text-right",children:a(e.revenue)}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.ev_revenue.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.ev_ebitda.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.pe_ratio.toFixed(1),"x"]})]},e.id)),s.jsxs("tr",{className:"border-t-2 border-gray-300 bg-blue-50 font-semibold",children:[s.jsx("td",{className:"p-3",children:"Market Statistics"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsxs("td",{className:"p-3 text-right",children:[p.ev_revenue.median.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right",children:[p.ev_ebitda.median.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right",children:[p.pe_ratio.median.toFixed(1),"x"]})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-3",children:"Multiple Distribution"}),s.jsx("div",{className:"space-y-3",children:Object.entries(p).slice(0,3).map(([e,t])=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[s.jsx("span",{children:v[e].name}),s.jsxs("span",{className:"font-medium",children:[t.median.toFixed(1),"x"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:(t.median-t.min)/(t.max-t.min)*100+"%"}})}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[s.jsxs("span",{children:[t.min.toFixed(1),"x"]}),s.jsxs("span",{children:[t.max.toFixed(1),"x"]})]})]},e))})]}),s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Companies Analyzed:"}),s.jsx("span",{className:"font-medium",children:x.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median Market Cap:"}),s.jsx("span",{className:"font-medium",children:a(x.sort((e,t)=>e.marketCap-t.marketCap)[Math.floor(x.length/2)]?.marketCap||0)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median Revenue:"}),s.jsx("span",{className:"font-medium",children:a(x.sort((e,t)=>e.revenue-t.revenue)[Math.floor(x.length/2)]?.revenue||0)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Avg Founded Year:"}),s.jsx("span",{className:"font-medium",children:Math.round(x.reduce((e,t)=>e+t.founded,0)/x.length)})]})]})]})]})]}),"analysis"===l&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Valuation Analysis"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Implied Valuation by Multiple"}),s.jsx("div",{className:"space-y-4",children:Object.entries(f).map(([e,t])=>s.jsxs("div",{className:"p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"font-medium",children:v[e].name}),s.jsxs("span",{className:"text-sm text-gray-500",children:[p[e].median.toFixed(1),"x median"]})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"25th Percentile:"}),s.jsx("span",{className:"font-medium",children:a(t.p25)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median:"}),s.jsx("span",{className:"font-bold text-blue-600",children:a(t.median)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"75th Percentile:"}),s.jsx("span",{className:"font-medium",children:a(t.p75)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Mean:"}),s.jsx("span",{className:"font-medium",children:a(t.mean)})]})]})]},e))})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Valuation Summary"}),s.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Recommended Range"}),s.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[a((f.ev_revenue.p25+f.ev_ebitda.p25)/2)," -",a((f.ev_revenue.p75+f.ev_ebitda.p75)/2)]}),s.jsx("div",{className:"text-sm text-blue-600",children:"Blended 25th-75th percentile"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Midpoint Valuation"}),s.jsx("div",{className:"text-xl font-bold text-blue-800",children:a((f.ev_revenue.median+f.ev_ebitda.median)/2)}),s.jsx("div",{className:"text-sm text-blue-600",children:"Average of median multiples"})]})]})}),s.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(j,{size:16,className:"text-yellow-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-1",children:"Valuation Considerations"}),s.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[s.jsx("li",{children:"• Consider company-specific growth and margin profiles"}),s.jsx("li",{children:"• Adjust for differences in business model and scale"}),s.jsx("li",{children:"• Factor in market conditions and sector trends"}),s.jsx("li",{children:"• Apply appropriate discount for private company liquidity"})]})]})]})})]})]})]}),"companies"===l&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Comparable Company Set"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx(H,{size:16,className:"absolute left-3 top-3 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search companies...",className:"pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("button",{className:"px-3 py-2 border rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[s.jsx(Q,{size:16}),"Filter"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:x.map(e=>s.jsxs(le.div,{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex justify-between items-start mb-3",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-semibold text-gray-800",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[e.ticker," • ",e.geography]})]}),s.jsx("button",{onClick:()=>{return t=e.id,void u(x.filter(e=>e.id!==t));var t},className:"text-red-500 hover:bg-red-50 p-1 rounded",children:"×"})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Market Cap:"}),s.jsx("span",{className:"font-medium",children:a(e.marketCap)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Revenue:"}),s.jsx("span",{className:"font-medium",children:a(e.revenue)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"EV/Revenue:"}),s.jsxs("span",{className:"font-medium",children:[(e.enterpriseValue/e.revenue).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Founded:"}),s.jsx("span",{className:"font-medium",children:e.founded})]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t",children:s.jsx("div",{className:"text-xs text-gray-600",children:e.businessModel})})]},e.id))})]})]}),d&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Add Comparable Company"}),s.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=new FormData(e.target);(e=>{const t={id:Date.now(),...e,marketCap:parseFloat(e.marketCap)||0,enterpriseValue:parseFloat(e.enterpriseValue)||0,revenue:parseFloat(e.revenue)||0,ebitda:parseFloat(e.ebitda)||0,netIncome:parseFloat(e.netIncome)||0,employees:parseInt(e.employees)||0,founded:parseInt(e.founded)||(new Date).getFullYear()};u([...x,t]),m(!1)})(Object.fromEntries(t))},children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"company-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),s.jsx("input",{id:"company-name",name:"name",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"ticker",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ticker"}),s.jsx("input",{id:"ticker",name:"ticker",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketCap",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Cap ($000s)"}),s.jsx("input",{id:"marketCap",name:"marketCap",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"enterpriseValue",className:"block text-sm font-medium text-gray-700 mb-1",children:"Enterprise Value ($000s)"}),s.jsx("input",{id:"enterpriseValue",name:"enterpriseValue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"revenue",className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue ($000s)"}),s.jsx("input",{id:"revenue",name:"revenue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"ebitda",className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA ($000s)"}),s.jsx("input",{id:"ebitda",name:"ebitda",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"businessModel",className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Model"}),s.jsx("input",{id:"businessModel",name:"businessModel",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Company"}),s.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]})})]})};const st=new class{constructor(){this.workers=[],this.isRunning=!1,this.currentSimulation=null}async runDCFSimulation(e,t,s={}){const{iterations:a=1e4,confidenceLevel:r=.95,correlationMatrix:i=null,randomSeed:l=null}=s;re.log("INFO","Starting DCF Monte Carlo simulation",{iterations:a,variables:Object.keys(t).length}),this.isRunning=!0;const n=Date.now();try{l&&this.setSeed(l);const o=this.generateCorrelatedSamples(t,a,i),c=[],d=s.onProgress;for(let s=0;s<a;s++){if(!this.isRunning)throw new Error("Simulation cancelled");const r=this.createScenarioInputs(e,o[s],t),i=this.calculateDCFScenario(r);c.push({iteration:s+1,pricePerShare:i.pricePerShare,enterpriseValue:i.enterpriseValue,upside:i.upside,inputs:r}),d&&s%Math.floor(a/100)===0&&d(s/a*100)}const m=this.analyzeResults(c,r),x=Date.now();return re.log("INFO","DCF Monte Carlo simulation completed",{iterations:a,duration:x-n,meanPrice:m.statistics.mean}),{type:"DCF_MONTE_CARLO",timestamp:(new Date).toISOString(),parameters:{iterations:a,confidenceLevel:r,randomSeed:l},results:c,analysis:m,duration:x-n}}catch(o){throw this.isRunning=!1,re.log("ERROR","DCF Monte Carlo simulation failed",{error:o.message}),o}finally{this.isRunning=!1}}async runLBOSimulation(e,t,s={}){const{iterations:a=1e4,confidenceLevel:r=.95,correlationMatrix:i=null,randomSeed:l=null}=s;re.log("INFO","Starting LBO Monte Carlo simulation",{iterations:a,variables:Object.keys(t).length}),this.isRunning=!0;const n=Date.now();try{l&&this.setSeed(l);const o=this.generateCorrelatedSamples(t,a,i),c=[],d=s.onProgress;for(let s=0;s<a;s++){if(!this.isRunning)throw new Error("Simulation cancelled");const r=this.createScenarioInputs(e,o[s],t),i=this.calculateLBOScenario(r);c.push({iteration:s+1,irr:i.irr,moic:i.moic,totalReturn:i.totalReturn,inputs:r}),d&&s%Math.floor(a/100)===0&&d(s/a*100)}const m=this.analyzeResults(c,r,["irr","moic","totalReturn"]),x=Date.now();return re.log("INFO","LBO Monte Carlo simulation completed",{iterations:a,duration:x-n,meanIRR:m.statistics.irr?.mean}),{type:"LBO_MONTE_CARLO",timestamp:(new Date).toISOString(),parameters:{iterations:a,confidenceLevel:r,randomSeed:l},results:c,analysis:m,duration:x-n}}catch(o){throw this.isRunning=!1,re.log("ERROR","LBO Monte Carlo simulation failed",{error:o.message}),o}finally{this.isRunning=!1}}generateCorrelatedSamples(e,t,s){const a=Object.keys(e),r=a.length,i=[],l=[];for(let n=0;n<t;n++){const t={};a.forEach(s=>{const a=e[s];t[s]=this.sampleFromDistribution(a)}),l.push(t)}if(s&&s.length===r){const e=this.choleskyDecomposition(s);for(let s=0;s<t;s++){const t={},r=a.map(e=>l[s][e]),n=this.applyCorrelation(r,e);a.forEach((e,s)=>{t[e]=n[s]}),i.push(t)}}else i.push(...l);return i}sampleFromDistribution(e){const{type:t,parameters:s}=e;switch(t){case"normal":return this.normalRandom(s.mean,s.stdDev);case"lognormal":{const e=this.normalRandom(s.mu,s.sigma);return Math.exp(e)}case"uniform":return s.min+Math.random()*(s.max-s.min);case"triangular":return this.triangularRandom(s.min,s.mode,s.max);case"beta":return this.betaRandom(s.alpha,s.beta);case"exponential":return this.exponentialRandom(s.lambda);case"weibull":return this.weibullRandom(s.shape,s.scale);case"pareto":return this.paretoRandom(s.scale,s.shape);case"student_t":return this.studentTRandom(s.df);case"chi_squared":return this.chiSquaredRandom(s.df);default:throw new Error(`Unsupported distribution type: ${t}`)}}exponentialRandom(e){return-Math.log(1-Math.random())/e}weibullRandom(e,t){const s=Math.random();return t*Math.pow(-Math.log(1-s),1/e)}paretoRandom(e,t){const s=Math.random();return e/Math.pow(s,1/t)}studentTRandom(e){if(e<=0)throw new Error("Degrees of freedom must be positive");const t=this.normalRandom(0,1),s=this.chiSquaredRandom(e);return t/Math.sqrt(s/e)}chiSquaredRandom(e){if(e<=0)throw new Error("Degrees of freedom must be positive");return 2*this.gammaRandom(e/2)}normalRandom(e=0,t=1){if(void 0!==this.spareNormal){const s=this.spareNormal;return this.spareNormal=void 0,s*t+e}const s=Math.random(),a=Math.random(),r=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*a),i=Math.sqrt(-2*Math.log(s))*Math.sin(2*Math.PI*a);return this.spareNormal=i,r*t+e}triangularRandom(e,t,s){const a=Math.random();return a<(t-e)/(s-e)?e+Math.sqrt(a*(s-e)*(t-e)):s-Math.sqrt((1-a)*(s-e)*(s-t))}betaRandom(e,t){const s=this.gammaRandom(e);return s/(s+this.gammaRandom(t))}gammaRandom(e){if(!(e>=1))return this.gammaRandom(e+1)*Math.pow(Math.random(),1/e);{const t=e-1/3,s=1/Math.sqrt(9*t);for(;;){let e,a;do{e=this.normalRandom(),a=1+s*e}while(a<=0);a*=a*a;const r=Math.random();if(r<1-.0331*e*e*e*e)return t*a;if(Math.log(r)<.5*e*e+t*(1-a+Math.log(a)))return t*a}}}choleskyDecomposition(e){const t=e.length,s=Array(t).fill().map(()=>Array(t).fill(0));for(let a=0;a<t;a++)for(let t=0;t<=a;t++)if(a===t){let a=0;for(let e=0;e<t;e++)a+=s[t][e]*s[t][e];s[t][t]=Math.sqrt(e[t][t]-a)}else{let r=0;for(let e=0;e<t;e++)r+=s[a][e]*s[t][e];s[a][t]=(e[a][t]-r)/s[t][t]}return s}applyCorrelation(e,t){const s=e.length,a=Array(s).fill(0);for(let r=0;r<s;r++)for(let s=0;s<=r;s++)a[r]+=t[r][s]*e[s];return a}createScenarioInputs(e,t,s){const a={...e};return Object.entries(t).forEach(([e,t])=>{const r=s[e];r.applyTo?a[r.applyTo]=t:a[e]=t}),a}calculateDCFScenario(e){const{currentRevenue:t=1e9,revenueGrowthRate:s=.1,fcfMargin:a=.15,wacc:r=.1,terminalGrowthRate:i=.025,sharesOutstanding:l=1e8,currentPrice:n=100}=e;let o=0,c=t;for(let x=1;x<=5;x++){c*=1+s;o+=c*a/Math.pow(1+r,x)}const d=o+c*a*(1+i)/(r-i)/Math.pow(1+r,5),m=d/l;return{pricePerShare:m,enterpriseValue:d,upside:(m-n)/n*100}}calculateLBOScenario(e){const{ebitda:t=1e8,ebitdaGrowthRate:s=.05,exitMultiple:a=10,debtMultiple:r=5,holdingPeriod:i=5}=e,l=t*r,n=10*t-l,o=t*Math.pow(1+s,i)*a-.5*l,c=o/n;return{irr:Math.pow(c,1/i)-1,moic:c,totalReturn:o}}analyzeResults(e,t,s=["pricePerShare","enterpriseValue","upside"]){const a={statistics:{},percentiles:{},confidenceIntervals:{},riskMetrics:{},distributionTests:{},correlations:{}};return s.forEach(s=>{const r=e.map(e=>e[s]).filter(e=>null!==e&&!isNaN(e)).sort((e,t)=>e-t);if(0===r.length)return;const i=r.reduce((e,t)=>e+t,0)/r.length,l=r.reduce((e,t)=>e+Math.pow(t-i,2),0)/r.length,n=Math.sqrt(l),o=Math.sqrt(l*r.length/(r.length-1));a.statistics[s]={mean:i,median:this.percentile(r,.5),mode:this.calculateMode(r),stdDev:n,sampleStdDev:o,variance:l,min:r[0],max:r[r.length-1],range:r[r.length-1]-r[0],count:r.length,trimmedMean:this.calculateTrimmedMean(r,.1),mad:this.calculateMAD(r),iqr:this.percentile(r,.75)-this.percentile(r,.25)},a.percentiles[s]={p1:this.percentile(r,.01),p5:this.percentile(r,.05),p10:this.percentile(r,.1),p25:this.percentile(r,.25),p50:this.percentile(r,.5),p75:this.percentile(r,.75),p90:this.percentile(r,.9),p95:this.percentile(r,.95),p99:this.percentile(r,.99)};const c=1-t,d=this.percentile(r,c/2),m=this.percentile(r,1-c/2);a.confidenceIntervals[s]={level:t,lowerBound:d,upperBound:m,width:m-d,bootstrapCI:this.calculateBootstrapCI(r,t)};const x=this.percentile(r,.05),u=this.percentile(r,.01),h=r.slice(0,Math.floor(.05*r.length)).reduce((e,t)=>e+t,0)/Math.floor(.05*r.length),p=r.slice(0,Math.floor(.01*r.length)).reduce((e,t)=>e+t,0)/Math.floor(.01*r.length);a.riskMetrics[s]={var95:x,var99:u,cvar95:h,cvar99:p,skewness:this.calculateSkewness(r,i,n),kurtosis:this.calculateKurtosis(r,i,n),excessKurtosis:this.calculateKurtosis(r,i,n)-3,expectedShortfall:h,maxDrawdown:this.calculateMaxDrawdown(r),sharpeRatio:this.calculateSharpeRatio(r,.02),sortinoRatio:this.calculateSortinoRatio(r,i)},a.distributionTests[s]={jarqueBera:this.jarqueBeraTest(r),kolmogorovSmirnov:this.ksTestNormality(r),shapiroWilk:r.length<=5e3?this.shapiroWilkTest(r):null}}),s.length>1&&(a.correlations=this.calculateCorrelationMatrix(e,s)),a}calculateMode(e){const t={};e.forEach(e=>{const s=Math.round(100*e)/100;t[s]=(t[s]||0)+1});const s=Math.max(...Object.values(t)),a=Object.keys(t).filter(e=>t[e]===s);return 1===a.length?parseFloat(a[0]):null}calculateTrimmedMean(e,t=.1){const s=Math.floor(e.length*t),a=e.slice(s,-s||void 0);return a.reduce((e,t)=>e+t,0)/a.length}calculateMAD(e){const t=this.percentile(e,.5),s=e.map(e=>Math.abs(e-t)).sort((e,t)=>e-t);return this.percentile(s,.5)}calculateBootstrapCI(e,t,s=1e3){const a=[];for(let i=0;i<s;i++){const t=[];for(let s=0;s<e.length;s++)t.push(e[Math.floor(Math.random()*e.length)]);a.push(t.reduce((e,t)=>e+t,0)/t.length)}a.sort((e,t)=>e-t);const r=1-t;return{lowerBound:this.percentile(a,r/2),upperBound:this.percentile(a,1-r/2)}}calculateMaxDrawdown(e){let t=e[0],s=0;for(const a of e){a>t&&(t=a);const e=(t-a)/t;e>s&&(s=e)}return s}calculateSharpeRatio(e,t=.02){const s=e.reduce((e,t)=>e+t,0)/e.length,a=e.reduce((e,t)=>e+Math.pow(t-s,2),0)/e.length,r=Math.sqrt(a);return r>0?(s-t)/r:0}calculateSortinoRatio(e,t){const s=e.map(e=>e-t),a=s.filter(e=>e<0);if(0===a.length)return 1/0;const r=Math.sqrt(a.reduce((e,t)=>e+t*t,0)/a.length),i=s.reduce((e,t)=>e+t,0)/s.length;return r>0?i/r:0}jarqueBeraTest(e){const t=e.length,s=e.reduce((e,t)=>e+t,0)/t,a=e.reduce((e,t)=>e+Math.pow(t-s,2),0)/t,r=Math.sqrt(a),i=this.calculateSkewness(e,s,r),l=this.calculateKurtosis(e,s,r),n=t/6*(Math.pow(i,2)+Math.pow(l-3,2)/4),o=1-this.chiSquaredCDF(n,2);return{statistic:n,pValue:o,isNormal:o>.05}}chiSquaredCDF(e,t){return e<=0?0:this.incompleteGamma(t/2,e/2)}incompleteGamma(e,t){if(0===t)return 0;if(t<0)return 0;if(e<=0)return 0;if(t<e+1){let s=1/e,a=1/e;for(let r=1;r<100&&(a*=t/(e+r),s+=a,!(Math.abs(a)<1e-15));r++);return Math.exp(-t+e*Math.log(t)-this.logGamma(e))*s}{let s=t+1-e,a=1e30,r=1/s,i=r;for(let t=1;t<=100;t++){const l=-t*(t-e);s+=2,r=l*r+s,Math.abs(r)<1e-30&&(r=1e-30),a=s+l/a,Math.abs(a)<1e-30&&(a=1e-30),r=1/r;const n=r*a;if(i*=n,Math.abs(n-1)<1e-15)break}return 1-Math.exp(-t+e*Math.log(t)-this.logGamma(e))*i}}logGamma(e){const t=[76.18009172947144,-86.50532032941676,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let s=0,a=1.0000000001900151,r=e,i=r=e,l=e+5.5;for(l-=(e+.5)*Math.log(l);s<6;s++)a+=t[s]/++i;return-l+Math.log(2.506628274631001*a/r)}ksTestNormality(e){const t=e.length,s=e.reduce((e,t)=>e+t,0)/t,a=e.reduce((e,t)=>e+Math.pow(t-s,2),0)/t,r=Math.sqrt(a);let i=0;for(let n=0;n<t;n++){const a=(n+1)/t,l=this.normalCDF((e[n]-s)/r),o=Math.abs(a-l);o>i&&(i=o)}const l=1.36/Math.sqrt(t);return{statistic:i,critical:l,isNormal:i<l}}normalCDF(e){return.5*(1+this.erf(e/Math.sqrt(2)))}erf(e){const t=e<0?-1:1,s=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*s-1.453152027)*s+1.421413741)*s-.284496736)*s+.254829592)*s*Math.exp(-e*e))}shapiroWilkTest(e){const t=e.length;if(t<3||t>5e3)return null;const s=[...e].sort((e,t)=>e-t),a=e.reduce((e,t)=>e+t,0)/t;let r=0;for(let l=0;l<t;l++)r+=Math.pow(s[l]-a,2);const i=0/r;return{statistic:i,isNormal:i>.9}}calculateCorrelationMatrix(e,t){const s={};for(let a=0;a<t.length;a++){s[t[a]]={};for(let r=0;r<t.length;r++)if(a===r)s[t[a]][t[r]]=1;else{const i=e.map(e=>e[t[a]]).filter(e=>null!==e&&!isNaN(e)),l=e.map(e=>e[t[r]]).filter(e=>null!==e&&!isNaN(e));s[t[a]][t[r]]=this.calculateCorrelation(i,l)}}return s}calculateCorrelation(e,t){if(e.length!==t.length||0===e.length)return 0;const s=e.length,a=e.reduce((e,t)=>e+t,0)/s,r=t.reduce((e,t)=>e+t,0)/s;let i=0,l=0,n=0;for(let c=0;c<s;c++){const s=e[c]-a,o=t[c]-r;i+=s*o,l+=s*s,n+=o*o}const o=Math.sqrt(l*n);return o>0?i/o:0}percentile(e,t){const s=t*(e.length-1),a=Math.floor(s),r=Math.ceil(s),i=s-a;return a===r?e[a]:e[a]*(1-i)+e[r]*i}calculateSkewness(e,t,s){const a=e.length;return a/((a-1)*(a-2))*e.reduce((e,a)=>e+Math.pow((a-t)/s,3),0)}calculateKurtosis(e,t,s){const a=e.length;return a*(a+1)/((a-1)*(a-2)*(a-3))*e.reduce((e,a)=>e+Math.pow((a-t)/s,4),0)-3*Math.pow(a-1,2)/((a-2)*(a-3))}setSeed(e){this.seed=e,this.random=()=>(this.seed=(9301*this.seed+49297)%233280,this.seed/233280),Math.random=this.random}stopSimulation(){this.isRunning=!1}isSimulationRunning(){return this.isRunning}},at=({data:t,onDataChange:a})=>{const[r,i]=e.useState("setup"),[n,o]=e.useState(null),[c,d]=e.useState(!1),[m,x]=e.useState(0),[h,p]=e.useState({iterations:1e4,confidenceLevel:.95,randomSeed:null,enableCorrelation:!1}),[g,f]=e.useState({revenueGrowthRate:{type:"normal",parameters:{mean:.1,stdDev:.03},name:"Revenue Growth Rate",enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.12,mode:.15,max:.18},name:"FCF Margin",enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},name:"WACC",enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},name:"Terminal Growth Rate",enabled:!0}}),[j,v]=e.useState([[1,.3,-.2,.1],[.3,1,-.4,.2],[-.2,-.4,1,-.3],[.1,.2,-.3,1]]),N=[{value:"normal",label:"Normal",parameters:["mean","stdDev"]},{value:"triangular",label:"Triangular",parameters:["min","mode","max"]},{value:"uniform",label:"Uniform",parameters:["min","max"]},{value:"lognormal",label:"Log-Normal",parameters:["mu","sigma"]},{value:"beta",label:"Beta",parameters:["alpha","beta"]}],C=e.useCallback(async()=>{try{d(!0),x(0);const e=Object.fromEntries(Object.entries(g).filter(([e,t])=>t.enabled));if(0===Object.keys(e).length)throw new Error("No distributions are enabled. Please enable at least one variable distribution to run the simulation.");const s={iterations:h.iterations,confidenceLevel:h.confidenceLevel,randomSeed:h.randomSeed,correlationMatrix:h.enableCorrelation?j:null,onProgress:x},a=t?.statements?.incomeStatement,r=t?.periods?.length-1||2,i={currentRevenue:1e3*(a?.totalRevenue?.[r]||1e6),currentPrice:100,sharesOutstanding:1e6,currentOperatingIncome:1e3*(a?.operatingIncome?.[r]||15e4),...Object.fromEntries(Object.entries(e).map(([e,t])=>[e,t.parameters.mean||t.parameters.mode||(t.parameters.min+t.parameters.max)/2]))},l=await st.runDCFSimulation(i,e,s);o(l)}catch(e){alert(`Monte Carlo simulation failed: ${e.message}`)}finally{d(!1),x(0)}},[g,h,j,t]),S=e.useCallback(()=>{st.stopSimulation(),d(!1)},[]),R=e.useCallback((e,t)=>{f(s=>({...s,[e]:{...s[e],...t}}))},[]),M=e.useCallback((e,t,s)=>{v(a=>{const r=a.map(e=>[...e]);return r[e][t]=s,r[t][e]=s,r})},[]),I=e.useMemo(()=>{if(!n?.results)return[];const e=n.results.map(e=>e.pricePerShare),t=Math.min(...e),s=(Math.max(...e)-t)/50,a=Array(50).fill(0).map((e,a)=>({bin:t+a*s,count:0,frequency:0}));return e.forEach(e=>{const r=Math.min(Math.floor((e-t)/s),49);a[r].count++}),a.forEach(t=>{t.frequency=t.count/e.length}),a},[n]),E=e.useMemo(()=>n?.results?n.results.slice(0,1e3).map((e,t)=>({x:100*e.inputs.revenueGrowthRate,y:e.pricePerShare,upside:e.upside})):[],[n]),A=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),F=[{id:"setup",label:"Setup",icon:B},{id:"run",label:"Run Simulation",icon:z},{id:"results",label:"Results",icon:b},{id:"analysis",label:"Analysis",icon:y}];return s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsx("div",{className:"mb-6",children:s.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsxs("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center",children:[s.jsx(w,{className:"inline-block mr-2"}),"Monte Carlo Simulation"]}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Advanced risk analysis using probabilistic modeling • Generate thousands of scenarios • Measure uncertainty"})]})}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"flex space-x-2",children:F.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>i(e.id),className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 "+(r===e.id?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[s.jsx(t,{size:16}),e.label]},e.id)})})}),s.jsx("div",{className:"mt-6",children:s.jsxs(ne,{mode:"wait",children:["setup"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🎛️ Simulation Settings"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"iterations",className:"block text-sm font-medium text-gray-200",children:"Iterations"}),s.jsx("input",{id:"iterations",type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:h.iterations,onChange:e=>p(t=>({...t,iterations:parseInt(e.target.value)})),min:"1000",max:"100000",step:"1000"}),s.jsx("small",{className:"text-gray-400",children:"Leave empty for random"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"confidenceLevel",className:"block text-sm font-medium text-gray-200",children:"Confidence Level"}),s.jsxs("select",{id:"confidenceLevel",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:h.confidenceLevel,onChange:e=>p(t=>({...t,confidenceLevel:parseFloat(e.target.value)})),children:[s.jsx("option",{value:.9,children:"90%"}),s.jsx("option",{value:.95,children:"95%"}),s.jsx("option",{value:.99,children:"99%"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"randomSeed",className:"block text-sm font-medium text-gray-200",children:"Random Seed (Optional)"}),s.jsx("input",{id:"randomSeed",type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:h.randomSeed||"",onChange:e=>p(t=>({...t,randomSeed:e.target.value?parseInt(e.target.value):null})),placeholder:"Leave empty for random"})]}),s.jsx("div",{className:"space-y-2",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 rounded focus:ring-blue-500",checked:h.enableCorrelation,onChange:e=>p(t=>({...t,enableCorrelation:e.target.checked}))}),s.jsx("span",{children:"Enable Variable Correlation"})]})})]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Variable Distributions"}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Object.entries(g).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded-lg p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",checked:t.enabled,onChange:t=>R(e,{enabled:t.target.checked})}),s.jsx("span",{className:"font-medium",children:t.name})]})}),t.enabled&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"distributionType",className:"block text-sm font-medium text-gray-200",children:"Distribution Type"}),s.jsx("select",{id:"distributionType",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.type,onChange:t=>{const s=t.target.value;N.find(e=>e.value===s);const a={};"normal"===s?a.mean=.1:"triangular"===s?(a.min=.05,a.mode=.1,a.max=.15):"uniform"===s&&(a.min=.05,a.max=.15),R(e,{type:s,parameters:a})},children:N.map((e,t)=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:N.find(e=>e.value===t.type)?.parameters.map(a=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-300",children:a.charAt(0).toUpperCase()+a.slice(1)}),s.jsx("input",{className:"w-full px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",type:"number",value:t.parameters[a]||"",onChange:s=>R(e,{parameters:{...t.parameters,[a]:parseFloat(s.target.value)}}),step:"0.001"})]},a))})]})]},e))})]}),h.enableCorrelation&&s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🔗 Correlation Matrix"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{}),Object.keys(g).map(e=>s.jsx("th",{children:g[e].name},e))]})}),s.jsx("tbody",{children:Object.keys(g).map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{className:"font-medium text-gray-200 p-2 border border-gray-600",children:g.map((e,t)=>s.jsx("span",{children:e.name},t))}),Object.keys(g).map((e,a)=>s.jsx("td",{className:"p-2 border border-gray-600",children:s.jsx("input",{type:"number",value:j[t][a],onChange:e=>M(t,a,parseFloat(e.target.value)),min:"-1",max:"1",step:"0.1",disabled:t===a,className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-700 disabled:text-gray-400"})},a))]},e))})]})})]})]})},"setup"),"run"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{children:"🚀 Simulation Control"}),s.jsx("div",{className:"flex items-center space-x-2",children:c?s.jsxs("button",{onClick:S,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(J,{size:16}),s.jsx("span",{children:"Stop Simulation"})]}):s.jsxs("button",{onClick:C,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",disabled:Object.values(g).every(e=>!e.enabled),children:[s.jsx(z,{size:16}),s.jsx("span",{children:"Run Simulation"})]})})]}),c&&s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${m}%`}})}),s.jsxs("div",{className:"text-sm text-gray-400 text-center",children:[m.toFixed(1),"% Complete (",Math.floor(m*h.iterations/100)," / ",h.iterations," iterations)"]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 mt-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📋 Simulation Preview"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Iterations"}),s.jsx("div",{className:"text-xl font-bold text-white",children:h.iterations.toLocaleString()})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Variables"}),s.jsx("div",{className:"text-xl font-bold text-white",children:Object.values(g).filter(e=>e.enabled).length})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Confidence Level"}),s.jsxs("div",{className:"text-xl font-bold text-white",children:[(100*h.confidenceLevel).toFixed(0),"%"]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Correlation"}),s.jsx("div",{className:"text-xl font-bold text-white",children:h.enableCorrelation?"Enabled":"Disabled"})]})]})]})]})},"run"),"results"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:n?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-xl font-semibold text-white flex items-center",children:"📊 Simulation Results"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(l,{size:16}),"Export Results"]}),s.jsxs("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(u,{size:16}),"Generate Report"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(n.analysis.statistics).map(([e,t])=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"💰 Price per Share":"enterpriseValue"===e?"🏢 Enterprise Value":"📈 Upside %"}),s.jsx("div",{className:"text-2xl font-bold text-green-400 mb-2",children:"upside"===e?`${t.mean.toFixed(1)}%`:A(t.mean)}),s.jsxs("div",{className:"space-y-1 text-sm text-gray-300",children:[s.jsxs("div",{children:["Median: ","upside"===e?`${t.median.toFixed(1)}%`:A(t.median)]}),s.jsxs("div",{children:["Std Dev: ","upside"===e?`${t.stdDev.toFixed(1)}%`:A(t.stdDev)]}),s.jsxs("div",{children:["Min: ","upside"===e?`${t.min.toFixed(1)}%`:A(t.min)]}),s.jsxs("div",{children:["Max: ","upside"===e?`${t.max.toFixed(1)}%`:A(t.max)]})]})]},e))}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"📊 Price Distribution"}),s.jsx(oe,{width:"100%",height:300,children:s.jsxs(ve,{data:I,children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"bin",tickFormatter:A}),s.jsx(xe,{}),s.jsx(ue,{formatter:(e,t)=>[`${(100*e).toFixed(2)}%`,"Frequency"],labelFormatter:e=>`Price: ${A(e)}`}),s.jsx(Ne,{type:"monotone",dataKey:"frequency",stroke:"#3B82F6",fill:"#3B82F6",fillOpacity:.6})]})})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"🎯 Sensitivity Scatter Plot"}),s.jsx(oe,{width:"100%",height:300,children:s.jsxs(we,{data:E,children:[s.jsx(de,{strokeDasharray:"3 3"}),s.jsx(me,{dataKey:"x",name:"Revenue Growth Rate",tickFormatter:e=>`${e.toFixed(1)}%`}),s.jsx(xe,{dataKey:"y",name:"Price per Share",tickFormatter:A}),s.jsx(ue,{formatter:(e,t)=>["Revenue Growth Rate"===t?`${e.toFixed(2)}%`:A(e),t]}),s.jsx(Ce,{name:"Scenarios",fill:"#10B981",children:E.map((e,t)=>s.jsx(fe,{fill:e.upside>0?"#10B981":"#EF4444"},`cell-${t}`))})]})})]})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(k,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Results Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see results here."})]})},"results"),"analysis"===r&&s.jsx(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:n?.analysis?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"⚠️ Risk Metrics"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(n.analysis.riskMetrics).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"var95"===e?"Value at Risk (95%)":"cvar95"===e?"Conditional VaR (95%)":"probabilityOfLoss"===e?"Probability of Loss":"Sharpe Ratio"}),s.jsx("div",{className:"text-xl font-bold text-red-400 mb-1",children:"probabilityOfLoss"===e?`${(100*t).toFixed(1)}%`:A(t)}),s.jsx("div",{className:"text-xs text-gray-400",children:"Risk measure"})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:["📊 Confidence Intervals (",(100*n.analysis.confidenceIntervals.pricePerShare?.level).toFixed(0),"%)"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(n.analysis.confidenceIntervals).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Lower Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${t.lowerBound.toFixed(1)}%`:A(t.lowerBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Upper Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${t.upperBound.toFixed(1)}%`:A(t.upperBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Width:"}),s.jsx("span",{className:"font-medium text-blue-400",children:"upside"===e?`${t.width.toFixed(1)}%`:A(t.width)})]})]})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Percentile Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-300",children:"Metric"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"5th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"25th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"50th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"75th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"95th %ile"})]})}),s.jsx("tbody",{children:Object.entries(n.analysis.percentiles).map(([e,t])=>s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("td",{className:"p-3 text-sm text-white",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p5.toFixed(1)}%`:A(t.p5)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p25.toFixed(1)}%`:A(t.p25)}),s.jsx("td",{className:"p-3 text-sm text-right text-blue-400 font-medium",children:"upside"===e?`${t.p50.toFixed(1)}%`:A(t.p50)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p75.toFixed(1)}%`:A(t.p75)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p95.toFixed(1)}%`:A(t.p95)})]},e))})]})})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(k,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Analysis Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see analysis here."})]})},"analysis")]})})]})},rt=({data:t,modelInputs:a,onModelInputChange:r,calculateDCF:i,formatCurrency:l,formatPercent:n})=>{const[o,c]=e.useState(!1),d=a.scenario?.scenarios||[],m=e.useMemo(()=>d.map(e=>{try{const s={...t.statements.incomeStatement},a=s.totalRevenue||{},r={};Object.keys(a).forEach(t=>{const s=parseInt(t);if(0===s)r[t]=a[t];else{const i=1+e.revenueGrowth/100;r[t]=a[0]*Math.pow(i,s)}});const l=s.operatingIncome||{},n={};Object.keys(l).forEach(t=>{if(0===parseInt(t))n[t]=l[t];else{const s=a[t]||0,i=r[t]||0,o=l[t]||0;if(s>0){const a=o/s+e.marginImprovement/100;n[t]=i*a}else n[t]=o}});const o={...t,statements:{...t.statements,incomeStatement:{...s,totalRevenue:r,operatingIncome:n}}},c=i(o);return{...e,...c,weightedValue:c.enterpriseValue*(e.probability/100)}}catch(s){return{...e,enterpriseValue:0,equityValue:0,weightedValue:0}}}),[d,t,i]),x=m.reduce((e,t)=>e+t.weightedValue,0),u=(e,t,s)=>{const a=d.map((a,r)=>r===e?{...a,[t]:s}:a);r("scenario","scenarios",a)},h=({scenario:e,index:t})=>s.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-name-${t}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Scenario Name"}),s.jsx("input",{id:`scenario-name-${t}`,type:"text",value:e.name,onChange:e=>u(t,"name",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter scenario name"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-probability-${t}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Probability (%)"}),s.jsx("input",{id:`scenario-probability-${t}`,type:"number",min:"0",max:"100",value:e.probability,onChange:e=>u(t,"probability",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-revenueGrowth-${t}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue Growth (%)"}),s.jsx("input",{id:`scenario-revenueGrowth-${t}`,type:"number",step:"0.1",value:e.revenueGrowth,onChange:e=>u(t,"revenueGrowth",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-marginImprovement-${t}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Margin Change (%)"}),s.jsx("input",{id:`scenario-marginImprovement-${t}`,type:"number",step:"0.1",value:e.marginImprovement,onChange:e=>u(t,"marginImprovement",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsx("div",{className:"flex justify-end mt-4 gap-2",children:s.jsxs("button",{onClick:()=>(e=>{const t=d.filter((t,s)=>s!==e);r("scenario","scenarios",t)})(t),className:"px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-1",children:[s.jsx(G,{size:16}),"Delete"]})})]});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{children:s.jsx("p",{className:"text-gray-600",children:"Create and compare multiple financial scenarios with different assumptions and probabilities."})}),s.jsxs("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[s.jsx(q,{size:16}),"Add Scenario"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Assumptions"}),d.map((e,t)=>s.jsx(h,{scenario:e,index:t},t)),o&&s.jsx("div",{className:"border-2 border-dashed border-blue-300 rounded-lg p-4",children:s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h5",{className:"font-medium",children:"Add New Scenario"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{const e={name:`Scenario ${d.length+1}`,probability:Math.max(0,100-d.reduce((e,t)=>e+t.probability,0)),revenueGrowth:10,marginImprovement:0};r("scenario","scenarios",[...d,e]),c(!1)},className:"px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Add"}),s.jsx("button",{onClick:()=>c(!1),className:"px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})})]}),m.length>0&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Analysis Results"}),s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(b,{size:20,className:"text-blue-600"}),s.jsx("h5",{className:"font-semibold text-blue-800",children:"Probability-Weighted Valuation"})]}),s.jsx("div",{className:"text-3xl font-bold text-blue-800",children:l(x)}),s.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"Expected value based on scenario probabilities"})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:m.map((e,t)=>s.jsxs(le.div,{className:"bg-white rounded-lg border p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{children:[s.jsx("h6",{className:"font-semibold text-gray-800",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsxs("span",{children:[e.probability,"% probability"]}),e.revenueGrowth>15?s.jsx(y,{size:14,className:"text-green-500"}):e.revenueGrowth<5?s.jsx(A,{size:14,className:"text-red-500"}):s.jsx(T,{size:14,className:"text-gray-500"})]})]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Enterprise Value"}),s.jsx("div",{className:"text-xl font-bold text-gray-800",children:l(e.enterpriseValue)})]}),s.jsxs("div",{className:"text-xs space-y-1 text-gray-600",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Revenue Growth:"}),s.jsx("span",{className:"font-medium",children:n(e.revenueGrowth)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Margin Change:"}),s.jsxs("span",{className:"font-medium "+(e.marginImprovement>=0?"text-green-600":"text-red-600"),children:[e.marginImprovement>=0?"+":"",n(e.marginImprovement)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Weighted Value:"}),s.jsx("span",{className:"font-medium",children:l(e.weightedValue)})]})]})]})]},t))}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h5",{className:"font-semibold mb-4",children:"Scenario Statistics"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:l(Math.max(...m.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:l(Math.min(...m.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l(x)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-800",children:l(Math.max(...m.map(e=>e.enterpriseValue))-Math.min(...m.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Value Range"})]})]}),s.jsx("div",{className:"mt-4 pt-4 border-t",children:s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("strong",{children:"Total Probability:"})," ",d.reduce((e,t)=>e+t.probability,0),"%",100!==d.reduce((e,t)=>e+t.probability,0)&&s.jsx("span",{className:"text-orange-600 ml-2",children:"⚠ Probabilities should sum to 100%"})]})})]})]}),0===d.length&&s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(b,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"No scenarios created yet."}),s.jsx("p",{className:"text-sm mt-2",children:"Click “Add Scenario” to get started with scenario modeling."})]})]})},it=({data:t,modelInputs:a,onModelInputChange:r,calculateDCF:i,formatCurrency:l,_formatPercent:n})=>{const[o,c]=e.useState(null),d=a.sensitivity||{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},m={revenue:{name:"Revenue Growth",unit:"%",description:"Annual revenue growth rate",baseValue:15,isPercentage:!0},grossMargin:{name:"Gross Margin",unit:"%",description:"Gross profit margin improvement",baseValue:45,isPercentage:!0},discountRate:{name:"Discount Rate (WACC)",unit:"%",description:"Weighted average cost of capital",baseValue:a.dcf?.discountRate||10,isPercentage:!0},terminalGrowthRate:{name:"Terminal Growth Rate",unit:"%",description:"Long-term growth rate assumption",baseValue:a.dcf?.terminalGrowthRate||2.5,isPercentage:!0},taxRate:{name:"Tax Rate",unit:"%",description:"Corporate tax rate",baseValue:a.dcf?.taxRate||25,isPercentage:!0}},x=e.useMemo(()=>i(),[t,a,i]),u=e.useMemo(()=>{const e={};return d.variables.forEach(s=>{const r=d.ranges[s],i=m[s];if(!r||!i)return;const l=(r.max-r.min)/8,n=[];for(let e=0;e<9;e++){const o=r.min+l*e;let c={...t};const d={...a.dcf,[s]:(i.isPercentage,o)};if("revenue"===s||"grossMargin"===s){const e={...t.statements.incomeStatement};if("revenue"===s){const t=e.totalRevenue||{},s={};Object.keys(t).forEach(e=>{const a=parseInt(e);if(0===a)s[e]=t[e];else{const r=1+o/100;s[e]=t[0]*Math.pow(r,a)}}),e.totalRevenue=s}if("grossMargin"===s){const t=e.operatingIncome||{},s=e.totalRevenue||{},a={};Object.keys(t).forEach(e=>{const r=s[e]||0,i=t[e]||0;if(r>0){const t=i/r+o/100;a[e]=r*t}else a[e]=i}),e.operatingIncome=a}c={...t,statements:{...t.statements,incomeStatement:e}}}const m=(()=>{try{const e={discountRate:d.discountRate||10,terminalGrowthRate:d.terminalGrowthRate||2.5,projectionYears:d.projectionYears||5,taxRate:d.taxRate||25},t=c.statements.incomeStatement.operatingIncome||{},s=[];if(Object.keys(t).forEach(e=>{parseInt(e)>=0&&s.push(t[e]||0)}),0===s.length)return{enterpriseValue:0,equityValue:0};let a=0;const r=1+e.discountRate/100;s.forEach((t,s)=>{if(s>0&&s<=e.projectionYears){const i=t*(1-e.taxRate/100)/Math.pow(r,s);a+=i}});const i=s[s.length-1]||0,l=i*(1+e.terminalGrowthRate/100)*(1-e.taxRate/100)/((e.discountRate-e.terminalGrowthRate)/100),n=l/Math.pow(r,e.projectionYears),o=a+n;return{enterpriseValue:o,equityValue:o,presentValueOperations:a,presentValueTerminal:n,terminalValue:l}}catch(e){return{enterpriseValue:0,equityValue:0}}})();n.push({variable:o,valuation:m.enterpriseValue,changeFromBase:(m.enterpriseValue-x.enterpriseValue)/x.enterpriseValue*100})}e[s]={definition:i,range:r,dataPoints:n}}),e},[t,a,d,x,i]),h=e.useMemo(()=>Object.entries(u).map(([e,t])=>{const s=Math.max(...t.dataPoints.map(e=>Math.abs(e.changeFromBase)));return{variable:e,definition:t.definition,maxImpact:s,positiveImpact:Math.max(...t.dataPoints.map(e=>e.changeFromBase)),negativeImpact:Math.min(...t.dataPoints.map(e=>e.changeFromBase))}}).sort((e,t)=>t.maxImpact-e.maxImpact),[u]),p=(e,t,s)=>{const a={...d.ranges,[e]:{...d.ranges[e],[t]:parseFloat(s)}};r("sensitivity","ranges",a)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600 mb-4",children:"Analyze how changes in key variables impact enterprise valuation. Higher sensitivity indicates greater risk and importance for due diligence."}),s.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),s.jsxs("span",{children:["Base Case: ",l(x.enterpriseValue)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(I,{size:14}),s.jsxs("span",{children:[d.variables.length," variables analyzed"]})]})]})]}),s.jsxs("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[s.jsx(B,{size:16}),"Configure"]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("h4",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[s.jsx(b,{size:20}),"Impact Ranking (Tornado Chart)"]}),s.jsx("div",{className:"space-y-3",children:h.map((e,t)=>s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("span",{className:"text-sm font-medium",children:[t+1,". ",e.definition.name]}),s.jsxs("span",{className:"text-xs text-gray-500",children:["±",e.maxImpact.toFixed(1),"%"]})]}),s.jsxs("div",{className:"relative h-8 bg-gray-100 rounded",children:[s.jsx("div",{className:"absolute left-1/2 h-full bg-red-400 rounded-l",style:{width:Math.abs(e.negativeImpact)/Math.max(Math.abs(e.negativeImpact),e.positiveImpact)*50+"%",transform:"translateX(-100%)"}}),s.jsx("div",{className:"absolute left-1/2 h-full bg-green-400 rounded-r",style:{width:e.positiveImpact/Math.max(Math.abs(e.negativeImpact),e.positiveImpact)*50+"%"}}),s.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-400 transform -translate-x-0.5"}),s.jsxs("div",{className:"absolute inset-0 flex items-center justify-between px-2 text-xs font-medium text-white",children:[s.jsxs("span",{children:[e.negativeImpact.toFixed(1),"%"]}),s.jsxs("span",{children:["+",e.positiveImpact.toFixed(1),"%"]})]})]})]},e.variable))})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Variable Configuration"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.variables.map(e=>{const t=u[e];return t?s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium",children:t.definition.name}),s.jsx("p",{className:"text-xs text-gray-500",children:t.definition.description})]}),s.jsx("button",{onClick:()=>(e=>{const t=d.variables.filter(t=>t!==e),{[e]:s,...a}=d.ranges;r("sensitivity","variables",t),r("sensitivity","ranges",a)})(e),className:"text-red-500 hover:bg-red-50 p-1 rounded",children:s.jsx(T,{size:16})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Min Value (",t.definition.unit,")"]}),s.jsx("input",{type:"number",step:"0.1",value:t.range.min,onChange:t=>p(e,"min",t.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Max Value (",t.definition.unit,")"]}),s.jsx("input",{type:"number",step:"0.1",value:t.range.max,onChange:t=>p(e,"max",t.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"h-16 bg-gray-50 rounded p-2",children:[s.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Valuation Sensitivity"}),s.jsx("div",{className:"flex items-end justify-between h-8",children:t.dataPoints.map((e,a)=>s.jsx("div",{className:"w-1 rounded-t "+(e.changeFromBase>0?"bg-green-400":e.changeFromBase<0?"bg-red-400":"bg-blue-400"),style:{height:Math.abs(e.changeFromBase)/50*100+"%",minHeight:"2px"},title:`${e.variable}${t.definition.unit}: ${l(e.valuation)}`},a))})]})]},e):null}),s.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(q,{size:24,className:"mx-auto mb-2 text-gray-400"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Add Variable"}),s.jsx("div",{className:"space-y-2",children:Object.keys(m).filter(e=>!d.variables.includes(e)).map(e=>s.jsx("button",{onClick:()=>(e=>{if(!d.variables.includes(e)&&m[e]){const t=[...d.variables,e],s={...d.ranges,[e]:{min:-10,max:10}};r("sensitivity","variables",t),r("sensitivity","ranges",s)}})(e),className:"block w-full px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:m[e].name},e))})]})})]})]}),o&&u[o]&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("h4",{className:"font-semibold text-lg mb-4",children:["Detailed Analysis: ",u[o].definition.name]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-3",children:"Data Points"}),s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:u[o].dataPoints.map((e,t)=>s.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-gray-50 rounded",children:[s.jsxs("span",{children:[e.variable,u[o].definition.unit]}),s.jsx("span",{className:"font-medium",children:l(e.valuation)}),s.jsxs("span",{className:"font-medium "+(e.changeFromBase>0?"text-green-600":e.changeFromBase<0?"text-red-600":"text-gray-600"),children:[e.changeFromBase>0?"+":"",e.changeFromBase.toFixed(1),"%"]})]},t))})]}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Range Impact:"}),s.jsxs("span",{className:"font-medium",children:["±",Math.max(...u[o].dataPoints.map(e=>Math.abs(e.changeFromBase))).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Max Upside:"}),s.jsxs("span",{className:"font-medium text-green-600",children:["+",Math.max(...u[o].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Max Downside:"}),s.jsxs("span",{className:"font-medium text-red-600",children:[Math.min(...u[o].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]})]})]})]})]})]})},lt=({onOpenOptions:e,onOpenBonds:t,onOpenCredit:a})=>s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[s.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Advanced Analytics Tools"}),s.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Send your current analysis assumptions to advanced pricing models:"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:e,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Options Pricer"}),s.jsx("button",{onClick:t,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Bond Analytics"}),s.jsx("button",{onClick:a,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Credit Modeling"})]})]}),nt=({data:a,adjustedValues:r,onDataChange:l})=>{const[n,o]=e.useState("dcf"),[c,d]=e.useState({dcf:{discountRate:10,terminalGrowthRate:2.5,projectionYears:5,terminalValueMultiple:10,taxRate:25,sharesOutstanding:1e3,workingCapital:{receivablesDays:45,inventoryDays:60,payablesDays:30,receivablesGrowth:2,inventoryGrowth:1.5,payablesGrowth:1.8},capex:{capexAsPercentOfRevenue:3.5,depreciationRate:7,maintenanceCapex:2}},ratios:{compareToIndustry:!0,industryAverages:{grossMargin:45,operatingMargin:15,netMargin:8,currentRatio:2.1,debtToEquity:.5}},sensitivity:{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},scenario:{scenarios:[{name:"Base Case",probability:50,revenueGrowth:15,marginImprovement:0},{name:"Bull Case",probability:25,revenueGrowth:25,marginImprovement:2},{name:"Bear Case",probability:25,revenueGrowth:5,marginImprovement:-2}]}}),m=e.useMemo(()=>{const e=a.statements.incomeStatement,t=a.periods,s={revenue:[],grossProfit:[],operatingIncome:[],margins:{gross:[],operating:[],net:[]},growth:{revenue:[],operating:[]}};return t.forEach((a,i)=>{const l=i===t.length-1,n=l&&r?.totalRevenue?r.totalRevenue:e.totalRevenue?.[i]||0,o=l&&r?.totalCostOfGoodsSold?r.totalCostOfGoodsSold:e.totalCostOfGoodsSold?.[i]||0,c=l&&r?.grossProfit?r.grossProfit:e.grossProfit?.[i]||n-o,d=l&&r?.operatingIncome?r.operatingIncome:e.operatingIncome?.[i]||0;if(s.revenue.push(n),s.grossProfit.push(c),s.operatingIncome.push(d),s.margins.gross.push(n?c/n*100:0),s.margins.operating.push(n?d/n*100:0),i>0){const t=e.totalRevenue?.[i-1]||0,a=e.operatingIncome?.[i-1]||0;s.growth.revenue.push(t?(n-t)/t*100:0),s.growth.operating.push(a?(d-a)/a*100:0)}}),s},[a]),x=(e=null)=>{const{discountRate:t,terminalGrowthRate:s,projectionYears:r,taxRate:i}=c.dcf,l=e||a;let n;if(e?(n=[],l.periods.forEach((e,t)=>{t>0&&t<=r&&n.push(l.statements.incomeStatement.operatingIncome?.[t]||0)})):n=m.operatingIncome.slice(1,r+1),0===n.length)return{enterpriseValue:0,equityValue:0,sharePrice:0};let o=0;const d=1+t/100;n.forEach((e,t)=>{const s=e*(1-i/100)/Math.pow(d,t+1);o+=s});const x=(n[n.length-1]||0)*(1+s/100)*(1-i/100)/((t-s)/100),u=x/Math.pow(d,r),h=o+u;return{enterpriseValue:h,equityValue:h,presentValueOperations:o,presentValueTerminal:u,terminalValue:x}};x();const u=[{id:"dcf",label:"DCF Valuation",icon:g,description:"Discounted Cash Flow analysis"},{id:"ratios",label:"Ratio Analysis",icon:b,description:"Financial ratio comparison"},{id:"sensitivity",label:"Sensitivity Analysis",icon:I,description:"Variable impact analysis"},{id:"scenario",label:"Scenario Modeling",icon:j,description:"Multi-scenario projections"},{id:"comparable",label:"Comparable Analysis",icon:i,description:"Market-based valuation"},{id:"montecarlo",label:"Monte Carlo",icon:w,description:"Probabilistic risk analysis"}],h=(e,t,s)=>{d(a=>({...a,[e]:{...a[e],[t]:s}}))},p=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(1e3*e),y=e=>`${e.toFixed(1)}%`;return s.jsxs("div",{className:"h-full bg-gray-900 text-white p-6",children:[s.jsx(lt,{onOpenOptions:()=>{window.dispatchEvent(new CustomEvent("open-options-pricer"))},onOpenBonds:()=>{window.dispatchEvent(new CustomEvent("open-bond-analytics"))},onOpenCredit:()=>{window.dispatchEvent(new CustomEvent("open-credit-modeling"))}}),s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Financial Modeling"}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Select a modeling approach to analyze your financial data"})]})}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:u.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>o(e.id),className:(n===e.id?"bg-blue-600 text-white border-blue-500 shadow-lg":"bg-gray-800 text-gray-300 border-gray-700 hover:bg-gray-700 hover:text-white hover:border-gray-600")+" flex items-center gap-3 px-4 py-3 rounded-lg border transition-all duration-200",children:[s.jsx(t,{size:18,className:n===e.id?"text-white":"text-blue-400"}),s.jsx("span",{className:"font-medium",children:e.label})]},e.id)})}),s.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[t.createElement(u.find(e=>e.id===n)?.icon,{size:20,className:"text-blue-400"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-white",children:u.find(e=>e.id===n)?.label}),s.jsx("p",{className:"text-gray-400 text-sm",children:u.find(e=>e.id===n)?.description})]})]})})]}),s.jsxs("div",{children:["dcf"===n&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(g,{size:20,className:"text-blue-400"}),"DCF Valuation Model"]}),s.jsx(et,{data:a,modelInputs:c,onModelInputChange:h,formatCurrency:p,formatPercent:y})]}),"ratios"===n&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(b,{size:20}),"Financial Ratio Analysis"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Profitability Ratios"}),s.jsxs("div",{className:"space-y-3",children:[m.margins.gross.map((e,t)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Gross Margin:"]}),s.jsx("span",{className:"font-medium",children:y(e)})]},t)),m.margins.operating.map((e,t)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Operating Margin:"]}),s.jsx("span",{className:"font-medium",children:y(e)})]},t))]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Growth Rates"}),s.jsxs("div",{className:"space-y-3",children:[m.growth.revenue.map((e,t)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Revenue Growth:"]}),s.jsx("span",{className:"font-medium "+(e>=0?"text-green-600":"text-red-600"),children:y(e)})]},t)),m.growth.operating.map((e,t)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Operating Growth:"]}),s.jsx("span",{className:"font-medium "+(e>=0?"text-green-600":"text-red-600"),children:y(e)})]},t))]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Industry Comparison"}),s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"p-3 bg-gray-700 rounded-lg",children:[s.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Industry Avg"}),s.jsxs("div",{className:"text-sm",children:["Gross Margin: ",y(c.ratios.industryAverages.grossMargin)]}),s.jsxs("div",{className:"text-sm",children:["Operating Margin: ",y(c.ratios.industryAverages.operatingMargin)]}),s.jsxs("div",{className:"text-sm",children:["Net Margin: ",y(c.ratios.industryAverages.netMargin)]})]})})]})]})]}),"sensitivity"===n&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(I,{size:20}),"Sensitivity Analysis"]}),s.jsx(it,{data:a,modelInputs:c,onModelInputChange:h,calculateDCF:x,formatCurrency:p,formatPercent:y})]}),"scenario"===n&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(j,{size:20}),"Scenario Modeling"]}),s.jsx(rt,{data:a,modelInputs:c,onModelInputChange:h,calculateDCF:x,formatCurrency:p,formatPercent:y})]}),"comparable"===n&&s.jsx("div",{className:"p-6",children:s.jsx(tt,{data:a,formatCurrency:p,formatPercent:y})}),"montecarlo"===n&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[s.jsx(w,{size:20}),"Monte Carlo Simulation"]}),s.jsx(at,{data:a,onDataChange:l})]})]})]})},ot=({data:t,dcfResults:a,lboResults:r,financialModel:i,scenarioResults:l,onDataChange:n})=>{const[o,c]=e.useState("unified"),[d,m]=e.useState({iterations:1e4,confidenceLevel:.95,correlationsEnabled:!0,crossModelAnalysis:!0,riskMetrics:["var","cvar","downside"]}),[x,u]=e.useState(null),[h,p]=e.useState(!1),[g,b]=e.useState(0),f=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),v=e.useCallback(e=>`${(100*e).toFixed(1)}%`,[]),N=e.useCallback(async()=>{p(!0),b(0);try{const e={dcf:null,lbo:null,correlation:null,portfolio:null,riskMetrics:null};if(a&&d.crossModelAnalysis){const s={revenueGrowthRate:{type:"normal",parameters:{mean:.05,stdDev:.02},enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.1,mode:.15,max:.2},enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},enabled:!0}},r={currentRevenue:1e3*t?.statements?.incomeStatement?.totalRevenue?.[0]||1e6,currentPrice:100,sharesOutstanding:1e6,...a};b(25),e.dcf=await st.runDCFSimulation(r,s,{iterations:d.iterations,confidenceLevel:d.confidenceLevel,onProgress:e=>b(25+.25*e)})}if(r&&d.crossModelAnalysis){const t={ebitdaGrowthRate:{type:"normal",parameters:{mean:.06,stdDev:.02},enabled:!0},exitMultiple:{type:"triangular",parameters:{min:8,mode:10,max:12},enabled:!0},leverageRatio:{type:"normal",parameters:{mean:5.5,stdDev:.5},enabled:!0}};b(50),e.lbo=await st.runLBOSimulation(r.inputs||{},t,{iterations:d.iterations,confidenceLevel:d.confidenceLevel,onProgress:e=>b(50+.25*e)})}e.dcf&&e.lbo&&d.correlationsEnabled&&(b(75),e.correlation=C(e.dcf,e.lbo)),b(90),e.riskMetrics=S(e),l&&l.scenarios&&(e.portfolio=R(e,l)),b(100),u(e),n&&n({monteCarloIntegrated:{settings:d,results:e,timestamp:(new Date).toISOString()}})}catch(e){alert(`Simulation error: ${e.message}`)}finally{p(!1),b(0)}},[a,r,l,d,t,n]),C=e.useCallback((e,t)=>{const s=e.simulations?.map(e=>e.pricePerShare)||[],a=t.simulations?.map(e=>e.irr)||[];if(0===s.length||0===a.length)return null;const r=k(s,a);return{dcfLboCorrelation:r,interpretation:Math.abs(r)>.7?"Strong":Math.abs(r)>.4?"Moderate":"Weak",riskImplication:r>0?"Aligned Risk":"Hedged Risk"}},[]),k=(e,t)=>{const s=Math.min(e.length,t.length);if(0===s)return 0;const a=e.slice(0,s).reduce((e,t)=>e+t,0),r=t.slice(0,s).reduce((e,t)=>e+t,0),i=e.slice(0,s).reduce((e,s,a)=>e+s*t[a],0),l=e.slice(0,s).reduce((e,t)=>e+t*t,0),n=t.slice(0,s).reduce((e,t)=>e+t*t,0),o=s*i-a*r,c=Math.sqrt((s*l-a*a)*(s*n-r*r));return 0===c?0:o/c},S=e.useCallback(e=>{const t={};return e.dcf?.analysis&&(t.dcf={var95:e.dcf.analysis.percentiles?.pricePerShare?.p5||0,expectedValue:e.dcf.analysis.summary?.mean||0,volatility:e.dcf.analysis.summary?.standardDeviation||0}),e.lbo?.analysis&&(t.lbo={var95:e.lbo.analysis.percentiles?.irr?.p5||0,expectedValue:e.lbo.analysis.summary?.mean||0,volatility:e.lbo.analysis.summary?.standardDeviation||0}),t},[]),R=e.useCallback((e,t)=>t.scenarios.reduce((t,s)=>{const a=s.probability/100;return e.dcf&&(t.dcfWeighted=(t.dcfWeighted||0)+(e.dcf.analysis?.summary?.mean||0)*a),e.lbo&&(t.lboWeighted=(t.lboWeighted||0)+(e.lbo.analysis?.summary?.mean||0)*a),t},{}),[]),M=[{id:"unified",label:"Unified Analysis",icon:w},{id:"dcf",label:"DCF Monte Carlo",icon:y},{id:"lbo",label:"LBO Monte Carlo",icon:j},{id:"correlation",label:"Cross-Model Risk",icon:I}];return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(w,{className:"text-purple-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Monte Carlo Integration Hub"}),s.jsx("p",{className:"text-gray-600",children:"Cross-model risk analysis & unified simulations"})]})]}),s.jsx("div",{className:"flex space-x-3",children:s.jsxs(le.button,{onClick:N,disabled:h,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(h?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:h?{}:{scale:1.02},whileTap:h?{}:{scale:.98},children:[s.jsx(z,{size:18}),s.jsx("span",{children:h?"Running...":"Run Integrated Simulation"})]})})]}),h&&s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Simulation Progress"}),s.jsxs("span",{className:"text-sm text-gray-500",children:[g.toFixed(0),"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Simulation Settings"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"iterations",children:"Iterations"}),s.jsx("input",{id:"iterations",type:"number",value:d.iterations,onChange:e=>m(t=>({...t,iterations:parseInt(e.target.value)||1e4})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"confidence-level",children:"Confidence Level"}),s.jsxs("select",{id:"confidence-level",value:d.confidenceLevel,onChange:e=>m(t=>({...t,confidenceLevel:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:.9,children:"90%"}),s.jsx("option",{value:.95,children:"95%"}),s.jsx("option",{value:.99,children:"99%"})]})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:d.correlationsEnabled,onChange:e=>m(t=>({...t,correlationsEnabled:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Cross-Model Correlations"})]})}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:d.crossModelAnalysis,onChange:e=>m(t=>({...t,crossModelAnalysis:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Cross-Model Analysis"})]})})]})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:M.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>c(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(o===e.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),x?s.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:["unified"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[x.dcf&&s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f(x.dcf.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"DCF Expected Value"})]}),x.lbo&&s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:v(x.lbo.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"LBO Expected IRR"})]}),x.correlation&&s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:(x.correlation.dcfLboCorrelation||0).toFixed(2)}),s.jsx("div",{className:"text-sm text-gray-600",children:"DCF-LBO Correlation"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:d.iterations.toLocaleString()}),s.jsx("div",{className:"text-sm text-gray-600",children:"Simulations Run"})]})]}),x.correlation&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Cross-Model Risk Analysis"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Correlation Strength"}),s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:x.correlation.interpretation}),s.jsx("div",{className:"text-sm text-gray-600",children:x.correlation.riskImplication})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Risk Diversification"}),s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.abs(x.correlation.dcfLboCorrelation)<.5?"High":"Low"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Portfolio benefit"})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Confidence Level"}),s.jsx("div",{className:"text-2xl font-bold text-green-600",children:v(d.confidenceLevel)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Statistical confidence"})]})]})]}),x.portfolio&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Portfolio-Weighted Analysis"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Scenario-Weighted DCF"}),s.jsx("div",{className:"text-xl font-bold text-blue-600",children:f(x.portfolio.dcfWeighted||0)})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Scenario-Weighted LBO IRR"}),s.jsx("div",{className:"text-xl font-bold text-green-600",children:v(x.portfolio.lboWeighted||0)})]})]})]})]}),"dcf"===o&&x.dcf&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"DCF Monte Carlo Results"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-blue-600",children:f(x.dcf.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Mean Value"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-green-600",children:f(x.dcf.analysis?.percentiles?.pricePerShare?.p95||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"95th Percentile"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-red-600",children:f(x.dcf.analysis?.percentiles?.pricePerShare?.p5||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"5th Percentile"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-purple-600",children:f(x.dcf.analysis?.summary?.standardDeviation||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Std Deviation"})]})]})]}),"lbo"===o&&x.lbo&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"LBO Monte Carlo Results"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-green-600",children:v(x.lbo.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Mean IRR"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-blue-600",children:v(x.lbo.analysis?.percentiles?.irr?.p95||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"95th Percentile IRR"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-red-600",children:v(x.lbo.analysis?.percentiles?.irr?.p5||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"5th Percentile IRR"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-lg font-bold text-purple-600",children:[((x.lbo.analysis?.percentiles?.moic?.p95||0)+(x.lbo.analysis?.percentiles?.moic?.p5||0))/2,"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Avg MOIC"})]})]})]})]}):s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(w,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Configure settings and run integrated simulation to see cross-model analysis"}),s.jsx("p",{className:"text-sm mt-2",children:a||r?"Ready to run comprehensive Monte Carlo analysis":"Run DCF and/or LBO analysis first to enable Monte Carlo integration"})]})]})},ct={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ADSENSE_ID:"your-adsense-id-here",VITE_ALPHA_VANTAGE_API_KEY:"your_staging_alpha_vantage_api_key_here",VITE_ALPHA_VANTAGE_BASE_URL:"https://www.alphavantage.co/query",VITE_ANTHROPIC_API_KEY:"your-anthropic-api-key-here",VITE_API_BASE_URL:"https://api.financeanalyst.pro",VITE_APP_ENV:"production",VITE_APP_URL:"https://financeanalyst.pro",VITE_APP_VERSION:"1.0.0",VITE_ASSETS_BASE_URL:"/assets/",VITE_BACKUP_ENABLED:"true",VITE_CACHE_ENABLED:"true",VITE_CACHE_TTL:"300000",VITE_CDN_URL:"https://cdn.yourapp.com",VITE_COLLAB_WS_MOCK:"true",VITE_COOKIE_CONSENT_ENABLED:"true",VITE_CORE_WEB_VITALS_TRACKING:"true",VITE_DEBUG:"false",VITE_DEFAULT_TICKER:"AAPL",VITE_ENABLE_ADVANCED_FEATURES:"true",VITE_ENABLE_ANALYTICS:"true",VITE_ENABLE_BETA_FEATURES:"false",VITE_ENABLE_COLLABORATION:"false",VITE_ENABLE_DEBUG_MODE:"false",VITE_ENABLE_ERROR_REPORTING:"true",VITE_ENABLE_TEST_DATA:"true",VITE_FMP_API_KEY:"your_staging_fmp_api_key_here",VITE_FMP_BASE_URL:"https://financialmodelingprep.com/api/v3",VITE_FORCE_DEMO_MODE:"false",VITE_GA_TRACKING_ID:"your_google_analytics_id_here",VITE_GEMINI_API_KEY:"your-gemini-api-key-here",VITE_GOOGLE_ANALYTICS_ID:"your-google-analytics-id-here",VITE_HOTJAR_ID:"your_hotjar_id_here",VITE_LIGHTHOUSE_CI:"true",VITE_MAX_REQUESTS_PER_MINUTE:"60",VITE_MOCK_API_RESPONSES:"false",VITE_OPENAI_API_KEY:"your-openai-api-key-here",VITE_PERFORMANCE_MONITORING:"true",VITE_PERPLEXITY_API_KEY:"your-perplexity-api-key-here",VITE_POLYGON_API_KEY:"your_staging_polygon_api_key_here",VITE_POLYGON_BASE_URL:"https://api.polygon.io/v2",VITE_PRIVACY_POLICY_URL:"https://financeanalyst.pro/privacy",VITE_RATE_LIMITING_ENABLED:"true",VITE_SENTRY_DSN:"your_sentry_dsn_here",VITE_STORAGE_BUCKET:"financeanalyst-prod-storage",VITE_STRIPE_PUBLISHABLE_KEY:"your-stripe-publishable-key-here",VITE_SUPABASE_ANON_KEY:"dummykey.updateyourkkey.here",VITE_SUPABASE_URL:"https://dummy.supabase.co",VITE_SUPPORT_URL:"https://support.financeanalyst.pro",VITE_TERMS_OF_SERVICE_URL:"https://financeanalyst.pro/terms",VITE_VERBOSE_LOGGING:"true"};class dt extends Ae.EventEmitter{constructor(){super(),this.workspaces=new Map,this.users=new Map,this.connections=new Map,this.annotations=new Map,this.modelStates=new Map,this.isInitialized=!1,this.wsConnection=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.heartbeatInterval=null,this.syncQueue=[],this.isOnline=navigator.onLine,this.env=void 0!==import.meta&&ct?ct:{},this.collabEnabled="true"===this.env.VITE_ENABLE_COLLABORATION,this.handleConnectionOpen=this.handleConnectionOpen.bind(this),this.handleConnectionMessage=this.handleConnectionMessage.bind(this),this.handleConnectionClose=this.handleConnectionClose.bind(this),this.handleConnectionError=this.handleConnectionError.bind(this),window.addEventListener("online",()=>{this.isOnline=!0,this.reconnectWebSocket()}),window.addEventListener("offline",()=>{this.isOnline=!1,this.emit("connectionStatus",{online:!1})})}async initialize(e,t={}){try{if(this.isInitialized)return;this.currentUserId=e,this.currentUserProfile={id:e,name:t.name||"Anonymous User",avatar:t.avatar||null,role:t.role||"viewer",joinedAt:(new Date).toISOString(),lastActive:(new Date).toISOString(),...t},this.users.set(e,this.currentUserProfile),this.collabEnabled&&await this.initializeWebSocket(),this.collabEnabled&&this.startHeartbeat(),this.isInitialized=!0,this.emit("initialized",{userId:e,userProfile:this.currentUserProfile})}catch(s){throw s}}async initializeWebSocket(){try{const e=this.env.VITE_COLLAB_WS_URL;let t;if(e)t=e;else if("undefined"!=typeof window&&window.location){t=`${"https:"===window.location.protocol?"wss":"ws"}://${window.location.host}/collaboration`}else t="ws://localhost:8080/collaboration";const s="true"===this.env.VITE_COLLAB_WS_MOCK;s||"undefined"==typeof WebSocket?(this.wsConnection={readyState:1,send:e=>{setTimeout(()=>{this.handleConnectionMessage({data:e})},100)},close:()=>{this.wsConnection.readyState=3,this.handleConnectionClose()}},this.handleConnectionOpen()):(this.wsConnection=new WebSocket(t),this.wsConnection.addEventListener("open",this.handleConnectionOpen),this.wsConnection.addEventListener("message",this.handleConnectionMessage),this.wsConnection.addEventListener("close",this.handleConnectionClose),this.wsConnection.addEventListener("error",this.handleConnectionError))}catch(e){throw e}}handleConnectionOpen(){this.reconnectAttempts=0,this.emit("connectionStatus",{online:!0,connected:!0}),this.sendMessage({type:"auth",userId:this.currentUserId,userProfile:this.currentUserProfile}),this.processSyncQueue()}handleConnectionMessage(e){try{const t="string"==typeof e.data?JSON.parse(e.data):e.data;switch(t.type){case"workspace_update":this.handleWorkspaceUpdate(t.data);break;case"user_joined":this.handleUserJoined(t.data);break;case"user_left":this.handleUserLeft(t.data);break;case"model_update":this.handleModelUpdate(t.data);break;case"annotation_added":this.handleAnnotationAdded(t.data);break;case"annotation_updated":this.handleAnnotationUpdated(t.data);break;case"annotation_deleted":this.handleAnnotationDeleted(t.data);break;case"cursor_update":this.handleCursorUpdate(t.data);break;case"presence_update":this.handlePresenceUpdate(t.data)}}catch(t){}}handleConnectionClose(){this.emit("connectionStatus",{online:this.isOnline,connected:!1}),this.isOnline&&this.reconnectAttempts<this.maxReconnectAttempts&&setTimeout(()=>{this.reconnectWebSocket()},1e3*Math.pow(2,this.reconnectAttempts))}handleConnectionError(e){this.emit("connectionError",e)}async reconnectWebSocket(){if(!(this.reconnectAttempts>=this.maxReconnectAttempts)){this.reconnectAttempts++;try{await this.initializeWebSocket()}catch(e){}}}sendMessage(e){this.wsConnection&&1===this.wsConnection.readyState?this.wsConnection.send(JSON.stringify(e)):this.syncQueue.push(e)}processSyncQueue(){for(;this.syncQueue.length>0;){const e=this.syncQueue.shift();this.sendMessage(e)}}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.wsConnection&&1===this.wsConnection.readyState&&this.sendMessage({type:"ping",timestamp:Date.now()})},3e4)}async joinWorkspace(e,t={}){try{const s={id:e,name:t.name||`Workspace ${e}`,description:t.description||"",createdBy:this.currentUserId,createdAt:(new Date).toISOString(),members:new Map([[this.currentUserId,this.currentUserProfile]]),models:new Map,annotations:new Map,settings:{isPublic:t.isPublic||!1,allowGuests:t.allowGuests||!1,maxMembers:t.maxMembers||10,...t.settings},lastActivity:(new Date).toISOString()};return this.workspaces.set(e,s),this.sendMessage({type:"join_workspace",workspaceId:e,userId:this.currentUserId,options:t}),this.emit("workspaceJoined",{workspaceId:e,workspace:s}),s}catch(s){throw s}}async leaveWorkspace(e){try{const t=this.workspaces.get(e);if(!t)throw new Error("Workspace not found");return t.members.delete(this.currentUserId),0===t.members.size&&this.workspaces.delete(e),this.sendMessage({type:"leave_workspace",workspaceId:e,userId:this.currentUserId}),this.emit("workspaceLeft",{workspaceId:e}),!0}catch(t){throw t}}async shareModel(e,t,s,a={}){try{const r=this.workspaces.get(e);if(!r)throw new Error("Workspace not found");const i={id:t,workspaceId:e,data:s,sharedBy:this.currentUserId,sharedAt:(new Date).toISOString(),permissions:{canEdit:a.canEdit||!1,canComment:!1!==a.canComment,canView:!1!==a.canView,...a},version:1,lastModified:(new Date).toISOString(),modifiedBy:this.currentUserId};return r.models.set(t,i),this.modelStates.set(t,{...s}),this.sendMessage({type:"model_shared",workspaceId:e,modelId:t,sharedModel:i,userId:this.currentUserId}),this.emit("modelShared",{workspaceId:e,modelId:t,sharedModel:i}),i}catch(r){throw r}}async updateModel(e,t,s,a={}){try{const a=this.workspaces.get(e);if(!a)throw new Error("Workspace not found");const r=a.models.get(t);if(!r)throw new Error("Model not found");if(!r.permissions.canEdit&&r.sharedBy!==this.currentUserId)throw new Error("No edit permission for this model");const i={...r.data,...s};return r.data=i,r.version+=1,r.lastModified=(new Date).toISOString(),r.modifiedBy=this.currentUserId,this.modelStates.set(t,i),this.sendMessage({type:"model_update",workspaceId:e,modelId:t,updates:s,version:r.version,userId:this.currentUserId,timestamp:r.lastModified}),this.emit("modelUpdated",{workspaceId:e,modelId:t,updates:s,model:r}),r}catch(r){throw r}}async addAnnotation(e,t,s){try{const a=this.workspaces.get(e);if(!a)throw new Error("Workspace not found");const r=`annotation_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:r,workspaceId:e,modelId:t,content:s.content||"",type:s.type||"comment",position:s.position||{x:0,y:0},target:s.target||null,createdBy:this.currentUserId,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),resolved:!1,replies:[],metadata:s.metadata||{}};return a.annotations.set(r,i),this.sendMessage({type:"annotation_added",workspaceId:e,modelId:t,annotation:i,userId:this.currentUserId}),this.emit("annotationAdded",{workspaceId:e,modelId:t,annotation:i}),i}catch(a){throw a}}updateCursor(e,t){this.sendMessage({type:"cursor_update",workspaceId:e,userId:this.currentUserId,position:t,timestamp:Date.now()})}getWorkspaceMembers(e){const t=this.workspaces.get(e);return t?Array.from(t.members.values()):[]}getWorkspaceModels(e){const t=this.workspaces.get(e);return t?Array.from(t.models.values()):[]}getModelAnnotations(e,t){const s=this.workspaces.get(e);return s?Array.from(s.annotations.values()).filter(e=>e.modelId===t):[]}handleWorkspaceUpdate(e){this.emit("workspaceUpdate",e)}handleUserJoined(e){const t=this.workspaces.get(e.workspaceId);t&&t.members.set(e.user.id,e.user),this.emit("userJoined",e)}handleUserLeft(e){const t=this.workspaces.get(e.workspaceId);t&&t.members.delete(e.userId),this.emit("userLeft",e)}handleModelUpdate(e){const t=this.workspaces.get(e.workspaceId);if(t){const s=t.models.get(e.modelId);s&&(s.data={...s.data,...e.updates},s.version=e.version,s.lastModified=e.timestamp,s.modifiedBy=e.userId)}this.emit("modelUpdate",e)}handleAnnotationAdded(e){const t=this.workspaces.get(e.workspaceId);t&&t.annotations.set(e.annotation.id,e.annotation),this.emit("annotationAdded",e)}handleAnnotationUpdated(e){const t=this.workspaces.get(e.workspaceId);if(t){const s=t.annotations.get(e.annotationId);s&&Object.assign(s,e.updates)}this.emit("annotationUpdated",e)}handleAnnotationDeleted(e){const t=this.workspaces.get(e.workspaceId);t&&t.annotations.delete(e.annotationId),this.emit("annotationDeleted",e)}handleCursorUpdate(e){this.emit("cursorUpdate",e)}handlePresenceUpdate(e){this.emit("presenceUpdate",e)}async cleanup(){try{this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.wsConnection&&this.wsConnection.close(),this.workspaces.clear(),this.users.clear(),this.connections.clear(),this.annotations.clear(),this.modelStates.clear(),this.isInitialized=!1,this.emit("cleanup")}catch(e){}}}const mt=new dt;const xt={dcf:{title:"Discounted Cash Flow (DCF) Analysis",description:"Estimates company value by projecting future cash flows and discounting them to present value.",keyPoints:["Projects free cash flows for 5-10 years","Calculates terminal value for perpetual growth","Uses weighted average cost of capital (WACC) as discount rate","Highly sensitive to growth and discount rate assumptions"],formulas:["FCF = EBIT(1-Tax Rate) + Depreciation - CapEx - Working Capital Change","Terminal Value = FCF × (1+g) / (WACC - g)","Enterprise Value = Σ(FCF/(1+WACC)^t) + Terminal Value/(1+WACC)^n"],tips:["Use conservative growth rates for terminal value (2-4%)","Validate WACC calculation with industry benchmarks","Perform sensitivity analysis on key assumptions","Cross-reference with comparable company multiples"]},lbo:{title:"Leveraged Buyout (LBO) Analysis",description:"Models acquisition using significant debt financing to achieve target returns.",keyPoints:["High debt-to-equity ratio (60-90% debt typical)","Focus on debt paydown and equity value creation","Requires strong, predictable cash flows","Exit typically through sale or IPO after 3-7 years"],formulas:["Equity IRR = (Exit Equity Value / Initial Equity Investment)^(1/years) - 1","Debt Service Coverage = EBITDA / (Interest + Principal Payments)","Exit Multiple = Exit Enterprise Value / Exit EBITDA"],tips:["Model different debt structures and covenants","Include management fees and transaction costs","Test downside scenarios for covenant compliance","Consider operational improvements in projections"]},wacc:{title:"Weighted Average Cost of Capital (WACC)",description:"Blended cost of debt and equity financing used as discount rate in valuations.",keyPoints:["Reflects risk and capital structure of the business","Used as discount rate in DCF analysis","Lower WACC increases company valuation","Varies by industry and company size"],formulas:["WACC = (E/V × Re) + (D/V × Rd × (1-Tax Rate))","Cost of Equity (Re) = Risk-free Rate + Beta × Market Risk Premium","After-tax Cost of Debt = Pre-tax Rate × (1-Tax Rate)"],tips:["Use market values, not book values, for weights","Consider company-specific risk factors","Review beta calculation methodology","Update regularly as market conditions change"]},ratios:{title:"Financial Ratio Analysis",description:"Key metrics for evaluating financial performance, efficiency, and risk.",keyPoints:["Liquidity ratios measure short-term obligations","Leverage ratios assess debt and financial risk","Profitability ratios evaluate operational efficiency","Valuation ratios compare market vs. intrinsic value"],formulas:["Current Ratio = Current Assets / Current Liabilities","Debt-to-Equity = Total Debt / Total Equity","ROE = Net Income / Shareholders Equity","P/E Ratio = Price per Share / Earnings per Share"],tips:["Compare ratios to industry benchmarks","Look at trends over multiple periods","Consider seasonal business variations","Understand accounting policy impacts"]},montecarlo:{title:"Monte Carlo Simulation",description:"Uses random sampling to model uncertainty in financial projections.",keyPoints:["Tests thousands of scenarios with variable inputs","Provides probability distributions of outcomes","Helps quantify risks and uncertainties","Useful for complex models with multiple variables"],formulas:["Confidence Interval = Percentile(results, confidence_level)","Value at Risk = Percentile(results, risk_level)","Expected Value = Mean(simulation_results)"],tips:["Define realistic ranges for input variables","Use appropriate probability distributions","Run sufficient iterations (10,000+) for stability","Validate results against historical data"]}},ut=({helpKey:e,isOpen:t,onClose:a})=>{const r=xt[e];return r&&t?X.createPortal(s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Y,{className:"w-6 h-6 text-blue-600"}),s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:r.title})]}),s.jsx("button",{onClick:a,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg",children:s.jsx(F,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{children:s.jsx("p",{className:"text-slate-700 leading-relaxed",children:r.description})}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-slate-900 mb-3 flex items-center",children:[s.jsx(y,{className:"w-5 h-5 mr-2 text-green-600"}),"Key Points"]}),s.jsx("ul",{className:"space-y-2",children:r.keyPoints.map((e,t)=>s.jsxs("li",{className:"flex items-start space-x-2",children:[s.jsx(P,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),s.jsx("span",{className:"text-slate-700",children:e})]},t))})]}),r.formulas&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-slate-900 mb-3 flex items-center",children:[s.jsx(p,{className:"w-5 h-5 mr-2 text-purple-600"}),"Key Formulas"]}),s.jsx("div",{className:"space-y-2",children:r.formulas.map((e,t)=>s.jsx("div",{className:"bg-slate-100 p-3 rounded-lg",children:s.jsx("code",{className:"text-sm text-slate-800 font-mono",children:e})},t))})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-slate-900 mb-3 flex items-center",children:[s.jsx(x,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Best Practices"]}),s.jsx("ul",{className:"space-y-2",children:r.tips.map((e,t)=>s.jsxs("li",{className:"flex items-start space-x-2",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full mt-2 flex-shrink-0"}),s.jsx("span",{className:"text-slate-700",children:e})]},t))})]}),s.jsx("div",{className:"border-t border-slate-200 pt-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-slate-600",children:"Need more help?"}),s.jsxs("a",{href:"mailto:support@financeanalystpro.com",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center space-x-1",children:[s.jsx("span",{children:"Contact Support"}),s.jsx(Z,{className:"w-3 h-3"})]})]})})]})})]})}),document.body):null},ht=({steps:t,isActive:a,onComplete:r,onSkip:i})=>{const[l,n]=e.useState(0),[o,c]=e.useState({top:0,left:0});if(e.useEffect(()=>{if(a&&t[l]){const e=document.querySelector(t[l].target);if(e){const t=e.getBoundingClientRect(),s=window.pageYOffset||document.documentElement.scrollTop,a=window.pageXOffset||document.documentElement.scrollLeft;e.style.position="relative",e.style.zIndex="1001",e.style.boxShadow="0 0 0 4px rgba(59, 130, 246, 0.5)",c({top:t.bottom+s+8,left:t.left+a})}}return()=>{if(t[l]){const e=document.querySelector(t[l].target);e&&(e.style.position="",e.style.zIndex="",e.style.boxShadow="")}}},[l,a,t]),!a||!t[l])return null;const d=t[l],m=l===t.length-1;return X.createPortal(s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-1000"}),s.jsx("div",{className:"fixed z-1002 max-w-sm bg-white rounded-lg shadow-xl border border-slate-200",style:{top:o.top,left:o.left},children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsx("h3",{className:"font-semibold text-slate-900",children:d.title}),s.jsx("button",{onClick:i,className:"text-slate-400 hover:text-slate-600",children:s.jsx(F,{className:"w-4 h-4"})})]}),s.jsx("p",{className:"text-sm text-slate-700 mb-4",children:d.content}),d.tip&&s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(x,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),s.jsx("p",{className:"text-sm text-blue-800",children:d.tip})]})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-1",children:t.map((e,t)=>s.jsx("div",{className:Ie("w-2 h-2 rounded-full",t===l?"bg-blue-600":"bg-slate-300")},t))}),s.jsxs("div",{className:"flex items-center space-x-2",children:[l>0&&s.jsx("button",{onClick:()=>{l>0&&n(l-1)},className:"px-3 py-1 text-sm text-slate-600 hover:text-slate-800",children:"Back"}),s.jsx("button",{onClick:()=>{m?r():n(l+1)},className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:m?"Finish":"Next"})]})]})]})})]}),document.body)},pt=({className:e,animate:t=!0,variant:a="default",...r})=>s.jsx("div",{className:Ie("bg-slate-200 rounded",t&&"animate-pulse","text"===a&&"h-4","button"===a&&"h-10","avatar"===a&&"h-12 w-12 rounded-full","card"===a&&"h-48",e),...r}),gt=({rows:e=8,columns:t=5,showHeader:a=!0,className:r})=>s.jsxs("div",{className:Ie("space-y-3",r),children:[a&&s.jsx("div",{className:"flex items-center space-x-4 p-4 bg-slate-50 rounded-lg",children:Array.from({length:t}).map((e,t)=>s.jsx(pt,{className:"h-4 flex-1",variant:"text"},`header-${t}`))}),s.jsx("div",{className:"space-y-2",children:Array.from({length:e}).map((e,a)=>s.jsx("div",{className:"flex items-center space-x-4 p-4 border border-slate-200 rounded-lg",children:Array.from({length:t}).map((e,r)=>s.jsx(pt,{className:Ie("h-4",0===r?"flex-2":"flex-1",r>0&&r<t-1&&"w-20")},`cell-${a}-${r}`))},`row-${a}`))})]}),bt=({isLoading:e,skeleton:t,children:a,className:r,fallback:i=null})=>e?s.jsx("div",{className:Ie("animate-pulse",r),children:t||i}):a;class yt extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}}static getDerivedStateFromError(e){return{hasError:!0,errorId:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.logErrorToService(e,t)}logErrorToService=(e,t)=>{const s={message:e.message,stack:e.stack,componentStack:t.componentStack,errorId:this.state.errorId,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,userId:this.props.userId||"anonymous"};try{fetch("/api/errors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).catch(()=>{})}catch(a){}};handleRetry=()=>{this.setState(e=>({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:e.retryCount+1}))};handleReportError=()=>{const{error:e,errorInfo:t,errorId:s}=this.state;(new Date).toISOString();const a=encodeURIComponent(`FinanceAnalyst Pro Error Report - ${s}`),r=encodeURIComponent(`Error Details:\n\nError ID: ${s}\nMessage: ${e?.message}\nTimestamp: ${(new Date).toISOString()}\nURL: ${window.location.href}\n\nTechnical Details:\n${e?.stack}\n\nComponent Stack:\n${t?.componentStack}`);window.open(`mailto:support@financeanalystpro.com?subject=${a}&body=${r}`)};render(){if(this.state.hasError){const{fallback:e,variant:a="default"}=this.props,{error:r,errorId:i,retryCount:l}=this.state;if(e){if(t.isValidElement(e))return e;if("function"==typeof e)return s.jsx(e,{error:r,retry:this.handleRetry})}const n=r?.message?.includes("fetch")||r?.message?.includes("network"),o=r?.message?.includes("Cannot read")||r?.message?.includes("undefined"),c=l>2;return"minimal"===a?s.jsxs("div",{className:"flex items-center justify-center p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsx(k,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("span",{className:"text-red-800 text-sm",children:"Something went wrong"}),s.jsx(Ee,{variant:"ghost",size:"sm",onClick:this.handleRetry,className:"ml-3 text-red-700 hover:text-red-900",children:s.jsx(V,{className:"w-4 h-4"})})]}):"inline"===a?s.jsx("div",{className:"p-4 bg-red-50 border-l-4 border-red-400 rounded-r-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(k,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-medium text-red-800 mb-1",children:"Unable to load this section"}),s.jsx("p",{className:"text-sm text-red-700 mb-2",children:n?"Check your internet connection and try again.":o?"There was an issue with the data format.":"An unexpected error occurred."}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs(Ee,{variant:"outline",size:"sm",onClick:this.handleRetry,className:"text-red-700 border-red-300 hover:bg-red-100",children:[s.jsx(V,{className:"w-3 h-3 mr-1"}),"Try Again"]})})]})]})}):s.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"max-w-lg w-full bg-white rounded-lg shadow-lg border border-slate-200 p-8 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(k,{className:"w-8 h-8 text-red-600"})}),s.jsx("h1",{className:"text-xl font-semibold text-slate-900 mb-2",children:c?"Application Error":"Something went wrong"}),s.jsx("p",{className:"text-slate-600 mb-6",children:c?"The application encountered a critical error. Please refresh the page or contact support.":n?"Unable to connect to our servers. Please check your internet connection and try again.":o?"There was an issue processing the data. This might be a temporary problem.":"An unexpected error occurred. Our team has been notified and is working on a fix."}),i&&s.jsxs("div",{className:"bg-slate-100 rounded-lg p-3 mb-6 text-left",children:[s.jsx("div",{className:"text-xs font-mono text-slate-500 mb-1",children:"Error ID (for support):"}),s.jsx("div",{className:"text-sm font-mono text-slate-700 break-all",children:i})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[!c&&s.jsxs(Ee,{onClick:this.handleRetry,className:"flex items-center justify-center",variant:"primary",children:[s.jsx(V,{className:"w-4 h-4 mr-2"}),"Try Again"]}),s.jsxs(Ee,{onClick:()=>window.location.href="/",variant:"outline",className:"flex items-center justify-center",children:[s.jsx(ee,{className:"w-4 h-4 mr-2"}),"Go Home"]}),s.jsxs(Ee,{onClick:this.handleReportError,variant:"ghost",className:"flex items-center justify-center text-slate-600 hover:text-slate-800",children:[s.jsx(te,{className:"w-4 h-4 mr-2"}),"Report Issue"]})]}),s.jsx("div",{className:"mt-6 pt-6 border-t border-slate-200 text-sm text-slate-500",children:s.jsxs("p",{children:["Need immediate help?"," ",s.jsxs("a",{href:"mailto:support@financeanalystpro.com",className:"text-blue-600 hover:text-blue-800 inline-flex items-center",children:["Contact Support",s.jsx(Z,{className:"w-3 h-3 ml-1"})]})]})}),!1]})})}return this.props.children}}const ft={privateAnalysis:{id:"private-analysis-tour",name:"Private Analysis Walkthrough",description:"Learn how to build and analyze financial models",steps:[{target:'[data-tour="financial-spreadsheet-tab"]',title:"Financial Spreadsheet",content:"Start by building your financial model with historical and projected data. Click here to access the spreadsheet interface.",tip:"You can import data from Excel or enter it manually using our intuitive interface."},{target:'[data-tour="revenue-section"]',title:"Revenue Assumptions",content:"Begin with revenue projections. Break down by business segments or product lines for more accurate modeling.",tip:"Use growth rates and market size assumptions to build credible revenue forecasts."},{target:'[data-tour="expense-section"]',title:"Operating Expenses",content:"Model your cost structure including COGS, SG&A, and other operating expenses. Link these to revenue drivers where possible.",tip:"Consider both fixed and variable cost components for realistic expense modeling."},{target:'[data-tour="financial-modeling-tab"]',title:"Advanced Modeling",content:"Access DCF, LBO, and other valuation models. These tools use your spreadsheet data for sophisticated analysis.",tip:"Always validate your model assumptions before running complex analyses."},{target:'[data-tour="analysis-results-tab"]',title:"Analysis Results",content:"View detailed results including valuations, ratios, and sensitivity analysis. Export reports for presentations.",tip:"Use scenario analysis to test different assumptions and risk factors."}]},dcfModeling:{id:"dcf-modeling-tour",name:"DCF Analysis Guide",description:"Master discounted cash flow valuation methodology",steps:[{target:'[data-tour="dcf-assumptions"]',title:"Key Assumptions",content:"Set your growth rates, margin assumptions, and terminal value parameters. These drive your entire valuation.",tip:"Use conservative assumptions and benchmark against industry standards."},{target:'[data-tour="wacc-calculation"]',title:"WACC Calculation",content:"Configure your weighted average cost of capital. This discount rate reflects the risk of your investment.",tip:"Consider using industry betas and current market rates for accuracy."},{target:'[data-tour="cash-flow-projections"]',title:"Cash Flow Projections",content:"Review projected free cash flows. These should reflect your operating assumptions and capital requirements.",tip:"Pay attention to working capital changes and capital expenditure requirements."},{target:'[data-tour="terminal-value"]',title:"Terminal Value",content:"The terminal value often represents 60-80% of total value. Choose appropriate growth rates and exit multiples.",tip:"Terminal growth rates should not exceed long-term GDP growth (2-4%)."},{target:'[data-tour="sensitivity-analysis"]',title:"Sensitivity Analysis",content:"Test how changes in key assumptions affect valuation. This helps assess investment risk.",tip:"Focus on the variables that have the biggest impact on your valuation."}]},portfolioManagement:{id:"portfolio-tour",name:"Portfolio Management Tour",description:"Learn to track and analyze investment portfolios",steps:[{target:'[data-tour="portfolio-overview"]',title:"Portfolio Overview",content:"Get a high-level view of your portfolio performance, allocation, and key metrics.",tip:"Use this dashboard to quickly assess portfolio health and identify areas for attention."},{target:'[data-tour="holdings-table"]',title:"Holdings Analysis",content:"Detailed view of individual positions with performance metrics, valuations, and risk indicators.",tip:"Sort and filter holdings to focus on specific sectors, performance ranges, or risk levels."},{target:'[data-tour="allocation-chart"]',title:"Asset Allocation",content:"Visualize your portfolio allocation by sector, geography, market cap, or custom categories.",tip:"Monitor allocation drift and rebalance when allocations deviate from targets."},{target:'[data-tour="performance-charts"]',title:"Performance Analysis",content:"Track performance over time with benchmark comparisons and risk-adjusted metrics.",tip:"Look at both absolute and relative performance across different time periods."}]},marketAnalysis:{id:"market-analysis-tour",name:"Market Analysis Guide",description:"Navigate market data and analysis tools",steps:[{target:'[data-tour="market-overview"]',title:"Market Overview",content:"Real-time market data, indices, and key economic indicators to inform your analysis.",tip:"Check market conditions before making investment decisions or valuations."},{target:'[data-tour="company-search"]',title:"Company Research",content:"Search and analyze public companies with financial statements, ratios, and peer comparisons.",tip:"Use comparable company analysis to validate your private company valuations."},{target:'[data-tour="economic-data"]',title:"Economic Indicators",content:"Access key economic data like GDP, inflation, interest rates, and employment statistics.",tip:"Economic indicators help contextualize your investment thesis and assumptions."},{target:'[data-tour="sector-analysis"]',title:"Sector Analysis",content:"Compare performance across different sectors and identify investment themes.",tip:"Sector trends can help identify opportunities and risks in your portfolio."}]}},jt={financialValidator:{title:"Real-time Financial Validation",content:"Get instant feedback on your financial inputs with suggestions for improvements and error detection.",trigger:"first-validation-error",dismissible:!0},virtualizedTable:{title:"High-Performance Tables",content:"Handle large datasets efficiently with our virtualized table system. Scroll through thousands of rows without performance issues.",trigger:"first-large-dataset",dismissible:!0},advancedCharts:{title:"Interactive Financial Charts",content:"Create professional charts and visualizations. Click chart types to switch views and hover for detailed information.",trigger:"chart-creation",dismissible:!0},exportCapabilities:{title:"Data Export Options",content:"Export your analysis to Excel, PDF, or CSV formats. Perfect for presentations and further analysis.",trigger:"first-export-attempt",dismissible:!0}},vt="financeanalyst-onboarding-state",Nt=()=>{const[t,s]=e.useState(()=>{try{const e=localStorage.getItem(vt);return e?JSON.parse(e):{completedTours:[],dismissedIntroductions:[],currentTour:null,userPreferences:{showTooltips:!0,autoStartTours:!0,tourSpeed:"normal"}}}catch{return{completedTours:[],dismissedIntroductions:[],currentTour:null,userPreferences:{showTooltips:!0,autoStartTours:!0,tourSpeed:"normal"}}}});e.useEffect(()=>{try{localStorage.setItem(vt,JSON.stringify(t))}catch(e){}},[t]);const a=e=>t.completedTours.includes(e);return{currentTour:t.currentTour,completedTours:t.completedTours,dismissedIntroductions:t.dismissedIntroductions,userPreferences:t.userPreferences,startTour:e=>{const t=ft[e];return!!t&&(s(s=>({...s,currentTour:{id:e,...t,startedAt:Date.now()}})),!0)},completeTour:e=>{s(t=>({...t,currentTour:null,completedTours:[...new Set([...t.completedTours,e])]}))},skipTour:()=>{s(e=>({...e,currentTour:null}))},dismissIntroduction:e=>{s(t=>({...t,dismissedIntroductions:[...new Set([...t.dismissedIntroductions,e])]}))},resetOnboarding:()=>{s({completedTours:[],dismissedIntroductions:[],currentTour:null,userPreferences:{showTooltips:!0,autoStartTours:!0,tourSpeed:"normal"}})},updatePreferences:e=>{s(t=>({...t,userPreferences:{...t.userPreferences,...e}}))},shouldShowFeatureIntroduction:e=>((e,t={})=>!!jt[e]&&!(t.dismissedIntroductions||[]).includes(e))(e,{dismissedIntroductions:t.dismissedIntroductions}),hasTourBeenCompleted:a,getAvailableTours:()=>Object.entries(ft).map(([e,t])=>({id:e,...t,completed:a(e)}))}},wt=()=>{const{isInitialized:t,joinWorkspace:a}=function(t,s={}){const[a,r]=e.useState(!1),[i,l]=e.useState({online:navigator.onLine,connected:!1}),[n,o]=e.useState(null),[c,d]=e.useState([]),[m,x]=e.useState(!1),[u,h]=e.useState(null),p=e.useRef(!1);e.useEffect(()=>{if(!p.current)return(async()=>{try{x(!0),h(null),await mt.initialize(t,s),r(!0),p.current=!0}catch(e){h(e.message)}finally{x(!1)}})(),()=>{p.current&&(mt.cleanup(),p.current=!1)}},[t,s]),e.useEffect(()=>{if(!a)return;const e=e=>{l(e)},t=({workspace:e})=>{o(e),d(Array.from(e.members.values()))},s=()=>{o(null),d([])},r=({user:e,workspaceId:t})=>{n?.id===t&&d(t=>t.find(t=>t.id===e.id)?t:[...t,e])},i=({userId:e,workspaceId:t})=>{n?.id===t&&d(t=>t.filter(t=>t.id!==e))};return mt.on("connectionStatus",e),mt.on("workspaceJoined",t),mt.on("workspaceLeft",s),mt.on("userJoined",r),mt.on("userLeft",i),()=>{mt.off("connectionStatus",e),mt.off("workspaceJoined",t),mt.off("workspaceLeft",s),mt.off("userJoined",r),mt.off("userLeft",i)}},[a,n?.id]);const g=e.useCallback(async(e,t={})=>{if(!a)throw new Error("Collaboration service not initialized");try{return x(!0),h(null),await mt.joinWorkspace(e,t)}catch(s){throw h(s.message),s}finally{x(!1)}},[a]),b=e.useCallback(async e=>{if(a)try{await mt.leaveWorkspace(e)}catch(t){h(t.message)}},[a]);return{isInitialized:a,connectionStatus:i,currentWorkspace:n,workspaceMembers:c,isLoading:m,error:u,joinWorkspace:g,leaveWorkspace:b,shareModel:mt.shareModel.bind(mt),updateModel:mt.updateModel.bind(mt),addAnnotation:mt.addAnnotation.bind(mt),updateCursor:mt.updateCursor.bind(mt),getWorkspaceModels:mt.getWorkspaceModels.bind(mt),getModelAnnotations:mt.getModelAnnotations.bind(mt)}}("current-user-id",{name:"Financial Analyst",role:"analyst"});e.useEffect(()=>{t&&!Q&&a(ee,{name:"Private Analysis Workspace",description:"Collaborative financial modeling and analysis"}).catch(e=>{})},[t,ee,a,Q]);const{currentTour:r,startTour:i,completeTour:l,skipTour:c,hasTourBeenCompleted:d}=Nt(),[m,x]=e.useState(null),[h,p]=e.useState(!1),[g,b]=e.useState("spreadsheet"),[y,f]=e.useState(Pe),[j,v]=e.useState(!1),[N,w]=e.useState(null),[C,k]=e.useState(!1);e.useRef(null),e.useEffect(()=>{localStorage.getItem("fa-pro-visited-private-analysis")||d("privateAnalysis")||(p(!0),localStorage.setItem("fa-pro-visited-private-analysis","true"))},[d]);const[S,R]=e.useState({lbo:null,threeStatement:null,scenarios:null,marketData:null,monteCarlo:null}),[M,E]=e.useState({}),[A,F]=e.useState({dcf:{discountRate:10,terminalGrowthRate:2.5,projectionYears:5,taxRate:25},scenario:{scenarios:[]}}),[D,P]=e.useState(!1),[O,T]=e.useState(null),[V,B]=e.useState(()=>{try{const e=localStorage.getItem("privateAnalyses");return e?JSON.parse(e):[]}catch(e){return[]}}),[_,L]=e.useState(!1),[U,q]=e.useState("spreadsheet"),[G,$]=e.useState(!1),[W,K]=e.useState(!1),[Y,H]=e.useState(!1),[Q,J]=e.useState(!0),[X,Z]=e.useState(!1),[ee]=e.useState(`workspace_${Date.now()}`),[te,re]=e.useState("ready"),ie=()=>{if(!y?.statements)return 0;let e=0,t=0;["totalRevenue","totalCostOfGoodsSold","operatingIncome","netIncome"].forEach(s=>{t+=3,void 0!==y.statements.incomeStatement?.[s]?.[2]&&(e+=3)}),["totalAssets","totalLiabilities","totalEquity"].forEach(s=>{t+=2,void 0!==y.statements.balanceSheet?.[s]?.[2]&&(e+=2)}),["operatingCashFlow","investingCashFlow","financingCashFlow"].forEach(s=>{t+=2,void 0!==y.statements.cashFlow?.[s]?.[2]&&(e+=2)});const s=Math.round(e/t*100);return void 0!==y?.statements?.incomeStatement?.totalRevenue?.[2]&&void 0!==y?.statements?.incomeStatement?.operatingIncome?.[2]?Math.max(s,80):s},ne=()=>{let e=0;A?.dcf?.discountRate&&A?.dcf?.terminalGrowthRate&&(e+=40);return ie()>=80&&(e+=20),A?.scenario?.scenarios&&A.scenario.scenarios.length>0&&(e+=20),(S.lbo||S.threeStatement||S.monteCarlo)&&(e+=20),Math.min(e,100)},oe=()=>{let e=0;return y?.statements?.incomeStatement&&(e+=30),S.lbo&&(e+=20),S.threeStatement&&(e+=20),S.scenarios&&(e+=15),S.monteCarlo&&(e+=15),Math.min(e,100)};e.useEffect(()=>{oe()>60&&!D&&P(!0)},[y,S,D]);const ce=[{id:"spreadsheet",label:"Financial Spreadsheet",icon:o},{id:"modeling",label:"Financial Modeling",icon:I},{id:"analysis",label:"Analysis & Results",icon:u},{id:"lbo",label:"Advanced LBO",icon:I},{id:"threestatement",label:"3-Statement Model",icon:o},{id:"scenarios",label:"Scenario Analysis",icon:I},{id:"marketdata",label:"Market Data",icon:I},{id:"montecarlo",label:"Monte Carlo",icon:I},{id:"import-export",label:"Import/Export",icon:n}];return s.jsxs("div",{className:"min-h-screen bg-slate-900 relative",children:[s.jsx(Me,{title:"Private Analysis Suite | FinanceAnalyst Pro",description:"Comprehensive financial analysis platform with advanced modeling tools, scenario analysis, Monte Carlo simulation, and private equity workflows.",canonical:"/private-analysis",keywords:"private analysis, financial modeling, scenario analysis, Monte Carlo simulation, LBO analysis, private equity tools"}),s.jsx(Fe,{}),s.jsxs("main",{id:"main-content",className:"container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8",role:"main","aria-label":"Private Analysis Dashboard",children:[s.jsxs("section",{className:"mb-6 sm:mb-8","aria-labelledby":"page-title",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[s.jsx("h1",{id:"page-title",className:"text-2xl sm:text-3xl font-bold text-white",children:"Private Analysis"}),s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 flex-wrap",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full "+("ready"===te?"bg-green-400":"saving"===te?"bg-blue-400":"bg-yellow-400")}),s.jsx("span",{className:"text-xs text-gray-400",children:"ready"===te?"Ready":"saving"===te?"Saving...":te})]}),N&&s.jsxs(Ee,{onClick:()=>(async e=>{try{L(!0),re("saving");const s={id:Date.now().toString(),name:e||`Analysis ${(new Date).toLocaleDateString()}`,timestamp:(new Date).toISOString(),financialData:y,adjustedValues:M,modelInputs:A,advancedResults:S,dataCompleteness:ie(),modelingProgress:ne(),analysisProgress:oe()},a=[...V,s];B(a);try{localStorage.setItem("privateAnalyses",JSON.stringify(a))}catch(t){throw new Error("Failed to save analysis to localStorage")}re("ready"),w(new Date)}catch(t){re("error")}finally{L(!1)}})(),disabled:_,className:"flex items-center gap-2 text-xs sm:text-sm",variant:"primary",size:"sm",children:[s.jsx(se,{className:"w-3 h-3 sm:w-4 sm:h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Saved"}),s.jsx("span",{className:"sm:hidden",children:N.toLocaleTimeString()}),s.jsx("span",{className:"hidden sm:inline",children:N.toLocaleTimeString()})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-6",children:[s.jsxs("div",{className:"bg-slate-800 rounded-lg p-3 sm:p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs sm:text-sm text-gray-400",children:"Data Completeness"}),s.jsxs("span",{className:"text-sm sm:text-base text-white font-semibold",children:[ie(),"%"]})]}),s.jsx("div",{className:"w-full bg-slate-700 rounded-full h-1.5 sm:h-2",children:s.jsx("div",{className:"bg-blue-500 h-1.5 sm:h-2 rounded-full transition-all duration-500",style:{width:`${ie()}%`}})})]}),s.jsxs("div",{className:"bg-slate-800 rounded-lg p-3 sm:p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs sm:text-sm text-gray-400",children:"Analysis Progress"}),s.jsxs("span",{className:"text-sm sm:text-base text-white font-semibold",children:[oe(),"%"]})]}),s.jsx("div",{className:"w-full bg-slate-700 rounded-full h-1.5 sm:h-2",children:s.jsx("div",{className:"bg-green-500 h-1.5 sm:h-2 rounded-full transition-all duration-500",style:{width:`${oe()}%`}})})]})]}),h&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[s.jsx(z,{className:"w-6 h-6 text-blue-600"}),s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Welcome to Private Analysis"})]}),s.jsx("p",{className:"text-slate-700 mb-6",children:"Take a quick tour to learn how to build financial models, run DCF analysis, and export professional reports."}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:()=>{p(!1),i("privateAnalysis")},className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Start Tour"}),s.jsx("button",{onClick:()=>{p(!1)},className:"flex-1 bg-slate-200 text-slate-800 px-4 py-2 rounded-lg hover:bg-slate-300",children:"Skip"})]})]})})]}),s.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[s.jsx(De,{variant:"horizontal",navigation:"analysisTools",activeItem:g,onItemClick:e=>b(e),className:"flex-1","data-tour":"financial-spreadsheet-tab"}),s.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[s.jsx("button",{onClick:()=>{x("modeling"===g?"dcf":g)},className:"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",title:"Get help with this feature",children:s.jsx(ae,{className:"w-4 h-4"})}),!d("privateAnalysis")&&s.jsx("button",{onClick:()=>i("privateAnalysis"),className:"p-2 text-blue-400 hover:text-blue-300 hover:bg-slate-700 rounded-lg transition-colors",title:"Take a guided tour",children:s.jsx(z,{className:"w-4 h-4"})})]})]}),s.jsx("nav",{className:"mb-6 hidden",role:"tablist","aria-label":"Analysis Tools",children:s.jsx("div",{className:"flex flex-wrap gap-2 p-1 bg-slate-800 rounded-lg",role:"tablist",children:ce.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>b(e.id),role:"tab","aria-selected":g===e.id,"aria-controls":`tabpanel-${e.id}`,tabIndex:g===e.id?0:-1,className:`\n                    flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-slate-800\n                    ${g===e.id?"bg-blue-600 text-white shadow-lg":"text-gray-300 hover:text-white hover:bg-slate-700"}\n                  `,children:[s.jsx(t,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.id)})})}),s.jsx("section",{className:"relative",role:"tabpanel",id:`tabpanel-${g}`,"aria-labelledby":`tab-${g}`,children:s.jsxs(le.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:["spreadsheet"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading spreadsheet. Please refresh the page."}),children:s.jsx(bt,{isLoading:_,skeleton:s.jsx(gt,{rows:12,columns:6}),children:s.jsx(Je,{data:y,onDataChange:f,onAdjustedValuesChange:E})})}),"modeling"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading modeling tools. Please refresh the page."}),children:s.jsx(nt,{data:y,adjustedValues:M,onDataChange:f})}),"analysis"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading analysis results. Please check your data and refresh."}),children:s.jsx(We,{data:y,adjustedValues:M,modelInputs:A,calculateDCF:e=>Oe(e,A),formatCurrency:Re,formatPercentage:Se})}),"lbo"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading LBO tool. Please check your data."}),children:s.jsx($e,{data:y,onDataChange:e=>R(t=>({...t,lbo:e}))})}),"threestatement"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading financial model workspace."}),children:s.jsx(Qe,{data:y,onDataChange:e=>R(t=>({...t,threeStatement:e}))})}),"scenarios"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading scenario analysis."}),children:s.jsx(He,{data:y,onDataChange:e=>R(t=>({...t,scenarios:e})),calculateDCF:e=>Oe(e,A),lboModelingEngine:null})}),"marketdata"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading market data dashboard."}),children:s.jsx(Ye,{data:y,onDataChange:e=>R(t=>({...t,marketData:e}))})}),"montecarlo"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading Monte Carlo integration."}),children:s.jsx(ot,{data:y,dcfResults:S.dcf,lboResults:S.lbo,financialModel:S.threeStatement,scenarioResults:S.scenarios,onDataChange:e=>R(t=>({...t,monteCarlo:e}))})}),"import-export"===g&&s.jsx(yt,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading import/export tools."}),children:s.jsx(Ge,{data:y,onDataChange:f,savedAnalyses:V,onAnalysesChange:B})})]},g)}),s.jsx(Ke,{financialData:y,currentMetric:O,analysisContext:"analysis"===g?"dcf":g,onInsightClick:e=>{T(e.metric)},isVisible:D,onToggle:()=>{P(!D)}})]}),s.jsx(ut,{helpKey:m,isOpen:!!m,onClose:()=>{x(null)}}),s.jsx(ht,{steps:r?.steps||[],isActive:!!r,onComplete:()=>l(r?.id),onSkip:c})]})};export{wt as default};
//# sourceMappingURL=PrivateAnalysis--xVULYGV.js.map
