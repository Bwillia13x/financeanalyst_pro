import{j as e,I as t,c as s}from"./index-By8bwNCY.js";import{r as a,R as r}from"./react-vendor-BaLqnLcQ.js";import{B as n}from"./Button-BTp6y2ew.js";import{H as i}from"./Header-CFwDfd7Y.js";import{I as o}from"./Input-CKp0wr7H.js";import{W as c,K as l,T as d,a as m,b as u}from"./ui-vendor-Cvmjbkc9.js";import{a as h,d as p}from"./dataFetching-D13QSlSP.js";import"./charts-vendor-D2zAVpJz.js";import"./utils-vendor-Cj_bvvWu.js";import"./data-vendor-B1ga0eaz.js";const x=({selectedSymbols:s,onBulkExport:r,onBulkAlert:i,onBulkHistorical:c})=>{const[l,d]=a.useState(!1),[m,u]=a.useState("csv"),[h,p]=a.useState(""),[x,g]=a.useState("1y");return 0===s.length?null:e.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-elevation-1",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer",onClick:()=>d(!l),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"Layers",size:16,color:"white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Bulk Operations"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.length," symbol",1!==s.length?"s":""," selected"]})]})]}),e.jsx(t,{name:l?"ChevronUp":"ChevronDown",size:20,className:"text-muted-foreground"})]}),l&&e.jsxs("div",{className:"border-t border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-2",children:"Selected Symbols:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.slice(0,10).map(t=>e.jsx("span",{className:"px-2 py-1 bg-muted text-muted-foreground text-xs rounded",children:t},t)),s.length>10&&e.jsxs("span",{className:"px-2 py-1 bg-muted text-muted-foreground text-xs rounded",children:["+",s.length-10," more"]})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Data Export"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:m,onChange:e=>u(e.target.value),className:"px-3 py-2 border border-border rounded-lg text-sm bg-input text-foreground",children:[e.jsx("option",{value:"csv",children:"CSV Format"}),e.jsx("option",{value:"xlsx",children:"Excel Format"}),e.jsx("option",{value:"json",children:"JSON Format"}),e.jsx("option",{value:"pdf",children:"PDF Report"})]}),e.jsx(n,{variant:"outline",size:"sm",iconName:"Download",onClick:()=>{r({symbols:s,format:m,timestamp:(new Date).toISOString()})},children:"Export Data"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Price Alerts"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{type:"number",placeholder:"Threshold %",value:h,onChange:e=>p(e.target.value),className:"flex-1"}),e.jsx(n,{variant:"outline",size:"sm",iconName:"Bell",onClick:()=>{h&&(i({symbols:s,threshold:parseFloat(h),type:"price_change"}),p(""))},disabled:!h,children:"Set Alerts"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Historical Data"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:x,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-border rounded-lg text-sm bg-input text-foreground",children:[e.jsx("option",{value:"1d",children:"1 Day"}),e.jsx("option",{value:"1w",children:"1 Week"}),e.jsx("option",{value:"1m",children:"1 Month"}),e.jsx("option",{value:"3m",children:"3 Months"}),e.jsx("option",{value:"6m",children:"6 Months"}),e.jsx("option",{value:"1y",children:"1 Year"}),e.jsx("option",{value:"5y",children:"5 Years"})]}),e.jsx(n,{variant:"outline",size:"sm",iconName:"BarChart3",onClick:()=>{c({symbols:s,period:x})},children:"Get Historical"})]})]})]}),e.jsx("div",{className:"p-4 border-t border-border bg-muted/30",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-foreground",children:s.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Symbols"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-foreground",children:Math.min(50*s.length,1e3)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Data Points"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-foreground",children:["~",Math.ceil(s.length/10),"s"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Est. Time"})]})]})})]})]})},g=({connectionHealth:s,lastUpdate:a})=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:(e=>{switch(e){case"excellent":case"good":default:return"Wifi";case"warning":return"WifiOff";case"error":return"AlertTriangle"}})(s.overall),size:16,className:(e=>{switch(e){case"excellent":return"text-success";case"good":return"text-primary";case"warning":return"text-warning";case"error":return"text-error";default:return"text-muted-foreground"}})(s.overall)}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:["Connection: ",s.overall]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(t,{name:"Clock",size:14}),e.jsxs("span",{children:["Last update: ",a]})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Object.entries(s.sources).map(([t,s])=>e.jsx("div",{className:"w-3 h-3 rounded-full "+("connected"===s?"bg-success":"warning"===s?"bg-warning":"bg-error"),title:`${t}: ${s}`},t))})]}),f=({dataSources:t,onToggle:s})=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Data Sources:"}),e.jsx("div",{className:"flex items-center space-x-2",children:t.map(t=>e.jsxs("button",{onClick:()=>s(t.id),className:`\n              flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-smooth\n              ${t.enabled?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"}\n            `,children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+("connected"===t.status?"bg-success":"warning"===t.status?"bg-warning":"bg-error")}),e.jsx("span",{children:t.name}),e.jsxs("span",{className:"text-xs opacity-75",children:[t.latency,"ms"]})]},t.id))})]}),y=({widget:s,onResize:a,onRemove:r})=>{const n=(e,t)=>{switch(t){case"currency":return`$${e.toLocaleString("en-US",{minimumFractionDigits:2})}`;case"percentage":return`${e.toFixed(2)}%`;case"number":return e.toLocaleString("en-US",{minimumFractionDigits:2});default:return e}};return e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4 shadow-elevation-1 hover:shadow-elevation-2 transition-smooth",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.name}),e.jsx("div",{className:`w-2 h-2 rounded-full ${(e=>{const t=(new Date-new Date(e))/1e3;return t<5?"bg-success":t<30?"bg-warning":"bg-error"})(s.lastUpdate)}`,title:`Last updated: ${new Date(s.lastUpdate).toLocaleTimeString()}`})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>a(s.id),className:"p-1 text-muted-foreground hover:text-foreground transition-smooth",title:"Resize widget",children:e.jsx(t,{name:"Maximize2",size:14})}),e.jsx("button",{onClick:()=>r(s.id),className:"p-1 text-muted-foreground hover:text-error transition-smooth",title:"Remove widget",children:e.jsx(t,{name:"X",size:14})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:n(s.currentValue,s.valueType)}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm "+(i=s.change,i>0?"text-success":i<0?"text-error":"text-muted-foreground"),children:[e.jsx(t,{name:(e=>e>0?"TrendingUp":e<0?"TrendingDown":"Minus")(s.change),size:14}),e.jsx("span",{children:n(Math.abs(s.change),s.valueType)}),e.jsxs("span",{children:["(",s.changePercent>0?"+":"",s.changePercent.toFixed(2),"%)"]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"h-16 bg-muted rounded flex items-end space-x-1 p-2",children:s.sparklineData.map((t,a)=>e.jsx("div",{className:"flex-1 rounded-sm "+(t>s.sparklineData[0]?"bg-success":"bg-error"),style:{height:t/Math.max(...s.sparklineData)*100+"%",minHeight:"2px"}},a))})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"High:"}),e.jsx("span",{className:"ml-1 font-medium text-foreground",children:n(s.dayHigh,s.valueType)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Low:"}),e.jsx("span",{className:"ml-1 font-medium text-foreground",children:n(s.dayLow,s.valueType)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Volume:"}),e.jsx("span",{className:"ml-1 font-medium text-foreground",children:s.volume?s.volume.toLocaleString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Source:"}),e.jsx("span",{className:"ml-1 font-medium text-foreground",children:s.source})]})]})]});var i},b=({onSymbolSelect:s,watchlist:r,onAddToWatchlist:n})=>{const[i,c]=a.useState(""),[l,d]=a.useState([]),[m,u]=a.useState(!1),[h,p]=a.useState(-1),x=a.useRef(null),g=[{symbol:"AAPL",name:"Apple Inc.",exchange:"NASDAQ",sector:"Technology"},{symbol:"MSFT",name:"Microsoft Corporation",exchange:"NASDAQ",sector:"Technology"},{symbol:"GOOGL",name:"Alphabet Inc.",exchange:"NASDAQ",sector:"Technology"},{symbol:"AMZN",name:"Amazon.com Inc.",exchange:"NASDAQ",sector:"Consumer Discretionary"},{symbol:"TSLA",name:"Tesla Inc.",exchange:"NASDAQ",sector:"Consumer Discretionary"},{symbol:"META",name:"Meta Platforms Inc.",exchange:"NASDAQ",sector:"Technology"},{symbol:"NVDA",name:"NVIDIA Corporation",exchange:"NASDAQ",sector:"Technology"},{symbol:"JPM",name:"JPMorgan Chase & Co.",exchange:"NYSE",sector:"Financial Services"},{symbol:"JNJ",name:"Johnson & Johnson",exchange:"NYSE",sector:"Healthcare"},{symbol:"V",name:"Visa Inc.",exchange:"NYSE",sector:"Financial Services"}];a.useEffect(()=>{if(i.length>0){const e=g.filter(e=>e.symbol.toLowerCase().includes(i.toLowerCase())||e.name.toLowerCase().includes(i.toLowerCase())).slice(0,8);d(e),u(!0),p(-1)}else d([]),u(!1)},[i]);const f=e=>{s(e),c(""),u(!1),p(-1)};return e.jsxs("div",{className:"relative",ref:x,children:[e.jsxs("div",{className:"relative",children:[e.jsx(o,{type:"text",placeholder:"Search symbols (e.g., AAPL, Apple)...",value:i,onChange:e=>c(e.target.value),onKeyDown:e=>{if(m)switch(e.key){case"ArrowDown":e.preventDefault(),p(e=>e<l.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),p(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),h>=0&&f(l[h]);break;case"Escape":u(!1),p(-1)}},className:"pl-10 pr-4"}),e.jsx(t,{name:"Search",size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"})]}),m&&l.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-lg shadow-elevation-2 z-50 max-h-64 overflow-y-auto",children:l.map((s,a)=>{return e.jsxs("div",{className:`\n                flex items-center justify-between p-3 cursor-pointer transition-smooth\n                ${a===h?"bg-muted":"hover:bg-muted"}\n              `,onClick:()=>f(s),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:s.symbol}),e.jsx("span",{className:"text-xs px-2 py-1 bg-muted rounded text-muted-foreground",children:s.exchange})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.sector})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(i=s.symbol,!r.some(e=>e.symbol===i)&&e.jsx("button",{onClick:e=>{e.stopPropagation(),n(s)},className:"p-1 text-muted-foreground hover:text-primary transition-smooth",title:"Add to watchlist",children:e.jsx(t,{name:"Star",size:16})})),e.jsx(t,{name:"Plus",size:16,className:"text-muted-foreground"})]})]},s.symbol);var i})}),m&&i.length>0&&0===l.length&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-lg shadow-elevation-2 z-50 p-4 text-center",children:e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx(t,{name:"Search",size:24,className:"mx-auto mb-2"}),e.jsxs("p",{children:['No symbols found for "',i,'"']})]})})]})},v=({watchlist:s,onRemoveFromWatchlist:r,onSelectSymbol:i})=>{const[o,c]=a.useState("symbol"),[l,d]=a.useState("asc"),m=[...s].sort((e,t)=>{let s=e[o],a=t[o];return"string"==typeof s&&(s=s.toLowerCase(),a=a.toLowerCase()),"asc"===l?s<a?-1:s>a?1:0:s>a?-1:s<a?1:0}),u=(e,t)=>{switch(t){case"currency":return`$${e.toLocaleString("en-US",{minimumFractionDigits:2})}`;case"percentage":return`${e.toFixed(2)}%`;default:return e}};return e.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-elevation-1",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Watchlist"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.length," symbols"]}),e.jsx(n,{variant:"ghost",size:"sm",iconName:"MoreVertical","aria-label":"Watchlist options"})]})]})}),e.jsx("div",{className:"p-3 border-b border-border bg-muted/30",children:e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Sort by:"}),["symbol","name","price","change"].map(s=>e.jsxs("button",{onClick:()=>(e=>{o===e?d("asc"===l?"desc":"asc"):(c(e),d("asc"))})(s),className:`\n                flex items-center space-x-1 px-2 py-1 rounded transition-smooth\n                ${o===s?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"}\n              `,children:[e.jsx("span",{className:"capitalize",children:s}),o===s&&e.jsx(t,{name:"asc"===l?"ChevronUp":"ChevronDown",size:12})]},s))]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===m.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(t,{name:"Star",size:32,className:"mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No symbols in watchlist"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Search and add symbols to track them here"})]}):m.map(s=>{return e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border last:border-b-0 hover:bg-muted/50 cursor-pointer transition-smooth",onClick:()=>i(s),children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:s.symbol}),e.jsx("span",{className:"text-xs px-2 py-1 bg-muted rounded text-muted-foreground",children:s.exchange})]}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.name})]}),e.jsxs("div",{className:"text-right mr-3",children:[e.jsx("div",{className:"font-semibold text-foreground",children:u(s.price||150.25,"currency")}),e.jsxs("div",{className:"text-sm "+(a=s.change||2.15,a>0?"text-success":a<0?"text-error":"text-muted-foreground"),children:[s.change>0?"+":"",u(Math.abs(s.change||2.15),"currency"),"(",s.changePercent>0?"+":"",(s.changePercent||1.45).toFixed(2),"%)"]})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),r(s.symbol)},className:"p-1 text-muted-foreground hover:text-error transition-smooth",title:"Remove from watchlist",children:e.jsx(t,{name:"X",size:16})})]},s.symbol);var a})}),s.length>0&&e.jsx("div",{className:"p-3 border-t border-border bg-muted/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{variant:"ghost",size:"sm",iconName:"Download",children:"Export"}),e.jsx(n,{variant:"ghost",size:"sm",iconName:"Bell",children:"Set Alerts"})]})})]})},j=r.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:s("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a}));j.displayName="Card";const N=r.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:s("flex flex-col space-y-1.5 p-6",t),...a}));N.displayName="CardHeader";const w=r.forwardRef(({className:t,...a},r)=>e.jsx("h3",{ref:r,className:s("text-2xl font-semibold leading-none tracking-tight",t),...a}));w.displayName="CardTitle";r.forwardRef(({className:t,...a},r)=>e.jsx("p",{ref:r,className:s("text-sm text-muted-foreground",t),...a})).displayName="CardDescription";const S=r.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:s("p-6 pt-0",t),...a}));S.displayName="CardContent";r.forwardRef(({className:t,...a},r)=>e.jsx("div",{ref:r,className:s("flex items-center p-6 pt-0",t),...a})).displayName="CardFooter";const A=r.forwardRef(({className:t="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium bg-muted text-foreground",variant:a="default",children:r,...n},i)=>{const o="outline"===a?"border border-input bg-transparent":"bg-primary text-primary-foreground";return e.jsx("span",{ref:i,className:s(t,o),...n,children:r})});A.displayName="Badge";const D=r.forwardRef(({value:t=0,className:a="h-1 bg-muted",...r},n)=>{const i=Math.min(100,Math.max(0,t));return e.jsx("div",{ref:n,className:s("w-full rounded bg-muted/50",a),...r,children:e.jsx("div",{className:"h-full rounded bg-primary transition-all",style:{width:`${i}%`}})})});D.displayName="Progress";const P=r.forwardRef(({className:t="relative w-full rounded-lg border p-4",...a},r)=>e.jsx("div",{ref:r,role:"alert",...a,className:s("bg-card text-card-foreground",t)}));P.displayName="Alert";const k=r.forwardRef(({className:t="text-sm [&_p]:leading-relaxed",...a},r)=>e.jsx("div",{ref:r,className:s(t),...a}));k.displayName="AlertDescription";const C=({apiHealthStatus:t={},realDataEnabled:s=!1,dataSources:a=[],dataQuality:r={}})=>{const n=t=>{switch(t){case"healthy":case"connected":return e.jsx(u,{className:"h-4 w-4 text-green-500"});case"error":case"disconnected":return e.jsx(m,{className:"h-4 w-4 text-red-500"});case"warning":return e.jsx(d,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(d,{className:"h-4 w-4 text-gray-400"})}},i=e=>{switch(e){case"healthy":case"connected":return"bg-green-100 text-green-800";case"error":case"disconnected":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},o=a.filter(e=>"connected"===e.status).length,h=a.length,p=h>0?o/h*100:0;return e.jsxs(j,{children:[e.jsx(N,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5"}),"API Status & Data Quality"]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(s?"connected":"disconnected"),e.jsxs("span",{className:"font-medium",children:["Real Data: ",s?"Enabled":"Disabled"]})]}),e.jsx(A,{className:i(s?"connected":"disconnected"),children:s?"Live":"Demo Mode"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Connection Health"}),e.jsxs("span",{children:[o,"/",h," sources"]})]}),e.jsx(D,{value:p,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Data Sources"}),e.jsx("div",{className:"space-y-2",children:a.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(t.status),e.jsx("span",{children:t.name}),t.requiresKey&&e.jsx(l,{className:"h-3 w-3 text-gray-400",title:"Requires API Key"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"outline",className:`text-xs ${i(t.status)}`,children:t.status}),"connected"===t.status&&e.jsxs("span",{className:"text-xs text-gray-500",children:[t.latency,"ms"]})]})]},t.id))})]}),Object.keys(t).length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"API Health Details"}),e.jsx("div",{className:"space-y-1 text-xs",children:Object.entries(t).map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"capitalize",children:t.toLowerCase().replace("_"," ")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Success: ",(100*s.successRate).toFixed(1),"%"]}),e.jsxs("span",{children:["Avg: ",s.avgResponseTime.toFixed(0),"ms"]})]})]},t))})]}),Object.keys(r).length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Data Quality"}),e.jsx("div",{className:"space-y-1",children:Object.entries(r).map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{value:s,className:"h-1 w-16"}),e.jsxs("span",{className:"text-xs",children:[s,"%"]})]})]},t))})]}),!s&&e.jsxs(P,{children:[e.jsx(d,{className:"h-4 w-4"}),e.jsxs(k,{className:"text-sm",children:["Running in demo mode. Add API keys to enable real-time data.",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-600",children:"Set VITE_ALPHA_VANTAGE_API_KEY or VITE_FMP_API_KEY in your .env file"})]})]}),s&&o<h&&e.jsxs(P,{children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(k,{className:"text-sm",children:"Some data sources are unavailable. Check your API keys and network connection."})]})]})]})};const R=new class{constructor(){this.subscribers=new Map,this.activeStreams=new Map,this.pollingIntervals=new Map,this.connectionStatus=new Map,this.lastUpdateTimes=new Map,this.updateIntervals={marketData:5e3,quotes:1e3,news:3e4,fundamentals:3e5},this.maxRetries=3,this.retryDelay=2e3}subscribe(e,t,s){const a=`${e}_${t}_${Date.now()}`,r=`${e}_${t}`;return this.subscribers.has(r)||this.subscribers.set(r,new Map),this.subscribers.get(r).set(a,s),1===this.subscribers.get(r).size&&this.startStream(e,t),h.log("INFO",`Subscribed to ${t} for ${e}`,{subscriptionId:a,totalSubscribers:this.subscribers.get(r).size}),a}unsubscribe(e){for(const[t,s]of this.subscribers.entries())if(s.has(e)){if(s.delete(e),0===s.size){const[e,s]=t.split("_");this.stopStream(e,s),this.subscribers.delete(t)}h.log("INFO",`Unsubscribed from ${t}`,{subscriptionId:e,remainingSubscribers:s.size});break}}async startStream(e,t){const s=`${e}_${t}`;if(!this.activeStreams.has(s)){this.activeStreams.set(s,!0),this.connectionStatus.set(s,"connecting");try{this.supportsWebSocket(t)?await this.startWebSocketStream(e,t):await this.startPollingStream(e,t),this.connectionStatus.set(s,"connected"),h.log("INFO",`Started real-time stream for ${e} ${t}`)}catch(a){this.connectionStatus.set(s,"error"),h.log("ERROR",`Failed to start stream for ${e} ${t}`,{error:a.message}),this.supportsWebSocket(t)&&await this.startPollingStream(e,t)}}}stopStream(e,t){const s=`${e}_${t}`;this.pollingIntervals.has(s)&&(clearInterval(this.pollingIntervals.get(s)),this.pollingIntervals.delete(s)),this.activeStreams.has(s)&&this.activeStreams.delete(s),this.connectionStatus.set(s,"disconnected"),h.log("INFO",`Stopped real-time stream for ${e} ${t}`)}async startWebSocketStream(e,t){throw new Error("WebSocket streaming not yet implemented")}async startPollingStream(e,t){const s=`${e}_${t}`,a=this.updateIntervals[t]||1e4;await this.fetchAndBroadcast(e,t);const r=setInterval(async()=>{try{await this.fetchAndBroadcast(e,t)}catch(s){h.log("ERROR",`Polling error for ${e} ${t}`,{error:s.message})}},a);this.pollingIntervals.set(s,r)}async fetchAndBroadcast(e,t){const s=`${e}_${t}`;try{let a;switch(t){case"marketData":a=await p.fetchMarketData(e);break;case"quotes":a=await p.fetchCompanyProfile(e);break;case"fundamentals":a=await p.fetchFinancialStatements(e,"income-statement");break;default:throw new Error(`Unknown data type: ${t}`)}const r={...a,symbol:e,dataType:t,timestamp:(new Date).toISOString(),source:"realTimeDataService"},n=this.subscribers.get(s);n&&n.forEach(e=>{try{e(r)}catch(t){h.log("ERROR",`Subscriber callback error for ${s}`,{error:t.message})}}),this.lastUpdateTimes.set(s,new Date)}catch(a){throw h.log("ERROR",`Failed to fetch data for ${e} ${t}`,{error:a.message}),a}}supportsWebSocket(e){return!1}getConnectionStatus(){const e={};for(const[t,s]of this.connectionStatus.entries()){const[a,r]=t.split("_");e[a]||(e[a]={}),e[a][r]={status:s,lastUpdate:this.lastUpdateTimes.get(t),subscriberCount:this.subscribers.get(t)?.size||0}}return e}getActiveSubscriptions(){const e=[];for(const[t,s]of this.subscribers.entries()){const[a,r]=t.split("_");e.push({symbol:a,dataType:r,subscriberCount:s.size,status:this.connectionStatus.get(t)||"unknown",lastUpdate:this.lastUpdateTimes.get(t)})}return e}cleanup(){for(const e of this.pollingIntervals.values())clearInterval(e);this.subscribers.clear(),this.activeStreams.clear(),this.pollingIntervals.clear(),this.connectionStatus.clear(),this.lastUpdateTimes.clear(),h.log("INFO","Real-time data service cleaned up")}},T={baseURL:"https://www.alphavantage.co/query"},F={marketData:["YAHOO_FINANCE","ALPHA_VANTAGE"],financialStatements:["FMP","ALPHA_VANTAGE"],companyProfile:["FMP","ALPHA_VANTAGE"],secFilings:["SEC_EDGAR"],economicData:["FRED","QUANDL"],peers:["FMP"]};class M{constructor(e,t){this.requestsPerInterval=e,this.interval=t,this.requestTimestamps=[]}async acquire(){const e=Date.now();if(this.requestTimestamps=this.requestTimestamps.filter(t=>e-t<this.interval),this.requestTimestamps.length>=this.requestsPerInterval){const t=this.interval-(e-this.requestTimestamps[0]);return await new Promise(e=>setTimeout(e,t)),this.acquire()}this.requestTimestamps.push(e)}}const $=new class{constructor(){this.rateLimiters=new Map,this.sourceHealth=new Map,this.lastRequests=new Map,this.apiKeys=this.loadApiKeys(),this.cache=new Map,this.rateLimitInfo={remaining:null,reset:null},this.initializeSourceHealth(),this.rateLimiters.set("default",new M(5,1e3))}loadApiKeys(){const e={ALPHA_VANTAGE:"your_alpha_vantage_api_key_here",FMP:"your_fmp_api_key_here",QUANDL:void 0,FRED:void 0},t=Object.entries(e).filter(([e,t])=>t&&"demo"!==t).map(([e,t])=>e);return h.log("INFO","API keys loaded",{availableKeys:t,totalKeys:t.length}),e}initializeSourceHealth(){["ALPHA_VANTAGE","FMP","YAHOO_FINANCE","SEC_EDGAR","QUANDL","FRED"].forEach(e=>{this.sourceHealth.set(e,{status:"unknown",successRate:1,avgResponseTime:0,lastError:null,requestCount:0,errorCount:0,lastHealthCheck:null})})}hasValidApiKey(e){const t=this.apiKeys[e];return t&&"demo"!==t&&t.length>5}getBestSource(e){const t=F[e]||[];for(const s of t){const e=this.sourceHealth.get(s);if(e&&"error"!==e.status){if(!this.requiresApiKey(s))return s;if(this.hasValidApiKey(s))return s}}return t[0]||"YAHOO_FINANCE"}requiresApiKey(e){return["ALPHA_VANTAGE","FMP","QUANDL","FRED"].includes(e)}async fetchRealTimeMarketData(e,t={}){const s=this.getBestSource("marketData");try{let a;switch(s){case"YAHOO_FINANCE":a=await this.fetchFromYahooFinance(e,t);break;case"ALPHA_VANTAGE":a=await this.fetchFromAlphaVantage(e,"GLOBAL_QUOTE",t);break;default:throw new Error(`Unsupported source for market data: ${s}`)}return this.updateSourceHealth(s,!0,Date.now()),this.normalizeMarketData(a,s)}catch(a){this.updateSourceHealth(s,!1,Date.now(),a);if(F.marketData.filter(e=>e!==s).length>0)return h.log("WARN",`Primary source ${s} failed, trying fallback`,{error:a.message}),this.fetchRealTimeMarketData(e,{...t,excludeSource:s});throw a}}async fetchFromYahooFinance(e,t={}){const s=`/v8/finance/chart/${e}`,a={range:t.range||"1d",interval:t.interval||"1m",includePrePost:!0,events:"div,splits"},r=new URL(s,"http://localhost:3000");r.search=new URLSearchParams(a).toString();const n=await fetch(r.pathname+r.search,{signal:AbortSignal.timeout(1e4),headers:{"User-Agent":"FinanceAnalyst-Pro/1.0"}});if(!n.ok)throw new Error(`Yahoo Finance API request failed with status ${n.status}`);const i=await n.json();if(!i?.chart?.result?.[0])throw new Error(`No data found for symbol: ${e}`);return i.chart.result[0]}async fetchFromAlphaVantage(e,t,s={}){if(!this.hasValidApiKey("ALPHA_VANTAGE"))throw new Error("Alpha Vantage API key not available");const a=T,r={function:t,symbol:e,apikey:this.apiKeys.ALPHA_VANTAGE,...s.params},n=new URL(a.baseURL);n.search=new URLSearchParams(r).toString();const i=await fetch(n,{signal:AbortSignal.timeout(15e3)});if(!i.ok)throw new Error(`Alpha Vantage API request failed with status ${i.status}`);const o=await i.json();if(o["Error Message"])throw new Error(`Alpha Vantage error: ${o["Error Message"]}`);if(o.Note)throw new Error(`Alpha Vantage rate limit: ${o.Note}`);return o}async fetchComprehensiveData(e){const t={},s={},a=[{key:"marketData",method:"fetchRealTimeMarketData"},{key:"profile",method:"fetchCompanyProfile"},{key:"financials",method:"fetchFinancialStatements"},{key:"peers",method:"fetchPeerComparison"}].map(async({key:a,method:r})=>{try{t[a]="fetchFinancialStatements"===r?await p[r](e,"income-statement"):"fetchPeerComparison"===r?await p[r](e):await this[r](e)}catch(n){s[a]=n.message,h.log("ERROR",`Failed to fetch ${a} for ${e}`,{error:n.message})}});return await Promise.allSettled(a),{symbol:e,timestamp:(new Date).toISOString(),data:t,errors:Object.keys(s).length>0?s:null,sources:this.getSourcesUsed(t)}}normalizeMarketData(e,t){switch(t){case"YAHOO_FINANCE":return this.normalizeYahooData(e);case"ALPHA_VANTAGE":return this.normalizeAlphaVantageData(e);default:return e}}normalizeYahooData(e){const t=e.meta,s=e.indicators?.quote?.[0],a=s?{open:s.open[s.open.length-1],high:s.high[s.high.length-1],low:s.low[s.low.length-1],close:s.close[s.close.length-1],volume:s.volume[s.volume.length-1]}:{};return{symbol:t.symbol,currentPrice:t.regularMarketPrice||a.close,previousClose:t.previousClose,change:t.regularMarketPrice-t.previousClose,changePercent:(t.regularMarketPrice-t.previousClose)/t.previousClose*100,dayHigh:t.regularMarketDayHigh||a.high,dayLow:t.regularMarketDayLow||a.low,volume:t.regularMarketVolume||a.volume,marketCap:t.marketCap,currency:t.currency,exchangeName:t.exchangeName,timestamp:new Date(1e3*t.regularMarketTime).toISOString(),source:"YAHOO_FINANCE"}}normalizeAlphaVantageData(e){const t=e["Global Quote"];if(!t)throw new Error("Invalid Alpha Vantage response format");return{symbol:t["01. symbol"],currentPrice:parseFloat(t["05. price"]),previousClose:parseFloat(t["08. previous close"]),change:parseFloat(t["09. change"]),changePercent:parseFloat(t["10. change percent"].replace("%","")),dayHigh:parseFloat(t["03. high"]),dayLow:parseFloat(t["04. low"]),volume:parseInt(t["06. volume"]),timestamp:t["07. latest trading day"],source:"ALPHA_VANTAGE"}}updateSourceHealth(e,t,s,a=null){const r=this.sourceHealth.get(e);r&&(r.requestCount++,t?(r.status="healthy",r.lastError=null):(r.errorCount++,r.lastError=a?.message||"Unknown error",r.status="error"),r.successRate=(r.requestCount-r.errorCount)/r.requestCount,r.avgResponseTime=(r.avgResponseTime+s)/2,r.lastHealthCheck=(new Date).toISOString(),this.sourceHealth.set(e,r))}getSourceHealthStatus(){const e={};for(const[t,s]of this.sourceHealth.entries())e[t]={...s,hasValidApiKey:this.hasValidApiKey(t),requiresApiKey:this.requiresApiKey(t)};return e}getSourcesUsed(e){const t=new Set;return Object.values(e).forEach(e=>{e?.source&&t.add(e.source)}),Array.from(t)}baseUrl="https://api.example.com";defaultHeaders={};timeout=1e4;authToken=null;cacheTTL=3e5;requestInterceptors=[];responseInterceptors=[];metrics={totalRequests:0,successfulRequests:0,failedRequests:0,avgResponseTime:0};async request(e,t={}){const s=Date.now();this.metrics.totalRequests++;const a=this.rateLimiters.get("default");await a.acquire();const r=e.startsWith("http")?e:`${this.baseUrl}${e}`,n=r;if(this.cache.has(n)){const e=this.cache.get(n);if(Date.now()-e.timestamp<this.cacheTTL)return this.metrics.successfulRequests++,e.data}try{let e={method:"GET",headers:{...this.defaultHeaders},...t};this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`);for(const t of this.requestInterceptors)e=await t(e);const a=new AbortController,i=setTimeout(()=>a.abort(),this.timeout);e.signal=a.signal;const o=await fetch(r,e);if(clearTimeout(i),!o.ok){const e=await o.text();throw new Error(`HTTP error! status: ${o.status}, body: ${e}`)}this.rateLimitInfo.remaining=parseInt(o.headers.get("X-RateLimit-Remaining"),10),this.rateLimitInfo.reset=parseInt(o.headers.get("X-RateLimit-Reset"),10);let c=await o.json();for(const t of this.responseInterceptors)c=await t(c,o);this.cache.set(n,{data:c,timestamp:Date.now()});const l=Date.now()-s;return this.metrics.successfulRequests++,this.metrics.avgResponseTime=(this.metrics.avgResponseTime+l)/2,c}catch(i){throw this.metrics.failedRequests++,i}}setAuthToken(e){this.authToken=e}setCacheTTL(e){this.cacheTTL=e}async batchRequests(e){const t=e.map(e=>"string"==typeof e?this.request(e):this.request(e.url,e.options));return(await Promise.allSettled(t)).map(e=>"fulfilled"===e.status?e.value:e.reason)}addRequestInterceptor(e){this.requestInterceptors.push(e)}addResponseInterceptor(e){this.responseInterceptors.push(e)}async requestWithRetry(e,t={},s=3){let a;for(let n=0;n<=s;n++)try{return await this.request(e,t)}catch(r){if(a=r,n<s){const e=100*Math.pow(2,n);await new Promise(t=>setTimeout(t,e))}}throw a}setBaseUrl(e){this.baseUrl=e}getBaseUrl(){return this.baseUrl}setDefaultHeaders(e){this.defaultHeaders={...e}}getDefaultHeaders(){return{...this.defaultHeaders}}setTimeout(e){this.timeout=e}getTimeout(){return this.timeout}getMetrics(){return{...this.metrics}}resetMetrics(){this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,avgResponseTime:0}}getRateLimitInfo(){return this.rateLimitInfo}clearCache(){this.cache.clear()}};const q=new class{constructor(){this.validationRules=this.initializeValidationRules(),this.qualityMetrics=new Map,this.anomalyDetection=new Map}initializeValidationRules(){return{marketData:{required:["symbol","currentPrice","volume"],numeric:["currentPrice","previousClose","change","changePercent","volume","marketCap"],ranges:{currentPrice:{min:0,max:1e5},volume:{min:0,max:1e12},changePercent:{min:-50,max:50}},formats:{symbol:/^[A-Z]{1,5}$/,timestamp:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/}},financialStatements:{required:["revenue","netIncome"],numeric:["revenue","netIncome","totalDebt","cashAndCashEquivalents"],ranges:{revenue:{min:0,max:1e12},netIncome:{min:-1e11,max:1e11}}},companyProfile:{required:["symbol","companyName","sector"],numeric:["mktCap","pe","pb","beta"],ranges:{pe:{min:0,max:1e3},pb:{min:0,max:100},beta:{min:-5,max:5}}},dcfModel:{required:["cashFlows","discountRate"],numeric:["discountRate","terminalGrowthRate","years"],custom:e=>{const t=[];return Array.isArray(e.cashFlows)&&0!==e.cashFlows.length||t.push("Cash flows must be a non-empty array"),e.discountRate<0&&t.push("Discount rate must be non-negative"),{errors:t,warnings:[]}}},lboModel:{required:["purchasePrice","debtFinancing","equityFinancing"],numeric:["purchasePrice","debtFinancing","equityFinancing","exitMultiple","holdingPeriod"],custom:e=>{const t=[],s=[];if(e.debtFinancing&&e.equityFinancing&&e.purchasePrice){const a=e.debtFinancing+e.equityFinancing;Math.abs(a-e.purchasePrice)>.01&&t.push("Debt + Equity must equal purchase price");e.debtFinancing/e.purchasePrice>.9&&s.push("High leverage ratio detected")}return{errors:t,warnings:s}}},stockData:{required:["symbol","price"],numeric:["price","volume","change","changePercent"],custom:e=>{const t=[];return e.symbol&&"string"==typeof e.symbol&&""!==e.symbol.trim()||t.push("Symbol is required and must be a non-empty string"),("number"!=typeof e.price||e.price<0)&&t.push("Price must be a positive number"),{errors:t,warnings:[]}}}}}validateData(e,t){try{const s=this.validationRules[t];if(!s)return{isValid:!1,errors:[`Unknown data type: ${t}`]};const a=[],r=[];for(const t of s.required||[])void 0!==e[t]&&null!==e[t]||a.push(`Missing required field: ${t}`);for(const t of s.numeric||[])if(void 0!==e[t]&&null!==e[t]){const n=parseFloat(e[t]);if(isNaN(n))a.push(`Field ${t} must be numeric, got: ${e[t]}`);else{const e=s.ranges?.[t];e&&(n<e.min||n>e.max)&&r.push(`Field ${t} value ${n} outside expected range [${e.min}, ${e.max}]`)}}for(const[t,o]of Object.entries(s.formats||{}))e[t]&&!o.test(e[t])&&a.push(`Field ${t} format invalid: ${e[t]}`);const n=this.validateBusinessLogic(e,t);if(a.push(...n.errors),r.push(...n.warnings),s.custom){const t=s.custom(e);a.push(...t.errors||[]),r.push(...t.warnings||[])}const i=0===a.length;return i?r.length>0&&h.log("WARN",`Data validation warnings for ${t}`,{warnings:r}):h.log("ERROR",`Data validation failed for ${t}`,{errors:a,warnings:r}),{isValid:i,errors:a,warnings:r,qualityScore:this.calculateQualityScore(a,r)}}catch(s){return{isValid:!1,errors:["An unexpected error occurred during validation."],warnings:[]}}}validateBusinessLogic(e,t){const s=[],a=[];switch(t){case"marketData":if(e.currentPrice&&e.previousClose){const t=e.currentPrice-e.previousClose,s=t/e.previousClose*100;e.change&&Math.abs(e.change-t)>.01&&a.push(`Price change inconsistency: reported ${e.change}, calculated ${t.toFixed(2)}`),e.changePercent&&Math.abs(e.changePercent-s)>.1&&a.push(`Change percent inconsistency: reported ${e.changePercent}%, calculated ${s.toFixed(2)}%`)}e.currentPrice&&e.dayHigh&&e.dayLow&&(e.currentPrice>e.dayHigh&&a.push(`Current price ${e.currentPrice} exceeds day high ${e.dayHigh}`),e.currentPrice<e.dayLow&&a.push(`Current price ${e.currentPrice} below day low ${e.dayLow}`),e.dayLow>e.dayHigh&&s.push(`Day low ${e.dayLow} greater than day high ${e.dayHigh}`));break;case"financialStatements":if(e.revenue&&e.netIncome){const t=e.netIncome/e.revenue*100;(t<-100||t>100)&&a.push(`Unusual net profit margin: ${t.toFixed(2)}%`)}if(e.totalCurrentAssets&&e.totalCurrentLiabilities){const t=e.totalCurrentAssets/e.totalCurrentLiabilities;(t<.1||t>20)&&a.push(`Unusual current ratio: ${t.toFixed(2)}`)}break;case"companyProfile":e.pe&&(e.pe<0||e.pe>500)&&a.push(`Unusual P/E ratio: ${e.pe}`),e.pb&&(e.pb<0||e.pb>50)&&a.push(`Unusual P/B ratio: ${e.pb}`)}return{errors:s,warnings:a}}calculateQualityScore(e,t){return e.length>0?Math.max(0,50-10*e.length):Math.max(70,100-5*t.length)}crossValidateData(e,t){if(e.length<2)return{isConsistent:!0,discrepancies:[],recommendedSource:e[0]?.source};const s=[],a=this.validationRules[t]?.numeric||[];for(const i of a){const t=e.filter(e=>void 0!==e[i]&&null!==e[i]).map(e=>({value:parseFloat(e[i]),source:e.source}));if(t.length>1){const e=t.reduce((e,t)=>e+t.value,0)/t.length,a=Math.max(...t.map(t=>Math.abs(t.value-e))),r=.05*e;a>r&&s.push({field:i,values:t,mean:e,maxDeviation:a,threshold:r})}}const r=e.map(e=>{const s=this.validateData(e,t);return{source:e.source,qualityScore:s.qualityScore,errorCount:s.errors.length,warningCount:s.warnings.length}}),n=r.sort((e,t)=>t.qualityScore-e.qualityScore)[0]?.source;return{isConsistent:0===s.length,discrepancies:s,sourceQuality:r,recommendedSource:n}}detectAnomalies(e,t){if(e.length<10)return[];const s=e.map(e=>parseFloat(e[t])).filter(e=>!isNaN(e)),a=s.reduce((e,t)=>e+t,0)/s.length,r=s.reduce((e,t)=>e+Math.pow(t-a,2),0)/s.length,n=Math.sqrt(r),i=[];return e.forEach((e,s)=>{const r=parseFloat(e[t]);if(!isNaN(r)){const t=Math.abs((r-a)/n);t>2.5&&i.push({index:s,timestamp:e.timestamp,value:r,zScore:t,deviation:r-a,severity:t>3?"high":"medium"})}}),i}getValidationSummary(e,t){const s=this.validateData(e,t);return{dataType:t,timestamp:(new Date).toISOString(),isValid:s.isValid,qualityScore:s.qualityScore,errorCount:s.errors.length,warningCount:s.warnings.length,completeness:this.calculateCompleteness(e,t),freshness:this.calculateFreshness(e),source:e.source||"unknown"}}calculateCompleteness(e,t){const s=this.validationRules[t];if(!s)return 0;const a=[...s.required||[],...s.numeric||[],...Object.keys(s.formats||{})],r=[...new Set(a)];return r.filter(t=>void 0!==e[t]&&null!==e[t]&&""!==e[t]).length/r.length*100}calculateFreshness(e){if(!e.timestamp)return 50;const t=new Date(e.timestamp),s=(new Date-t)/6e4;return s<5?100:s<15?90:s<60?80:s<240?70:s<1440?60:40}sanitizeInput(e){if(null==e)return"";return String(e).replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<[^>]*>/g,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"")}isInRange(e,t,s){return"number"==typeof e&&e>=t&&e<=s}isValidPercentage(e){return"number"==typeof e&&e>=0&&e<=1}isValidNumber(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}isValidArray(e){return Array.isArray(e)}isValidObject(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}validateFinancialRatios(e){const t=[],s=[];return e.currentRatio<1&&s.push("Current ratio below 1.0 indicates potential liquidity issues"),e.debtToEquity>2&&s.push("High debt-to-equity ratio indicates high leverage"),e.returnOnEquity<0&&s.push("Negative return on equity indicates poor performance"),{isValid:0===t.length,errors:t,warnings:s}}},E=()=>{const[s,r]=a.useState([{id:"yahoo",name:"Yahoo Finance",enabled:!0,status:"connected",latency:12,requiresKey:!1},{id:"alpha_vantage",name:"Alpha Vantage",enabled:!1,status:"disconnected",latency:25,requiresKey:!0},{id:"fmp",name:"Financial Modeling Prep",enabled:!1,status:"disconnected",latency:18,requiresKey:!0},{id:"sec_edgar",name:"SEC EDGAR",enabled:!0,status:"connected",latency:45,requiresKey:!1}]),[o,c]=a.useState({overall:"good",sources:{yahoo:"connected",alpha_vantage:"disconnected",fmp:"disconnected",sec_edgar:"connected"}}),[l,d]=a.useState(!1),[m,u]=a.useState({}),[h,p]=a.useState({}),[j,N]=a.useState([{id:"widget-1",symbol:"AAPL",name:"Apple Inc.",currentValue:182.52,change:2.15,changePercent:1.19,valueType:"currency",dayHigh:184.3,dayLow:180.15,volume:52847392,source:"Bloomberg",lastUpdate:new Date(Date.now()-2e3),sparklineData:[180.25,181.15,180.95,182.1,181.85,182.52]},{id:"widget-2",symbol:"MSFT",name:"Microsoft Corporation",currentValue:378.85,change:-1.25,changePercent:-.33,valueType:"currency",dayHigh:381.2,dayLow:377.5,volume:28394751,source:"FactSet",lastUpdate:new Date(Date.now()-1500),sparklineData:[380.15,379.85,378.95,379.4,378.2,378.85]},{id:"widget-3",symbol:"GOOGL",name:"Alphabet Inc.",currentValue:2847.35,change:15.8,changePercent:.56,valueType:"currency",dayHigh:2855,dayLow:2830.15,volume:1847392,source:"Bloomberg",lastUpdate:new Date(Date.now()-3e3),sparklineData:[2835.25,2841.15,2838.95,2845.1,2843.85,2847.35]},{id:"widget-4",symbol:"US10Y",name:"US 10-Year Treasury",currentValue:4.285,change:.025,changePercent:.59,valueType:"percentage",dayHigh:4.295,dayLow:4.26,volume:null,source:"Refinitiv",lastUpdate:new Date(Date.now()-5e3),sparklineData:[4.26,4.27,4.275,4.28,4.285,4.285]}]),[w,S]=a.useState([{symbol:"AAPL",name:"Apple Inc.",exchange:"NASDAQ",sector:"Technology",price:182.52,change:2.15,changePercent:1.19},{symbol:"MSFT",name:"Microsoft Corporation",exchange:"NASDAQ",sector:"Technology",price:378.85,change:-1.25,changePercent:-.33},{symbol:"TSLA",name:"Tesla Inc.",exchange:"NASDAQ",sector:"Consumer Discretionary",price:248.42,change:5.67,changePercent:2.34}]),[A,D]=a.useState([]),[P,k]=a.useState("2 min ago"),[T,F]=a.useState(5e3),[M,E]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const e=$.getSourceHealthStatus();u(e),r(t=>t.map(t=>{const s=e[t.id.toUpperCase()];return s?{...t,enabled:s.hasValidApiKey||!s.requiresApiKey,status:s.hasValidApiKey||!s.requiresApiKey?"connected":"disconnected"}:t}));const t=Object.values(e).some(e=>e.hasValidApiKey||!e.requiresApiKey);d(t)}catch(e){}})()},[]),a.useEffect(()=>{if(!M)return;const e=setInterval(async()=>{if(l){const e=await Promise.all(j.map(async e=>{try{const t=await $.fetchRealTimeMarketData(e.symbol),s=q.validateData(t,"marketData");return{...e,currentValue:t.currentPrice,change:t.change,changePercent:t.changePercent,dayHigh:t.dayHigh,dayLow:t.dayLow,volume:t.volume,lastUpdate:new Date,source:t.source,dataQuality:s.qualityScore,sparklineData:[...e.sparklineData.slice(1),t.currentPrice]}}catch(t){return{...e,currentValue:e.currentValue+2*(Math.random()-.5),change:5*(Math.random()-.5),changePercent:2*(Math.random()-.5),lastUpdate:new Date,source:"Simulation",sparklineData:[...e.sparklineData.slice(1),e.currentValue+2*(Math.random()-.5)]}}}));N(e)}else N(e=>e.map(e=>({...e,currentValue:e.currentValue+2*(Math.random()-.5),change:5*(Math.random()-.5),changePercent:2*(Math.random()-.5),lastUpdate:new Date,source:"Simulation",sparklineData:[...e.sparklineData.slice(1),e.currentValue+2*(Math.random()-.5)]})));k("Just now")},T);return()=>clearInterval(e)},[T,M,l,j]);const I=async e=>{try{let s,a="Simulation",r=75;if(l)try{s=await $.fetchRealTimeMarketData(e.symbol);const t=q.validateData(s,"marketData");a=s.source,r=t.qualityScore}catch(t){s=null}const n={id:`widget-${Date.now()}`,symbol:e.symbol,name:e.name,currentValue:s?.currentPrice||1e3*Math.random()+50,change:s?.change||10*(Math.random()-.5),changePercent:s?.changePercent||5*(Math.random()-.5),valueType:"currency",dayHigh:s?.dayHigh||1e3*Math.random()+60,dayLow:s?.dayLow||1e3*Math.random()+40,volume:s?.volume||Math.floor(1e8*Math.random()),source:a,dataQuality:r,lastUpdate:new Date,sparklineData:Array.from({length:6},()=>s?.currentPrice||1e3*Math.random()+50)};N(e=>[...e,n]),l&&R.subscribe(e.symbol,"marketData",t=>{N(s=>s.map(s=>s.symbol===e.symbol?{...s,currentValue:t.currentPrice,change:t.change,changePercent:t.changePercent,lastUpdate:new Date(t.timestamp),source:t.source}:s))})}catch(t){}},L=e=>{},H=e=>{N(t=>t.filter(t=>t.id!==e))},V=e=>{e.ctrlKey&&"f"===e.key&&(e.preventDefault(),document.querySelector('input[placeholder*="Search symbols"]')?.focus())};return a.useEffect(()=>(document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)),[]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(i,{}),e.jsxs("div",{className:"pt-[60px]",children:[e.jsx("div",{className:"bg-card border-b border-border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx(f,{dataSources:s,onToggle:e=>{r(t=>t.map(t=>t.id===e?{...t,enabled:!t.enabled}:t))}}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",iconName:"RefreshCw",onClick:()=>{k("Just now")},className:M?"animate-spin":"",children:"Refresh"}),e.jsx(n,{variant:M?"default":"outline",size:"sm",iconName:M?"Pause":"Play",onClick:()=>E(!M),children:M?"Pause":"Resume"})]})]}),e.jsx(g,{connectionHealth:o,lastUpdate:P})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-3 space-y-6",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4 shadow-elevation-1",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"Add Symbols"}),e.jsx(b,{onSymbolSelect:I,watchlist:w,onAddToWatchlist:e=>{w.some(t=>t.symbol===e.symbol)||S(t=>[...t,{...e,price:1e3*Math.random()+50,change:10*(Math.random()-.5),changePercent:5*(Math.random()-.5)}])}}),e.jsx("div",{className:"mt-3 text-xs text-muted-foreground",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Keyboard",size:12}),e.jsx("span",{children:"Ctrl+F to focus search"})]})})]}),e.jsx(v,{watchlist:w,onRemoveFromWatchlist:e=>{S(t=>t.filter(t=>t.symbol!==e))},onSelectSymbol:I}),e.jsx(x,{selectedSymbols:A,onBulkExport:e=>{alert(`Exporting ${e.symbols.length} symbols in ${e.format.toUpperCase()} format`)},onBulkAlert:e=>{alert(`Setting ${e.threshold}% alerts for ${e.symbols.length} symbols`)},onBulkHistorical:e=>{alert(`Fetching ${e.period} historical data for ${e.symbols.length} symbols`)}}),e.jsx(C,{apiHealthStatus:m,realDataEnabled:l,dataSources:s,dataQuality:h})]}),e.jsxs("div",{className:"col-span-9",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-foreground",children:["Market Data Widgets (",j.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",iconName:"Settings",children:"Layout"}),e.jsx(n,{variant:"outline",size:"sm",iconName:"Save",children:"Save Dashboard"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:j.map(t=>e.jsx(y,{widget:t,onResize:L,onRemove:H},t.id))}),0===j.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(t,{name:"BarChart3",size:48,className:"mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No Data Widgets"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Search and add symbols to start monitoring market data"}),e.jsx(n,{variant:"outline",iconName:"Plus",children:"Add Your First Widget"})]})]})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Active Widgets: ",j.length]}),e.jsxs("span",{children:["Watchlist: ",w.length]}),e.jsxs("span",{children:["Auto-refresh: ",M?"ON":"OFF"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{children:"Market Hours: OPEN"}),e.jsxs("span",{children:["Last Update: ",P]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),e.jsx("span",{children:"All systems operational"})]})]})]})})]})]})};export{E as default};
//# sourceMappingURL=index-CnJRWCxt.js.map
