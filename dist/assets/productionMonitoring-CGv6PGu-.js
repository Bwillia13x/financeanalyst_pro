var e={};const t=new class{constructor(){this.isInitialized=!1,this.userId=null,this.sessionId=this.generateSessionId(),this.startTime=Date.now(),this.errorQueue=[],this.performanceQueue=[],this.userActivityQueue=[],this.detectAutomatedEnvironment()||this.init()}detectAutomatedEnvironment(){try{return"undefined"!=typeof navigator&&!0===navigator.webdriver||"undefined"!=typeof window&&window.location&&new URLSearchParams(window.location.search).has("lhci")||"undefined"!=typeof window&&window.location&&new URLSearchParams(window.location.search).has("ci")||"undefined"!=typeof window&&window.location&&new URLSearchParams(window.location.search).has("audit")}catch{return!1}}init(){if(!this.isInitialized)try{this.initSentry(),this.setupErrorListeners(),this.setupPerformanceMonitoring(),this.setupUserActivityTracking(),this.setupHealthChecks(),this.isInitialized=!0}catch(e){}}initSentry(){"undefined"!=typeof window&&window.Sentry&&(window.Sentry.init({dsn:e.VITE_SENTRY_DSN,environment:e.VITE_APP_ENV||"development",tracesSampleRate:.1,beforeSend:(e,t)=>["ResizeObserver loop limit exceeded","Non-Error promise rejection captured","Network request failed"].some(t=>e.exception?.values?.[0]?.value?.includes(t))?null:e}),this.userId&&window.Sentry.setUser({id:this.userId}))}setupErrorListeners(){window.addEventListener("error",e=>{this.logError({type:"javascript",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error?.stack,timestamp:(new Date).toISOString()})}),window.addEventListener("unhandledrejection",e=>{this.logError({type:"promise",message:e.reason?.message||"Unhandled promise rejection",stack:e.reason?.stack,timestamp:(new Date).toISOString()})}),window.addEventListener("error",e=>{e.target!==window&&this.logError({type:"resource",message:`Failed to load ${e.target.tagName}: ${e.target.src||e.target.href}`,element:e.target.tagName,source:e.target.src||e.target.href,timestamp:(new Date).toISOString()})},!0)}setupPerformanceMonitoring(){"PerformanceObserver"in window&&(new PerformanceObserver(e=>{for(const t of e.getEntries())t.hadRecentInput||this.logPerformance({metric:"CLS",value:t.value,timestamp:(new Date).toISOString()})}).observe({entryTypes:["layout-shift"]}),new PerformanceObserver(e=>{const t=e.getEntries(),r=t[t.length-1];this.logPerformance({metric:"LCP",value:r.startTime,timestamp:(new Date).toISOString()})}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(e=>{for(const t of e.getEntries())this.logPerformance({metric:"FID",value:t.processingStart-t.startTime,timestamp:(new Date).toISOString()})}).observe({entryTypes:["first-input"]})),window.addEventListener("load",()=>{setTimeout(()=>{const e=performance.getEntriesByType("navigation")[0],t=performance.getEntriesByType("paint");this.logPerformance({metric:"page_load",domContentLoaded:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,loadComplete:e.loadEventEnd-e.loadEventStart,firstPaint:t.find(e=>"first-paint"===e.name)?.startTime,firstContentfulPaint:t.find(e=>"first-contentful-paint"===e.name)?.startTime,timestamp:(new Date).toISOString()})},0)})}setupUserActivityTracking(){let e=Date.now(),t=!0;const r=()=>{e=Date.now(),t||(t=!0,this.logUserActivity({type:"session_resume",timestamp:(new Date).toISOString()}))};["click","scroll","keypress","mousemove"].forEach(e=>{document.addEventListener(e,r,{passive:!0})}),setInterval(()=>{Date.now()-e>3e5&&t&&(t=!1,this.logUserActivity({type:"session_idle",duration:Date.now()-e,timestamp:(new Date).toISOString()}))},6e4),document.addEventListener("visibilitychange",()=>{this.logUserActivity({type:document.hidden?"page_hidden":"page_visible",timestamp:(new Date).toISOString()})}),window.addEventListener("beforeunload",()=>{this.logUserActivity({type:"page_unload",sessionDuration:Date.now()-this.startTime,timestamp:(new Date).toISOString()}),this.flush()})}setupHealthChecks(){setInterval(()=>{this.logHealthCheck({memoryUsage:this.getMemoryUsage(),connectionType:this.getConnectionType(),timestamp:(new Date).toISOString()})},3e5)}logError(e){const t={...e,sessionId:this.sessionId,userId:this.userId,url:window.location.href,userAgent:navigator.userAgent,timestamp:e.timestamp||(new Date).toISOString()};this.errorQueue.push(t),window.Sentry&&window.Sentry.captureException(new Error(e.message),{extra:t}),this.errorQueue.length>=10&&this.flushErrors()}logPerformance(e){const t={...e,sessionId:this.sessionId,userId:this.userId,url:window.location.href};this.performanceQueue.push(t),this.performanceQueue.length>=20&&this.flushPerformance()}logUserActivity(e){const t={...e,sessionId:this.sessionId,userId:this.userId,url:window.location.href};this.userActivityQueue.push(t),this.userActivityQueue.length>=50&&this.flushUserActivity()}logHealthCheck(e){this.sendToEndpoint("/api/health",{...e,sessionId:this.sessionId,userId:this.userId})}setUser(e,t={}){this.userId=e,window.Sentry&&window.Sentry.setUser({id:e,...t})}flushErrors(){this.errorQueue.length>0&&(this.sendToEndpoint("/api/errors",this.errorQueue),this.errorQueue=[])}flushPerformance(){this.performanceQueue.length>0&&(this.sendToEndpoint("/api/performance",this.performanceQueue),this.performanceQueue=[])}flushUserActivity(){this.userActivityQueue.length>0&&(this.sendToEndpoint("/api/user-activity",this.userActivityQueue),this.userActivityQueue=[])}flush(){this.flushErrors(),this.flushPerformance(),this.flushUserActivity()}generateSessionId(){return`session-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}getMemoryUsage(){return"memory"in performance?{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}:null}getConnectionType(){return"connection"in navigator?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:null}async sendToEndpoint(e,t){try{await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(r){}}captureErrorBoundary(e,t,r){this.logError({type:"react_error_boundary",message:e.message,stack:e.stack,componentStack:t.componentStack,errorId:r,timestamp:(new Date).toISOString()})}trackFeatureUsage(e,t={}){this.logUserActivity({type:"feature_usage",feature:e,context:t,timestamp:(new Date).toISOString()})}mark(e){"performance"in window&&"mark"in performance&&performance.mark(e)}measure(e,t,r){if("performance"in window&&"measure"in performance)try{performance.measure(e,t,r);const n=performance.getEntriesByName(e,"measure")[0];this.logPerformance({metric:"custom_measure",name:e,duration:n.duration,timestamp:(new Date).toISOString()})}catch(n){}}};export{t as default};
//# sourceMappingURL=productionMonitoring-CGv6PGu-.js.map
