{"version":3,"mappings":"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","names":["helpContent","dcf","title","description","keyPoints","formulas","tips","lbo","wacc","ratios","montecarlo","HelpPanel","helpKey","isOpen","onClose","help","createPortal","className","children","jsxs","jsx","BookOpen","onClick","X","TrendingUp","map","point","index","ChevronRight","Calculator","formula","AlertCircle","tip","href","ExternalLink","document","body","ErrorBoundary","React","Component","constructor","props","super","this","state","hasError","error","errorInfo","errorId","retryCount","getDerivedStateFromError","_error","Date","now","Math","random","toString","substr","componentDidCatch","setState","logErrorToService","errorData","message","stack","componentStack","timestamp","toISOString","userAgent","navigator","url","window","location","userId","fetch","method","headers","JSON","stringify","catch","_e","handleRetry","prevState","handleReportError","subject","encodeURIComponent","open","render","fallback","FallbackComponent","variant","isValidElement","retry","isNetworkError","includes","isDataError","isCriticalError","AlertTriangle","Button","size","RefreshCw","Home","Bug","Skeleton","animate","cn","FinancialTableSkeleton","rows","columns","showHeader","from","length","_","Array","rowIndex","colIndex","LoadingWrapper","isLoading","skeleton","CollaborationService","EventEmitter","workspaces","Map","users","connections","annotations","modelStates","isInitialized","wsConnection","reconnectAttempts","maxReconnectAttempts","heartbeatInterval","syncQueue","isOnline","onLine","env","__vite_import_meta_env__","collabEnabled","VITE_ENABLE_COLLABORATION","handleConnectionOpen","bind","handleConnectionMessage","handleConnectionClose","handleConnectionError","addEventListener","reconnectWebSocket","emit","online","initialize","userProfile","currentUserId","currentUserProfile","id","name","avatar","role","joinedAt","lastActive","set","initializeWebSocket","startHeartbeat","explicitUrl","VITE_COLLAB_WS_URL","wsUrl","protocol","host","VITE_COLLAB_WS_MOCK","WebSocket","readyState","send","data","setTimeout","close","connected","sendMessage","type","processSyncQueue","event","parse","handleWorkspaceUpdate","handleUserJoined","handleUserLeft","handleModelUpdate","handleAnnotationAdded","handleAnnotationUpdated","handleAnnotationDeleted","handleCursorUpdate","handlePresenceUpdate","pow","push","shift","setInterval","joinWorkspace","workspaceId","options","workspace","createdBy","createdAt","members","models","settings","isPublic","allowGuests","maxMembers","lastActivity","leaveWorkspace","get","Error","delete","shareModel","modelId","modelData","permissions","sharedModel","sharedBy","sharedAt","canEdit","canComment","canView","version","lastModified","modifiedBy","updateModel","updates","_options","model","updatedData","addAnnotation","annotation","annotationId","newAnnotation","content","position","x","y","target","updatedAt","resolved","replies","metadata","updateCursor","getWorkspaceMembers","values","getWorkspaceModels","getModelAnnotations","filter","user","Object","assign","cleanup","clearInterval","clear","collaborationService","FinancialSpreadsheet","lazy","__vitePreload","import","__VITE_PRELOAD__","ModelingTools","AnalysisResults","AdvancedLBOTool","FinancialModelWorkspace","EnhancedScenarioAnalysis","EnhancedMarketDataDashboard","MonteCarloIntegrationHub","DataExportImport","ContextualInsightsSidebar","PrivateAnalysis","dispatch","useDispatch","financialData","useSelector","selectFinancialData","selectActiveModel","analysis","isDirty","isTestEnvironment","webdriver","search","isCollabInitialized","setIsInitialized","useState","connectionStatus","setConnectionStatus","currentWorkspace","setCurrentWorkspace","workspaceMembers","setWorkspaceMembers","setIsLoading","setError","initialized","useRef","useEffect","current","async","err","initializeService","handleConnectionStatus","status","handleWorkspaceJoined","handleWorkspaceLeft","prev","find","member","leftUserId","on","off","useCallback","useCollaboration","showCollaboration","_setShowCollaboration","activeTab","setActiveTab","_showTour","setShowTour","activeHelpPanel","setActiveHelpPanel","showQuickStart","setShowQuickStart","quickStartDialogRef","quickStartStartBtnRef","quickStartSkipBtnRef","lastSaved","setLastSaved","localStorage","getItem","setItem","focus","handleKeyDown","e","key","preventDefault","titleEl","getElementById","container","focusables","querySelectorAll","first","last","shiftKey","activeElement","removeEventListener","advancedResults","setAdvancedResults","threeStatement","scenarios","marketData","monteCarlo","adjustedValues","setAdjustedValues","modelInputs","discountRate","terminalGrowthRate","projectionYears","taxRate","scenario","insightsSidebarVisible","setInsightsSidebarVisible","currentMetricFocus","setCurrentMetricFocus","savedAnalyses","setSavedAnalyses","saved","dataStatus","setDataStatus","getDataCompleteness","statements","completedFields","totalWeightedFields","forEach","field","incomeStatement","balanceSheet","cashFlow","completionPercentage","round","totalRevenue","operatingIncome","max","calculateModelingProgress","progress","min","calculateAnalysisProgress","saveAnalysis","toLocaleDateString","dataCompleteness","modelingProgress","analysisProgress","updated","keys","setFinancialData","defaultFinancialData","handleDataChange","newData","section","setLboResults","setThreeStatementResults","setMonteCarloResults","tabs","label","icon","Database","Activity","FileText","Upload","SEOHead","canonical","keywords","Header","tabIndex","disabled","Save","toLocaleTimeString","style","width","ref","Play","SecondaryNav","navigation","activeItem","onItemClick","itemId","HelpCircle","tab","Icon","Suspense","motion","div","initial","opacity","exit","transition","duration","onDataChange","onAdjustedValuesChange","calculateDCF","formatCurrency","formatPercentage","results","lboModelingEngine","dcfResults","lboResults","financialModel","scenarioResults","onAnalysesChange","currentMetric","analysisContext","onInsightClick","insight","metric","isVisible","onToggle"],"ignoreList":[],"sources":["../../src/components/ui/ContextualHelp.jsx","../../src/components/ui/ErrorBoundary.jsx","../../src/components/ui/LoadingSkeleton.jsx","../../src/services/collaborationService.js","../../src/pages/PrivateAnalysis.jsx","../../src/hooks/useCollaboration.js"],"sourcesContent":["import { HelpCircle, X, BookOpen, Calculator, TrendingUp, AlertCircle, ChevronRight, ExternalLink } from 'lucide-react';\nimport React, { useState, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\n\nimport { cn } from '../../utils/cn';\n\n/**\n * Comprehensive contextual help and onboarding system for financial features\n * Provides intelligent tooltips, guided tours, and contextual assistance\n */\n\n// Help content database\nconst helpContent = {\n  dcf: {\n    title: 'Discounted Cash Flow (DCF) Analysis',\n    description: 'Estimates company value by projecting future cash flows and discounting them to present value.',\n    keyPoints: [\n      'Projects free cash flows for 5-10 years',\n      'Calculates terminal value for perpetual growth',\n      'Uses weighted average cost of capital (WACC) as discount rate',\n      'Highly sensitive to growth and discount rate assumptions'\n    ],\n    formulas: [\n      'FCF = EBIT(1-Tax Rate) + Depreciation - CapEx - Working Capital Change',\n      'Terminal Value = FCF × (1+g) / (WACC - g)',\n      'Enterprise Value = Σ(FCF/(1+WACC)^t) + Terminal Value/(1+WACC)^n'\n    ],\n    tips: [\n      'Use conservative growth rates for terminal value (2-4%)',\n      'Validate WACC calculation with industry benchmarks',\n      'Perform sensitivity analysis on key assumptions',\n      'Cross-reference with comparable company multiples'\n    ]\n  },\n  lbo: {\n    title: 'Leveraged Buyout (LBO) Analysis',\n    description: 'Models acquisition using significant debt financing to achieve target returns.',\n    keyPoints: [\n      'High debt-to-equity ratio (60-90% debt typical)',\n      'Focus on debt paydown and equity value creation',\n      'Requires strong, predictable cash flows',\n      'Exit typically through sale or IPO after 3-7 years'\n    ],\n    formulas: [\n      'Equity IRR = (Exit Equity Value / Initial Equity Investment)^(1/years) - 1',\n      'Debt Service Coverage = EBITDA / (Interest + Principal Payments)',\n      'Exit Multiple = Exit Enterprise Value / Exit EBITDA'\n    ],\n    tips: [\n      'Model different debt structures and covenants',\n      'Include management fees and transaction costs',\n      'Test downside scenarios for covenant compliance',\n      'Consider operational improvements in projections'\n    ]\n  },\n  wacc: {\n    title: 'Weighted Average Cost of Capital (WACC)',\n    description: 'Blended cost of debt and equity financing used as discount rate in valuations.',\n    keyPoints: [\n      'Reflects risk and capital structure of the business',\n      'Used as discount rate in DCF analysis',\n      'Lower WACC increases company valuation',\n      'Varies by industry and company size'\n    ],\n    formulas: [\n      'WACC = (E/V × Re) + (D/V × Rd × (1-Tax Rate))',\n      'Cost of Equity (Re) = Risk-free Rate + Beta × Market Risk Premium',\n      'After-tax Cost of Debt = Pre-tax Rate × (1-Tax Rate)'\n    ],\n    tips: [\n      'Use market values, not book values, for weights',\n      'Consider company-specific risk factors',\n      'Review beta calculation methodology',\n      'Update regularly as market conditions change'\n    ]\n  },\n  ratios: {\n    title: 'Financial Ratio Analysis',\n    description: 'Key metrics for evaluating financial performance, efficiency, and risk.',\n    keyPoints: [\n      'Liquidity ratios measure short-term obligations',\n      'Leverage ratios assess debt and financial risk',\n      'Profitability ratios evaluate operational efficiency',\n      'Valuation ratios compare market vs. intrinsic value'\n    ],\n    formulas: [\n      'Current Ratio = Current Assets / Current Liabilities',\n      'Debt-to-Equity = Total Debt / Total Equity',\n      'ROE = Net Income / Shareholders Equity',\n      'P/E Ratio = Price per Share / Earnings per Share'\n    ],\n    tips: [\n      'Compare ratios to industry benchmarks',\n      'Look at trends over multiple periods',\n      'Consider seasonal business variations',\n      'Understand accounting policy impacts'\n    ]\n  },\n  montecarlo: {\n    title: 'Monte Carlo Simulation',\n    description: 'Uses random sampling to model uncertainty in financial projections.',\n    keyPoints: [\n      'Tests thousands of scenarios with variable inputs',\n      'Provides probability distributions of outcomes',\n      'Helps quantify risks and uncertainties',\n      'Useful for complex models with multiple variables'\n    ],\n    formulas: [\n      'Confidence Interval = Percentile(results, confidence_level)',\n      'Value at Risk = Percentile(results, risk_level)',\n      'Expected Value = Mean(simulation_results)'\n    ],\n    tips: [\n      'Define realistic ranges for input variables',\n      'Use appropriate probability distributions',\n      'Run sufficient iterations (10,000+) for stability',\n      'Validate results against historical data'\n    ]\n  }\n};\n\n// Tooltip component\nexport const FinancialTooltip = ({\n  content,\n  position = 'top',\n  trigger = 'hover',\n  className,\n  children\n}) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [tooltipPosition, setTooltipPosition] = useState({ top: 0, left: 0 });\n  const triggerRef = useRef(null);\n  const tooltipRef = useRef(null);\n\n  const showTooltip = () => setIsVisible(true);\n  const hideTooltip = () => setIsVisible(false);\n\n  useEffect(() => {\n    if (isVisible && triggerRef.current && tooltipRef.current) {\n      const triggerRect = triggerRef.current.getBoundingClientRect();\n      const tooltipRect = tooltipRef.current.getBoundingClientRect();\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n      const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n\n      let top, left;\n\n      switch (position) {\n        case 'top':\n          top = triggerRect.top + scrollTop - tooltipRect.height - 8;\n          left = triggerRect.left + scrollLeft + (triggerRect.width - tooltipRect.width) / 2;\n          break;\n        case 'bottom':\n          top = triggerRect.bottom + scrollTop + 8;\n          left = triggerRect.left + scrollLeft + (triggerRect.width - tooltipRect.width) / 2;\n          break;\n        case 'left':\n          top = triggerRect.top + scrollTop + (triggerRect.height - tooltipRect.height) / 2;\n          left = triggerRect.left + scrollLeft - tooltipRect.width - 8;\n          break;\n        case 'right':\n          top = triggerRect.top + scrollTop + (triggerRect.height - tooltipRect.height) / 2;\n          left = triggerRect.right + scrollLeft + 8;\n          break;\n        default:\n          top = triggerRect.top + scrollTop - tooltipRect.height - 8;\n          left = triggerRect.left + scrollLeft + (triggerRect.width - tooltipRect.width) / 2;\n      }\n\n      // Keep tooltip within viewport\n      const padding = 16;\n      if (left < padding) left = padding;\n      if (left + tooltipRect.width > window.innerWidth - padding) {\n        left = window.innerWidth - tooltipRect.width - padding;\n      }\n      if (top < padding) top = triggerRect.bottom + scrollTop + 8;\n\n      setTooltipPosition({ top, left });\n    }\n  }, [isVisible, position]);\n\n  const triggerProps = trigger === 'hover'\n    ? { onMouseEnter: showTooltip, onMouseLeave: hideTooltip }\n    : { onClick: () => setIsVisible(!isVisible) };\n\n  return (\n    <>\n      <span ref={triggerRef} className={className} {...triggerProps}>\n        {children}\n      </span>\n\n      {isVisible && createPortal(\n        <div\n          ref={tooltipRef}\n          className=\"fixed z-50 max-w-sm p-3 bg-slate-900 text-white text-sm rounded-lg shadow-lg pointer-events-none\"\n          style={{ top: tooltipPosition.top, left: tooltipPosition.left }}\n        >\n          <div className=\"relative\">\n            {typeof content === 'string' ? (\n              <p>{content}</p>\n            ) : (\n              <div className=\"space-y-2\">\n                {content.title && <div className=\"font-semibold\">{content.title}</div>}\n                {content.description && <p className=\"text-slate-300\">{content.description}</p>}\n                {content.formula && (\n                  <div className=\"bg-slate-800 px-2 py-1 rounded text-xs font-mono\">\n                    {content.formula}\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </div>,\n        document.body\n      )}\n    </>\n  );\n};\n\n// Help icon with tooltip\nexport const HelpIcon = ({ helpKey, className }) => {\n  const help = helpContent[helpKey];\n  if (!help) return null;\n\n  return (\n    <FinancialTooltip\n      content={{\n        title: help.title,\n        description: help.description,\n        formula: help.formulas?.[0]\n      }}\n      className={cn('inline-flex items-center justify-center cursor-help', className)}\n    >\n      <HelpCircle className=\"w-4 h-4 text-slate-400 hover:text-slate-600\" />\n    </FinancialTooltip>\n  );\n};\n\n// Comprehensive help panel\nexport const HelpPanel = ({ helpKey, isOpen, onClose }) => {\n  const help = helpContent[helpKey];\n  if (!help || !isOpen) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-slate-200\">\n          <div className=\"flex items-center space-x-3\">\n            <BookOpen className=\"w-6 h-6 text-blue-600\" />\n            <h2 className=\"text-xl font-semibold text-slate-900\">{help.title}</h2>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-80px)]\">\n          <div className=\"space-y-6\">\n            {/* Description */}\n            <div>\n              <p className=\"text-slate-700 leading-relaxed\">{help.description}</p>\n            </div>\n\n            {/* Key Points */}\n            <div>\n              <h3 className=\"text-lg font-medium text-slate-900 mb-3 flex items-center\">\n                <TrendingUp className=\"w-5 h-5 mr-2 text-green-600\" />\n                Key Points\n              </h3>\n              <ul className=\"space-y-2\">\n                {help.keyPoints.map((point, index) => (\n                  <li key={index} className=\"flex items-start space-x-2\">\n                    <ChevronRight className=\"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0\" />\n                    <span className=\"text-slate-700\">{point}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n\n            {/* Formulas */}\n            {help.formulas && (\n              <div>\n                <h3 className=\"text-lg font-medium text-slate-900 mb-3 flex items-center\">\n                  <Calculator className=\"w-5 h-5 mr-2 text-purple-600\" />\n                  Key Formulas\n                </h3>\n                <div className=\"space-y-2\">\n                  {help.formulas.map((formula, index) => (\n                    <div key={index} className=\"bg-slate-100 p-3 rounded-lg\">\n                      <code className=\"text-sm text-slate-800 font-mono\">{formula}</code>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Tips */}\n            <div>\n              <h3 className=\"text-lg font-medium text-slate-900 mb-3 flex items-center\">\n                <AlertCircle className=\"w-5 h-5 mr-2 text-yellow-600\" />\n                Best Practices\n              </h3>\n              <ul className=\"space-y-2\">\n                {help.tips.map((tip, index) => (\n                  <li key={index} className=\"flex items-start space-x-2\">\n                    <div className=\"w-1.5 h-1.5 bg-yellow-500 rounded-full mt-2 flex-shrink-0\" />\n                    <span className=\"text-slate-700\">{tip}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n\n            {/* Additional Resources */}\n            <div className=\"border-t border-slate-200 pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-slate-600\">Need more help?</span>\n                <a\n                  href=\"mailto:support@financeanalystpro.com\"\n                  className=\"text-sm text-blue-600 hover:text-blue-800 flex items-center space-x-1\"\n                >\n                  <span>Contact Support</span>\n                  <ExternalLink className=\"w-3 h-3\" />\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>,\n    document.body\n  );\n};\n\n// Onboarding tour component\nexport const OnboardingTour = ({ steps, isActive, onComplete, onSkip }) => {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [tooltipPosition, setTooltipPosition] = useState({ top: 0, left: 0 });\n\n  useEffect(() => {\n    if (isActive && steps[currentStep]) {\n      const element = document.querySelector(steps[currentStep].target);\n      if (element) {\n        const rect = element.getBoundingClientRect();\n        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n\n        // Highlight the target element\n        element.style.position = 'relative';\n        element.style.zIndex = '1001';\n        element.style.boxShadow = '0 0 0 4px rgba(59, 130, 246, 0.5)';\n\n        // Position tooltip with strict viewport constraints\n        const tooltipWidth = 320;\n        const tooltipHeight = 250; // increased to account for buttons\n        const padding = 20;\n\n        let top = rect.bottom + scrollTop + 12;\n        let left = rect.left + scrollLeft;\n\n        // Ensure tooltip stays within horizontal bounds\n        const maxLeft = window.innerWidth - tooltipWidth - padding;\n        const minLeft = padding;\n        left = Math.max(minLeft, Math.min(left, maxLeft));\n\n        // Ensure tooltip stays within vertical bounds\n        const maxTop = window.innerHeight + scrollTop - tooltipHeight - padding;\n        const minTop = scrollTop + padding;\n\n        if (top > maxTop) {\n          // Position above target if no room below\n          top = Math.max(rect.top + scrollTop - tooltipHeight - 12, minTop);\n        }\n\n        top = Math.max(minTop, Math.min(top, maxTop));\n\n        setTooltipPosition({ top, left });\n      }\n    }\n\n    return () => {\n      // Clean up highlighting\n      if (steps[currentStep]) {\n        const element = document.querySelector(steps[currentStep].target);\n        if (element) {\n          element.style.position = '';\n          element.style.zIndex = '';\n          element.style.boxShadow = '';\n        }\n      }\n    };\n  }, [currentStep, isActive, steps]);\n\n  if (!isActive || !steps[currentStep]) return null;\n\n  const step = steps[currentStep];\n  const isLastStep = currentStep === steps.length - 1;\n\n  const nextStep = () => {\n    try {\n      if (isLastStep) {\n        // Delay completion to ensure UI is stable\n        setTimeout(() => {\n          try {\n            onComplete();\n          } catch (error) {\n            console.error('Error in onComplete:', error);\n          }\n        }, 100);\n      } else {\n        setCurrentStep(currentStep + 1);\n      }\n    } catch (error) {\n      console.error('Error in nextStep:', error);\n    }\n  };\n\n  const prevStep = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  return createPortal(\n    <>\n      {/* Overlay */}\n      <div className=\"fixed inset-0 bg-black bg-opacity-50\" style={{ zIndex: 1000 }} />\n\n      {/* Tooltip */}\n      <div\n        className=\"fixed max-w-sm bg-white rounded-lg shadow-xl border border-slate-200\"\n        style={{\n          top: tooltipPosition.top,\n          left: tooltipPosition.left,\n          zIndex: 1002\n        }}\n      >\n        <div className=\"p-4\">\n          <div className=\"flex items-start justify-between mb-3\">\n            <h3 className=\"font-semibold text-slate-900\">{step.title}</h3>\n            <button\n              onClick={onSkip}\n              className=\"text-slate-400 hover:text-slate-600\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          </div>\n\n          <p className=\"text-sm text-slate-700 mb-4\">{step.content}</p>\n\n          {step.tip && (\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4\">\n              <div className=\"flex items-start space-x-2\">\n                <AlertCircle className=\"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0\" />\n                <p className=\"text-sm text-blue-800\">{step.tip}</p>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-1\">\n              {steps.map((_, index) => (\n                <div\n                  key={index}\n                  className={cn(\n                    'w-2 h-2 rounded-full',\n                    index === currentStep ? 'bg-blue-600' : 'bg-slate-300'\n                  )}\n                />\n              ))}\n            </div>\n\n            <div className=\"flex items-center space-x-2\">\n              {currentStep > 0 && (\n                <button\n                  onClick={prevStep}\n                  className=\"px-3 py-1 text-sm text-slate-600 hover:text-slate-800\"\n                >\n                  Back\n                </button>\n              )}\n              <button\n                onClick={nextStep}\n                className=\"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700\"\n                aria-label={isLastStep ? 'Finish' : 'Next'}\n              >\n                {isLastStep ? 'Finish' : 'Next'}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>,\n    document.body\n  );\n};\n\nexport default {\n  FinancialTooltip,\n  HelpIcon,\n  HelpPanel,\n  OnboardingTour,\n  helpContent\n};\n","import { AlertTriangle, RefreshCw, Home, Bug, ExternalLink } from 'lucide-react';\nimport React from 'react';\n\nimport Button from './Button';\n\n/**\n * Enhanced Error Boundary with user-friendly error handling and recovery options\n */\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: null,\n      retryCount: 0\n    };\n  }\n\n  static getDerivedStateFromError(_error) {\n    // Update state so the next render will show the fallback UI\n    return {\n      hasError: true,\n      errorId: `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n    };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // Log error details\n    this.setState({\n      error,\n      errorInfo\n    });\n\n    // Log to console in development\n    if (import.meta.env.DEV) {\n      console.error('ErrorBoundary caught an error:', error, errorInfo);\n    }\n\n    // Send error to monitoring service in production\n    if (import.meta.env.PROD) {\n      this.logErrorToService(error, errorInfo);\n    }\n  }\n\n  logErrorToService = (error, errorInfo) => {\n    // Integration point for error monitoring services like Sentry, LogRocket, etc.\n    const errorData = {\n      message: error.message,\n      stack: error.stack,\n      componentStack: errorInfo.componentStack,\n      errorId: this.state.errorId,\n      timestamp: new Date().toISOString(),\n      userAgent: navigator.userAgent,\n      url: window.location.href,\n      userId: this.props.userId || 'anonymous'\n    };\n\n    // Example integration (replace with actual service)\n    try {\n      fetch('/api/errors', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(errorData)\n      }).catch(() => {\n        // Fail silently if error reporting fails\n      });\n    } catch (_e) {\n      // Fail silently\n    }\n  };\n\n  handleRetry = () => {\n    this.setState(prevState => ({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: null,\n      retryCount: prevState.retryCount + 1\n    }));\n  };\n\n  handleReportError = () => {\n    const { error, errorInfo, errorId } = this.state;\n    const _bugReport = {\n      errorId,\n      message: error?.message,\n      stack: error?.stack,\n      component: errorInfo?.componentStack,\n      timestamp: new Date().toISOString(),\n      url: window.location.href\n    };\n\n    // Create mailto link with error details\n    const subject = encodeURIComponent(`FinanceAnalyst Pro Error Report - ${errorId}`);\n    const body = encodeURIComponent(\n      'Error Details:\\n\\n' +\n      `Error ID: ${errorId}\\n` +\n      `Message: ${error?.message}\\n` +\n      `Timestamp: ${new Date().toISOString()}\\n` +\n      `URL: ${window.location.href}\\n\\n` +\n      `Technical Details:\\n${error?.stack}\\n\\n` +\n      `Component Stack:\\n${errorInfo?.componentStack}`\n    );\n\n    window.open(`mailto:support@financeanalystpro.com?subject=${subject}&body=${body}`);\n  };\n\n  render() {\n    if (this.state.hasError) {\n      const { fallback: FallbackComponent, variant = 'default' } = this.props;\n      const { error, errorId, retryCount } = this.state;\n\n      // Use custom fallback if provided\n      if (FallbackComponent) {\n        if (React.isValidElement(FallbackComponent)) {\n          return FallbackComponent;\n        }\n        if (typeof FallbackComponent === 'function') {\n          return <FallbackComponent error={error} retry={this.handleRetry} />;\n        }\n      }\n\n      // Determine error severity and appropriate response\n      const isNetworkError = error?.message?.includes('fetch') || error?.message?.includes('network');\n      const isDataError = error?.message?.includes('Cannot read') || error?.message?.includes('undefined');\n      const isCriticalError = retryCount > 2;\n\n      if (variant === 'minimal') {\n        return (\n          <div className=\"flex items-center justify-center p-4 bg-red-50 border border-red-200 rounded-lg\">\n            <AlertTriangle className=\"w-5 h-5 text-red-600 mr-2\" />\n            <span className=\"text-red-800 text-sm\">Something went wrong</span>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={this.handleRetry}\n              className=\"ml-3 text-red-700 hover:text-red-900\"\n            >\n              <RefreshCw className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        );\n      }\n\n      if (variant === 'inline') {\n        return (\n          <div className=\"p-4 bg-red-50 border-l-4 border-red-400 rounded-r-lg\">\n            <div className=\"flex items-start\">\n              <AlertTriangle className=\"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0\" />\n              <div className=\"flex-1\">\n                <h4 className=\"text-sm font-medium text-red-800 mb-1\">\n                  Unable to load this section\n                </h4>\n                <p className=\"text-sm text-red-700 mb-2\">\n                  {isNetworkError ? 'Check your internet connection and try again.' :\n                    isDataError ? 'There was an issue with the data format.' :\n                      'An unexpected error occurred.'}\n                </p>\n                <div className=\"flex items-center space-x-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={this.handleRetry}\n                    className=\"text-red-700 border-red-300 hover:bg-red-100\"\n                  >\n                    <RefreshCw className=\"w-3 h-3 mr-1\" />\n                    Try Again\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        );\n      }\n\n      // Full-page error boundary (default)\n      return (\n        <div className=\"min-h-screen bg-slate-50 flex items-center justify-center p-4\">\n          <div className=\"max-w-lg w-full bg-white rounded-lg shadow-lg border border-slate-200 p-8 text-center\">\n            {/* Error Icon */}\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <AlertTriangle className=\"w-8 h-8 text-red-600\" />\n            </div>\n\n            {/* Error Title */}\n            <h1 className=\"text-xl font-semibold text-slate-900 mb-2\">\n              {isCriticalError ? 'Application Error' : 'Something went wrong'}\n            </h1>\n\n            {/* Error Message */}\n            <p className=\"text-slate-600 mb-6\">\n              {isCriticalError ? (\n                'The application encountered a critical error. Please refresh the page or contact support.'\n              ) : isNetworkError ? (\n                'Unable to connect to our servers. Please check your internet connection and try again.'\n              ) : isDataError ? (\n                'There was an issue processing the data. This might be a temporary problem.'\n              ) : (\n                'An unexpected error occurred. Our team has been notified and is working on a fix.'\n              )}\n            </p>\n\n            {/* Error ID for support */}\n            {errorId && (\n              <div className=\"bg-slate-100 rounded-lg p-3 mb-6 text-left\">\n                <div className=\"text-xs font-mono text-slate-500 mb-1\">Error ID (for support):</div>\n                <div className=\"text-sm font-mono text-slate-700 break-all\">{errorId}</div>\n              </div>\n            )}\n\n            {/* Action Buttons */}\n            <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n              {!isCriticalError && (\n                <Button\n                  onClick={this.handleRetry}\n                  className=\"flex items-center justify-center\"\n                  variant=\"primary\"\n                >\n                  <RefreshCw className=\"w-4 h-4 mr-2\" />\n                  Try Again\n                </Button>\n              )}\n\n              <Button\n                onClick={() => window.location.href = '/'}\n                variant=\"outline\"\n                className=\"flex items-center justify-center\"\n              >\n                <Home className=\"w-4 h-4 mr-2\" />\n                Go Home\n              </Button>\n\n              <Button\n                onClick={this.handleReportError}\n                variant=\"ghost\"\n                className=\"flex items-center justify-center text-slate-600 hover:text-slate-800\"\n              >\n                <Bug className=\"w-4 h-4 mr-2\" />\n                Report Issue\n              </Button>\n            </div>\n\n            {/* Additional Help */}\n            <div className=\"mt-6 pt-6 border-t border-slate-200 text-sm text-slate-500\">\n              <p>\n                Need immediate help?{' '}\n                <a\n                  href=\"mailto:support@financeanalystpro.com\"\n                  className=\"text-blue-600 hover:text-blue-800 inline-flex items-center\"\n                >\n                  Contact Support\n                  <ExternalLink className=\"w-3 h-3 ml-1\" />\n                </a>\n              </p>\n            </div>\n\n            {/* Development Info */}\n            {import.meta.env.DEV && error && (\n              <details className=\"mt-6 text-left\">\n                <summary className=\"cursor-pointer text-sm text-slate-600 hover:text-slate-800\">\n                  Show Technical Details\n                </summary>\n                <div className=\"mt-2 p-3 bg-slate-100 rounded text-xs font-mono text-slate-700 overflow-auto max-h-40\">\n                  <div className=\"mb-2 font-semibold\">Error:</div>\n                  <div className=\"mb-2\">{error.message}</div>\n                  <div className=\"mb-2 font-semibold\">Stack:</div>\n                  <pre className=\"whitespace-pre-wrap\">{error.stack}</pre>\n                </div>\n              </details>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\n// Hook for functional component error handling\nexport const useErrorHandler = () => {\n  const [error, setError] = React.useState(null);\n\n  const resetError = React.useCallback(() => {\n    setError(null);\n  }, []);\n\n  const captureError = React.useCallback((error, errorInfo = {}) => {\n    console.error('Error captured:', error);\n    setError({ error, errorInfo });\n  }, []);\n\n  React.useEffect(() => {\n    if (error) {\n      // Log error to monitoring service\n      console.error('Captured error:', error);\n    }\n  }, [error]);\n\n  return { error, resetError, captureError };\n};\n\n// Higher-order component for adding error boundaries\nexport const withErrorBoundary = (Component, errorBoundaryConfig = {}) => {\n  const WrappedComponent = React.forwardRef((props, ref) => (\n    <ErrorBoundary {...errorBoundaryConfig}>\n      <Component {...props} ref={ref} />\n    </ErrorBoundary>\n  ));\n\n  WrappedComponent.displayName = `withErrorBoundary(${Component.displayName || Component.name})`;\n  return WrappedComponent;\n};\n\nexport default ErrorBoundary;\n","import React from 'react';\n\nimport { cn } from '../../utils/cn';\n\n/**\n * Flexible skeleton loading components for consistent loading states\n * Provides animated placeholders while content loads\n */\n\n// Base skeleton component\nexport const Skeleton = ({\n  className,\n  animate = true,\n  variant = 'default',\n  ...props\n}) => (\n  <div\n    className={cn(\n      'bg-slate-200 rounded',\n      animate && 'animate-pulse',\n      variant === 'text' && 'h-4',\n      variant === 'button' && 'h-10',\n      variant === 'avatar' && 'h-12 w-12 rounded-full',\n      variant === 'card' && 'h-48',\n      className\n    )}\n    {...props}\n  />\n);\n\n// Financial table skeleton\nexport const FinancialTableSkeleton = ({\n  rows = 8,\n  columns = 5,\n  showHeader = true,\n  className\n}) => (\n  <div className={cn('space-y-3', className)}>\n    {showHeader && (\n      <div className=\"flex items-center space-x-4 p-4 bg-slate-50 rounded-lg\">\n        {Array.from({ length: columns }).map((_, index) => (\n          <Skeleton\n            key={`header-${index}`}\n            className=\"h-4 flex-1\"\n            variant=\"text\"\n          />\n        ))}\n      </div>\n    )}\n\n    <div className=\"space-y-2\">\n      {Array.from({ length: rows }).map((_, rowIndex) => (\n        <div key={`row-${rowIndex}`} className=\"flex items-center space-x-4 p-4 border border-slate-200 rounded-lg\">\n          {Array.from({ length: columns }).map((_, colIndex) => (\n            <Skeleton\n              key={`cell-${rowIndex}-${colIndex}`}\n              className={cn(\n                'h-4',\n                colIndex === 0 ? 'flex-2' : 'flex-1',\n                colIndex > 0 && colIndex < columns - 1 && 'w-20'\n              )}\n            />\n          ))}\n        </div>\n      ))}\n    </div>\n  </div>\n);\n\n// Chart skeleton\nexport const ChartSkeleton = ({\n  height = 300,\n  showLegend = true,\n  className\n}) => (\n  <div className={cn('p-6 border border-slate-200 rounded-lg', className)}>\n    {/* Chart title */}\n    <div className=\"mb-4\">\n      <Skeleton className=\"h-6 w-48 mb-2\" />\n      <Skeleton className=\"h-4 w-32\" />\n    </div>\n\n    {/* Chart area */}\n    <div className=\"relative\" style={{ height }}>\n      <Skeleton className=\"w-full h-full rounded-lg\" />\n\n      {/* Simulate chart elements */}\n      <div className=\"absolute inset-4 flex flex-col justify-end\">\n        <div className=\"flex items-end space-x-2 h-full\">\n          {Array.from({ length: 8 }).map((_, index) => (\n            <Skeleton\n              key={`bar-${index}`}\n              className=\"flex-1 bg-slate-300\"\n              style={{ height: `${Math.random() * 80 + 20}%` }}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n\n    {/* Legend */}\n    {showLegend && (\n      <div className=\"flex items-center justify-center space-x-4 mt-4\">\n        {Array.from({ length: 3 }).map((_, index) => (\n          <div key={`legend-${index}`} className=\"flex items-center space-x-2\">\n            <Skeleton className=\"w-4 h-4 rounded-sm\" />\n            <Skeleton className=\"w-16 h-4\" />\n          </div>\n        ))}\n      </div>\n    )}\n  </div>\n);\n\n// Dashboard card skeleton\nexport const DashboardCardSkeleton = ({ className }) => (\n  <div className={cn('p-6 border border-slate-200 rounded-lg space-y-4', className)}>\n    {/* Header */}\n    <div className=\"flex items-center justify-between\">\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-5 w-32\" />\n        <Skeleton className=\"h-4 w-24\" />\n      </div>\n      <Skeleton className=\"w-8 h-8 rounded-lg\" />\n    </div>\n\n    {/* Main content */}\n    <div className=\"space-y-3\">\n      <Skeleton className=\"h-8 w-20\" />\n      <div className=\"flex items-center space-x-2\">\n        <Skeleton className=\"h-4 w-4\" />\n        <Skeleton className=\"h-4 w-16\" />\n      </div>\n    </div>\n\n    {/* Mini chart */}\n    <div className=\"h-16 flex items-end space-x-1\">\n      {Array.from({ length: 12 }).map((_, index) => (\n        <Skeleton\n          key={`mini-bar-${index}`}\n          className=\"flex-1 bg-slate-300\"\n          style={{ height: `${Math.random() * 60 + 20}%` }}\n        />\n      ))}\n    </div>\n  </div>\n);\n\n// Portfolio holdings skeleton\nexport const PortfolioHoldingsSkeleton = ({ rows = 5, className }) => (\n  <div className={cn('space-y-3', className)}>\n    {/* Header */}\n    <div className=\"flex items-center justify-between p-4 bg-slate-50 rounded-lg\">\n      <Skeleton className=\"h-5 w-40\" />\n      <div className=\"flex items-center space-x-2\">\n        <Skeleton className=\"h-8 w-20\" />\n        <Skeleton className=\"h-8 w-8 rounded\" />\n      </div>\n    </div>\n\n    {/* Holdings list */}\n    <div className=\"space-y-2\">\n      {Array.from({ length: rows }).map((_, index) => (\n        <div key={`holding-${index}`} className=\"flex items-center justify-between p-4 border border-slate-200 rounded-lg\">\n          <div className=\"flex items-center space-x-3\">\n            <Skeleton className=\"w-10 h-10 rounded-lg\" />\n            <div className=\"space-y-1\">\n              <Skeleton className=\"h-4 w-16\" />\n              <Skeleton className=\"h-3 w-32\" />\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-6 text-right\">\n            <div className=\"space-y-1\">\n              <Skeleton className=\"h-4 w-12\" />\n              <Skeleton className=\"h-3 w-8\" />\n            </div>\n            <div className=\"space-y-1\">\n              <Skeleton className=\"h-4 w-16\" />\n              <Skeleton className=\"h-3 w-12\" />\n            </div>\n            <div className=\"space-y-1\">\n              <Skeleton className=\"h-4 w-20\" />\n              <Skeleton className=\"h-3 w-16\" />\n            </div>\n            <Skeleton className=\"h-6 w-12\" />\n          </div>\n        </div>\n      ))}\n    </div>\n  </div>\n);\n\n// Market data widget skeleton\nexport const MarketDataSkeleton = ({ className }) => (\n  <div className={cn('p-4 border border-slate-200 rounded-lg', className)}>\n    {/* Header with symbol */}\n    <div className=\"flex items-center justify-between mb-3\">\n      <div className=\"space-y-1\">\n        <Skeleton className=\"h-5 w-16\" />\n        <Skeleton className=\"h-3 w-24\" />\n      </div>\n      <Skeleton className=\"w-6 h-6 rounded\" />\n    </div>\n\n    {/* Price and change */}\n    <div className=\"space-y-2 mb-4\">\n      <Skeleton className=\"h-7 w-24\" />\n      <Skeleton className=\"h-4 w-20\" />\n    </div>\n\n    {/* Stats */}\n    <div className=\"grid grid-cols-2 gap-3\">\n      {Array.from({ length: 4 }).map((_, index) => (\n        <div key={`stat-${index}`} className=\"space-y-1\">\n          <Skeleton className=\"h-3 w-12\" />\n          <Skeleton className=\"h-4 w-16\" />\n        </div>\n      ))}\n    </div>\n\n    {/* Sparkline */}\n    <div className=\"mt-4 h-8 flex items-end space-x-0.5\">\n      {Array.from({ length: 20 }).map((_, index) => (\n        <Skeleton\n          key={`spark-${index}`}\n          className=\"flex-1 bg-slate-300\"\n          style={{ height: `${Math.random() * 70 + 10}%` }}\n        />\n      ))}\n    </div>\n  </div>\n);\n\n// Analysis results skeleton\nexport const AnalysisResultsSkeleton = ({ className }) => (\n  <div className={cn('space-y-6', className)}>\n    {/* Summary cards */}\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n      {Array.from({ length: 3 }).map((_, index) => (\n        <DashboardCardSkeleton key={`summary-${index}`} />\n      ))}\n    </div>\n\n    {/* Main analysis chart */}\n    <ChartSkeleton height={400} />\n\n    {/* Detailed breakdown */}\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      <FinancialTableSkeleton rows={6} columns={3} />\n      <ChartSkeleton height={250} showLegend={false} />\n    </div>\n  </div>\n);\n\n// Loading state wrapper component\nexport const LoadingWrapper = ({\n  isLoading,\n  skeleton,\n  children,\n  className,\n  fallback = null\n}) => {\n  if (isLoading) {\n    return (\n      <div className={cn('animate-pulse', className)}>\n        {skeleton || fallback}\n      </div>\n    );\n  }\n\n  return children;\n};\n\n// Shimmer effect for enhanced loading animations\nexport const ShimmerWrapper = ({\n  children,\n  className,\n  intensity = 'normal' // 'subtle', 'normal', 'intense'\n}) => (\n  <div\n    className={cn(\n      'relative overflow-hidden',\n      className\n    )}\n  >\n    {children}\n    <div\n      className={cn(\n        'absolute inset-0 -translate-x-full animate-[shimmer_2s_infinite]',\n        'bg-gradient-to-r from-transparent via-white/20 to-transparent',\n        intensity === 'subtle' && 'via-white/10',\n        intensity === 'intense' && 'via-white/30'\n      )}\n    />\n  </div>\n);\n\nexport default {\n  Skeleton,\n  FinancialTableSkeleton,\n  ChartSkeleton,\n  DashboardCardSkeleton,\n  PortfolioHoldingsSkeleton,\n  MarketDataSkeleton,\n  AnalysisResultsSkeleton,\n  LoadingWrapper,\n  ShimmerWrapper\n};\n","/**\n * Real-Time Collaboration Service\n * Handles multi-user financial modeling workspaces, live sharing, and real-time sync\n */\n\nimport { EventEmitter } from 'events';\n\n// import { performanceMonitoring } from '../utils/performanceMonitoring'; // Missing module\n\nclass CollaborationService extends EventEmitter {\n  constructor() {\n    super();\n    this.workspaces = new Map();\n    this.users = new Map();\n    this.connections = new Map();\n    this.annotations = new Map();\n    this.modelStates = new Map();\n    this.isInitialized = false;\n    this.wsConnection = null;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.heartbeatInterval = null;\n    this.syncQueue = [];\n    this.isOnline = navigator.onLine;\n\n    // Env and feature flags (Vite)\n    this.env = (typeof import.meta !== 'undefined' && import.meta.env) ? import.meta.env : {};\n    // Explicitly opt-in to collaboration to avoid unexpected WS errors in dev/staging\n    this.collabEnabled = this.env.VITE_ENABLE_COLLABORATION === 'true';\n\n    // Bind methods to preserve context\n    this.handleConnectionOpen = this.handleConnectionOpen.bind(this);\n    this.handleConnectionMessage = this.handleConnectionMessage.bind(this);\n    this.handleConnectionClose = this.handleConnectionClose.bind(this);\n    this.handleConnectionError = this.handleConnectionError.bind(this);\n\n    // Listen for online/offline status\n    window.addEventListener('online', () => {\n      this.isOnline = true;\n      this.reconnectWebSocket();\n    });\n\n    window.addEventListener('offline', () => {\n      this.isOnline = false;\n      this.emit('connectionStatus', { online: false });\n    });\n  }\n\n  /**\n   * Initialize the collaboration service\n   */\n  async initialize(userId, userProfile = {}) {\n    try {\n      if (this.isInitialized) {\n        console.warn('CollaborationService already initialized');\n        return;\n      }\n\n      this.currentUserId = userId;\n      this.currentUserProfile = {\n        id: userId,\n        name: userProfile.name || 'Anonymous User',\n        avatar: userProfile.avatar || null,\n        role: userProfile.role || 'viewer',\n        joinedAt: new Date().toISOString(),\n        lastActive: new Date().toISOString(),\n        ...userProfile\n      };\n\n      // Store current user\n      this.users.set(userId, this.currentUserProfile);\n\n      // Initialize WebSocket connection only if collaboration is enabled\n      if (this.collabEnabled) {\n        await this.initializeWebSocket();\n      } else {\n        console.info('Collaboration disabled via VITE_ENABLE_COLLABORATION. Skipping WebSocket initialization.');\n      }\n\n      // Start heartbeat if enabled\n      if (this.collabEnabled) {\n        this.startHeartbeat();\n      }\n\n      this.isInitialized = true;\n      this.emit('initialized', { userId, userProfile: this.currentUserProfile });\n\n      // Track initialization performance\n      if (typeof performanceMonitoring !== 'undefined') {\n        // performanceMonitoring.trackCustomMetric('collaboration_init_success', 1);\n      }\n\n      console.log('CollaborationService initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize CollaborationService:', error);\n      if (typeof performanceMonitoring !== 'undefined') {\n        // performanceMonitoring.trackCustomMetric('collaboration_init_error', 1);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Initialize WebSocket connection\n   */\n  async initializeWebSocket() {\n    try {\n      // Resolve WebSocket URL from Vite env or current origin\n      const explicitUrl = this.env.VITE_COLLAB_WS_URL;\n      let wsUrl;\n      if (explicitUrl) {\n        wsUrl = explicitUrl;\n      } else if (typeof window !== 'undefined' && window.location) {\n        const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';\n        wsUrl = `${protocol}://${window.location.host}/collaboration`;\n      } else {\n        wsUrl = 'ws://localhost:8080/collaboration';\n      }\n\n      // If mock flag is set, simulate a WS connection; otherwise, attempt a real one\n      const useMock = this.env.VITE_COLLAB_WS_MOCK === 'true';\n      const _options = { useMock };\n      if (useMock || typeof WebSocket === 'undefined') {\n        // Simulated WebSocket for demo/testing\n        this.wsConnection = {\n          readyState: 1, // OPEN\n          send: (data) => {\n            console.log('WebSocket send (mock):', data);\n            setTimeout(() => {\n              this.handleConnectionMessage({ data });\n            }, 100);\n          },\n          close: () => {\n            this.wsConnection.readyState = 3; // CLOSED\n            this.handleConnectionClose();\n          }\n        };\n        console.info(`Collaboration WebSocket running in MOCK mode at ${wsUrl}`);\n        this.handleConnectionOpen();\n      } else {\n        // Real WebSocket connection\n        this.wsConnection = new WebSocket(wsUrl);\n        this.wsConnection.addEventListener('open', this.handleConnectionOpen);\n        this.wsConnection.addEventListener('message', this.handleConnectionMessage);\n        this.wsConnection.addEventListener('close', this.handleConnectionClose);\n        this.wsConnection.addEventListener('error', this.handleConnectionError);\n        console.info(`Connecting to Collaboration WebSocket at ${wsUrl}`);\n      }\n\n    } catch (error) {\n      console.error('WebSocket initialization failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Handle WebSocket connection open\n   */\n  handleConnectionOpen() {\n    console.log('Collaboration WebSocket connected');\n    this.reconnectAttempts = 0;\n    this.emit('connectionStatus', { online: true, connected: true });\n\n    // Send authentication message\n    this.sendMessage({\n      type: 'auth',\n      userId: this.currentUserId,\n      userProfile: this.currentUserProfile\n    });\n\n    // Process any queued messages\n    this.processSyncQueue();\n  }\n\n  /**\n   * Handle WebSocket messages\n   */\n  handleConnectionMessage(event) {\n    try {\n      const message = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;\n\n      switch (message.type) {\n        case 'workspace_update':\n          this.handleWorkspaceUpdate(message.data);\n          break;\n        case 'user_joined':\n          this.handleUserJoined(message.data);\n          break;\n        case 'user_left':\n          this.handleUserLeft(message.data);\n          break;\n        case 'model_update':\n          this.handleModelUpdate(message.data);\n          break;\n        case 'annotation_added':\n          this.handleAnnotationAdded(message.data);\n          break;\n        case 'annotation_updated':\n          this.handleAnnotationUpdated(message.data);\n          break;\n        case 'annotation_deleted':\n          this.handleAnnotationDeleted(message.data);\n          break;\n        case 'cursor_update':\n          this.handleCursorUpdate(message.data);\n          break;\n        case 'presence_update':\n          this.handlePresenceUpdate(message.data);\n          break;\n        default:\n          console.warn('Unknown message type:', message.type);\n      }\n    } catch (error) {\n      console.error('Error handling WebSocket message:', error);\n    }\n  }\n\n  /**\n   * Handle WebSocket connection close\n   */\n  handleConnectionClose() {\n    console.log('Collaboration WebSocket disconnected');\n    this.emit('connectionStatus', { online: this.isOnline, connected: false });\n\n    if (this.isOnline && this.reconnectAttempts < this.maxReconnectAttempts) {\n      setTimeout(() => {\n        this.reconnectWebSocket();\n      }, Math.pow(2, this.reconnectAttempts) * 1000); // Exponential backoff\n    }\n  }\n\n  /**\n   * Handle WebSocket connection error\n   */\n  handleConnectionError(error) {\n    console.error('Collaboration WebSocket error:', error);\n    this.emit('connectionError', error);\n  }\n\n  /**\n   * Reconnect WebSocket\n   */\n  async reconnectWebSocket() {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.error('Max reconnection attempts reached');\n      return;\n    }\n\n    this.reconnectAttempts++;\n    console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);\n\n    try {\n      await this.initializeWebSocket();\n    } catch (error) {\n      console.error('Reconnection failed:', error);\n    }\n  }\n\n  /**\n   * Send message through WebSocket\n   */\n  sendMessage(message) {\n    if (this.wsConnection && this.wsConnection.readyState === 1) {\n      this.wsConnection.send(JSON.stringify(message));\n    } else {\n      // Queue message for later\n      this.syncQueue.push(message);\n    }\n  }\n\n  /**\n   * Process queued sync messages\n   */\n  processSyncQueue() {\n    while (this.syncQueue.length > 0) {\n      const message = this.syncQueue.shift();\n      this.sendMessage(message);\n    }\n  }\n\n  /**\n   * Start heartbeat to keep connection alive\n   */\n  startHeartbeat() {\n    this.heartbeatInterval = setInterval(() => {\n      if (this.wsConnection && this.wsConnection.readyState === 1) {\n        this.sendMessage({ type: 'ping', timestamp: Date.now() });\n      }\n    }, 30000); // 30 seconds\n  }\n\n  /**\n   * Create or join a workspace\n   */\n  async joinWorkspace(workspaceId, options = {}) {\n    try {\n      const workspace = {\n        id: workspaceId,\n        name: options.name || `Workspace ${workspaceId}`,\n        description: options.description || '',\n        createdBy: this.currentUserId,\n        createdAt: new Date().toISOString(),\n        members: new Map([[this.currentUserId, this.currentUserProfile]]),\n        models: new Map(),\n        annotations: new Map(),\n        settings: {\n          isPublic: options.isPublic || false,\n          allowGuests: options.allowGuests || false,\n          maxMembers: options.maxMembers || 10,\n          ...options.settings\n        },\n        lastActivity: new Date().toISOString()\n      };\n\n      this.workspaces.set(workspaceId, workspace);\n\n      // Notify server\n      this.sendMessage({\n        type: 'join_workspace',\n        workspaceId,\n        userId: this.currentUserId,\n        options\n      });\n\n      this.emit('workspaceJoined', { workspaceId, workspace });\n\n      // Track performance\n      if (typeof performanceMonitoring !== 'undefined') {\n        // performanceMonitoring.trackCustomMetric('workspace_joined', 1);\n      }\n\n      return workspace;\n    } catch (error) {\n      console.error('Failed to join workspace:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Leave a workspace\n   */\n  async leaveWorkspace(workspaceId) {\n    try {\n      const workspace = this.workspaces.get(workspaceId);\n      if (!workspace) {\n        throw new Error('Workspace not found');\n      }\n\n      workspace.members.delete(this.currentUserId);\n\n      if (workspace.members.size === 0) {\n        this.workspaces.delete(workspaceId);\n      }\n\n      // Notify server\n      this.sendMessage({\n        type: 'leave_workspace',\n        workspaceId,\n        userId: this.currentUserId\n      });\n\n      this.emit('workspaceLeft', { workspaceId });\n\n      return true;\n    } catch (error) {\n      console.error('Failed to leave workspace:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Share a financial model in real-time\n   */\n  async shareModel(workspaceId, modelId, modelData, permissions = {}) {\n    try {\n      const workspace = this.workspaces.get(workspaceId);\n      if (!workspace) {\n        throw new Error('Workspace not found');\n      }\n\n      const sharedModel = {\n        id: modelId,\n        workspaceId,\n        data: modelData,\n        sharedBy: this.currentUserId,\n        sharedAt: new Date().toISOString(),\n        permissions: {\n          canEdit: permissions.canEdit || false,\n          canComment: permissions.canComment !== false,\n          canView: permissions.canView !== false,\n          ...permissions\n        },\n        version: 1,\n        lastModified: new Date().toISOString(),\n        modifiedBy: this.currentUserId\n      };\n\n      workspace.models.set(modelId, sharedModel);\n      this.modelStates.set(modelId, { ...modelData });\n\n      // Notify all workspace members\n      this.sendMessage({\n        type: 'model_shared',\n        workspaceId,\n        modelId,\n        sharedModel,\n        userId: this.currentUserId\n      });\n\n      this.emit('modelShared', { workspaceId, modelId, sharedModel });\n\n      return sharedModel;\n    } catch (error) {\n      console.error('Failed to share model:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Update shared model data\n   */\n  async updateModel(workspaceId, modelId, updates, _options = {}) {\n    try {\n      const workspace = this.workspaces.get(workspaceId);\n      if (!workspace) {\n        throw new Error('Workspace not found');\n      }\n\n      const model = workspace.models.get(modelId);\n      if (!model) {\n        throw new Error('Model not found');\n      }\n\n      // Check permissions\n      if (!model.permissions.canEdit && model.sharedBy !== this.currentUserId) {\n        throw new Error('No edit permission for this model');\n      }\n\n      // Apply updates\n      const updatedData = { ...model.data, ...updates };\n      model.data = updatedData;\n      model.version += 1;\n      model.lastModified = new Date().toISOString();\n      model.modifiedBy = this.currentUserId;\n\n      this.modelStates.set(modelId, updatedData);\n\n      // Broadcast update\n      this.sendMessage({\n        type: 'model_update',\n        workspaceId,\n        modelId,\n        updates,\n        version: model.version,\n        userId: this.currentUserId,\n        timestamp: model.lastModified\n      });\n\n      this.emit('modelUpdated', { workspaceId, modelId, updates, model });\n\n      return model;\n    } catch (error) {\n      console.error('Failed to update model:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Add annotation to model\n   */\n  async addAnnotation(workspaceId, modelId, annotation) {\n    try {\n      const workspace = this.workspaces.get(workspaceId);\n      if (!workspace) {\n        throw new Error('Workspace not found');\n      }\n\n      const annotationId = `annotation_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      const newAnnotation = {\n        id: annotationId,\n        workspaceId,\n        modelId,\n        content: annotation.content || '',\n        type: annotation.type || 'comment',\n        position: annotation.position || { x: 0, y: 0 },\n        target: annotation.target || null, // Chart element, data point, etc.\n        createdBy: this.currentUserId,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n        resolved: false,\n        replies: [],\n        metadata: annotation.metadata || {}\n      };\n\n      workspace.annotations.set(annotationId, newAnnotation);\n\n      // Broadcast annotation\n      this.sendMessage({\n        type: 'annotation_added',\n        workspaceId,\n        modelId,\n        annotation: newAnnotation,\n        userId: this.currentUserId\n      });\n\n      this.emit('annotationAdded', { workspaceId, modelId, annotation: newAnnotation });\n\n      return newAnnotation;\n    } catch (error) {\n      console.error('Failed to add annotation:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Update cursor position for real-time presence\n   */\n  updateCursor(workspaceId, position) {\n    this.sendMessage({\n      type: 'cursor_update',\n      workspaceId,\n      userId: this.currentUserId,\n      position,\n      timestamp: Date.now()\n    });\n  }\n\n  /**\n   * Get workspace members\n   */\n  getWorkspaceMembers(workspaceId) {\n    const workspace = this.workspaces.get(workspaceId);\n    return workspace ? Array.from(workspace.members.values()) : [];\n  }\n\n  /**\n   * Get shared models in workspace\n   */\n  getWorkspaceModels(workspaceId) {\n    const workspace = this.workspaces.get(workspaceId);\n    return workspace ? Array.from(workspace.models.values()) : [];\n  }\n\n  /**\n   * Get annotations for model\n   */\n  getModelAnnotations(workspaceId, modelId) {\n    const workspace = this.workspaces.get(workspaceId);\n    if (!workspace) return [];\n\n    return Array.from(workspace.annotations.values())\n      .filter(annotation => annotation.modelId === modelId);\n  }\n\n  /**\n   * Handle workspace update from server\n   */\n  handleWorkspaceUpdate(data) {\n    this.emit('workspaceUpdate', data);\n  }\n\n  /**\n   * Handle user joined workspace\n   */\n  handleUserJoined(data) {\n    const workspace = this.workspaces.get(data.workspaceId);\n    if (workspace) {\n      workspace.members.set(data.user.id, data.user);\n    }\n    this.emit('userJoined', data);\n  }\n\n  /**\n   * Handle user left workspace\n   */\n  handleUserLeft(data) {\n    const workspace = this.workspaces.get(data.workspaceId);\n    if (workspace) {\n      workspace.members.delete(data.userId);\n    }\n    this.emit('userLeft', data);\n  }\n\n  /**\n   * Handle model update from other users\n   */\n  handleModelUpdate(data) {\n    const workspace = this.workspaces.get(data.workspaceId);\n    if (workspace) {\n      const model = workspace.models.get(data.modelId);\n      if (model) {\n        model.data = { ...model.data, ...data.updates };\n        model.version = data.version;\n        model.lastModified = data.timestamp;\n        model.modifiedBy = data.userId;\n      }\n    }\n    this.emit('modelUpdate', data);\n  }\n\n  /**\n   * Handle annotation added\n   */\n  handleAnnotationAdded(data) {\n    const workspace = this.workspaces.get(data.workspaceId);\n    if (workspace) {\n      workspace.annotations.set(data.annotation.id, data.annotation);\n    }\n    this.emit('annotationAdded', data);\n  }\n\n  /**\n   * Handle annotation updated\n   */\n  handleAnnotationUpdated(data) {\n    const workspace = this.workspaces.get(data.workspaceId);\n    if (workspace) {\n      const annotation = workspace.annotations.get(data.annotationId);\n      if (annotation) {\n        Object.assign(annotation, data.updates);\n      }\n    }\n    this.emit('annotationUpdated', data);\n  }\n\n  /**\n   * Handle annotation deleted\n   */\n  handleAnnotationDeleted(data) {\n    const workspace = this.workspaces.get(data.workspaceId);\n    if (workspace) {\n      workspace.annotations.delete(data.annotationId);\n    }\n    this.emit('annotationDeleted', data);\n  }\n\n  /**\n   * Handle cursor update\n   */\n  handleCursorUpdate(data) {\n    this.emit('cursorUpdate', data);\n  }\n\n  /**\n   * Handle presence update\n   */\n  handlePresenceUpdate(data) {\n    this.emit('presenceUpdate', data);\n  }\n\n  /**\n   * Cleanup and disconnect\n   */\n  async cleanup() {\n    try {\n      if (this.heartbeatInterval) {\n        clearInterval(this.heartbeatInterval);\n      }\n\n      if (this.wsConnection) {\n        this.wsConnection.close();\n      }\n\n      // Clear all maps\n      this.workspaces.clear();\n      this.users.clear();\n      this.connections.clear();\n      this.annotations.clear();\n      this.modelStates.clear();\n\n      this.isInitialized = false;\n      this.emit('cleanup');\n\n      console.log('CollaborationService cleaned up');\n    } catch (error) {\n      console.error('Error during cleanup:', error);\n    }\n  }\n}\n\n// Export singleton instance\nexport default new CollaborationService();\n","import { motion } from 'framer-motion';\nimport {\n  FileText,\n  Save,\n  Upload,\n  HelpCircle,\n  Play,\n  Database,\n  Activity\n} from 'lucide-react';\nimport React, { useState, useEffect, useCallback, useRef, lazy, Suspense } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\n// OnboardingTour components will be added later\nimport Button from '../components/ui/Button';\nimport { HelpPanel } from '../components/ui/ContextualHelp';\nimport ErrorBoundary from '../components/ui/ErrorBoundary';\nimport Header from '../components/ui/Header';\nimport SEOHead from '../components/SEO/SEOHead';\nimport { LoadingWrapper, FinancialTableSkeleton } from '../components/ui/LoadingSkeleton';\nimport SecondaryNav from '../components/ui/SecondaryNav';\nimport defaultFinancialData from '../data/defaultFinancialData';\nimport { useCollaboration } from '../hooks/useCollaboration';\nimport {\n  setFinancialData,\n  setDcfResults,\n  setLboResults,\n  setThreeStatementResults,\n  setMonteCarloResults,\n  selectFinancialData,\n  selectActiveModel,\n  selectIsDirty\n} from '../store/analysisStore';\nimport { formatCurrency, formatPercentage } from '../utils/dataTransformation';\nimport { calculateDCF } from '../utils/dcfCalculations';\n\n// Lazy-loaded heavy modules to reduce initial bundle size for the Private Analysis route\nconst FinancialSpreadsheet = lazy(() => import('../components/PrivateAnalysis/FinancialSpreadsheet'));\nconst ModelingTools = lazy(() => import('../components/PrivateAnalysis/ModelingTools'));\nconst AnalysisResults = lazy(() => import('../components/PrivateAnalysis/AnalysisResults'));\nconst AdvancedLBOTool = lazy(() => import('../components/PrivateAnalysis/AdvancedLBOTool'));\nconst FinancialModelWorkspace = lazy(() => import('../components/PrivateAnalysis/FinancialModelWorkspace'));\nconst EnhancedScenarioAnalysis = lazy(() => import('../components/PrivateAnalysis/EnhancedScenarioAnalysis'));\nconst EnhancedMarketDataDashboard = lazy(() => import('../components/PrivateAnalysis/EnhancedMarketDataDashboard'));\nconst MonteCarloIntegrationHub = lazy(() => import('../components/PrivateAnalysis/MonteCarloIntegrationHub'));\nconst DataExportImport = lazy(() => import('../components/DataExportImport'));\nconst ContextualInsightsSidebar = lazy(() => import('../components/PrivateAnalysis/ContextualInsightsSidebar'));\n\nconst PrivateAnalysis = () => {\n  // Redux hooks\n  const dispatch = useDispatch();\n  const financialData = useSelector(selectFinancialData);\n  const _activeModel = useSelector(selectActiveModel);\n  const _isDirty = useSelector(state => state.analysis.isDirty);\n\n  // Collaboration hook - disabled during testing to prevent errors\n  const isTestEnvironment = typeof window !== 'undefined' && (\n    window.navigator?.webdriver === true ||\n    window.location?.search?.includes('lhci') ||\n    window.location?.search?.includes('ci') ||\n    window.location?.search?.includes('audit')\n  );\n\n  const {\n    isInitialized: isCollabInitialized,\n    joinWorkspace\n  } = useCollaboration('current-user-id', {\n    name: 'Financial Analyst',\n    role: 'analyst'\n  });\n\n  const [showCollaboration, _setShowCollaboration] = useState(false);\n  const workspaceId = 'private-analysis-workspace';\n\n  // Initialize collaboration workspace - skip during testing\n  useEffect(() => {\n    if (!isTestEnvironment && isCollabInitialized && !showCollaboration) {\n      joinWorkspace(workspaceId, {\n        name: 'Private Analysis Workspace',\n        description: 'Collaborative financial modeling and analysis'\n      }).catch(error => {\n        console.error('Failed to join workspace:', error);\n      });\n    }\n  }, [isCollabInitialized, workspaceId, joinWorkspace, showCollaboration, isTestEnvironment]);\n\n  // Local state for UI\n  const [activeTab, setActiveTab] = useState('spreadsheet');\n  const [_showTour, setShowTour] = useState(false);\n\n  // Onboarding and help state\n  const [activeHelpPanel, setActiveHelpPanel] = useState(null);\n  const [showQuickStart, setShowQuickStart] = useState(false);\n  const quickStartDialogRef = useRef(null);\n  const quickStartStartBtnRef = useRef(null);\n  const quickStartSkipBtnRef = useRef(null);\n\n  // Existing state management\n  const [lastSaved, setLastSaved] = useState(null);\n\n  // Auto-start tour for new users\n  useEffect(() => {\n    const hasVisited = localStorage.getItem('fa-pro-visited-private-analysis');\n    if (!hasVisited && !localStorage.getItem('privateAnalyses')) {\n      setShowQuickStart(true);\n      localStorage.setItem('fa-pro-visited-private-analysis', 'true');\n    }\n  }, []);\n\n  // Focus management and keyboard support for Quick Start modal\n  useEffect(() => {\n    if (!showQuickStart) return;\n\n    // Focus the Start button on open\n    quickStartStartBtnRef.current?.focus();\n\n    const handleKeyDown = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        setShowQuickStart(false);\n        // Return focus to page title after closing\n        const titleEl = document.getElementById('page-title');\n        if (titleEl) titleEl.focus();\n        return;\n      }\n      if (e.key === 'Tab') {\n        const container = quickStartDialogRef.current;\n        if (!container) return;\n        const focusables = container.querySelectorAll(\n          'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        );\n        if (!focusables.length) return;\n        const first = focusables[0];\n        const last = focusables[focusables.length - 1];\n        if (e.shiftKey && document.activeElement === first) {\n          e.preventDefault();\n          last.focus();\n        } else if (!e.shiftKey && document.activeElement === last) {\n          e.preventDefault();\n          first.focus();\n        }\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [showQuickStart]);\n\n  const handleStartTour = () => {\n    setShowQuickStart(false);\n    setShowTour(true);\n    // Return focus to page title\n    const titleEl = document.getElementById('page-title');\n    if (titleEl) titleEl.focus();\n  };\n\n  const handleSkipTour = () => {\n    setShowQuickStart(false);\n    // Return focus to page title\n    const titleEl = document.getElementById('page-title');\n    if (titleEl) titleEl.focus();\n  };\n\n  const openHelpPanel = (helpKey) => {\n    setActiveHelpPanel(helpKey);\n  };\n\n  const closeHelpPanel = () => {\n    setActiveHelpPanel(null);\n  };\n\n  // Additional state management\n  const [advancedResults, setAdvancedResults] = useState({\n    lbo: null,\n    threeStatement: null,\n    scenarios: null,\n    marketData: null,\n    monteCarlo: null\n  });\n  const [adjustedValues, setAdjustedValues] = useState({});\n  const [modelInputs] = useState({\n    dcf: {\n      discountRate: 10,\n      terminalGrowthRate: 2.5,\n      projectionYears: 5,\n      taxRate: 25\n    },\n    scenario: {\n      scenarios: []\n    }\n  });\n\n  // Insights sidebar state\n  const [insightsSidebarVisible, setInsightsSidebarVisible] = useState(false);\n  const [currentMetricFocus, setCurrentMetricFocus] = useState(null);\n\n  const [savedAnalyses, setSavedAnalyses] = useState(() => {\n    try {\n      const saved = localStorage.getItem('privateAnalyses');\n      return saved ? JSON.parse(saved) : [];\n    } catch (error) {\n      console.error('Error loading saved analyses:', error);\n      return [];\n    }\n  });\n\n  const [isLoading, setIsLoading] = useState(false);\n\n  const [dataStatus, setDataStatus] = useState('ready');\n\n  // Enhanced data completeness tracking\n  const getDataCompleteness = () => {\n    if (!financialData?.statements) return 0;\n\n    const coreIncomeFields = ['totalRevenue', 'totalCostOfGoodsSold', 'operatingIncome', 'netIncome'];\n    const optionalBalanceFields = ['totalAssets', 'totalLiabilities', 'totalEquity'];\n    const optionalCashFlowFields = ['operatingCashFlow', 'investingCashFlow', 'financingCashFlow'];\n\n    let completedFields = 0;\n    let totalWeightedFields = 0;\n\n    // Check core income statement fields (weighted more heavily)\n    coreIncomeFields.forEach(field => {\n      totalWeightedFields += 3; // Core fields worth 3 points each\n      if (financialData.statements.incomeStatement?.[field]?.[2] !== undefined) {\n        completedFields += 3;\n      }\n    });\n\n    // Check optional balance sheet fields\n    optionalBalanceFields.forEach(field => {\n      totalWeightedFields += 2; // Optional fields worth 2 points each\n      if (financialData.statements.balanceSheet?.[field]?.[2] !== undefined) {\n        completedFields += 2;\n      }\n    });\n\n    // Check cash flow fields\n    optionalCashFlowFields.forEach(field => {\n      totalWeightedFields += 2;\n      if (financialData.statements.cashFlow?.[field]?.[2] !== undefined) {\n        completedFields += 2;\n      }\n    });\n\n    const completionPercentage = Math.round((completedFields / totalWeightedFields) * 100);\n\n    // If we have core income statement data, ensure minimum 80% completion\n    const hasBasicIncomeData = financialData?.statements?.incomeStatement?.totalRevenue?.[2] !== undefined &&\n                              financialData?.statements?.incomeStatement?.operatingIncome?.[2] !== undefined;\n\n    return hasBasicIncomeData ? Math.max(completionPercentage, 80) : completionPercentage;\n  };\n\n  const calculateModelingProgress = () => {\n    let progress = 0;\n\n    // DCF Model completion\n    if (modelInputs?.dcf?.discountRate && modelInputs?.dcf?.terminalGrowthRate) {\n      progress += 40;\n    }\n\n    // Enhanced data completeness boost\n    const dataCompleteness = getDataCompleteness();\n    if (dataCompleteness >= 80) {\n      progress += 20; // Comprehensive data gets boost\n    }\n\n    // Scenario analysis completion\n    if (modelInputs?.scenario?.scenarios && modelInputs.scenario.scenarios.length > 0) {\n      progress += 20;\n    }\n\n    // Advanced tools usage\n    if (advancedResults.lbo || advancedResults.threeStatement || advancedResults.monteCarlo) {\n      progress += 20;\n    }\n\n    return Math.min(progress, 100);\n  };\n\n  const calculateAnalysisProgress = () => {\n    let progress = 0;\n\n    // Basic DCF analysis\n    if (financialData?.statements?.incomeStatement) {\n      progress += 30;\n    }\n\n    // Advanced modeling results\n    if (advancedResults.lbo) progress += 20;\n    if (advancedResults.threeStatement) progress += 20;\n    if (advancedResults.scenarios) progress += 15;\n    if (advancedResults.monteCarlo) progress += 15;\n\n    return Math.min(progress, 100);\n  };\n\n  const saveAnalysis = useCallback(async(name) => {\n    try {\n      setIsLoading(true);\n      setDataStatus('saving');\n\n      const analysis = {\n        id: Date.now().toString(),\n        name: name || `Analysis ${new Date().toLocaleDateString()}`,\n        timestamp: new Date().toISOString(),\n        financialData,\n        adjustedValues,\n        modelInputs,\n        advancedResults,\n        dataCompleteness: getDataCompleteness(),\n        modelingProgress: calculateModelingProgress(),\n        analysisProgress: calculateAnalysisProgress()\n      };\n\n      const updated = [...savedAnalyses, analysis];\n      setSavedAnalyses(updated);\n\n      try {\n        localStorage.setItem('privateAnalyses', JSON.stringify(updated));\n      } catch (error) {\n        console.error('Error saving analysis:', error);\n        throw new Error('Failed to save analysis to localStorage');\n      }\n\n      setDataStatus('ready');\n      setLastSaved(new Date());\n\n    } catch (error) {\n      console.error('Save failed:', error);\n      setDataStatus('error');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [financialData, adjustedValues, modelInputs, advancedResults, savedAnalyses]);\n\n  const handleInsightClick = (insight) => {\n    setCurrentMetricFocus(insight.metric);\n  };\n\n  const toggleInsightsSidebar = () => {\n    setInsightsSidebarVisible(!insightsSidebarVisible);\n  };\n\n  // Auto-show insights sidebar when analysis becomes available\n  useEffect(() => {\n    if (calculateAnalysisProgress() > 60 && !insightsSidebarVisible) {\n      setInsightsSidebarVisible(true);\n    }\n  }, [financialData, advancedResults, insightsSidebarVisible]);\n\n  // Initialize financial data if not already set\n  useEffect(() => {\n    if (!financialData || Object.keys(financialData).length === 0) {\n      dispatch(setFinancialData(defaultFinancialData));\n    }\n  }, [dispatch, financialData]);\n\n  // Function to handle data changes from components\n  const handleDataChange = useCallback((newData, section = 'general') => {\n    if (section === 'lbo') {\n      dispatch(setLboResults(newData));\n    } else if (section === 'threeStatement') {\n      dispatch(setThreeStatementResults(newData));\n    } else if (section === 'scenarios') {\n      dispatch(setMonteCarloResults(newData));\n    } else {\n      dispatch(setFinancialData({ ...financialData, ...newData }));\n    }\n  }, [dispatch, financialData]);\n\n  // Status indicator component\n  // (Removed unused _WorkflowNavigation component)\n\n  const tabs = [\n    { id: 'spreadsheet', label: 'Financial Spreadsheet', icon: Database },\n    { id: 'modeling', label: 'Financial Modeling', icon: Activity },\n    { id: 'analysis', label: 'Analysis & Results', icon: FileText },\n    { id: 'lbo', label: 'Advanced LBO', icon: Activity },\n    { id: 'threestatement', label: '3-Statement Model', icon: Database },\n    { id: 'scenarios', label: 'Scenario Analysis', icon: Activity },\n    { id: 'marketdata', label: 'Market Data', icon: Activity },\n    { id: 'montecarlo', label: 'Monte Carlo', icon: Activity },\n    { id: 'import-export', label: 'Import/Export', icon: Upload }\n  ];\n\n  return (\n    <ErrorBoundary>\n      <div className=\"min-h-screen bg-slate-900 relative\">\n      <SEOHead\n        title=\"Private Analysis Suite | FinanceAnalyst Pro\"\n        description=\"Comprehensive financial analysis platform with advanced modeling tools, scenario analysis, Monte Carlo simulation, and private equity workflows.\"\n        canonical=\"/private-analysis\"\n        keywords=\"private analysis, financial modeling, scenario analysis, Monte Carlo simulation, LBO analysis, private equity tools\"\n      />\n      <Header />\n\n      <main\n        id=\"main-content\" className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8\" role=\"main\"\n        aria-label=\"Private Analysis Dashboard\"\n      >\n        {/* Header Section */}\n        <section className=\"mb-6 sm:mb-8\" aria-labelledby=\"page-title\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4\">\n            <h1 id=\"page-title\" tabIndex={-1} className=\"text-2xl sm:text-3xl font-bold text-white\">Private Analysis</h1>\n\n            <div className=\"flex items-center gap-3 sm:gap-4 flex-wrap\">\n              <div className=\"flex items-center gap-2\">\n                <div\n                  className={`w-2 h-2 rounded-full ${\n                    dataStatus === 'ready' ? 'bg-green-400' :\n                      dataStatus === 'saving' ? 'bg-blue-400' : 'bg-yellow-400'\n                  }`}\n                />\n                <span className=\"text-xs text-gray-400\">\n                  {dataStatus === 'ready' ? 'Ready' : dataStatus === 'saving' ? 'Saving...' : dataStatus}\n                </span>\n              </div>\n\n              {lastSaved && (\n                <Button\n                  onClick={() => saveAnalysis()}\n                  disabled={isLoading}\n                  className=\"flex items-center gap-2 text-xs sm:text-sm\"\n                  variant=\"primary\"\n                  size=\"sm\"\n                >\n                  <Save className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n                  <span className=\"hidden sm:inline\">Saved</span>\n                  <span className=\"sm:hidden\">{lastSaved.toLocaleTimeString()}</span>\n                  <span className=\"hidden sm:inline\">{lastSaved.toLocaleTimeString()}</span>\n                </Button>\n              )}\n            </div>\n          </div>\n\n          {/* Progress Indicators */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-6\">\n            <div className=\"bg-slate-800 rounded-lg p-3 sm:p-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-xs sm:text-sm text-gray-400\">Data Completeness</span>\n                <span className=\"text-sm sm:text-base text-white font-semibold\">{getDataCompleteness()}%</span>\n              </div>\n              <div className=\"w-full bg-slate-700 rounded-full h-1.5 sm:h-2\">\n                <div\n                  className=\"bg-blue-500 h-1.5 sm:h-2 rounded-full transition-all duration-500\"\n                  style={{ width: `${getDataCompleteness()}%` }}\n                />\n              </div>\n            </div>\n\n            <div className=\"bg-slate-800 rounded-lg p-3 sm:p-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-xs sm:text-sm text-gray-400\">Analysis Progress</span>\n                <span className=\"text-sm sm:text-base text-white font-semibold\">{calculateAnalysisProgress()}%</span>\n              </div>\n              <div className=\"w-full bg-slate-700 rounded-full h-1.5 sm:h-2\">\n                <div\n                  className=\"bg-green-500 h-1.5 sm:h-2 rounded-full transition-all duration-500\"\n                  style={{ width: `${calculateAnalysisProgress()}%` }}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Quick Start Modal */}\n          {showQuickStart && (\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\n              <div\n                ref={quickStartDialogRef}\n                className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6\"\n                role=\"dialog\"\n                aria-modal=\"true\"\n                aria-labelledby=\"quickstart-title\"\n                aria-describedby=\"quickstart-desc\"\n              >\n                <div className=\"flex items-center space-x-3 mb-4\">\n                  <Play className=\"w-6 h-6 text-blue-600\" />\n                  <h3 id=\"quickstart-title\" className=\"text-lg font-semibold text-slate-900\">Welcome to Private Analysis</h3>\n                </div>\n                <p id=\"quickstart-desc\" className=\"text-slate-700 mb-6\">\n                  Take a quick tour to learn how to build financial models, run DCF analysis, and export professional reports.\n                </p>\n                <div className=\"flex space-x-3\">\n                  <button\n                    ref={quickStartStartBtnRef}\n                    onClick={handleStartTour}\n                    className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700\"\n                    aria-label=\"Start Tour\"\n                  >\n                    Start Tour\n                  </button>\n                  <button\n                    ref={quickStartSkipBtnRef}\n                    onClick={handleSkipTour}\n                    className=\"flex-1 bg-slate-200 text-slate-800 px-4 py-2 rounded-lg hover:bg-slate-300\"\n                    aria-label=\"Skip\"\n                  >\n                    Skip\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n        </section>\n\n        {/* Secondary Navigation - Analysis Tools */}\n        <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n          <SecondaryNav\n            variant=\"horizontal\"\n            navigation=\"analysisTools\"\n            activeItem={activeTab}\n            onItemClick={(itemId) => setActiveTab(itemId)}\n            className=\"flex-1\"\n            data-tour=\"financial-spreadsheet-tab\"\n          />\n\n          {/* Help and Tour Controls */}\n          <div className=\"flex items-center space-x-2 ml-4\">\n            <button\n              onClick={() => openHelpPanel(activeTab === 'modeling' ? 'dcf' : activeTab)}\n              className=\"p-2 text-slate-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors\"\n              title=\"Get help with this feature\"\n              aria-label=\"Open help panel\"\n            >\n              <HelpCircle className=\"w-4 h-4\" />\n            </button>\n\n            {!localStorage.getItem('privateAnalyses') && (\n              <button\n                onClick={() => setShowTour(true)}\n                className=\"p-2 text-blue-400 hover:text-blue-300 hover:bg-slate-700 rounded-lg transition-colors\"\n                title=\"Take a guided tour\"\n                aria-label=\"Start Private Analysis tour\"\n              >\n                <Play className=\"w-4 h-4\" />\n              </button>\n            )}\n          </div>\n        </div>\n\n        {/* Legacy Tab Navigation (keeping as fallback) */}\n        <nav className=\"mb-6 hidden\" aria-label=\"Analysis Tools\">\n          <div className=\"flex flex-wrap gap-2 p-1 bg-slate-800 rounded-lg\" role=\"tablist\">\n            {tabs.map(tab => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  role=\"tab\"\n                  aria-selected={activeTab === tab.id}\n                  aria-controls={`tabpanel-${tab.id}`}\n                  tabIndex={activeTab === tab.id ? 0 : -1}\n                  className={`\n                    flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-slate-800\n                    ${\n                activeTab === tab.id\n                  ? 'bg-blue-600 text-white shadow-lg'\n                  : 'text-gray-300 hover:text-white hover:bg-slate-700'\n                }\n                  `}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-medium\">{tab.label}</span>\n                </button>\n              );\n            })}\n          </div>\n        </nav>\n\n        {/* Main Content Area */}\n        <section\n          className=\"relative\" role=\"tabpanel\" id={`tabpanel-${activeTab}`}\n          aria-labelledby={`tab-${activeTab}`}\n        >\n          <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n          <motion.div\n            key={activeTab}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            transition={{ duration: 0.2 }}\n          >\n            {activeTab === 'spreadsheet' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading spreadsheet. Please refresh the page.</div>}>\n                <Suspense fallback={<FinancialTableSkeleton rows={12} columns={6} />}>\n                  <LoadingWrapper\n                    isLoading={isLoading}\n                    skeleton={<FinancialTableSkeleton rows={12} columns={6} />}\n                  >\n                    <FinancialSpreadsheet\n                      data={financialData}\n                      onDataChange={handleDataChange}\n                      onAdjustedValuesChange={setAdjustedValues}\n                    />\n                  </LoadingWrapper>\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'modeling' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading modeling tools. Please refresh the page.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <ModelingTools\n                    data={financialData}\n                    adjustedValues={adjustedValues}\n                    onDataChange={handleDataChange}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'analysis' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading analysis results. Please check your data and refresh.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <AnalysisResults\n                    data={financialData}\n                    adjustedValues={adjustedValues}\n                    modelInputs={modelInputs}\n                    calculateDCF={(data) => calculateDCF(data, modelInputs)}\n                    formatCurrency={formatCurrency}\n                    formatPercentage={formatPercentage}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'lbo' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading LBO tool. Please check your data.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <AdvancedLBOTool\n                    data={financialData}\n                    onDataChange={(results) => handleDataChange(results, 'lbo')}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'threestatement' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading financial model workspace.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <FinancialModelWorkspace\n                    data={financialData}\n                    onDataChange={(results) => handleDataChange(results, 'threeStatement')}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'scenarios' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading scenario analysis.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <EnhancedScenarioAnalysis\n                    data={financialData}\n                    onDataChange={(results) => handleDataChange(results, 'scenarios')}\n                    calculateDCF={(data) => calculateDCF(data, modelInputs)}\n                    lboModelingEngine={null}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'marketdata' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading market data dashboard.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <EnhancedMarketDataDashboard\n                    data={financialData}\n                    onDataChange={(results) => handleDataChange(results, 'marketData')}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'montecarlo' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading Monte Carlo integration.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <MonteCarloIntegrationHub\n                    data={financialData}\n                    dcfResults={advancedResults.dcf}\n                    lboResults={advancedResults.lbo}\n                    financialModel={advancedResults.threeStatement}\n                    scenarioResults={advancedResults.scenarios}\n                    onDataChange={(results) => handleDataChange(results, 'monteCarlo')}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n\n            {activeTab === 'import-export' && (\n              <ErrorBoundary fallback={<div className=\"p-8 text-center text-red-400\">Error loading import/export tools.</div>}>\n                <Suspense fallback={<div className=\"p-8 text-center text-gray-400\">Loading...</div>}>\n                  <DataExportImport\n                    data={financialData}\n                    onDataChange={handleDataChange}\n                    savedAnalyses={savedAnalyses}\n                    onAnalysesChange={setSavedAnalyses}\n                  />\n                </Suspense>\n              </ErrorBoundary>\n            )}\n          </motion.div>\n          </Suspense>\n        </section>\n\n        {/* Contextual Insights Sidebar */}\n        <Suspense fallback={null}>\n          <ContextualInsightsSidebar\n            financialData={financialData}\n            currentMetric={currentMetricFocus}\n            analysisContext={activeTab === 'analysis' ? 'dcf' : activeTab}\n            onInsightClick={handleInsightClick}\n            isVisible={insightsSidebarVisible}\n            onToggle={toggleInsightsSidebar}\n          />\n        </Suspense>\n      </main>\n\n      {/* Help Panel */}\n      <HelpPanel\n        helpKey={activeHelpPanel}\n        isOpen={!!activeHelpPanel}\n        onClose={closeHelpPanel}\n      />\n\n      {/* OnboardingTour - temporarily disabled for integration focus */}\n      </div>\n    </ErrorBoundary>\n  );\n};\n\nexport default PrivateAnalysis;\n","/**\n * React Hook for Real-Time Collaboration\n * Provides easy integration with CollaborationService for React components\n */\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\n\nimport collaborationService from '../services/collaborationService';\n// import { performanceMonitoring } from '../utils/performanceMonitoring'; // Missing module\n\n/**\n * Main collaboration hook\n */\nexport function useCollaboration(userId, userProfile = {}) {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState({\n    online: navigator.onLine,\n    connected: false\n  });\n  const [currentWorkspace, setCurrentWorkspace] = useState(null);\n  const [workspaceMembers, setWorkspaceMembers] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  const initialized = useRef(false);\n\n  // Initialize collaboration service\n  useEffect(() => {\n    if (!userId || initialized.current) return;\n\n    const initializeService = async() => {\n      try {\n        setIsLoading(true);\n        setError(null);\n\n        await collaborationService.initialize(userId, userProfile);\n        setIsInitialized(true);\n        initialized.current = true;\n\n        // Track initialization success\n        if (typeof performanceMonitoring !== 'undefined') {\n          // performanceMonitoring.trackCustomMetric('collaboration_hook_init_success', 1);\n        }\n      } catch (err) {\n        setError(err.message);\n        console.error('Failed to initialize collaboration:', err);\n\n        if (typeof performanceMonitoring !== 'undefined') {\n          // performanceMonitoring.trackCustomMetric('collaboration_hook_init_error', 1);\n        }\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    initializeService();\n\n    // Cleanup on unmount\n    return () => {\n      if (initialized.current) {\n        collaborationService.cleanup();\n        initialized.current = false;\n      }\n    };\n  }, [userId, userProfile]);\n\n  // Set up event listeners\n  useEffect(() => {\n    if (!isInitialized) return;\n\n    const handleConnectionStatus = (status) => {\n      setConnectionStatus(status);\n    };\n\n    const handleWorkspaceJoined = ({ workspace }) => {\n      setCurrentWorkspace(workspace);\n      setWorkspaceMembers(Array.from(workspace.members.values()));\n    };\n\n    const handleWorkspaceLeft = () => {\n      setCurrentWorkspace(null);\n      setWorkspaceMembers([]);\n    };\n\n    const handleUserJoined = ({ user, workspaceId }) => {\n      if (currentWorkspace?.id === workspaceId) {\n        setWorkspaceMembers(prev => {\n          const existing = prev.find(member => member.id === user.id);\n          if (existing) return prev;\n          return [...prev, user];\n        });\n      }\n    };\n\n    const handleUserLeft = ({ userId: leftUserId, workspaceId }) => {\n      if (currentWorkspace?.id === workspaceId) {\n        setWorkspaceMembers(prev => prev.filter(member => member.id !== leftUserId));\n      }\n    };\n\n    // Add event listeners\n    collaborationService.on('connectionStatus', handleConnectionStatus);\n    collaborationService.on('workspaceJoined', handleWorkspaceJoined);\n    collaborationService.on('workspaceLeft', handleWorkspaceLeft);\n    collaborationService.on('userJoined', handleUserJoined);\n    collaborationService.on('userLeft', handleUserLeft);\n\n    // Cleanup listeners\n    return () => {\n      collaborationService.off('connectionStatus', handleConnectionStatus);\n      collaborationService.off('workspaceJoined', handleWorkspaceJoined);\n      collaborationService.off('workspaceLeft', handleWorkspaceLeft);\n      collaborationService.off('userJoined', handleUserJoined);\n      collaborationService.off('userLeft', handleUserLeft);\n    };\n  }, [isInitialized, currentWorkspace?.id]);\n\n  // Join workspace\n  const joinWorkspace = useCallback(async(workspaceId, options = {}) => {\n    if (!isInitialized) {\n      throw new Error('Collaboration service not initialized');\n    }\n\n    try {\n      setIsLoading(true);\n      setError(null);\n\n      const workspace = await collaborationService.joinWorkspace(workspaceId, options);\n      return workspace;\n    } catch (err) {\n      setError(err.message);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [isInitialized]);\n\n  // Leave workspace\n  const leaveWorkspace = useCallback(async(workspaceId) => {\n    if (!isInitialized) return;\n\n    try {\n      await collaborationService.leaveWorkspace(workspaceId);\n    } catch (err) {\n      setError(err.message);\n      console.error('Failed to leave workspace:', err);\n    }\n  }, [isInitialized]);\n\n  return {\n    isInitialized,\n    connectionStatus,\n    currentWorkspace,\n    workspaceMembers,\n    isLoading,\n    error,\n    joinWorkspace,\n    leaveWorkspace,\n    // Expose service methods\n    shareModel: collaborationService.shareModel.bind(collaborationService),\n    updateModel: collaborationService.updateModel.bind(collaborationService),\n    addAnnotation: collaborationService.addAnnotation.bind(collaborationService),\n    updateCursor: collaborationService.updateCursor.bind(collaborationService),\n    getWorkspaceModels: collaborationService.getWorkspaceModels.bind(collaborationService),\n    getModelAnnotations: collaborationService.getModelAnnotations.bind(collaborationService)\n  };\n}\n\n/**\n * Hook for real-time model sharing\n */\nexport function useModelSharing(workspaceId, modelId) {\n  const [model, setModel] = useState(null);\n  const [annotations, setAnnotations] = useState([]);\n  const [isShared, setIsShared] = useState(false);\n  const [collaborators, _setCollaborators] = useState([]);\n  const [modelVersion, setModelVersion] = useState(0);\n\n  useEffect(() => {\n    if (!workspaceId || !modelId) return;\n\n    const handleModelShared = ({ sharedModel, workspaceId: wsId, modelId: mId }) => {\n      if (wsId === workspaceId && mId === modelId) {\n        setModel(sharedModel);\n        setIsShared(true);\n        setModelVersion(sharedModel.version);\n      }\n    };\n\n    const handleModelUpdate = ({ workspaceId: wsId, modelId: mId, updates, version }) => {\n      if (wsId === workspaceId && mId === modelId) {\n        setModel(prev => prev ? { ...prev, data: { ...prev.data, ...updates }, version } : null);\n        setModelVersion(version);\n      }\n    };\n\n    const handleAnnotationAdded = ({ annotation, workspaceId: wsId, modelId: mId }) => {\n      if (wsId === workspaceId && mId === modelId) {\n        setAnnotations(prev => [...prev, annotation]);\n      }\n    };\n\n    // Add event listeners\n    collaborationService.on('modelShared', handleModelShared);\n    collaborationService.on('modelUpdate', handleModelUpdate);\n    collaborationService.on('annotationAdded', handleAnnotationAdded);\n\n    // Load existing data\n    const existingModels = collaborationService.getWorkspaceModels(workspaceId);\n    const existingModel = existingModels.find(m => m.id === modelId);\n    if (existingModel) {\n      setModel(existingModel);\n      setIsShared(true);\n      setModelVersion(existingModel.version);\n    }\n\n    const existingAnnotations = collaborationService.getModelAnnotations(workspaceId, modelId);\n    setAnnotations(existingAnnotations);\n\n    // Cleanup listeners\n    return () => {\n      collaborationService.off('modelShared', handleModelShared);\n      collaborationService.off('modelUpdate', handleModelUpdate);\n      collaborationService.off('annotationAdded', handleAnnotationAdded);\n    };\n  }, [workspaceId, modelId]);\n\n  const shareModel = useCallback(async(modelData, permissions = {}) => {\n    if (!workspaceId || !modelId) return;\n\n    try {\n      const sharedModel = await collaborationService.shareModel(\n        workspaceId,\n        modelId,\n        modelData,\n        permissions\n      );\n      return sharedModel;\n    } catch (error) {\n      console.error('Failed to share model:', error);\n      throw error;\n    }\n  }, [workspaceId, modelId]);\n\n  const updateModel = useCallback(async(updates) => {\n    if (!workspaceId || !modelId) return;\n\n    try {\n      const updatedModel = await collaborationService.updateModel(\n        workspaceId,\n        modelId,\n        updates\n      );\n      return updatedModel;\n    } catch (error) {\n      console.error('Failed to update model:', error);\n      throw error;\n    }\n  }, [workspaceId, modelId]);\n\n  const addAnnotation = useCallback(async(annotation) => {\n    if (!workspaceId || !modelId) return;\n\n    try {\n      const newAnnotation = await collaborationService.addAnnotation(\n        workspaceId,\n        modelId,\n        annotation\n      );\n      return newAnnotation;\n    } catch (error) {\n      console.error('Failed to add annotation:', error);\n      throw error;\n    }\n  }, [workspaceId, modelId]);\n\n  return {\n    model,\n    annotations,\n    isShared,\n    collaborators,\n    modelVersion,\n    shareModel,\n    updateModel,\n    addAnnotation\n  };\n}\n\n/**\n * Hook for real-time presence and cursors\n */\nexport function usePresence(workspaceId) {\n  const [cursors, setCursors] = useState(new Map());\n  const [presence, setPresence] = useState(new Map());\n  const [activeCursors, setActiveCursors] = useState([]);\n\n  useEffect(() => {\n    if (!workspaceId) return;\n\n    const handleCursorUpdate = ({ userId, position, workspaceId: wsId }) => {\n      if (wsId === workspaceId) {\n        setCursors(prev => {\n          const newCursors = new Map(prev);\n          newCursors.set(userId, { position, timestamp: Date.now() });\n          return newCursors;\n        });\n      }\n    };\n\n    const handlePresenceUpdate = ({ userId, status, workspaceId: wsId }) => {\n      if (wsId === workspaceId) {\n        setPresence(prev => {\n          const newPresence = new Map(prev);\n          newPresence.set(userId, { status, timestamp: Date.now() });\n          return newPresence;\n        });\n      }\n    };\n\n    // Add event listeners\n    collaborationService.on('cursorUpdate', handleCursorUpdate);\n    collaborationService.on('presenceUpdate', handlePresenceUpdate);\n\n    // Cleanup old cursors periodically\n    const cleanupInterval = setInterval(() => {\n      const now = Date.now();\n      const threshold = 30000; // 30 seconds\n\n      setCursors(prev => {\n        const filtered = new Map();\n        for (const [userId, data] of prev) {\n          if (now - data.timestamp < threshold) {\n            filtered.set(userId, data);\n          }\n        }\n        return filtered;\n      });\n    }, 5000);\n\n    // Cleanup listeners\n    return () => {\n      collaborationService.off('cursorUpdate', handleCursorUpdate);\n      collaborationService.off('presenceUpdate', handlePresenceUpdate);\n      clearInterval(cleanupInterval);\n    };\n  }, [workspaceId]);\n\n  // Convert cursors map to array for easier rendering\n  useEffect(() => {\n    setActiveCursors(Array.from(cursors.entries()).map(([userId, data]) => ({\n      userId,\n      ...data\n    })));\n  }, [cursors]);\n\n  const updateCursor = useCallback((position) => {\n    if (workspaceId) {\n      collaborationService.updateCursor(workspaceId, position);\n    }\n  }, [workspaceId]);\n\n  return {\n    cursors: activeCursors,\n    presence: Array.from(presence.entries()).map(([userId, data]) => ({\n      userId,\n      ...data\n    })),\n    updateCursor\n  };\n}\n\n/**\n * Hook for workspace management\n */\nexport function useWorkspace(workspaceId) {\n  const [workspace, setWorkspace] = useState(null);\n  const [members, setMembers] = useState([]);\n  const [models, setModels] = useState([]);\n  const [activity, setActivity] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    if (!workspaceId) return;\n\n    setIsLoading(true);\n\n    // Load workspace data\n    const loadWorkspaceData = () => {\n      const workspaceMembers = collaborationService.getWorkspaceMembers(workspaceId);\n      const workspaceModels = collaborationService.getWorkspaceModels(workspaceId);\n\n      setMembers(workspaceMembers);\n      setModels(workspaceModels);\n      setIsLoading(false);\n    };\n\n    loadWorkspaceData();\n\n    const handleWorkspaceUpdate = ({ workspaceId: wsId, data }) => {\n      if (wsId === workspaceId) {\n        setWorkspace(prev => ({ ...prev, ...data }));\n      }\n    };\n\n    const handleUserJoined = ({ user, workspaceId: wsId }) => {\n      if (wsId === workspaceId) {\n        setMembers(prev => {\n          const existing = prev.find(member => member.id === user.id);\n          if (existing) return prev;\n          return [...prev, user];\n        });\n\n        setActivity(prev => [{\n          id: `activity_${Date.now()}`,\n          type: 'user_joined',\n          userId: user.id,\n          userName: user.name,\n          timestamp: new Date().toISOString(),\n          data: { user }\n        }, ...prev.slice(0, 49)]); // Keep last 50 activities\n      }\n    };\n\n    const handleUserLeft = ({ userId, workspaceId: wsId }) => {\n      if (wsId === workspaceId) {\n        setMembers(prev => prev.filter(member => member.id !== userId));\n\n        setActivity(prev => [{\n          id: `activity_${Date.now()}`,\n          type: 'user_left',\n          userId,\n          timestamp: new Date().toISOString(),\n          data: { userId }\n        }, ...prev.slice(0, 49)]);\n      }\n    };\n\n    const handleModelShared = ({ sharedModel, workspaceId: wsId }) => {\n      if (wsId === workspaceId) {\n        setModels(prev => [...prev, sharedModel]);\n\n        setActivity(prev => [{\n          id: `activity_${Date.now()}`,\n          type: 'model_shared',\n          userId: sharedModel.sharedBy,\n          timestamp: sharedModel.sharedAt,\n          data: { modelId: sharedModel.id, modelName: sharedModel.name }\n        }, ...prev.slice(0, 49)]);\n      }\n    };\n\n    // Add event listeners\n    collaborationService.on('workspaceUpdate', handleWorkspaceUpdate);\n    collaborationService.on('userJoined', handleUserJoined);\n    collaborationService.on('userLeft', handleUserLeft);\n    collaborationService.on('modelShared', handleModelShared);\n\n    // Cleanup listeners\n    return () => {\n      collaborationService.off('workspaceUpdate', handleWorkspaceUpdate);\n      collaborationService.off('userJoined', handleUserJoined);\n      collaborationService.off('userLeft', handleUserLeft);\n      collaborationService.off('modelShared', handleModelShared);\n    };\n  }, [workspaceId]);\n\n  return {\n    workspace,\n    members,\n    models,\n    activity,\n    isLoading\n  };\n}\n\nexport default useCollaboration;\n"],"file":"assets/PrivateAnalysis-Dzr015NY.js"}