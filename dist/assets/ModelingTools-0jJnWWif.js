import{r as e,j as s,o as a,aE as t,E as i,l as r,y as n,k as l,m as d,$ as c,_ as o,a6 as m,u as x,a5 as u,J as h,af as p,n as g,c as b,aF as j,Z as f,ab as y,aG as v,D as N,F as w,T as C,ag as k,au as R,ah as F,R as V}from"./react-core-CeHLCIBw.js";import{b as M,A as S}from"./ui-vendor-B5RWaOCb.js";import{ResponsiveContainer as P,BarChart as I,CartesianGrid as A,XAxis as D,YAxis as E,Tooltip as O,Bar as B,PieChart as T,Pie as z,Cell as _,LineChart as q,Legend as $,Line as G,AreaChart as W,Area as U,ScatterChart as L,Scatter as H}from"./recharts-vendor-DQPXk1vH.js";import{m as K}from"./monteCarloEngine-VpQcTKma.js";import"./vendor-D2fsnhsW.js";import"./ai-vendor-CuiosWbE.js";import"./advanced-analytics-y00dU25g.js";import"./utils-vendor-DUg4_aAP.js";import"./react-dom-B6lyId6m.js";import"./d3-vendor-DOBQrAlH.js";import"./apiLogger-D987Un6Q.js";const Y=({dcfData:d,sensitivityData:c,scenarioData:o,formatCurrency:m,formatPercent:x})=>{const[u,h]=e.useState("dcf-waterfall"),[p,g]=e.useState(!0),b=[{id:"dcf-waterfall",label:"DCF Waterfall",icon:a,category:"dcf"},{id:"cashflow-trend",label:"Cash Flow Trend",icon:r,category:"dcf"},{id:"sensitivity-tornado",label:"Sensitivity Tornado",icon:n,category:"sensitivity"},{id:"scenario-distribution",label:"Scenario Distribution",icon:l,category:"scenario"},{id:"valuation-bridge",label:"Valuation Bridge",icon:a,category:"combined"}],j=e.useMemo(()=>{if(!d?.years)return[];let e=0;const s=[];d.years.forEach((a,t)=>{const i=e;e+=a.presentValue,s.push({name:`Year ${a.year}`,value:a.presentValue,cumulative:e,start:i,freeCashFlow:a.freeCashFlow,category:"operations"})});const a=e;return e+=d.presentValueTerminal,s.push({name:"Terminal Value",value:d.presentValueTerminal,cumulative:e,start:a,category:"terminal"}),s},[d]),f=e.useMemo(()=>d?.years?d.years.map((e,s)=>({year:`Year ${e.year}`,freeCashFlow:e.freeCashFlow,presentValue:e.presentValue,revenue:e.revenue,operatingIncome:e.operatingIncome,workingCapitalChange:e.workingCapitalChange,capex:Math.abs(e.capex)})):[],[d]),y=e.useMemo(()=>c?Object.entries(c).map(([e,s])=>{const a=Math.max(...s.dataPoints.map(e=>e.changeFromBase)),t=Math.min(...s.dataPoints.map(e=>e.changeFromBase));return{variable:s.definition.name,upside:a,downside:Math.abs(t),range:a-t}}).sort((e,s)=>s.range-e.range):[],[c]),v=e.useMemo(()=>o?.length?o.map((e,s)=>({name:e.name,value:e.enterpriseValue,probability:e.probability,weightedValue:e.weightedValue,fill:`hsl(${137.5*s%360}, 70%, 50%)`})):[],[o]),N=({active:e,payload:a,label:t,chartType:i})=>e&&a&&a.length?s.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[s.jsx("p",{className:"font-medium text-gray-800",children:t}),a.map((e,a)=>{return s.jsx("p",{style:{color:e.color},className:"text-sm",children:`${e.dataKey}: ${t=e.value,i=e.dataKey,i?.includes("Percent")||i?.includes("Rate")?x(t):m(t)}`},a);var t,i})]}):null,w=()=>s.jsx(P,{width:"100%",height:400,children:s.jsxs(I,{data:j,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(D,{dataKey:"name"}),s.jsx(E,{tickFormatter:e=>m(e)}),s.jsx(O,{content:s.jsx(N,{chartType:"waterfall"})}),s.jsx(B,{dataKey:"value",fill:"#3B82F6"})]})}),C=()=>s.jsx(P,{width:"100%",height:400,children:s.jsxs(q,{data:f,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(D,{dataKey:"year"}),s.jsx(E,{tickFormatter:e=>m(e)}),s.jsx(O,{content:s.jsx(N,{chartType:"trend"})}),s.jsx($,{}),s.jsx(G,{type:"monotone",dataKey:"freeCashFlow",stroke:"#10B981",strokeWidth:3,name:"Free Cash Flow"}),s.jsx(G,{type:"monotone",dataKey:"presentValue",stroke:"#3B82F6",strokeWidth:2,name:"Present Value"}),s.jsx(G,{type:"monotone",dataKey:"revenue",stroke:"#8B5CF6",strokeWidth:2,name:"Revenue"})]})}),k=()=>s.jsx(P,{width:"100%",height:400,children:s.jsxs(I,{data:y,layout:"horizontal",margin:{top:20,right:30,left:100,bottom:5},children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(D,{type:"number",tickFormatter:e=>`${e.toFixed(1)}%`}),s.jsx(E,{type:"category",dataKey:"variable"}),s.jsx(O,{formatter:(e,s)=>[`${e.toFixed(1)}%`,s],labelFormatter:e=>`Variable: ${e}`}),s.jsx(B,{dataKey:"upside",fill:"#10B981",name:"Upside Impact"}),s.jsx(B,{dataKey:"downside",fill:"#EF4444",name:"Downside Impact"})]})}),R=()=>s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsx(P,{width:"100%",height:300,children:s.jsxs(T,{children:[s.jsx(z,{data:v,cx:"50%",cy:"50%",outerRadius:80,dataKey:"probability",label:({name:e,probability:s})=>`${e}: ${s}%`,children:v.map((e,a)=>s.jsx(_,{fill:e.fill},`cell-${a}`))}),s.jsx(O,{formatter:e=>`${e}%`})]})}),s.jsx(P,{width:"100%",height:300,children:s.jsxs(I,{data:v,children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(D,{dataKey:"name"}),s.jsx(E,{tickFormatter:e=>m(e)}),s.jsx(O,{content:s.jsx(N,{chartType:"scenario"})}),s.jsx(B,{dataKey:"value",fill:"#8B5CF6",name:"Enterprise Value"})]})})]}),F=()=>{const e=[{name:"PV of Operations",value:d?.cumulativePV||0,type:"positive"},{name:"PV of Terminal",value:d?.presentValueTerminal||0,type:"positive"},{name:"Enterprise Value",value:d?.enterpriseValue||0,type:"total"}];return s.jsx(P,{width:"100%",height:400,children:s.jsxs(I,{data:e,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(D,{dataKey:"name"}),s.jsx(E,{tickFormatter:e=>m(e)}),s.jsx(O,{content:s.jsx(N,{chartType:"bridge"})}),s.jsx(B,{dataKey:"value",fill:e=>"total"===e.type?"#1F2937":"#3B82F6"})]})})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(a,{size:20}),"Data Visualization"]}),s.jsx("p",{className:"text-gray-600",children:"Interactive charts and graphs to visualize valuation results and sensitivity analysis."})]}),s.jsxs("button",{onClick:()=>g(!p),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 "+(p?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:[p?s.jsx(t,{size:14}):s.jsx(i,{size:14}),p?"Hide Details":"Show Details"]})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:b.map(e=>{const a=e.icon;return s.jsxs(M.button,{onClick:()=>h(e.id),className:"p-3 rounded-lg border-2 transition-all text-center "+(u===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(a,{size:20,className:"mx-auto mb-2"}),s.jsx("div",{className:"text-xs font-medium",children:e.label})]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h4",{className:"font-semibold text-lg",children:b.find(e=>e.id===u)?.label}),p&&s.jsx("span",{className:"text-sm text-gray-500",children:(()=>{switch(u){case"dcf-waterfall":return"Shows the contribution of each year's cash flows and terminal value to total enterprise value.";case"cashflow-trend":return"Displays the trend of free cash flows, present values, and key financial metrics over time.";case"sensitivity-tornado":return"Illustrates how changes in key variables impact enterprise value, ranked by sensitivity.";case"scenario-distribution":return"Compares different scenarios by probability weights and resulting enterprise values.";case"valuation-bridge":return"Breaks down enterprise value into operating value and terminal value components.";default:return""}})()})]}),s.jsx("div",{className:"min-h-[400px]",children:(()=>{switch(u){case"dcf-waterfall":default:return s.jsx(w,{});case"cashflow-trend":return s.jsx(C,{});case"sensitivity-tornado":return s.jsx(k,{});case"scenario-distribution":return s.jsx(R,{});case"valuation-bridge":return s.jsx(F,{})}})()})]}),p&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Key Insights"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:["dcf-waterfall"===u&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Operations Contribution"}),s.jsx("div",{className:"text-lg font-bold text-blue-800",children:d?.cumulativePV?`${(d.cumulativePV/d.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),s.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Terminal Contribution"}),s.jsx("div",{className:"text-lg font-bold text-purple-800",children:d?.presentValueTerminal?`${(d.presentValueTerminal/d.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Avg. Annual FCF"}),s.jsx("div",{className:"text-lg font-bold text-green-800",children:d?.freeCashFlows?m(d.freeCashFlows.reduce((e,s)=>e+s,0)/d.freeCashFlows.length):"N/A"})]})]}),"sensitivity-tornado"===u&&y.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Highest Risk Variable"}),s.jsx("div",{className:"text-lg font-bold text-red-800",children:y[0]?.variable}),s.jsxs("div",{className:"text-sm text-red-600",children:["±",y[0]?.range.toFixed(1),"% impact"]})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-yellow-600 font-medium",children:"Medium Risk Variables"}),s.jsx("div",{className:"text-lg font-bold text-yellow-800",children:y.slice(1,3).map(e=>e.variable).join(", ")})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Lowest Risk Variable"}),s.jsx("div",{className:"text-lg font-bold text-green-800",children:y[y.length-1]?.variable})]})]})]})]})]})},Q=({modelInputs:a,onModelInputChange:t,formatPercent:i})=>{const[n,l]=e.useState(!0),[h,p]=e.useState("inputs"),g=a.dcf.wacc||{riskFreeRate:4.5,marketRiskPremium:6,beta:1.2,smallCompanyPremium:3,companySpecificRisk:2,debtInterestRate:6.5,taxRate:25,marketValueEquity:1e5,marketValueDebt:3e4,buildUpMethod:{riskFreeRate:4.5,equityRiskPremium:6,sizeRiskPremium:3,industryRiskPremium:2,companySpecificRisk:2},industryWACC:10.5,industryBeta:1.1,industryDebtEquityRatio:.3},b=e.useMemo(()=>{const e={...g,...a.dcf.wacc},s=e.riskFreeRate+e.beta*e.marketRiskPremium+e.smallCompanyPremium+e.companySpecificRisk,t=e.buildUpMethod.riskFreeRate+e.buildUpMethod.equityRiskPremium+e.buildUpMethod.sizeRiskPremium+e.buildUpMethod.industryRiskPremium+e.buildUpMethod.companySpecificRisk,i=e.debtInterestRate*(1-e.taxRate/100),r=e.marketValueEquity+e.marketValueDebt,n=e.marketValueEquity/r,l=e.marketValueDebt/r,d=s/100*n+i/100*l,c=t/100*n+i/100*l;return{costOfEquityCAPM:s,costOfEquityBuildUp:t,costOfDebtAfterTax:i,equityWeight:100*n,debtWeight:100*l,waccCAPM:100*d,waccBuildUp:100*c,finalWACC:(d+c)/2*100,totalCapital:r,debtToEquityRatio:e.marketValueDebt/e.marketValueEquity}},[g,a.dcf.wacc]),j=(e,s)=>{const i={...g,...a.dcf.wacc,[e]:parseFloat(s)||0};t("dcf","wacc",i)},f=[{id:"inputs",label:"Inputs",icon:x},{id:"calculation",label:"Calculation",icon:d},{id:"benchmarks",label:"Benchmarks",icon:r}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(d,{size:20}),"WACC Calculator"]}),s.jsx("p",{className:"text-gray-600",children:"Professional weighted average cost of capital calculation using CAPM and build-up methods."})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{return e=b.finalWACC,void t("dcf","discountRate",e);var e},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Apply to DCF"}),s.jsx("button",{onClick:()=>l(!n),className:"px-3 py-2 rounded-lg text-sm transition-colors "+(n?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-600"),children:n?"Hide Details":"Show Details"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(M.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(c,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"FINAL WACC"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-800",children:i(b.finalWACC)}),s.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Risk-adjusted average"})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(r,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"COST OF EQUITY"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:i(b.costOfEquityCAPM)}),s.jsx("div",{className:"text-sm text-green-600 mt-1",children:"CAPM method"})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(o,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"COST OF DEBT"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-800",children:i(b.costOfDebtAfterTax)}),s.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"After-tax"})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(m,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"DEBT/EQUITY"})]}),s.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[b.debtToEquityRatio.toFixed(2),"x"]}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Capital structure"})]})]}),s.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:f.map(e=>{const a=e.icon;return s.jsxs("button",{onClick:()=>p(e.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(h===e.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[s.jsx(a,{size:16}),e.label]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["inputs"===h&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"WACC Input Parameters"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"Cost of Equity (CAPM Method)"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"riskFreeRate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Risk-Free Rate (%)"}),s.jsx("input",{id:"riskFreeRate",type:"number",step:"0.1",value:a.dcf.wacc?.riskFreeRate||g.riskFreeRate,onChange:e=>j("riskFreeRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"10-year Treasury rate"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketRiskPremium",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Risk Premium (%)"}),s.jsx("input",{id:"marketRiskPremium",type:"number",step:"0.1",value:a.dcf.wacc?.marketRiskPremium||g.marketRiskPremium,onChange:e=>j("marketRiskPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Expected market return - risk-free rate"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"beta",className:"block text-sm font-medium text-gray-700 mb-1",children:"Beta (β)"}),s.jsx("input",{id:"beta",type:"number",step:"0.1",value:a.dcf.wacc?.beta||g.beta,onChange:e=>j("beta",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Systematic risk relative to market"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"smallCompanyPremium",className:"block text-sm font-medium text-gray-700 mb-1",children:"Small Company Premium (%)"}),s.jsx("input",{id:"smallCompanyPremium",type:"number",step:"0.1",value:a.dcf.wacc?.smallCompanyPremium||g.smallCompanyPremium,onChange:e=>j("smallCompanyPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Size-related risk premium"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"companySpecificRisk",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company-Specific Risk (%)"}),s.jsx("input",{id:"companySpecificRisk",type:"number",step:"0.1",value:a.dcf.wacc?.companySpecificRisk||g.companySpecificRisk,onChange:e=>j("companySpecificRisk",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Unsystematic risk premium"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4 text-purple-800",children:"Capital Structure & Cost of Debt"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketValueEquity",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Equity ($000s)"}),s.jsx("input",{id:"marketValueEquity",type:"number",value:a.dcf.wacc?.marketValueEquity||g.marketValueEquity,onChange:e=>j("marketValueEquity",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketValueDebt",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Debt ($000s)"}),s.jsx("input",{id:"marketValueDebt",type:"number",value:a.dcf.wacc?.marketValueDebt||g.marketValueDebt,onChange:e=>j("marketValueDebt",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"debtInterestRate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre-Tax Cost of Debt (%)"}),s.jsx("input",{id:"debtInterestRate",type:"number",step:"0.1",value:a.dcf.wacc?.debtInterestRate||g.debtInterestRate,onChange:e=>j("debtInterestRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Interest rate on debt"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"taxRate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),s.jsx("input",{id:"taxRate",type:"number",step:"0.1",value:a.dcf.wacc?.taxRate||a.dcf.taxRate,onChange:e=>j("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Corporate tax rate"})]}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-2",children:"Capital Structure"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Equity Weight:"}),s.jsx("span",{className:"font-medium",children:i(b.equityWeight)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Debt Weight:"}),s.jsx("span",{className:"font-medium",children:i(b.debtWeight)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2",children:[s.jsx("span",{children:"Total Capital:"}),s.jsxs("span",{className:"font-medium",children:["$",(b.totalCapital/1e3).toFixed(0),"M"]})]})]})]})]})]})]})]}),"calculation"===h&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"WACC Calculation Breakdown"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"CAPM Method"}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Risk-Free Rate:"}),s.jsx("span",{className:"font-medium",children:i(a.dcf.wacc?.riskFreeRate||g.riskFreeRate)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta × Market Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i((a.dcf.wacc?.beta||g.beta)*(a.dcf.wacc?.marketRiskPremium||g.marketRiskPremium))})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Small Company Premium:"}),s.jsx("span",{className:"font-medium",children:i(a.dcf.wacc?.smallCompanyPremium||g.smallCompanyPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Company-Specific Risk:"}),s.jsx("span",{className:"font-medium",children:i(a.dcf.wacc?.companySpecificRisk||g.companySpecificRisk)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[s.jsx("span",{children:"Cost of Equity (CAPM):"}),s.jsx("span",{children:i(b.costOfEquityCAPM)})]})]})]}),s.jsxs("div",{className:"p-6 bg-green-50 rounded-lg border border-green-200",children:[s.jsx("h5",{className:"font-medium mb-4 text-green-800",children:"Build-up Method"}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Risk-Free Rate:"}),s.jsx("span",{className:"font-medium",children:i(g.buildUpMethod.riskFreeRate)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Equity Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i(g.buildUpMethod.equityRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Size Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i(g.buildUpMethod.sizeRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Industry Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i(g.buildUpMethod.industryRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Company-Specific Risk:"}),s.jsx("span",{className:"font-medium",children:i(g.buildUpMethod.companySpecificRisk)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[s.jsx("span",{children:"Cost of Equity (Build-up):"}),s.jsx("span",{children:i(b.costOfEquityBuildUp)})]})]})]})]}),s.jsxs("div",{className:"p-6 bg-gray-50 rounded-lg border",children:[s.jsx("h5",{className:"font-medium mb-4",children:"Final WACC Calculation"}),s.jsxs("div",{className:"space-y-4 text-sm",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"WACC (CAPM Method):"}),s.jsx("span",{className:"font-medium",children:i(b.waccCAPM)})]}),s.jsxs("div",{className:"text-xs text-gray-600",children:["[",i(b.costOfEquityCAPM)," × ",i(b.equityWeight),"] + [",i(b.costOfDebtAfterTax)," × ",i(b.debtWeight),"]"]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"WACC (Build-up Method):"}),s.jsx("span",{className:"font-medium",children:i(b.waccBuildUp)})]}),s.jsxs("div",{className:"text-xs text-gray-600",children:["[",i(b.costOfEquityBuildUp)," × ",i(b.equityWeight),"] + [",i(b.costOfDebtAfterTax)," × ",i(b.debtWeight),"]"]})]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-lg font-semibold",children:"Risk-Adjusted WACC:"}),s.jsx("span",{className:"text-2xl font-bold text-blue-600",children:i(b.finalWACC)})]}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Average of CAPM and Build-up methods"})]})]})]})]}),"benchmarks"===h&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Industry Benchmarks & Validation"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Your Company"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC:"}),s.jsx("span",{className:"font-semibold",children:i(b.finalWACC)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta:"}),s.jsx("span",{className:"font-semibold",children:(a.dcf.wacc?.beta||g.beta).toFixed(2)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"D/E Ratio:"}),s.jsxs("span",{className:"font-semibold",children:[b.debtToEquityRatio.toFixed(2),"x"]})]})]})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-green-800 mb-2",children:"Industry Average"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC:"}),s.jsx("span",{className:"font-semibold",children:i(g.industryWACC)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta:"}),s.jsx("span",{className:"font-semibold",children:g.industryBeta.toFixed(2)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"D/E Ratio:"}),s.jsxs("span",{className:"font-semibold",children:[g.industryDebtEquityRatio.toFixed(2),"x"]})]})]})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-2",children:"Variance"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC Diff:"}),s.jsxs("span",{className:"font-semibold "+(b.finalWACC>g.industryWACC?"text-red-600":"text-green-600"),children:[b.finalWACC>g.industryWACC?"+":"",i(b.finalWACC-g.industryWACC)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta Diff:"}),s.jsxs("span",{className:"font-semibold "+((a.dcf.wacc?.beta||g.beta)>g.industryBeta?"text-red-600":"text-green-600"),children:[(a.dcf.wacc?.beta||g.beta)>g.industryBeta?"+":"",((a.dcf.wacc?.beta||g.beta)-g.industryBeta).toFixed(2)]})]})]})]})]}),s.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(u,{size:16,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Validation Guidelines"}),s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"• WACC should be within ±2% of industry average for similar companies"}),s.jsx("li",{children:"• Beta should reflect business risk relative to market (typically 0.8-1.5 for most companies)"}),s.jsx("li",{children:"• Cost of equity should exceed risk-free rate by at least 4-6% for private companies"}),s.jsx("li",{children:"• Debt/equity ratio should align with industry norms and company strategy"}),s.jsx("li",{children:"• Consider economic conditions and company-specific factors"})]})]})]})})]})]})]})},J=({data:t,modelInputs:i,onModelInputChange:n,formatCurrency:l,formatPercent:c})=>{const[u,h]=e.useState(!1),[p,g]=e.useState(!0),[b,j]=e.useState("results"),f=e.useMemo(()=>{const{discountRate:e,terminalGrowthRate:s,projectionYears:a,taxRate:r}=i.dcf,n=t.statements,l=i.dcf.workingCapital||{receivablesDays:45,inventoryDays:60,payablesDays:30},d=i.dcf.capex||{capexAsPercentOfRevenue:3.5,depreciationRate:7},c={years:[],freeCashFlows:[],presentValues:[],workingCapitalChanges:[],capexAmounts:[],unleveredFreeCashFlow:[],cumulativePV:0,terminalValue:0,presentValueTerminal:0,enterpriseValue:0,equityValue:0,impliedShare:0},o=n.incomeStatement.totalRevenue?.[0]||1e5;for(let t=1;t<=a;t++){const s={year:t,revenue:n.incomeStatement.totalRevenue?.[t]||0,operatingIncome:n.incomeStatement.operatingIncome?.[t]||0,nopat:0,workingCapitalChange:0,capex:0,depreciation:0,freeCashFlow:0,presentValue:0};s.nopat=s.operatingIncome*(1-r/100);const a=s.revenue,i=t>1?n.incomeStatement.totalRevenue?.[t-1]||0:o,m=a*l.receivablesDays/365,x=a*l.inventoryDays/365,u=a*l.payablesDays/365,h=m-i*l.receivablesDays/365,p=x-i*l.inventoryDays/365,g=u-i*l.payablesDays/365;s.workingCapitalChange=-(h+p-g),s.capex=-a*d.capexAsPercentOfRevenue/100,s.depreciation=Math.abs(s.capex)/d.depreciationRate,s.freeCashFlow=s.nopat+s.depreciation+s.capex+s.workingCapitalChange;const b=Math.pow(1+e/100,t);s.presentValue=s.freeCashFlow/b,c.years.push(s),c.freeCashFlows.push(s.freeCashFlow),c.presentValues.push(s.presentValue),c.workingCapitalChanges.push(s.workingCapitalChange),c.capexAmounts.push(s.capex),c.unleveredFreeCashFlow.push(s.freeCashFlow),c.cumulativePV+=s.presentValue}const m=(c.years[c.years.length-1]?.freeCashFlow||0)*(1+s/100);c.terminalValue=m/((e-s)/100);const x=Math.pow(1+e/100,a);c.presentValueTerminal=c.terminalValue/x,c.enterpriseValue=c.cumulativePV+c.presentValueTerminal,c.equityValue=c.enterpriseValue-0;const u=i.dcf.sharesOutstanding||1e3;return c.impliedShare=c.equityValue/u,c},[t,i]),y=(e,s,a)=>{const t={...i.dcf,[e]:{...i.dcf[e],[s]:parseFloat(a)||0}};n("dcf",e,t[e])},v=(e,s)=>{n("dcf",e,parseFloat(s)||0)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(d,{size:20}),"Advanced DCF Valuation"]}),s.jsx("p",{className:"text-gray-600",children:"Professional-grade DCF with working capital analysis, capex modeling, and detailed cash flow projections."})]}),s.jsx("div",{className:"flex gap-2",children:["results","charts","wacc","assumptions"].map(e=>s.jsxs("button",{onClick:()=>j(e),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 "+(b===e?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:["results"===e&&s.jsx(o,{size:14}),"charts"===e&&s.jsx(a,{size:14}),"wacc"===e&&s.jsx(d,{size:14}),"assumptions"===e&&s.jsx(x,{size:14}),e.charAt(0).toUpperCase()+e.slice(1)]},e))})]}),"results"===b&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(M.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(o,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"ENTERPRISE VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:l(f.enterpriseValue)}),s.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["PV Operations: ",l(f.cumulativePV)]})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(r,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EQUITY VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-800",children:l(f.equityValue)}),s.jsxs("div",{className:"text-sm text-blue-600 mt-1",children:["Per Share: ",l(f.impliedShare)]})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(a,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"TERMINAL VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-800",children:l(f.terminalValue)}),s.jsxs("div",{className:"text-sm text-purple-600 mt-1",children:["PV: ",l(f.presentValueTerminal)]})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(m,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"IMPLIED MULTIPLE"})]}),s.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[(f.enterpriseValue/(t.statements.incomeStatement.totalRevenue?.[1]||1)).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"EV/Revenue (Year 1)"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Detailed Cash Flow Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b bg-gray-50",children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Year"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Operating Income"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"NOPAT"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Depreciation"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Capex"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"ΔWorking Capital"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Free Cash Flow"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Present Value"})]})}),s.jsxs("tbody",{children:[f.years.map((e,a)=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3 font-medium",children:e.year}),s.jsx("td",{className:"p-3 text-right",children:l(e.revenue)}),s.jsx("td",{className:"p-3 text-right",children:l(e.operatingIncome)}),s.jsx("td",{className:"p-3 text-right",children:l(e.nopat)}),s.jsxs("td",{className:"p-3 text-right text-green-600",children:["+",l(e.depreciation)]}),s.jsx("td",{className:"p-3 text-right text-red-600",children:l(e.capex)}),s.jsxs("td",{className:"p-3 text-right "+(e.workingCapitalChange>=0?"text-green-600":"text-red-600"),children:[e.workingCapitalChange>=0?"+":"",l(e.workingCapitalChange)]}),s.jsx("td",{className:"p-3 text-right font-medium",children:l(e.freeCashFlow)}),s.jsx("td",{className:"p-3 text-right font-medium",children:l(e.presentValue)})]},a)),s.jsxs("tr",{className:"border-b-2 border-gray-300 bg-blue-50",children:[s.jsx("td",{className:"p-3 font-bold",children:"Terminal"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right font-bold",children:l(f.terminalValue)}),s.jsx("td",{className:"p-3 text-right font-bold",children:l(f.presentValueTerminal)})]}),s.jsxs("tr",{className:"bg-gray-100 font-bold",children:[s.jsx("td",{className:"p-3",children:"TOTAL"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right text-lg",children:l(f.enterpriseValue)})]})]})]})})]})]}),"charts"===b&&s.jsx(Y,{dcfData:f,sensitivityData:null,scenarioData:null,formatCurrency:l,formatPercent:c}),"wacc"===b&&s.jsx(Q,{modelInputs:i,onModelInputChange:n,formatPercent:c}),"assumptions"===b&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Model Assumptions"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Core Assumptions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-discount-rate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Rate (WACC) %"}),s.jsx("input",{id:"dcf-discount-rate",type:"number",step:"0.1",value:i.dcf.discountRate,onChange:e=>v("discountRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-terminal-growth",className:"block text-sm font-medium text-gray-700 mb-1",children:"Terminal Growth Rate %"}),s.jsx("input",{id:"dcf-terminal-growth",type:"number",step:"0.1",value:i.dcf.terminalGrowthRate,onChange:e=>v("terminalGrowthRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-tax-rate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate %"}),s.jsx("input",{id:"dcf-tax-rate",type:"number",step:"0.1",value:i.dcf.taxRate,onChange:e=>v("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Working Capital"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-receivables-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Receivables (Days)"}),s.jsx("input",{id:"dcf-receivables-days",type:"number",value:i.dcf.workingCapital?.receivablesDays||45,onChange:e=>y("workingCapital","receivablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-inventory-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Inventory (Days)"}),s.jsx("input",{id:"dcf-inventory-days",type:"number",value:i.dcf.workingCapital?.inventoryDays||60,onChange:e=>y("workingCapital","inventoryDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-payables-days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Payables (Days)"}),s.jsx("input",{id:"dcf-payables-days",type:"number",value:i.dcf.workingCapital?.payablesDays||30,onChange:e=>y("workingCapital","payablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Capital Expenditure"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-capex-percent",className:"block text-sm font-medium text-gray-700 mb-1",children:"Capex (% of Revenue)"}),s.jsx("input",{id:"dcf-capex-percent",type:"number",step:"0.1",value:i.dcf.capex?.capexAsPercentOfRevenue||3.5,onChange:e=>y("capex","capexAsPercentOfRevenue",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-depreciation-period",className:"block text-sm font-medium text-gray-700 mb-1",children:"Depreciation Period (Years)"}),s.jsx("input",{id:"dcf-depreciation-period",type:"number",value:i.dcf.capex?.depreciationRate||7,onChange:e=>y("capex","depreciationRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"dcf-shares-outstanding",className:"block text-sm font-medium text-gray-700 mb-1",children:"Shares Outstanding (000s)"}),s.jsx("input",{id:"dcf-shares-outstanding",type:"number",value:i.dcf.sharesOutstanding||1e3,onChange:e=>v("sharesOutstanding",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]})]})]})},X=({data:t,formatCurrency:i,formatPercent:n})=>{const[l,d]=e.useState("multiples"),[c,m]=e.useState("ev_revenue"),[x,u]=e.useState(!1),[f,y]=e.useState([{id:1,name:"MedSpa Corp",ticker:"MSPA",marketCap:45e4,enterpriseValue:52e4,revenue:18e4,ebitda:45e3,netIncome:28e3,employees:1200,founded:2015,geography:"US",businessModel:"B2C Medical Spa Chain"},{id:2,name:"Wellness Holdings",ticker:"WELL",marketCap:68e4,enterpriseValue:75e4,revenue:22e4,ebitda:55e3,netIncome:35e3,employees:1800,founded:2012,geography:"US",businessModel:"Integrated Wellness Platform"},{id:3,name:"Aesthetic Solutions Inc",ticker:"AEST",marketCap:32e4,enterpriseValue:38e4,revenue:125e3,ebitda:32e3,netIncome:18e3,employees:850,founded:2018,geography:"US",businessModel:"Medical Device & Services"},{id:4,name:"Premium Health Group",ticker:"PHG",marketCap:92e4,enterpriseValue:105e4,revenue:31e4,ebitda:78e3,netIncome:48e3,employees:2500,founded:2010,geography:"US",businessModel:"Premium Healthcare Services"}]),v=e.useMemo(()=>f.map(e=>({...e,multiples:{ev_revenue:e.enterpriseValue/e.revenue,ev_ebitda:e.enterpriseValue/e.ebitda,pe_ratio:e.marketCap/e.netIncome,revenue_per_employee:e.revenue/e.employees,market_cap_revenue:e.marketCap/e.revenue}})),[f]),N=e.useMemo(()=>{const e=v.map(e=>e.multiples),s=e=>({mean:e.reduce((e,s)=>e+s,0)/e.length,median:e.sort((e,s)=>e-s)[Math.floor(e.length/2)],min:Math.min(...e),max:Math.max(...e),p25:e.sort((e,s)=>e-s)[Math.floor(.25*e.length)],p75:e.sort((e,s)=>e-s)[Math.floor(.75*e.length)]});return{ev_revenue:s(e.map(e=>e.ev_revenue)),ev_ebitda:s(e.map(e=>e.ev_ebitda)),pe_ratio:s(e.map(e=>e.pe_ratio)),revenue_per_employee:s(e.map(e=>e.revenue_per_employee)),market_cap_revenue:s(e.map(e=>e.market_cap_revenue))}},[v]),w=e.useMemo(()=>{const e=t.statements.incomeStatement.totalRevenue?.[1]||1e5,s=1.15*(t.statements.incomeStatement.operatingIncome?.[1]||5e4),a=.7*(t.statements.incomeStatement.operatingIncome?.[1]||5e4);return{ev_revenue:{mean:e*N.ev_revenue.mean,median:e*N.ev_revenue.median,p25:e*N.ev_revenue.p25,p75:e*N.ev_revenue.p75},ev_ebitda:{mean:s*N.ev_ebitda.mean,median:s*N.ev_ebitda.median,p25:s*N.ev_ebitda.p25,p75:s*N.ev_ebitda.p75},pe_ratio:{mean:a*N.pe_ratio.mean,median:a*N.pe_ratio.median,p25:a*N.pe_ratio.p25,p75:a*N.pe_ratio.p75}}},[t,N]),C={ev_revenue:{name:"EV/Revenue",description:"Enterprise Value / Annual Revenue"},ev_ebitda:{name:"EV/EBITDA",description:"Enterprise Value / EBITDA"},pe_ratio:{name:"P/E Ratio",description:"Market Cap / Net Income"},revenue_per_employee:{name:"Revenue/Employee",description:"Revenue per Employee"},market_cap_revenue:{name:"Market Cap/Revenue",description:"Market Cap / Revenue"}},k=[{id:"multiples",label:"Trading Multiples",icon:a},{id:"analysis",label:"Valuation Analysis",icon:g},{id:"companies",label:"Comparable Set",icon:h}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(h,{size:20}),"Comparable Company Analysis"]}),s.jsx("p",{className:"text-gray-600",children:"Market-based valuation using trading multiples from similar public companies."})]}),s.jsx("div",{className:"flex gap-2",children:s.jsxs("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[s.jsx(p,{size:16}),"Add Comparable"]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(M.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(a,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EV/REVENUE"})]}),s.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[N.ev_revenue.median.toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Median multiple"})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(r,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"IMPLIED VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:i(w.ev_revenue.median)}),s.jsx("div",{className:"text-sm text-green-600 mt-1",children:"EV/Revenue basis"})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(o,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"VALUATION RANGE"})]}),s.jsxs("div",{className:"text-lg font-bold text-purple-800",children:[i(w.ev_revenue.p25)," - ",i(w.ev_revenue.p75)]}),s.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"25th - 75th percentile"})]}),s.jsxs(M.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(h,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"PEER COUNT"})]}),s.jsx("div",{className:"text-2xl font-bold text-orange-800",children:f.length}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Comparable companies"})]})]}),s.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:k.map(e=>{const a=e.icon;return s.jsxs("button",{onClick:()=>d(e.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(l===e.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[s.jsx(a,{size:16}),e.label]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["multiples"===l&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Trading Multiples Analysis"}),s.jsx("select",{value:c,onChange:e=>m(e.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(C).map(([e,a])=>s.jsx("option",{value:e,children:a.name},e))})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b bg-gray-50",children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Company"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Market Cap"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Enterprise Value"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"EV/Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"EV/EBITDA"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"P/E Ratio"})]})}),s.jsxs("tbody",{children:[v.map((e,a)=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3",children:s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.name}),s.jsx("div",{className:"text-xs text-gray-500",children:e.ticker})]})}),s.jsx("td",{className:"p-3 text-right",children:i(e.marketCap)}),s.jsx("td",{className:"p-3 text-right",children:i(e.enterpriseValue)}),s.jsx("td",{className:"p-3 text-right",children:i(e.revenue)}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.ev_revenue.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.ev_ebitda.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.pe_ratio.toFixed(1),"x"]})]},e.id)),s.jsxs("tr",{className:"border-t-2 border-gray-300 bg-blue-50 font-semibold",children:[s.jsx("td",{className:"p-3",children:"Market Statistics"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsxs("td",{className:"p-3 text-right",children:[N.ev_revenue.median.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right",children:[N.ev_ebitda.median.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right",children:[N.pe_ratio.median.toFixed(1),"x"]})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-3",children:"Multiple Distribution"}),s.jsx("div",{className:"space-y-3",children:Object.entries(N).slice(0,3).map(([e,a])=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[s.jsx("span",{children:C[e].name}),s.jsxs("span",{className:"font-medium",children:[a.median.toFixed(1),"x"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:(a.median-a.min)/(a.max-a.min)*100+"%"}})}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[s.jsxs("span",{children:[a.min.toFixed(1),"x"]}),s.jsxs("span",{children:[a.max.toFixed(1),"x"]})]})]},e))})]}),s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Companies Analyzed:"}),s.jsx("span",{className:"font-medium",children:f.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median Market Cap:"}),s.jsx("span",{className:"font-medium",children:i(f.sort((e,s)=>e.marketCap-s.marketCap)[Math.floor(f.length/2)]?.marketCap||0)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median Revenue:"}),s.jsx("span",{className:"font-medium",children:i(f.sort((e,s)=>e.revenue-s.revenue)[Math.floor(f.length/2)]?.revenue||0)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Avg Founded Year:"}),s.jsx("span",{className:"font-medium",children:Math.round(f.reduce((e,s)=>e+s.founded,0)/f.length)})]})]})]})]})]}),"analysis"===l&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Valuation Analysis"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Implied Valuation by Multiple"}),s.jsx("div",{className:"space-y-4",children:Object.entries(w).map(([e,a])=>s.jsxs("div",{className:"p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"font-medium",children:C[e].name}),s.jsxs("span",{className:"text-sm text-gray-500",children:[N[e].median.toFixed(1),"x median"]})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"25th Percentile:"}),s.jsx("span",{className:"font-medium",children:i(a.p25)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median:"}),s.jsx("span",{className:"font-bold text-blue-600",children:i(a.median)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"75th Percentile:"}),s.jsx("span",{className:"font-medium",children:i(a.p75)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Mean:"}),s.jsx("span",{className:"font-medium",children:i(a.mean)})]})]})]},e))})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Valuation Summary"}),s.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Recommended Range"}),s.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[i((w.ev_revenue.p25+w.ev_ebitda.p25)/2)," -",i((w.ev_revenue.p75+w.ev_ebitda.p75)/2)]}),s.jsx("div",{className:"text-sm text-blue-600",children:"Blended 25th-75th percentile"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Midpoint Valuation"}),s.jsx("div",{className:"text-xl font-bold text-blue-800",children:i((w.ev_revenue.median+w.ev_ebitda.median)/2)}),s.jsx("div",{className:"text-sm text-blue-600",children:"Average of median multiples"})]})]})}),s.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(g,{size:16,className:"text-yellow-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-1",children:"Valuation Considerations"}),s.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[s.jsx("li",{children:"• Consider company-specific growth and margin profiles"}),s.jsx("li",{children:"• Adjust for differences in business model and scale"}),s.jsx("li",{children:"• Factor in market conditions and sector trends"}),s.jsx("li",{children:"• Apply appropriate discount for private company liquidity"})]})]})]})})]})]})]}),"companies"===l&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Comparable Company Set"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx(b,{size:16,className:"absolute left-3 top-3 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search companies...",className:"pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("button",{className:"px-3 py-2 border rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[s.jsx(j,{size:16}),"Filter"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:f.map(e=>s.jsxs(M.div,{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex justify-between items-start mb-3",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-semibold text-gray-800",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[e.ticker," • ",e.geography]})]}),s.jsx("button",{onClick:()=>{return s=e.id,void y(f.filter(e=>e.id!==s));var s},className:"text-red-500 hover:bg-red-50 p-1 rounded",children:"×"})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Market Cap:"}),s.jsx("span",{className:"font-medium",children:i(e.marketCap)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Revenue:"}),s.jsx("span",{className:"font-medium",children:i(e.revenue)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"EV/Revenue:"}),s.jsxs("span",{className:"font-medium",children:[(e.enterpriseValue/e.revenue).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Founded:"}),s.jsx("span",{className:"font-medium",children:e.founded})]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t",children:s.jsx("div",{className:"text-xs text-gray-600",children:e.businessModel})})]},e.id))})]})]}),x&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Add Comparable Company"}),s.jsxs("form",{onSubmit:e=>{e.preventDefault();const s=new FormData(e.target);(e=>{const s={id:Date.now(),...e,marketCap:parseFloat(e.marketCap)||0,enterpriseValue:parseFloat(e.enterpriseValue)||0,revenue:parseFloat(e.revenue)||0,ebitda:parseFloat(e.ebitda)||0,netIncome:parseFloat(e.netIncome)||0,employees:parseInt(e.employees)||0,founded:parseInt(e.founded)||(new Date).getFullYear()};y([...f,s]),u(!1)})(Object.fromEntries(s))},children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"company-name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),s.jsx("input",{id:"company-name",name:"name",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"ticker",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ticker"}),s.jsx("input",{id:"ticker",name:"ticker",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"marketCap",className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Cap ($000s)"}),s.jsx("input",{id:"marketCap",name:"marketCap",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"enterpriseValue",className:"block text-sm font-medium text-gray-700 mb-1",children:"Enterprise Value ($000s)"}),s.jsx("input",{id:"enterpriseValue",name:"enterpriseValue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"revenue",className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue ($000s)"}),s.jsx("input",{id:"revenue",name:"revenue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"ebitda",className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA ($000s)"}),s.jsx("input",{id:"ebitda",name:"ebitda",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"businessModel",className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Model"}),s.jsx("input",{id:"businessModel",name:"businessModel",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Company"}),s.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]})})]})},Z=({data:t,onDataChange:i})=>{const[n,l]=e.useState("setup"),[d,c]=e.useState(null),[o,m]=e.useState(!1),[u,h]=e.useState(0),[p,g]=e.useState({iterations:1e4,confidenceLevel:.95,randomSeed:null,enableCorrelation:!1}),[b,j]=e.useState({revenueGrowthRate:{type:"normal",parameters:{mean:.1,stdDev:.03},name:"Revenue Growth Rate",enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.12,mode:.15,max:.18},name:"FCF Margin",enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},name:"WACC",enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},name:"Terminal Growth Rate",enabled:!0}}),[k,R]=e.useState([[1,.3,-.2,.1],[.3,1,-.4,.2],[-.2,-.4,1,-.3],[.1,.2,-.3,1]]),F=[{value:"normal",label:"Normal",parameters:["mean","stdDev"]},{value:"triangular",label:"Triangular",parameters:["min","mode","max"]},{value:"uniform",label:"Uniform",parameters:["min","max"]},{value:"lognormal",label:"Log-Normal",parameters:["mu","sigma"]},{value:"beta",label:"Beta",parameters:["alpha","beta"]}],V=e.useCallback(async()=>{try{m(!0),h(0);const e=Object.fromEntries(Object.entries(b).filter(([e,s])=>s.enabled));if(0===Object.keys(e).length)throw new Error("No distributions are enabled. Please enable at least one variable distribution to run the simulation.");const s={iterations:p.iterations,confidenceLevel:p.confidenceLevel,randomSeed:p.randomSeed,correlationMatrix:p.enableCorrelation?k:null,onProgress:h},a=t?.statements?.incomeStatement,i=t?.periods?.length-1||2,r={currentRevenue:1e3*(a?.totalRevenue?.[i]||1e6),currentPrice:100,sharesOutstanding:1e6,currentOperatingIncome:1e3*(a?.operatingIncome?.[i]||15e4),...Object.fromEntries(Object.entries(e).map(([e,s])=>[e,s.parameters.mean||s.parameters.mode||(s.parameters.min+s.parameters.max)/2]))},n=await K.runDCFSimulation(r,e,s);c(n)}catch(e){alert(`Monte Carlo simulation failed: ${e.message}`)}finally{m(!1),h(0)}},[b,p,k,t]),I=e.useCallback(()=>{K.stopSimulation(),m(!1)},[]),B=e.useCallback((e,s)=>{j(a=>({...a,[e]:{...a[e],...s}}))},[]),T=e.useCallback((e,s,a)=>{R(t=>{const i=t.map(e=>[...e]);return i[e][s]=a,i[s][e]=a,i})},[]),z=e.useMemo(()=>{if(!d?.results)return[];const e=d.results.map(e=>e.pricePerShare),s=Math.min(...e),a=(Math.max(...e)-s)/50,t=Array(50).fill(0).map((e,t)=>({bin:s+t*a,count:0,frequency:0}));return e.forEach(e=>{const i=Math.min(Math.floor((e-s)/a),49);t[i].count++}),t.forEach(s=>{s.frequency=s.count/e.length}),t},[d]),q=e.useMemo(()=>d?.results?d.results.slice(0,1e3).map((e,s)=>({x:100*e.inputs.revenueGrowthRate,y:e.pricePerShare,upside:e.upside})):[],[d]),$=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),G=[{id:"setup",label:"Setup",icon:x},{id:"run",label:"Run Simulation",icon:y},{id:"results",label:"Results",icon:a},{id:"analysis",label:"Analysis",icon:r}];return s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsx("div",{className:"mb-6",children:s.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsxs("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center",children:[s.jsx(f,{className:"inline-block mr-2"}),"Monte Carlo Simulation"]}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Advanced risk analysis using probabilistic modeling • Generate thousands of scenarios • Measure uncertainty"})]})}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"flex space-x-2",children:G.map(e=>{const a=e.icon;return s.jsxs("button",{onClick:()=>l(e.id),className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 "+(n===e.id?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[s.jsx(a,{size:16}),e.label]},e.id)})})}),s.jsx("div",{className:"mt-6",children:s.jsxs(S,{mode:"wait",children:["setup"===n&&s.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🎛️ Simulation Settings"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"iterations",className:"block text-sm font-medium text-gray-200",children:"Iterations"}),s.jsx("input",{id:"iterations",type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:p.iterations,onChange:e=>g(s=>({...s,iterations:parseInt(e.target.value)})),min:"1000",max:"100000",step:"1000"}),s.jsx("small",{className:"text-gray-400",children:"Leave empty for random"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"confidenceLevel",className:"block text-sm font-medium text-gray-200",children:"Confidence Level"}),s.jsxs("select",{id:"confidenceLevel",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:p.confidenceLevel,onChange:e=>g(s=>({...s,confidenceLevel:parseFloat(e.target.value)})),children:[s.jsx("option",{value:.9,children:"90%"}),s.jsx("option",{value:.95,children:"95%"}),s.jsx("option",{value:.99,children:"99%"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"randomSeed",className:"block text-sm font-medium text-gray-200",children:"Random Seed (Optional)"}),s.jsx("input",{id:"randomSeed",type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:p.randomSeed||"",onChange:e=>g(s=>({...s,randomSeed:e.target.value?parseInt(e.target.value):null})),placeholder:"Leave empty for random"})]}),s.jsx("div",{className:"space-y-2",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 rounded focus:ring-blue-500",checked:p.enableCorrelation,onChange:e=>g(s=>({...s,enableCorrelation:e.target.checked}))}),s.jsx("span",{children:"Enable Variable Correlation"})]})})]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Variable Distributions"}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Object.entries(b).map(([e,a])=>s.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded-lg p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",checked:a.enabled,onChange:s=>B(e,{enabled:s.target.checked})}),s.jsx("span",{className:"font-medium",children:a.name})]})}),a.enabled&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"distributionType",className:"block text-sm font-medium text-gray-200",children:"Distribution Type"}),s.jsx("select",{id:"distributionType",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:a.type,onChange:s=>{const a=s.target.value;F.find(e=>e.value===a);const t={};"normal"===a?t.mean=.1:"triangular"===a?(t.min=.05,t.mode=.1,t.max=.15):"uniform"===a&&(t.min=.05,t.max=.15),B(e,{type:a,parameters:t})},children:F.map((e,a)=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:F.find(e=>e.value===a.type)?.parameters.map(t=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-300",children:t.charAt(0).toUpperCase()+t.slice(1)}),s.jsx("input",{className:"w-full px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",type:"number",value:a.parameters[t]||"",onChange:s=>B(e,{parameters:{...a.parameters,[t]:parseFloat(s.target.value)}}),step:"0.001"})]},t))})]})]},e))})]}),p.enableCorrelation&&s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🔗 Correlation Matrix"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{}),Object.keys(b).map(e=>s.jsx("th",{children:b[e].name},e))]})}),s.jsx("tbody",{children:Object.keys(b).map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{className:"font-medium text-gray-200 p-2 border border-gray-600",children:b.map((e,a)=>s.jsx("span",{children:e.name},a))}),Object.keys(b).map((e,t)=>s.jsx("td",{className:"p-2 border border-gray-600",children:s.jsx("input",{type:"number",value:k[a][t],onChange:e=>T(a,t,parseFloat(e.target.value)),min:"-1",max:"1",step:"0.1",disabled:a===t,className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-700 disabled:text-gray-400"})},t))]},e))})]})})]})]})},"setup"),"run"===n&&s.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{children:"🚀 Simulation Control"}),s.jsx("div",{className:"flex items-center space-x-2",children:o?s.jsxs("button",{onClick:I,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(v,{size:16}),s.jsx("span",{children:"Stop Simulation"})]}):s.jsxs("button",{onClick:V,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",disabled:Object.values(b).every(e=>!e.enabled),children:[s.jsx(y,{size:16}),s.jsx("span",{children:"Run Simulation"})]})})]}),o&&s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})}),s.jsxs("div",{className:"text-sm text-gray-400 text-center",children:[u.toFixed(1),"% Complete (",Math.floor(u*p.iterations/100)," / ",p.iterations," iterations)"]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 mt-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📋 Simulation Preview"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Iterations"}),s.jsx("div",{className:"text-xl font-bold text-white",children:p.iterations.toLocaleString()})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Variables"}),s.jsx("div",{className:"text-xl font-bold text-white",children:Object.values(b).filter(e=>e.enabled).length})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Confidence Level"}),s.jsxs("div",{className:"text-xl font-bold text-white",children:[(100*p.confidenceLevel).toFixed(0),"%"]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Correlation"}),s.jsx("div",{className:"text-xl font-bold text-white",children:p.enableCorrelation?"Enabled":"Disabled"})]})]})]})]})},"run"),"results"===n&&s.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:d?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-xl font-semibold text-white flex items-center",children:"📊 Simulation Results"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(N,{size:16}),"Export Results"]}),s.jsxs("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(w,{size:16}),"Generate Report"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(d.analysis.statistics).map(([e,a])=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"💰 Price per Share":"enterpriseValue"===e?"🏢 Enterprise Value":"📈 Upside %"}),s.jsx("div",{className:"text-2xl font-bold text-green-400 mb-2",children:"upside"===e?`${a.mean.toFixed(1)}%`:$(a.mean)}),s.jsxs("div",{className:"space-y-1 text-sm text-gray-300",children:[s.jsxs("div",{children:["Median: ","upside"===e?`${a.median.toFixed(1)}%`:$(a.median)]}),s.jsxs("div",{children:["Std Dev: ","upside"===e?`${a.stdDev.toFixed(1)}%`:$(a.stdDev)]}),s.jsxs("div",{children:["Min: ","upside"===e?`${a.min.toFixed(1)}%`:$(a.min)]}),s.jsxs("div",{children:["Max: ","upside"===e?`${a.max.toFixed(1)}%`:$(a.max)]})]})]},e))}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"📊 Price Distribution"}),s.jsx(P,{width:"100%",height:300,children:s.jsxs(W,{data:z,children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(D,{dataKey:"bin",tickFormatter:$}),s.jsx(E,{}),s.jsx(O,{formatter:(e,s)=>[`${(100*e).toFixed(2)}%`,"Frequency"],labelFormatter:e=>`Price: ${$(e)}`}),s.jsx(U,{type:"monotone",dataKey:"frequency",stroke:"#3B82F6",fill:"#3B82F6",fillOpacity:.6})]})})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"🎯 Sensitivity Scatter Plot"}),s.jsx(P,{width:"100%",height:300,children:s.jsxs(L,{data:q,children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(D,{dataKey:"x",name:"Revenue Growth Rate",tickFormatter:e=>`${e.toFixed(1)}%`}),s.jsx(E,{dataKey:"y",name:"Price per Share",tickFormatter:$}),s.jsx(O,{formatter:(e,s)=>["Revenue Growth Rate"===s?`${e.toFixed(2)}%`:$(e),s]}),s.jsx(H,{name:"Scenarios",fill:"#10B981",children:q.map((e,a)=>s.jsx(_,{fill:e.upside>0?"#10B981":"#EF4444"},`cell-${a}`))})]})})]})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(C,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Results Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see results here."})]})},"results"),"analysis"===n&&s.jsx(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:d?.analysis?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"⚠️ Risk Metrics"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(d.analysis.riskMetrics).map(([e,a])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"var95"===e?"Value at Risk (95%)":"cvar95"===e?"Conditional VaR (95%)":"probabilityOfLoss"===e?"Probability of Loss":"Sharpe Ratio"}),s.jsx("div",{className:"text-xl font-bold text-red-400 mb-1",children:"probabilityOfLoss"===e?`${(100*a).toFixed(1)}%`:$(a)}),s.jsx("div",{className:"text-xs text-gray-400",children:"Risk measure"})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:["📊 Confidence Intervals (",(100*d.analysis.confidenceIntervals.pricePerShare?.level).toFixed(0),"%)"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(d.analysis.confidenceIntervals).map(([e,a])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Lower Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${a.lowerBound.toFixed(1)}%`:$(a.lowerBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Upper Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${a.upperBound.toFixed(1)}%`:$(a.upperBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Width:"}),s.jsx("span",{className:"font-medium text-blue-400",children:"upside"===e?`${a.width.toFixed(1)}%`:$(a.width)})]})]})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Percentile Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-300",children:"Metric"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"5th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"25th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"50th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"75th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"95th %ile"})]})}),s.jsx("tbody",{children:Object.entries(d.analysis.percentiles).map(([e,a])=>s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("td",{className:"p-3 text-sm text-white",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${a.p5.toFixed(1)}%`:$(a.p5)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${a.p25.toFixed(1)}%`:$(a.p25)}),s.jsx("td",{className:"p-3 text-sm text-right text-blue-400 font-medium",children:"upside"===e?`${a.p50.toFixed(1)}%`:$(a.p50)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${a.p75.toFixed(1)}%`:$(a.p75)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${a.p95.toFixed(1)}%`:$(a.p95)})]},e))})]})})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(C,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Analysis Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see analysis here."})]})},"analysis")]})})]})},ee=({data:t,modelInputs:i,onModelInputChange:n,calculateDCF:l,formatCurrency:d,formatPercent:c})=>{const[o,m]=e.useState(!1),x=i.scenario?.scenarios||[],u=e.useMemo(()=>x.map(e=>{try{const s={...t.statements.incomeStatement},a=s.totalRevenue||{},i={};Object.keys(a).forEach(s=>{const t=parseInt(s);if(0===t)i[s]=a[s];else{const r=1+e.revenueGrowth/100;i[s]=a[0]*Math.pow(r,t)}});const r=s.operatingIncome||{},n={};Object.keys(r).forEach(s=>{if(0===parseInt(s))n[s]=r[s];else{const t=a[s]||0,l=i[s]||0,d=r[s]||0;if(t>0){const a=d/t+e.marginImprovement/100;n[s]=l*a}else n[s]=d}});const d={...t,statements:{...t.statements,incomeStatement:{...s,totalRevenue:i,operatingIncome:n}}},c=l(d);return{...e,...c,weightedValue:c.enterpriseValue*(e.probability/100)}}catch(s){return{...e,enterpriseValue:0,equityValue:0,weightedValue:0}}}),[x,t,l]),h=u.reduce((e,s)=>e+s.weightedValue,0),g=(e,s,a)=>{const t=x.map((t,i)=>i===e?{...t,[s]:a}:t);n("scenario","scenarios",t)},b=({scenario:e,index:a})=>s.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-name-${a}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Scenario Name"}),s.jsx("input",{id:`scenario-name-${a}`,type:"text",value:e.name,onChange:e=>g(a,"name",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter scenario name"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-probability-${a}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Probability (%)"}),s.jsx("input",{id:`scenario-probability-${a}`,type:"number",min:"0",max:"100",value:e.probability,onChange:e=>g(a,"probability",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-revenueGrowth-${a}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue Growth (%)"}),s.jsx("input",{id:`scenario-revenueGrowth-${a}`,type:"number",step:"0.1",value:e.revenueGrowth,onChange:e=>g(a,"revenueGrowth",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`scenario-marginImprovement-${a}`,className:"block text-sm font-medium text-gray-700 mb-1",children:"Margin Change (%)"}),s.jsx("input",{id:`scenario-marginImprovement-${a}`,type:"number",step:"0.1",value:e.marginImprovement,onChange:e=>g(a,"marginImprovement",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsx("div",{className:"flex justify-end mt-4 gap-2",children:s.jsxs("button",{onClick:()=>(e=>{const s=x.filter((s,a)=>a!==e);n("scenario","scenarios",s)})(a),className:"px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-1",children:[s.jsx(F,{size:16}),"Delete"]})})]});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{children:s.jsx("p",{className:"text-gray-600",children:"Create and compare multiple financial scenarios with different assumptions and probabilities."})}),s.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[s.jsx(p,{size:16}),"Add Scenario"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Assumptions"}),x.map((e,a)=>s.jsx(b,{scenario:e,index:a},a)),o&&s.jsx("div",{className:"border-2 border-dashed border-blue-300 rounded-lg p-4",children:s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h5",{className:"font-medium",children:"Add New Scenario"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{const e={name:`Scenario ${x.length+1}`,probability:Math.max(0,100-x.reduce((e,s)=>e+s.probability,0)),revenueGrowth:10,marginImprovement:0};n("scenario","scenarios",[...x,e]),m(!1)},className:"px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Add"}),s.jsx("button",{onClick:()=>m(!1),className:"px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})})]}),u.length>0&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Analysis Results"}),s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(a,{size:20,className:"text-blue-600"}),s.jsx("h5",{className:"font-semibold text-blue-800",children:"Probability-Weighted Valuation"})]}),s.jsx("div",{className:"text-3xl font-bold text-blue-800",children:d(h)}),s.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"Expected value based on scenario probabilities"})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:u.map((e,a)=>s.jsxs(M.div,{className:"bg-white rounded-lg border p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{children:[s.jsx("h6",{className:"font-semibold text-gray-800",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsxs("span",{children:[e.probability,"% probability"]}),e.revenueGrowth>15?s.jsx(r,{size:14,className:"text-green-500"}):e.revenueGrowth<5?s.jsx(k,{size:14,className:"text-red-500"}):s.jsx(R,{size:14,className:"text-gray-500"})]})]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Enterprise Value"}),s.jsx("div",{className:"text-xl font-bold text-gray-800",children:d(e.enterpriseValue)})]}),s.jsxs("div",{className:"text-xs space-y-1 text-gray-600",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Revenue Growth:"}),s.jsx("span",{className:"font-medium",children:c(e.revenueGrowth)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Margin Change:"}),s.jsxs("span",{className:"font-medium "+(e.marginImprovement>=0?"text-green-600":"text-red-600"),children:[e.marginImprovement>=0?"+":"",c(e.marginImprovement)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Weighted Value:"}),s.jsx("span",{className:"font-medium",children:d(e.weightedValue)})]})]})]})]},a))}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h5",{className:"font-semibold mb-4",children:"Scenario Statistics"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:d(Math.max(...u.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:d(Math.min(...u.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d(h)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-800",children:d(Math.max(...u.map(e=>e.enterpriseValue))-Math.min(...u.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Value Range"})]})]}),s.jsx("div",{className:"mt-4 pt-4 border-t",children:s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("strong",{children:"Total Probability:"})," ",x.reduce((e,s)=>e+s.probability,0),"%",100!==x.reduce((e,s)=>e+s.probability,0)&&s.jsx("span",{className:"text-orange-600 ml-2",children:"⚠ Probabilities should sum to 100%"})]})})]})]}),0===x.length&&s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(a,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"No scenarios created yet."}),s.jsx("p",{className:"text-sm mt-2",children:"Click “Add Scenario” to get started with scenario modeling."})]})]})},se=({data:t,modelInputs:i,onModelInputChange:r,calculateDCF:l,formatCurrency:d,_formatPercent:c})=>{const[o,m]=e.useState(null),u=i.sensitivity||{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},h={revenue:{name:"Revenue Growth",unit:"%",description:"Annual revenue growth rate",baseValue:15,isPercentage:!0},grossMargin:{name:"Gross Margin",unit:"%",description:"Gross profit margin improvement",baseValue:45,isPercentage:!0},discountRate:{name:"Discount Rate (WACC)",unit:"%",description:"Weighted average cost of capital",baseValue:i.dcf?.discountRate||10,isPercentage:!0},terminalGrowthRate:{name:"Terminal Growth Rate",unit:"%",description:"Long-term growth rate assumption",baseValue:i.dcf?.terminalGrowthRate||2.5,isPercentage:!0},taxRate:{name:"Tax Rate",unit:"%",description:"Corporate tax rate",baseValue:i.dcf?.taxRate||25,isPercentage:!0}},g=e.useMemo(()=>l(),[t,i,l]),b=e.useMemo(()=>{const e={};return u.variables.forEach(s=>{const a=u.ranges[s],r=h[s];if(!a||!r)return;const n=(a.max-a.min)/8,l=[];for(let e=0;e<9;e++){const d=a.min+n*e;let c={...t};const o={...i.dcf,[s]:(r.isPercentage,d)};if("revenue"===s||"grossMargin"===s){const e={...t.statements.incomeStatement};if("revenue"===s){const s=e.totalRevenue||{},a={};Object.keys(s).forEach(e=>{const t=parseInt(e);if(0===t)a[e]=s[e];else{const i=1+d/100;a[e]=s[0]*Math.pow(i,t)}}),e.totalRevenue=a}if("grossMargin"===s){const s=e.operatingIncome||{},a=e.totalRevenue||{},t={};Object.keys(s).forEach(e=>{const i=a[e]||0,r=s[e]||0;if(i>0){const s=r/i+d/100;t[e]=i*s}else t[e]=r}),e.operatingIncome=t}c={...t,statements:{...t.statements,incomeStatement:e}}}const m=(()=>{try{const e={discountRate:o.discountRate||10,terminalGrowthRate:o.terminalGrowthRate||2.5,projectionYears:o.projectionYears||5,taxRate:o.taxRate||25},s=c.statements.incomeStatement.operatingIncome||{},a=[];if(Object.keys(s).forEach(e=>{parseInt(e)>=0&&a.push(s[e]||0)}),0===a.length)return{enterpriseValue:0,equityValue:0};let t=0;const i=1+e.discountRate/100;a.forEach((s,a)=>{if(a>0&&a<=e.projectionYears){const r=s*(1-e.taxRate/100)/Math.pow(i,a);t+=r}});const r=(a[a.length-1]||0)*(1+e.terminalGrowthRate/100)*(1-e.taxRate/100)/((e.discountRate-e.terminalGrowthRate)/100),n=r/Math.pow(i,e.projectionYears),l=t+n;return{enterpriseValue:l,equityValue:l,presentValueOperations:t,presentValueTerminal:n,terminalValue:r}}catch(e){return{enterpriseValue:0,equityValue:0}}})();l.push({variable:d,valuation:m.enterpriseValue,changeFromBase:(m.enterpriseValue-g.enterpriseValue)/g.enterpriseValue*100})}e[s]={definition:r,range:a,dataPoints:l}}),e},[t,i,u,g,l]),j=e.useMemo(()=>Object.entries(b).map(([e,s])=>{const a=Math.max(...s.dataPoints.map(e=>Math.abs(e.changeFromBase)));return{variable:e,definition:s.definition,maxImpact:a,positiveImpact:Math.max(...s.dataPoints.map(e=>e.changeFromBase)),negativeImpact:Math.min(...s.dataPoints.map(e=>e.changeFromBase))}}).sort((e,s)=>s.maxImpact-e.maxImpact),[b]),f=(e,s,a)=>{const t={...u.ranges,[e]:{...u.ranges[e],[s]:parseFloat(a)}};r("sensitivity","ranges",t)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600 mb-4",children:"Analyze how changes in key variables impact enterprise valuation. Higher sensitivity indicates greater risk and importance for due diligence."}),s.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),s.jsxs("span",{children:["Base Case: ",d(g.enterpriseValue)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(n,{size:14}),s.jsxs("span",{children:[u.variables.length," variables analyzed"]})]})]})]}),s.jsxs("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[s.jsx(x,{size:16}),"Configure"]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("h4",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[s.jsx(a,{size:20}),"Impact Ranking (Tornado Chart)"]}),s.jsx("div",{className:"space-y-3",children:j.map((e,a)=>s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("span",{className:"text-sm font-medium",children:[a+1,". ",e.definition.name]}),s.jsxs("span",{className:"text-xs text-gray-500",children:["±",e.maxImpact.toFixed(1),"%"]})]}),s.jsxs("div",{className:"relative h-8 bg-gray-100 rounded",children:[s.jsx("div",{className:"absolute left-1/2 h-full bg-red-400 rounded-l",style:{width:Math.abs(e.negativeImpact)/Math.max(Math.abs(e.negativeImpact),e.positiveImpact)*50+"%",transform:"translateX(-100%)"}}),s.jsx("div",{className:"absolute left-1/2 h-full bg-green-400 rounded-r",style:{width:e.positiveImpact/Math.max(Math.abs(e.negativeImpact),e.positiveImpact)*50+"%"}}),s.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-400 transform -translate-x-0.5"}),s.jsxs("div",{className:"absolute inset-0 flex items-center justify-between px-2 text-xs font-medium text-white",children:[s.jsxs("span",{children:[e.negativeImpact.toFixed(1),"%"]}),s.jsxs("span",{children:["+",e.positiveImpact.toFixed(1),"%"]})]})]})]},e.variable))})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Variable Configuration"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[u.variables.map(e=>{const a=b[e];return a?s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium",children:a.definition.name}),s.jsx("p",{className:"text-xs text-gray-500",children:a.definition.description})]}),s.jsx("button",{onClick:()=>(e=>{const s=u.variables.filter(s=>s!==e),{[e]:a,...t}=u.ranges;r("sensitivity","variables",s),r("sensitivity","ranges",t)})(e),className:"text-red-500 hover:bg-red-50 p-1 rounded",children:s.jsx(R,{size:16})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Min Value (",a.definition.unit,")"]}),s.jsx("input",{type:"number",step:"0.1",value:a.range.min,onChange:s=>f(e,"min",s.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Max Value (",a.definition.unit,")"]}),s.jsx("input",{type:"number",step:"0.1",value:a.range.max,onChange:s=>f(e,"max",s.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"h-16 bg-gray-50 rounded p-2",children:[s.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Valuation Sensitivity"}),s.jsx("div",{className:"flex items-end justify-between h-8",children:a.dataPoints.map((e,t)=>s.jsx("div",{className:"w-1 rounded-t "+(e.changeFromBase>0?"bg-green-400":e.changeFromBase<0?"bg-red-400":"bg-blue-400"),style:{height:Math.abs(e.changeFromBase)/50*100+"%",minHeight:"2px"},title:`${e.variable}${a.definition.unit}: ${d(e.valuation)}`},t))})]})]},e):null}),s.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(p,{size:24,className:"mx-auto mb-2 text-gray-400"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Add Variable"}),s.jsx("div",{className:"space-y-2",children:Object.keys(h).filter(e=>!u.variables.includes(e)).map(e=>s.jsx("button",{onClick:()=>(e=>{if(!u.variables.includes(e)&&h[e]){const s=[...u.variables,e],a={...u.ranges,[e]:{min:-10,max:10}};r("sensitivity","variables",s),r("sensitivity","ranges",a)}})(e),className:"block w-full px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:h[e].name},e))})]})})]})]}),o&&b[o]&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("h4",{className:"font-semibold text-lg mb-4",children:["Detailed Analysis: ",b[o].definition.name]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-3",children:"Data Points"}),s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:b[o].dataPoints.map((e,a)=>s.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-gray-50 rounded",children:[s.jsxs("span",{children:[e.variable,b[o].definition.unit]}),s.jsx("span",{className:"font-medium",children:d(e.valuation)}),s.jsxs("span",{className:"font-medium "+(e.changeFromBase>0?"text-green-600":e.changeFromBase<0?"text-red-600":"text-gray-600"),children:[e.changeFromBase>0?"+":"",e.changeFromBase.toFixed(1),"%"]})]},a))})]}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Range Impact:"}),s.jsxs("span",{className:"font-medium",children:["±",Math.max(...b[o].dataPoints.map(e=>Math.abs(e.changeFromBase))).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Max Upside:"}),s.jsxs("span",{className:"font-medium text-green-600",children:["+",Math.max(...b[o].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Max Downside:"}),s.jsxs("span",{className:"font-medium text-red-600",children:[Math.min(...b[o].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]})]})]})]})]})]})},ae=({onOpenOptions:e,onOpenBonds:a,onOpenCredit:t})=>s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[s.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Advanced Analytics Tools"}),s.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Send your current analysis assumptions to advanced pricing models:"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:e,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Options Pricer"}),s.jsx("button",{onClick:a,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Bond Analytics"}),s.jsx("button",{onClick:t,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors",children:"Credit Modeling"})]})]}),te=({data:t,adjustedValues:i,onDataChange:r})=>{const[l,d]=e.useState("dcf"),[c,m]=e.useState({dcf:{discountRate:10,terminalGrowthRate:2.5,projectionYears:5,terminalValueMultiple:10,taxRate:25,sharesOutstanding:1e3,workingCapital:{receivablesDays:45,inventoryDays:60,payablesDays:30,receivablesGrowth:2,inventoryGrowth:1.5,payablesGrowth:1.8},capex:{capexAsPercentOfRevenue:3.5,depreciationRate:7,maintenanceCapex:2}},ratios:{compareToIndustry:!0,industryAverages:{grossMargin:45,operatingMargin:15,netMargin:8,currentRatio:2.1,debtToEquity:.5}},sensitivity:{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},scenario:{scenarios:[{name:"Base Case",probability:50,revenueGrowth:15,marginImprovement:0},{name:"Bull Case",probability:25,revenueGrowth:25,marginImprovement:2},{name:"Bear Case",probability:25,revenueGrowth:5,marginImprovement:-2}]}}),x=e.useMemo(()=>{const e=t.statements.incomeStatement,s=t.periods,a={revenue:[],grossProfit:[],operatingIncome:[],margins:{gross:[],operating:[],net:[]},growth:{revenue:[],operating:[]}};return s.forEach((t,r)=>{const n=r===s.length-1,l=n&&i?.totalRevenue?i.totalRevenue:e.totalRevenue?.[r]||0,d=n&&i?.totalCostOfGoodsSold?i.totalCostOfGoodsSold:e.totalCostOfGoodsSold?.[r]||0,c=n&&i?.grossProfit?i.grossProfit:e.grossProfit?.[r]||l-d,o=n&&i?.operatingIncome?i.operatingIncome:e.operatingIncome?.[r]||0;if(a.revenue.push(l),a.grossProfit.push(c),a.operatingIncome.push(o),a.margins.gross.push(l?c/l*100:0),a.margins.operating.push(l?o/l*100:0),r>0){const s=e.totalRevenue?.[r-1]||0,t=e.operatingIncome?.[r-1]||0;a.growth.revenue.push(s?(l-s)/s*100:0),a.growth.operating.push(t?(o-t)/t*100:0)}}),a},[t]),u=(e=null)=>{const{discountRate:s,terminalGrowthRate:a,projectionYears:i,taxRate:r}=c.dcf,n=e||t;let l;if(e?(l=[],n.periods.forEach((e,s)=>{s>0&&s<=i&&l.push(n.statements.incomeStatement.operatingIncome?.[s]||0)})):l=x.operatingIncome.slice(1,i+1),0===l.length)return{enterpriseValue:0,equityValue:0,sharePrice:0};let d=0;const o=1+s/100;l.forEach((e,s)=>{const a=e*(1-r/100)/Math.pow(o,s+1);d+=a});const m=(l[l.length-1]||0)*(1+a/100)*(1-r/100)/((s-a)/100),u=m/Math.pow(o,i),h=d+u;return{enterpriseValue:h,equityValue:h,presentValueOperations:d,presentValueTerminal:u,terminalValue:m}};u();const p=[{id:"dcf",label:"DCF Valuation",icon:o,description:"Discounted Cash Flow analysis"},{id:"ratios",label:"Ratio Analysis",icon:a,description:"Financial ratio comparison"},{id:"sensitivity",label:"Sensitivity Analysis",icon:n,description:"Variable impact analysis"},{id:"scenario",label:"Scenario Modeling",icon:g,description:"Multi-scenario projections"},{id:"comparable",label:"Comparable Analysis",icon:h,description:"Market-based valuation"},{id:"montecarlo",label:"Monte Carlo",icon:f,description:"Probabilistic risk analysis"}],b=(e,s,a)=>{m(t=>({...t,[e]:{...t[e],[s]:a}}))},j=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(1e3*e),y=e=>`${e.toFixed(1)}%`;return s.jsxs("div",{className:"h-full bg-gray-900 text-white p-6",children:[s.jsx(ae,{onOpenOptions:()=>{window.dispatchEvent(new CustomEvent("open-options-pricer"))},onOpenBonds:()=>{window.dispatchEvent(new CustomEvent("open-bond-analytics"))},onOpenCredit:()=>{window.dispatchEvent(new CustomEvent("open-credit-modeling"))}}),s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Financial Modeling"}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Select a modeling approach to analyze your financial data"})]})}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:p.map(e=>{const a=e.icon;return s.jsxs("button",{onClick:()=>d(e.id),className:(l===e.id?"bg-blue-600 text-white border-blue-500 shadow-lg":"bg-gray-800 text-gray-300 border-gray-700 hover:bg-gray-700 hover:text-white hover:border-gray-600")+" flex items-center gap-3 px-4 py-3 rounded-lg border transition-all duration-200",children:[s.jsx(a,{size:18,className:l===e.id?"text-white":"text-blue-400"}),s.jsx("span",{className:"font-medium",children:e.label})]},e.id)})}),s.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[V.createElement(p.find(e=>e.id===l)?.icon,{size:20,className:"text-blue-400"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-white",children:p.find(e=>e.id===l)?.label}),s.jsx("p",{className:"text-gray-400 text-sm",children:p.find(e=>e.id===l)?.description})]})]})})]}),s.jsxs("div",{children:["dcf"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(o,{size:20,className:"text-blue-400"}),"DCF Valuation Model"]}),s.jsx(J,{data:t,modelInputs:c,onModelInputChange:b,formatCurrency:j,formatPercent:y})]}),"ratios"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(a,{size:20}),"Financial Ratio Analysis"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Profitability Ratios"}),s.jsxs("div",{className:"space-y-3",children:[x.margins.gross.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Gross Margin:"]}),s.jsx("span",{className:"font-medium",children:y(e)})]},a)),x.margins.operating.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Operating Margin:"]}),s.jsx("span",{className:"font-medium",children:y(e)})]},a))]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Growth Rates"}),s.jsxs("div",{className:"space-y-3",children:[x.growth.revenue.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Revenue Growth:"]}),s.jsx("span",{className:"font-medium "+(e>=0?"text-green-600":"text-red-600"),children:y(e)})]},a)),x.growth.operating.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Operating Growth:"]}),s.jsx("span",{className:"font-medium "+(e>=0?"text-green-600":"text-red-600"),children:y(e)})]},a))]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Industry Comparison"}),s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"p-3 bg-gray-700 rounded-lg",children:[s.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Industry Avg"}),s.jsxs("div",{className:"text-sm",children:["Gross Margin: ",y(c.ratios.industryAverages.grossMargin)]}),s.jsxs("div",{className:"text-sm",children:["Operating Margin: ",y(c.ratios.industryAverages.operatingMargin)]}),s.jsxs("div",{className:"text-sm",children:["Net Margin: ",y(c.ratios.industryAverages.netMargin)]})]})})]})]})]}),"sensitivity"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(n,{size:20}),"Sensitivity Analysis"]}),s.jsx(se,{data:t,modelInputs:c,onModelInputChange:b,calculateDCF:u,formatCurrency:j,formatPercent:y})]}),"scenario"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(g,{size:20}),"Scenario Modeling"]}),s.jsx(ee,{data:t,modelInputs:c,onModelInputChange:b,calculateDCF:u,formatCurrency:j,formatPercent:y})]}),"comparable"===l&&s.jsx("div",{className:"p-6",children:s.jsx(X,{data:t,formatCurrency:j,formatPercent:y})}),"montecarlo"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[s.jsx(f,{size:20}),"Monte Carlo Simulation"]}),s.jsx(Z,{data:t,onDataChange:r})]})]})]})};export{te as default};
//# sourceMappingURL=ModelingTools-0jJnWWif.js.map
