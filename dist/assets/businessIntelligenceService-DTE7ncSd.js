import{W as e}from"./vendor-COg1wW2x.js";class t extends e.EventEmitter{constructor(){super(),this.analytics=new Map,this.userBehavior=new Map,this.performanceMetrics=new Map,this.marketIntelligence=new Map,this.automatedReports=new Map,this.benchmarks=new Map,this.insights=new Map,this.isInitialized=!1,this.trackingEnabled=!0,this.reportingInterval=null,this.insightGenerationInterval=null,this.analyticsQueue=[],this.behaviorQueue=[],this.performanceQueue=[],this.patterns={userEngagement:new Map,featureUsage:new Map,performanceTrends:new Map,marketCorrelations:new Map}}async initialize(e={}){try{if(this.isInitialized)return;this.config={enableUserTracking:!1!==e.enableUserTracking,enablePerformanceTracking:!1!==e.enablePerformanceTracking,enableMarketIntelligence:!1!==e.enableMarketIntelligence,reportingInterval:e.reportingInterval||3e5,insightGenerationInterval:e.insightGenerationInterval||9e5,maxQueueSize:e.maxQueueSize||1e3,batchSize:e.batchSize||50,...e},this.initializeAnalyticsCollector(),this.initializeBehaviorTracker(),this.initializePerformanceMonitor(),this.initializeMarketIntelligence(),this.startAutomatedReporting(),this.startInsightGeneration(),await this.initializeBenchmarks(),this.isInitialized=!0,this.emit("initialized",{config:this.config})}catch(t){throw t}}initializeAnalyticsCollector(){this.trackPageView=(e,t={})=>{this.addToQueue("analytics",{type:"page_view",page:e,timestamp:Date.now(),sessionId:this.getSessionId(),metadata:t})},this.trackFeatureUsage=(e,t,r={})=>{this.addToQueue("analytics",{type:"feature_usage",feature:e,action:t,timestamp:Date.now(),sessionId:this.getSessionId(),metadata:r})},this.trackUserInteraction=(e,t,r={})=>{this.addToQueue("analytics",{type:"user_interaction",interaction:e,target:t,timestamp:Date.now(),sessionId:this.getSessionId(),metadata:r})}}initializeBehaviorTracker(){this.behaviorPatterns={sessionDuration:new Map,featureAdoption:new Map,userJourney:new Map,engagementScores:new Map,retentionMetrics:new Map},this.startSession=(e,t={})=>{const r=this.generateSessionId(),a={id:r,userId:e,startTime:Date.now(),metadata:t,interactions:[],features:new Set,pages:[]};return this.behaviorPatterns.sessionDuration.set(r,a),r},this.endSession=e=>{const t=this.behaviorPatterns.sessionDuration.get(e);t&&(t.endTime=Date.now(),t.duration=t.endTime-t.startTime,this.analyzeSession(t))}}initializePerformanceMonitor(){this.performanceMetrics={responseTime:[],errorRates:new Map,resourceUsage:[],userExperience:new Map,systemHealth:new Map},this.collectPerformanceData=()=>{const e={timestamp:Date.now(),memory:this.getMemoryUsage(),timing:this.getTimingMetrics(),errors:this.getErrorMetrics(),userExperience:this.getUserExperienceMetrics()};this.addToQueue("performance",e)},setInterval(()=>{this.collectPerformanceData()},3e4)}initializeMarketIntelligence(){this.marketIntelligence={trends:new Map,correlations:new Map,anomalies:[],predictions:new Map,alerts:[]},this.analyzeMarketData=e=>{const t={timestamp:Date.now(),trends:this.identifyTrends(e),correlations:this.findCorrelations(e),anomalies:this.detectAnomalies(e),signals:this.generateTradingSignals(e)};this.marketIntelligence.trends.set(Date.now(),t),this.emit("marketAnalysis",t)}}async initializeBenchmarks(){this.benchmarks=new Map([["portfolio_performance",{excellent:{returns:.12,sharpe:1.5,volatility:.15},good:{returns:.08,sharpe:1,volatility:.18},average:{returns:.06,sharpe:.7,volatility:.22},poor:{returns:.03,sharpe:.4,volatility:.28}}],["risk_metrics",{excellent:{var_95:.02,cvar_95:.03,max_drawdown:.05},good:{var_95:.04,cvar_95:.06,max_drawdown:.08},average:{var_95:.06,cvar_95:.09,max_drawdown:.12},poor:{var_95:.08,cvar_95:.12,max_drawdown:.18}}],["user_engagement",{excellent:{session_duration:1800,pages_per_session:8,bounce_rate:.2},good:{session_duration:1200,pages_per_session:6,bounce_rate:.3},average:{session_duration:600,pages_per_session:4,bounce_rate:.5},poor:{session_duration:300,pages_per_session:2,bounce_rate:.7}}],["system_performance",{excellent:{response_time:200,error_rate:.001,uptime:.999},good:{response_time:500,error_rate:.005,uptime:.995},average:{response_time:1e3,error_rate:.01,uptime:.99},poor:{response_time:2e3,error_rate:.02,uptime:.95}}]])}startAutomatedReporting(){this.reportingInterval=setInterval(()=>{this.generateAutomatedReports()},this.config.reportingInterval)}startInsightGeneration(){this.insightGenerationInterval=setInterval(()=>{this.generateIntelligentInsights()},this.config.insightGenerationInterval)}addToQueue(e,t){if(!this.trackingEnabled)return;const r=this[`${e}Queue`];r&&r.length<this.config.maxQueueSize&&(r.push(t),r.length>=this.config.batchSize&&this.processBatch(e))}async processBatch(e){const t=this[`${e}Queue`];if(!t||0===t.length)return;const r=t.splice(0,this.config.batchSize);try{switch(e){case"analytics":await this.processAnalyticsBatch(r);break;case"behavior":await this.processBehaviorBatch(r);break;case"performance":await this.processPerformanceBatch(r)}}catch(a){}}async processAnalyticsBatch(e){for(const t of e)switch(t.type){case"page_view":this.updatePageViewMetrics(t);break;case"feature_usage":this.updateFeatureUsageMetrics(t);break;case"user_interaction":this.updateInteractionMetrics(t)}this.emit("analyticsBatchProcessed",{count:e.length})}async processBehaviorBatch(e){for(const t of e)this.updateBehaviorPatterns(t);this.emit("behaviorBatchProcessed",{count:e.length})}async processPerformanceBatch(e){const t=this.aggregatePerformanceMetrics(e);this.updatePerformanceTrends(t),this.emit("performanceBatchProcessed",{count:e.length,aggregated:t})}async generateAutomatedReports(){try{const e={timestamp:Date.now(),usage:await this.generateUsageReport(),performance:await this.generatePerformanceReport(),userBehavior:await this.generateBehaviorReport(),marketIntelligence:await this.generateMarketReport(),recommendations:await this.generateRecommendations()};if(this.automatedReports.set(Date.now(),e),this.emit("automatedReportGenerated",e),this.automatedReports.size>100){Array.from(this.automatedReports.keys()).sort().slice(0,-100).forEach(e=>{this.automatedReports.delete(e)})}return e}catch(e){}}async generateIntelligentInsights(){try{const e={timestamp:Date.now(),patterns:await this.identifyPatterns(),anomalies:await this.detectSystemAnomalies(),predictions:await this.generatePredictions(),optimizations:await this.suggestOptimizations(),alerts:await this.generateAlerts()};return this.insights.set(Date.now(),e),this.emit("intelligentInsightsGenerated",e),e}catch(e){}}async generateUsageReport(){const e=Date.now(),t=e-864e5;return{period:"24h",metrics:{totalSessions:this.countSessions(t,e),uniqueUsers:this.countUniqueUsers(t,e),averageSessionDuration:this.calculateAverageSessionDuration(t,e),topFeatures:this.getTopFeatures(t,e),pageViews:this.countPageViews(t,e),userEngagement:this.calculateEngagementMetrics(t,e)},trends:{sessionsGrowth:this.calculateGrowthRate("sessions",t,e),userGrowth:this.calculateGrowthRate("users",t,e),engagementTrend:this.calculateEngagementTrend(t,e)}}}async generatePerformanceReport(){const e=this.performanceMetrics;return{systemHealth:{overall:this.calculateOverallHealth(),responseTime:{average:this.calculateAverage(e.responseTime),p95:this.calculatePercentile(e.responseTime,95),trend:this.calculateTrend(e.responseTime)},errorRate:this.calculateErrorRate(),uptime:this.calculateUptime()},benchmarks:this.compareToBenchmarks("system_performance"),alerts:this.getPerformanceAlerts(),recommendations:this.getPerformanceRecommendations()}}async generateBehaviorReport(){return{userJourney:this.analyzeUserJourneys(),engagementPatterns:this.analyzeEngagementPatterns(),featureAdoption:this.analyzeFeatureAdoption(),retentionMetrics:this.calculateRetentionMetrics(),segmentation:this.segmentUsers(),churnRisk:this.identifyChurnRisk()}}async generateMarketReport(){return{trends:Array.from(this.marketIntelligence.trends.values()).slice(-10),correlations:Array.from(this.marketIntelligence.correlations.values()),anomalies:this.marketIntelligence.anomalies.slice(-20),predictions:Array.from(this.marketIntelligence.predictions.values()),alerts:this.marketIntelligence.alerts.slice(-10),signals:this.generateTradingSignals()}}compareToBenchmarks(e){const t=this.benchmarks.get(e);if(!t)return null;const r=this.getCurrentMetrics(e),a={};for(const[s,n]of Object.entries(t)){a[s]={};for(const[e,t]of Object.entries(n)){const n=r[e];void 0!==n&&(a[s][e]={current:n,benchmark:t,ratio:n/t,status:this.getBenchmarkStatus(n,t,e)})}}return a}async identifyPatterns(){return{userBehavior:this.identifyBehaviorPatterns(),performance:this.identifyPerformancePatterns(),market:this.identifyMarketPatterns(),usage:this.identifyUsagePatterns()}}async generatePredictions(){return{userGrowth:this.predictUserGrowth(),performance:this.predictPerformanceTrends(),market:this.predictMarketMovements(),churn:this.predictUserChurn()}}getCurrentAnalytics(){return{usage:this.getUsageMetrics(),performance:this.getPerformanceMetrics(),behavior:this.getBehaviorMetrics(),market:this.getMarketMetrics()}}getHistoricalTrends(e,t="30d"){const r=this.analytics.get(e)||[],a=Date.now()-this.parsePeriod(t);return r.filter(e=>e.timestamp>a).sort((e,t)=>e.timestamp-t.timestamp)}getActionableInsights(){const e=[],t=Array.from(this.insights.values()).pop();return t&&(e.push(...t.optimizations),e.push(...t.alerts)),e.sort((e,t)=>t.priority-e.priority)}exportData(e="json",t={}){const r={analytics:Array.from(this.analytics.entries()),behavior:Array.from(this.userBehavior.entries()),performance:Array.from(this.performanceMetrics.entries()),insights:Array.from(this.insights.entries()),reports:Array.from(this.automatedReports.entries())};return t.startDate||t.endDate,"csv"===e?this.convertToCSV(r):JSON.stringify(r,null,2)}getSessionId(){return sessionStorage.getItem("bi_session_id")||"anonymous"}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}parsePeriod(e){const t=e.match(/^(\d+)([dhm])$/);return t?parseInt(t[1])*{d:864e5,h:36e5,m:6e4}[t[2]]:864e5}calculateAverage(e){return e&&0!==e.length?e.reduce((e,t)=>e+t,0)/e.length:0}calculatePercentile(e,t){if(!e||0===e.length)return 0;const r=[...e].sort((e,t)=>e-t),a=Math.ceil(t/100*r.length)-1;return r[Math.max(0,a)]}async cleanup(){try{this.reportingInterval&&clearInterval(this.reportingInterval),this.insightGenerationInterval&&clearInterval(this.insightGenerationInterval),await this.processBatch("analytics"),await this.processBatch("behavior"),await this.processBatch("performance"),this.analytics.clear(),this.userBehavior.clear(),this.performanceMetrics.clear(),this.marketIntelligence.clear(),this.automatedReports.clear(),this.insights.clear(),this.isInitialized=!1,this.emit("cleanup")}catch(e){}}identifyTrends(e){return[]}findCorrelations(e){return[]}detectAnomalies(e){return[]}generateTradingSignals(e){return[]}analyzeSession(e){return{}}getMemoryUsage(){return{used:0,total:0}}getTimingMetrics(){return{}}getErrorMetrics(){return{}}getUserExperienceMetrics(){return{}}updatePageViewMetrics(e){}updateFeatureUsageMetrics(e){}updateInteractionMetrics(e){}updateBehaviorPatterns(e){}aggregatePerformanceMetrics(e){return{}}updatePerformanceTrends(e){}detectSystemAnomalies(){return[]}suggestOptimizations(){return[]}generateAlerts(){return[]}countSessions(e,t){return 0}countUniqueUsers(e,t){return 0}calculateAverageSessionDuration(e,t){return 0}getTopFeatures(e,t){return[]}countPageViews(e,t){return 0}calculateEngagementMetrics(e,t){return{}}calculateGrowthRate(e,t,r){return 0}calculateEngagementTrend(e,t){return 0}calculateOverallHealth(){return 100}calculateErrorRate(){return 0}calculateUptime(){return 99.9}getPerformanceAlerts(){return[]}getPerformanceRecommendations(){return[]}analyzeUserJourneys(){return{}}analyzeEngagementPatterns(){return{}}analyzeFeatureAdoption(){return{}}calculateRetentionMetrics(){return{}}segmentUsers(){return{}}identifyChurnRisk(){return[]}getCurrentMetrics(e){return{}}getBenchmarkStatus(e,t,r){return"good"}identifyBehaviorPatterns(){return[]}identifyPerformancePatterns(){return[]}identifyMarketPatterns(){return[]}identifyUsagePatterns(){return[]}predictUserGrowth(){return{}}predictPerformanceTrends(){return{}}predictMarketMovements(){return{}}predictUserChurn(){return[]}getUsageMetrics(){return{}}getPerformanceMetrics(){return{}}getBehaviorMetrics(){return{}}getMarketMetrics(){return{}}calculateTrend(e){return 0}generateRecommendations(){return[]}convertToCSV(e){return""}}const r=new t;export{r as b};
//# sourceMappingURL=businessIntelligenceService-DTE7ncSd.js.map
