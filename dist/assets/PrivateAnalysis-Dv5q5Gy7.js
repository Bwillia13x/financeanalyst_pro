import{j as e}from"./index-BBZS0tJJ.js";import{r as s,R as t}from"./react-vendor-BaLqnLcQ.js";import{H as a}from"./Header-DCHnwTqO.js";import{B as i}from"./Button-DrWX1msp.js";import{d as r,p as l,F as n,c as o,q as c,l as d,r as m,e as x,m as u,s as h,t as p,u as g,v as b,w as y,E as j,x as f,y as v,P as N,i as w,I as C,n as k,U as R,j as M,S,z as F,Z as D,G as I,g as A,H as E,D as P,T as O,J as T,N as V,O as B,Q as q,R as z,b as L,V as G,C as $,Y as U,_ as W,B as _,$ as K,f as Y,a0 as H,a1 as Q,a2 as J,a3 as X,X as Z,a4 as ee,a5 as se,a6 as te,a7 as ae,a8 as ie,a9 as re,aa as le}from"./ui-vendor-BKcgCImL.js";import{R as ne,B as oe,C as ce,X as de,Y as me,T as xe,a as ue,f as he,g as pe,h as ge,d as be,e as ye,L as je,A as fe,c as ve,S as Ne,b as we}from"./charts-vendor-sFhs1sQW.js";import{a as Ce,l as ke}from"./lboModelingEngine-DSAML38E.js";import{g as Re,b as Me,f as Se}from"./defaultFinancialData-BqNGcy_-.js";import{b as Fe}from"./dcfCalculations-jtFyFocw.js";import"./utils-vendor-Cj_bvvWu.js";const De=new class{constructor(){this.workers=[],this.isRunning=!1,this.currentSimulation=null}async runDCFSimulation(e,s,t={}){const{iterations:a=1e4,confidenceLevel:i=.95,correlationMatrix:r=null,randomSeed:l=null}=t;Ce.log("INFO","Starting DCF Monte Carlo simulation",{iterations:a,variables:Object.keys(s).length}),this.isRunning=!0;const n=Date.now();try{l&&this.setSeed(l);const o=this.generateCorrelatedSamples(s,a,r),c=[],d=t.onProgress;for(let t=0;t<a;t++){if(!this.isRunning)throw new Error("Simulation cancelled");const i=this.createScenarioInputs(e,o[t],s),r=this.calculateDCFScenario(i);c.push({iteration:t+1,pricePerShare:r.pricePerShare,enterpriseValue:r.enterpriseValue,upside:r.upside,inputs:i}),d&&t%Math.floor(a/100)===0&&d(t/a*100)}const m=this.analyzeResults(c,i),x=Date.now();return Ce.log("INFO","DCF Monte Carlo simulation completed",{iterations:a,duration:x-n,meanPrice:m.statistics.mean}),{type:"DCF_MONTE_CARLO",timestamp:(new Date).toISOString(),parameters:{iterations:a,confidenceLevel:i,randomSeed:l},results:c,analysis:m,duration:x-n}}catch(o){throw this.isRunning=!1,Ce.log("ERROR","DCF Monte Carlo simulation failed",{error:o.message}),o}finally{this.isRunning=!1}}async runLBOSimulation(e,s,t={}){const{iterations:a=1e4,confidenceLevel:i=.95,correlationMatrix:r=null,randomSeed:l=null}=t;Ce.log("INFO","Starting LBO Monte Carlo simulation",{iterations:a,variables:Object.keys(s).length}),this.isRunning=!0;const n=Date.now();try{l&&this.setSeed(l);const o=this.generateCorrelatedSamples(s,a,r),c=[],d=t.onProgress;for(let t=0;t<a;t++){if(!this.isRunning)throw new Error("Simulation cancelled");const i=this.createScenarioInputs(e,o[t],s),r=this.calculateLBOScenario(i);c.push({iteration:t+1,irr:r.irr,moic:r.moic,totalReturn:r.totalReturn,inputs:i}),d&&t%Math.floor(a/100)===0&&d(t/a*100)}const m=this.analyzeResults(c,i,["irr","moic","totalReturn"]),x=Date.now();return Ce.log("INFO","LBO Monte Carlo simulation completed",{iterations:a,duration:x-n,meanIRR:m.statistics.irr?.mean}),{type:"LBO_MONTE_CARLO",timestamp:(new Date).toISOString(),parameters:{iterations:a,confidenceLevel:i,randomSeed:l},results:c,analysis:m,duration:x-n}}catch(o){throw this.isRunning=!1,Ce.log("ERROR","LBO Monte Carlo simulation failed",{error:o.message}),o}finally{this.isRunning=!1}}generateCorrelatedSamples(e,s,t){const a=Object.keys(e),i=a.length,r=[],l=[];for(let n=0;n<s;n++){const s={};a.forEach(t=>{const a=e[t];s[t]=this.sampleFromDistribution(a)}),l.push(s)}if(t&&t.length===i){const e=this.choleskyDecomposition(t);for(let t=0;t<s;t++){const s={},i=a.map(e=>l[t][e]),n=this.applyCorrelation(i,e);a.forEach((e,t)=>{s[e]=n[t]}),r.push(s)}}else r.push(...l);return r}sampleFromDistribution(e){const{type:s,parameters:t}=e;switch(s){case"normal":return this.normalRandom(t.mean,t.stdDev);case"lognormal":const e=this.normalRandom(t.mu,t.sigma);return Math.exp(e);case"uniform":return t.min+Math.random()*(t.max-t.min);case"triangular":return this.triangularRandom(t.min,t.mode,t.max);case"beta":return this.betaRandom(t.alpha,t.beta);case"exponential":return this.exponentialRandom(t.lambda);case"weibull":return this.weibullRandom(t.shape,t.scale);case"pareto":return this.paretoRandom(t.scale,t.shape);case"student_t":return this.studentTRandom(t.df);case"chi_squared":return this.chiSquaredRandom(t.df);default:throw new Error(`Unsupported distribution type: ${s}`)}}exponentialRandom(e){return-Math.log(1-Math.random())/e}weibullRandom(e,s){const t=Math.random();return s*Math.pow(-Math.log(1-t),1/e)}paretoRandom(e,s){const t=Math.random();return e/Math.pow(t,1/s)}studentTRandom(e){if(e<=0)throw new Error("Degrees of freedom must be positive");const s=this.normalRandom(0,1),t=this.chiSquaredRandom(e);return s/Math.sqrt(t/e)}chiSquaredRandom(e){if(e<=0)throw new Error("Degrees of freedom must be positive");return 2*this.gammaRandom(e/2)}normalRandom(e=0,s=1){if(void 0!==this.spareNormal){const t=this.spareNormal;return this.spareNormal=void 0,t*s+e}const t=Math.random(),a=Math.random(),i=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*a),r=Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*a);return this.spareNormal=r,i*s+e}triangularRandom(e,s,t){const a=Math.random();return a<(s-e)/(t-e)?e+Math.sqrt(a*(t-e)*(s-e)):t-Math.sqrt((1-a)*(t-e)*(t-s))}betaRandom(e,s){const t=this.gammaRandom(e);return t/(t+this.gammaRandom(s))}gammaRandom(e){if(!(e>=1))return this.gammaRandom(e+1)*Math.pow(Math.random(),1/e);{const s=e-1/3,t=1/Math.sqrt(9*s);for(;;){let e,a;do{e=this.normalRandom(),a=1+t*e}while(a<=0);a*=a*a;const i=Math.random();if(i<1-.0331*e*e*e*e)return s*a;if(Math.log(i)<.5*e*e+s*(1-a+Math.log(a)))return s*a}}}choleskyDecomposition(e){const s=e.length,t=Array(s).fill().map(()=>Array(s).fill(0));for(let a=0;a<s;a++)for(let s=0;s<=a;s++)if(a===s){let a=0;for(let e=0;e<s;e++)a+=t[s][e]*t[s][e];t[s][s]=Math.sqrt(e[s][s]-a)}else{let i=0;for(let e=0;e<s;e++)i+=t[a][e]*t[s][e];t[a][s]=(e[a][s]-i)/t[s][s]}return t}applyCorrelation(e,s){const t=e.length,a=Array(t).fill(0);for(let i=0;i<t;i++)for(let t=0;t<=i;t++)a[i]+=s[i][t]*e[t];return a}createScenarioInputs(e,s,t){const a={...e};return Object.entries(s).forEach(([e,s])=>{const i=t[e];i.applyTo?a[i.applyTo]=s:a[e]=s}),a}calculateDCFScenario(e){const{currentRevenue:s=1e9,revenueGrowthRate:t=.1,fcfMargin:a=.15,wacc:i=.1,terminalGrowthRate:r=.025,sharesOutstanding:l=1e8,currentPrice:n=100}=e;let o=0,c=s;for(let x=1;x<=5;x++){c*=1+t;o+=c*a/Math.pow(1+i,x)}const d=o+c*a*(1+r)/(i-r)/Math.pow(1+i,5),m=d/l;return{pricePerShare:m,enterpriseValue:d,upside:(m-n)/n*100}}calculateLBOScenario(e){const{ebitda:s=1e8,ebitdaGrowthRate:t=.05,exitMultiple:a=10,debtMultiple:i=5,holdingPeriod:r=5}=e,l=s*i,n=10*s-l,o=s*Math.pow(1+t,r)*a-.5*l,c=o/n;return{irr:Math.pow(c,1/r)-1,moic:c,totalReturn:o}}analyzeResults(e,s,t=["pricePerShare","enterpriseValue","upside"]){const a={statistics:{},percentiles:{},confidenceIntervals:{},riskMetrics:{},distributionTests:{},correlations:{}};return t.forEach(t=>{const i=e.map(e=>e[t]).filter(e=>null!==e&&!isNaN(e)).sort((e,s)=>e-s);if(0===i.length)return;const r=i.reduce((e,s)=>e+s,0)/i.length,l=i.reduce((e,s)=>e+Math.pow(s-r,2),0)/i.length,n=Math.sqrt(l),o=Math.sqrt(l*i.length/(i.length-1));a.statistics[t]={mean:r,median:this.percentile(i,.5),mode:this.calculateMode(i),stdDev:n,sampleStdDev:o,variance:l,min:i[0],max:i[i.length-1],range:i[i.length-1]-i[0],count:i.length,trimmedMean:this.calculateTrimmedMean(i,.1),mad:this.calculateMAD(i),iqr:this.percentile(i,.75)-this.percentile(i,.25)},a.percentiles[t]={p1:this.percentile(i,.01),p5:this.percentile(i,.05),p10:this.percentile(i,.1),p25:this.percentile(i,.25),p50:this.percentile(i,.5),p75:this.percentile(i,.75),p90:this.percentile(i,.9),p95:this.percentile(i,.95),p99:this.percentile(i,.99)};const c=1-s,d=this.percentile(i,c/2),m=this.percentile(i,1-c/2);a.confidenceIntervals[t]={level:s,lowerBound:d,upperBound:m,width:m-d,bootstrapCI:this.calculateBootstrapCI(i,s)};const x=this.percentile(i,.05),u=this.percentile(i,.01),h=i.slice(0,Math.floor(.05*i.length)).reduce((e,s)=>e+s,0)/Math.floor(.05*i.length),p=i.slice(0,Math.floor(.01*i.length)).reduce((e,s)=>e+s,0)/Math.floor(.01*i.length);a.riskMetrics[t]={var95:x,var99:u,cvar95:h,cvar99:p,skewness:this.calculateSkewness(i,r,n),kurtosis:this.calculateKurtosis(i,r,n),excessKurtosis:this.calculateKurtosis(i,r,n)-3,expectedShortfall:h,maxDrawdown:this.calculateMaxDrawdown(i),sharpeRatio:this.calculateSharpeRatio(i,.02),sortinoRatio:this.calculateSortinoRatio(i,r)},a.distributionTests[t]={jarqueBera:this.jarqueBeraTest(i),kolmogorovSmirnov:this.ksTestNormality(i),shapiroWilk:i.length<=5e3?this.shapiroWilkTest(i):null}}),t.length>1&&(a.correlations=this.calculateCorrelationMatrix(e,t)),a}calculateMode(e){const s={};e.forEach(e=>{const t=Math.round(100*e)/100;s[t]=(s[t]||0)+1});const t=Math.max(...Object.values(s)),a=Object.keys(s).filter(e=>s[e]===t);return 1===a.length?parseFloat(a[0]):null}calculateTrimmedMean(e,s=.1){const t=Math.floor(e.length*s),a=e.slice(t,-t||void 0);return a.reduce((e,s)=>e+s,0)/a.length}calculateMAD(e){const s=this.percentile(e,.5),t=e.map(e=>Math.abs(e-s)).sort((e,s)=>e-s);return this.percentile(t,.5)}calculateBootstrapCI(e,s,t=1e3){const a=[];for(let r=0;r<t;r++){const s=[];for(let t=0;t<e.length;t++)s.push(e[Math.floor(Math.random()*e.length)]);a.push(s.reduce((e,s)=>e+s,0)/s.length)}a.sort((e,s)=>e-s);const i=1-s;return{lowerBound:this.percentile(a,i/2),upperBound:this.percentile(a,1-i/2)}}calculateMaxDrawdown(e){let s=e[0],t=0;for(const a of e){a>s&&(s=a);const e=(s-a)/s;e>t&&(t=e)}return t}calculateSharpeRatio(e,s=.02){const t=e.reduce((e,s)=>e+s,0)/e.length,a=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length,i=Math.sqrt(a);return i>0?(t-s)/i:0}calculateSortinoRatio(e,s){const t=e.map(e=>e-s),a=t.filter(e=>e<0);if(0===a.length)return 1/0;const i=Math.sqrt(a.reduce((e,s)=>e+s*s,0)/a.length),r=t.reduce((e,s)=>e+s,0)/t.length;return i>0?r/i:0}jarqueBeraTest(e){const s=e.length,t=e.reduce((e,s)=>e+s,0)/s,a=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/s,i=Math.sqrt(a),r=this.calculateSkewness(e,t,i),l=this.calculateKurtosis(e,t,i),n=s/6*(Math.pow(r,2)+Math.pow(l-3,2)/4),o=1-this.chiSquaredCDF(n,2);return{statistic:n,pValue:o,isNormal:o>.05}}chiSquaredCDF(e,s){return e<=0?0:this.incompleteGamma(s/2,e/2)}incompleteGamma(e,s){if(0===s)return 0;if(s<e+1){let t=1/e,a=1/e;for(let i=1;i<100&&(a*=s/(e+i),t+=a,!(a<1e-15));i++);return Math.exp(-s+e*Math.log(s)-this.logGamma(e))*t}return 1-this.incompleteGamma(e,s)}logGamma(e){const s=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let t=0,a=1.000000000190015,i=e,r=i=e,l=e+5.5;for(l-=(e+.5)*Math.log(l);t<6;t++)a+=s[t]/++r;return-l+Math.log(2.5066282746310007*a/i)}ksTestNormality(e){const s=e.length,t=e.reduce((e,s)=>e+s,0)/s,a=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/s,i=Math.sqrt(a);let r=0;for(let n=0;n<s;n++){const a=(n+1)/s,l=this.normalCDF((e[n]-t)/i),o=Math.abs(a-l);o>r&&(r=o)}const l=1.36/Math.sqrt(s);return{statistic:r,critical:l,isNormal:r<l}}normalCDF(e){return.5*(1+this.erf(e/Math.sqrt(2)))}erf(e){const s=e<0?-1:1,t=1/(1+.3275911*(e=Math.abs(e)));return s*(1-((((1.061405429*t-1.453152027)*t+1.421413741)*t-.284496736)*t+.254829592)*t*Math.exp(-e*e))}shapiroWilkTest(e){const s=e.length;if(s<3||s>5e3)return null;const t=[...e].sort((e,s)=>e-s),a=e.reduce((e,s)=>e+s,0)/s;let i=0;for(let l=0;l<s;l++)i+=Math.pow(t[l]-a,2);const r=0/i;return{statistic:r,isNormal:r>.9}}calculateCorrelationMatrix(e,s){const t={};for(let a=0;a<s.length;a++){t[s[a]]={};for(let i=0;i<s.length;i++)if(a===i)t[s[a]][s[i]]=1;else{const r=e.map(e=>e[s[a]]).filter(e=>null!==e&&!isNaN(e)),l=e.map(e=>e[s[i]]).filter(e=>null!==e&&!isNaN(e));t[s[a]][s[i]]=this.calculateCorrelation(r,l)}}return t}calculateCorrelation(e,s){if(e.length!==s.length||0===e.length)return 0;const t=e.length,a=e.reduce((e,s)=>e+s,0)/t,i=s.reduce((e,s)=>e+s,0)/t;let r=0,l=0,n=0;for(let c=0;c<t;c++){const t=e[c]-a,o=s[c]-i;r+=t*o,l+=t*t,n+=o*o}const o=Math.sqrt(l*n);return o>0?r/o:0}percentile(e,s){const t=s*(e.length-1),a=Math.floor(t),i=Math.ceil(t),r=t-a;return a===i?e[a]:e[a]*(1-r)+e[i]*r}calculateSkewness(e,s,t){const a=e.length;return a/((a-1)*(a-2))*e.reduce((e,a)=>e+Math.pow((a-s)/t,3),0)}calculateKurtosis(e,s,t){const a=e.length;return a*(a+1)/((a-1)*(a-2)*(a-3))*e.reduce((e,a)=>e+Math.pow((a-s)/t,4),0)-3*Math.pow(a-1,2)/((a-2)*(a-3))}setSeed(e){this.seed=e,this.random=()=>(this.seed=(9301*this.seed+49297)%233280,this.seed/233280),Math.random=this.random}stopSimulation(){this.isRunning=!1}isSimulationRunning(){return this.isRunning}},Ie=({data:a,onDataChange:i,onAdjustedValuesChange:x})=>{const[u,h]=s.useState("incomeStatement"),[p,g]=s.useState({}),[b,y]=s.useState({revenue:!0,costOfGoodsSold:!0,operatingExpenses:!0,salariesBenefits:!0,grossProfit:!0,operatingIncome:!0,incomeBeforeTax:!0,otherIncomeExpense:!0,currentAssets:!0,nonCurrentAssets:!0,currentLiabilities:!0,nonCurrentLiabilities:!0,equity:!0,operatingActivities:!0,investingActivities:!0,financingActivities:!0}),[j,f]=s.useState(null),[v,N]=s.useState(""),w=s.useRef(null);s.useEffect(()=>{if(a?.statements?.incomeStatement&&0===Object.keys(p).length){const e={},s=a.statements.incomeStatement;Object.keys(s).forEach(t=>{s[t]&&void 0!==s[t][2]&&(e[t]=s[t][2])}),g(e),x&&x(e)}},[a,p,x]);const C={revenue:{title:"Revenue",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"energyDevices",label:"Energy Devices",level:1},{key:"injectables",label:"Injectables",level:1},{key:"wellness",label:"Wellness",level:1},{key:"weightloss",label:"Weightloss",level:1},{key:"retailSales",label:"Retail Sales",level:1},{key:"surgery",label:"Surgery",level:1},{key:"totalRevenue",label:"Total Revenue",level:0,bold:!0,formula:!0}]},costOfGoodsSold:{title:"Cost of Goods Sold",color:"bg-red-50 border-red-300",headerBg:"bg-red-600",textColor:"text-red-900",items:[{key:"energyDeviceSupplies",label:"Energy Device Supplies",level:1},{key:"injectablesCogs",label:"Injectables",level:1},{key:"wellnessCogs",label:"Wellness",level:1},{key:"weightlossCogs",label:"Weightloss",level:1},{key:"retailProducts",label:"Retail Products",level:1},{key:"surgicalSupplies",label:"Surgical Supplies",level:1},{key:"totalCostOfGoodsSold",label:"Total Cost of Goods Sold",level:0,bold:!0,formula:!0}]},grossProfit:{title:"Gross Profit",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"grossProfit",label:"Gross Profit",level:0,bold:!0,formula:!0}]},salariesBenefits:{title:"Salaries & Benefits",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"employeeBenefits",label:"Employee Benefits",level:1},{key:"payroll",label:"Payroll",level:1},{key:"payrollTaxes",label:"Payroll Taxes",level:1},{key:"totalSalariesBenefits",label:"Total Salaries & Benefits",level:0,bold:!0,formula:!0}]},operatingExpenses:{title:"Operating Expenses",color:"bg-orange-50 border-orange-300",headerBg:"bg-orange-600",textColor:"text-orange-900",items:[{key:"marketing",label:"Marketing",level:1},{key:"automobile",label:"Automobile",level:1},{key:"creditCardBankCharges",label:"Credit Card and Bank Charges",level:1},{key:"donations",label:"Donations",level:1},{key:"computerTelephoneUtilities",label:"Computer, Telephone, and Utilities",level:1},{key:"depreciation",label:"Depreciation",level:1},{key:"duesSubscriptions",label:"Dues & Subscriptions",level:1},{key:"education",label:"Education",level:1},{key:"equipmentRental",label:"Equipment Rental",level:1},{key:"insurance",label:"Insurance",level:1},{key:"interestExpense",label:"Interest Expense",level:1},{key:"travelMealsEntertainment",label:"Travel, Meals, and Entertainment",level:1},{key:"rent",label:"Rent",level:1},{key:"officeExpenses",label:"Office Expenses",level:1},{key:"professionalFees",label:"Professional Fees",level:1},{key:"repairsMaintenance",label:"Repairs & Maintenance",level:1},{key:"localTax",label:"Local Tax",level:1},{key:"stateTax",label:"State Tax",level:1},{key:"totalOperatingExpense",label:"Total Operating Expense",level:0,bold:!0,formula:!0}]},operatingIncome:{title:"Operating Income",color:"bg-teal-50 border-teal-300",headerBg:"bg-teal-600",textColor:"text-teal-900",items:[{key:"operatingIncome",label:"Operating Income",level:0,bold:!0}]},otherIncomeExpense:{title:"Other Income / (Expense)",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-600",textColor:"text-slate-900",items:[{key:"gainOnAssetSale",label:"Gain (Loss) On Asset Sale",level:1},{key:"interestIncome",label:"Interest Income",level:1},{key:"otherExpenses",label:"Other Expenses",level:1},{key:"totalOtherIncomeExpense",label:"Total Other Income / (Expenses)",level:0,bold:!0,formula:!0}]},incomeBeforeTax:{title:"Net Income Before Taxes",color:"bg-amber-50 border-amber-300",headerBg:"bg-amber-600",textColor:"text-amber-900",items:[{key:"incomeBeforeTax",label:"Net Income Before Taxes",level:0,bold:!0}]}},k={currentAssets:{title:"Current Assets",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"cash",label:"Cash and Cash Equivalents",level:1},{key:"receivables",label:"Accounts Receivable",level:1},{key:"inventory",label:"Inventory",level:1},{key:"prepaidExpenses",label:"Prepaid Expenses",level:1},{key:"otherCurrentAssets",label:"Other Current Assets",level:1},{key:"totalCurrentAssets",label:"Total Current Assets",level:0,formula:!0,bold:!0}]},nonCurrentAssets:{title:"Non-Current Assets",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"ppe",label:"Property, Plant & Equipment",level:1},{key:"accumulatedDepreciation",label:"Less: Accumulated Depreciation",level:1},{key:"netPPE",label:"Net Property, Plant & Equipment",level:1,formula:!0},{key:"intangibleAssets",label:"Intangible Assets",level:1},{key:"goodwill",label:"Goodwill",level:1},{key:"otherNonCurrentAssets",label:"Other Non-Current Assets",level:1},{key:"totalNonCurrentAssets",label:"Total Non-Current Assets",level:0,formula:!0,bold:!0}]},totalAssets:{title:"Total Assets",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalAssets",label:"Total Assets",level:0,formula:!0,bold:!0}]},currentLiabilities:{title:"Current Liabilities",color:"bg-red-50 border-red-300",headerBg:"bg-red-600",textColor:"text-red-900",items:[{key:"accountsPayable",label:"Accounts Payable",level:1},{key:"accruedExpenses",label:"Accrued Expenses",level:1},{key:"shortTermDebt",label:"Short-term Debt",level:1},{key:"currentPortionLongTermDebt",label:"Current Portion of Long-term Debt",level:1},{key:"otherCurrentLiabilities",label:"Other Current Liabilities",level:1},{key:"totalCurrentLiabilities",label:"Total Current Liabilities",level:0,formula:!0,bold:!0}]},nonCurrentLiabilities:{title:"Non-Current Liabilities",color:"bg-orange-50 border-orange-300",headerBg:"bg-orange-600",textColor:"text-orange-900",items:[{key:"longTermDebt",label:"Long-term Debt",level:1},{key:"deferredTaxLiabilities",label:"Deferred Tax Liabilities",level:1},{key:"otherNonCurrentLiabilities",label:"Other Non-Current Liabilities",level:1},{key:"totalNonCurrentLiabilities",label:"Total Non-Current Liabilities",level:0,formula:!0,bold:!0}]},totalLiabilities:{title:"Total Liabilities",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalLiabilities",label:"Total Liabilities",level:0,formula:!0,bold:!0}]},equity:{title:"Shareholders' Equity",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"commonStock",label:"Common Stock",level:1},{key:"retainedEarnings",label:"Retained Earnings",level:1},{key:"otherEquity",label:"Other Comprehensive Income",level:1},{key:"totalEquity",label:"Total Shareholders' Equity",level:0,formula:!0,bold:!0}]},totalLiabilitiesEquity:{title:"Total Liabilities and Equity",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalLiabilitiesEquity",label:"Total Liabilities and Shareholders' Equity",level:0,formula:!0,bold:!0}]}},R={operatingActivities:{title:"Operating Activities",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"netIncome",label:"Net Income",level:1},{key:"depreciation",label:"Depreciation and Amortization",level:1},{key:"receivablesChange",label:"Change in Accounts Receivable",level:1},{key:"inventoryChange",label:"Change in Inventory",level:1},{key:"payablesChange",label:"Change in Accounts Payable",level:1},{key:"otherOperatingChanges",label:"Other Operating Changes",level:1},{key:"netCashFromOperating",label:"Net Cash from Operating Activities",level:0,formula:!0,bold:!0}]},investingActivities:{title:"Investing Activities",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"capex",label:"Capital Expenditures",level:1},{key:"acquisitions",label:"Acquisitions",level:1},{key:"assetSales",label:"Asset Sales",level:1},{key:"otherInvestingActivities",label:"Other Investing Activities",level:1},{key:"netCashFromInvesting",label:"Net Cash from Investing Activities",level:0,formula:!0,bold:!0}]},financingActivities:{title:"Financing Activities",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"debtIssuance",label:"Debt Issuance",level:1},{key:"debtRepayment",label:"Debt Repayment",level:1},{key:"equityIssuance",label:"Equity Issuance",level:1},{key:"dividends",label:"Dividends Paid",level:1},{key:"otherFinancingActivities",label:"Other Financing Activities",level:1},{key:"netCashFromFinancing",label:"Net Cash from Financing Activities",level:0,formula:!0,bold:!0}]},netCashFlow:{title:"Net Cash Flow",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"netCashFlow",label:"Net Change in Cash",level:0,formula:!0,bold:!0},{key:"beginningCash",label:"Cash at Beginning of Period",level:1},{key:"endingCash",label:"Cash at End of Period",level:0,formula:!0,bold:!0}]}},M=(()=>{switch(u){case"balanceSheet":return k;case"cashFlow":return R;default:return C}})(),S=(e,s,t=!1)=>{f({rowKey:e,periodIndex:s,isAdjusted:t});let i="";i=t?p[e]||"":a.statements.incomeStatement[e]?.[s]||"",N(i.toString())},F=()=>{if(j){const{rowKey:e,periodIndex:s,isAdjusted:t}=j,r=parseFloat(v)||0;if(t){const s={...p,[e]:r};g(s),x&&x(s)}else{const t={...a};t.statements.incomeStatement[e]||(t.statements.incomeStatement[e]={}),t.statements.incomeStatement[e][s]=r,i(t)}f(null),N("")}},D=e=>{"Enter"===e.key?(e.preventDefault(),F()):"Escape"===e.key?(e.preventDefault(),f(null),N("")):"Tab"===e.key&&(e.preventDefault(),F())},I=e=>/^-?\d*\.?\d*$/.test(e)||""===e,A=e=>{if(!e&&0!==e)return"";const s="string"==typeof e?parseFloat(e):e;if(isNaN(s))return"";const t=Math.abs(s);let a;return t>=1e6?(a=new Intl.NumberFormat("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}).format(s/1e6),a+="M"):a=t>=1e3?new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(s):new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s),a};s.useEffect(()=>{j&&w.current&&(w.current.focus(),w.current.select())},[j]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 pb-8",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 shadow-sm",children:e.jsx("div",{className:"max-w-full mx-auto px-8 py-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(r,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Financial Spreadsheet"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Professional financial modeling workspace"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{const e=prompt('Enter period label (e.g., "Year 5"):');if(e){const s={...a};s.periods=[...s.periods,e],i(s)}},className:"px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium",children:[e.jsx(l,{size:16}),"Add Period"]}),e.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"px-4 py-2.5 bg-white border border-slate-300 rounded-lg text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium shadow-sm",children:[e.jsx("option",{value:"incomeStatement",children:"Income Statement"}),e.jsx("option",{value:"balanceSheet",children:"Balance Sheet"}),e.jsx("option",{value:"cashFlow",children:"Cash Flow Statement"})]})]})]})})}),e.jsxs("div",{className:"max-w-full mx-auto p-8",children:[e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-slate-800 to-slate-900 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"min-w-[320px] px-6 py-4 text-left text-sm font-semibold tracking-wider",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{size:16,className:"text-slate-300"}),"Account Description"]})}),e.jsx("th",{className:"w-20 px-4 py-4 text-center text-sm font-semibold",children:"Units"}),a.periods.map((s,t)=>e.jsx("th",{className:"min-w-[140px] px-4 py-4 text-center text-sm font-semibold",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s}),e.jsx("span",{className:"text-xs text-slate-300 font-normal",children:"Actual"})]})},t)),e.jsx("th",{className:"min-w-[140px] px-4 py-4 text-center text-sm font-semibold bg-gradient-to-r from-amber-600 to-yellow-600 border-l-2 border-amber-400",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:"Adjusted"}),e.jsx("span",{className:"text-xs text-amber-100 font-normal",children:"Modified"})]})}),e.jsx("th",{className:"w-28 px-4 py-4 text-center text-sm font-semibold",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(o,{size:14}),"Type"]})})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:Object.entries(M).map(([s,r])=>e.jsxs(t.Fragment,{children:[e.jsx("tr",{className:`${r.headerBg||"bg-slate-600"} border-b-2 border-slate-300`,children:e.jsx("td",{colSpan:a.periods.length+4,className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-white w-full text-left group",children:[e.jsxs("button",{onClick:()=>(e=>{y(s=>({...s,[e]:!s[e]}))})(s),className:"flex items-center gap-3 text-white hover:text-slate-200 transition-colors flex-1",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-white/20 group-hover:bg-white/30 transition-colors",children:b[s]?e.jsx(c,{size:14}):e.jsx(d,{size:14})}),e.jsx("span",{className:"font-bold text-lg",children:r.title})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),(()=>{if(prompt("Enter row label:")){const e={...a};i(e)}})()},className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"Add custom row",children:e.jsx(l,{size:16})})]})})}),b[s]&&r.items.map(s=>(s=>{const{key:t,label:i,level:r,formula:l,bold:n}=s,c=1===r?"pl-8":2===r?"pl-12":"pl-4",d=n?"font-bold":0===r?"font-semibold":"font-medium",x=0===r?"text-slate-900":"text-slate-700",u=0===r?"bg-slate-50/70":"bg-white",h=0===r?"border-slate-200":"border-slate-100";return e.jsxs("tr",{className:`${u} border-b ${h} hover:bg-slate-50 transition-all duration-150 group`,children:[e.jsx("td",{className:`px-6 py-4 ${c} ${d} text-sm ${x}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[0===r&&e.jsx("div",{className:"w-1.5 h-4 bg-gradient-to-b from-blue-500 to-blue-600 rounded-full flex-shrink-0 shadow-sm"}),e.jsx("span",{className:"leading-tight",children:i}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{size:14,className:"text-blue-500/80 flex-shrink-0"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium px-1.5 py-0.5 bg-blue-50 rounded-md",children:"AUTO"})]})]})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-100 px-2 py-1 rounded-md",children:"$ 000s"})}),a.periods.map((s,i)=>e.jsx("td",{className:"px-4 py-4 text-right",children:j?.rowKey!==t||j?.periodIndex!==i||j?.isAdjusted?e.jsxs("div",{onClick:()=>!l&&S(t,i),className:"px-3 py-2.5 rounded-lg font-mono text-sm transition-all duration-200 min-h-[40px] flex items-center justify-end "+(l?"bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800 font-semibold border border-blue-200 shadow-sm":"hover:bg-slate-100 text-slate-800 cursor-pointer border border-transparent hover:border-slate-200 hover:shadow-sm group-hover:bg-slate-50"),children:[e.jsx("span",{className:l?"text-blue-900":"text-slate-700",children:A(a.statements.incomeStatement[t]?.[i])||"—"}),!l&&e.jsx(m,{size:12,className:"ml-2 opacity-0 group-hover:opacity-40 text-slate-400 transition-opacity"})]}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:w,type:"text",value:v,onChange:e=>{const s=e.target.value;I(s)&&N(s)},onBlur:F,onKeyDown:D,className:"w-full px-3 py-2.5 bg-white border-2 border-blue-400 rounded-lg text-slate-900 text-right font-mono text-sm focus:outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-500 shadow-lg",placeholder:"0.00"}),e.jsxs("div",{className:"absolute -top-2 -right-2 flex gap-1",children:[e.jsx("button",{onClick:F,className:"w-5 h-5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"✓"}),e.jsx("button",{onClick:()=>{f(null),N("")},className:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"×"})]})]})},i)),e.jsx("td",{className:"px-4 py-4 text-right bg-gradient-to-r from-amber-50 to-yellow-50 border-l-2 border-amber-300",children:j?.rowKey===t&&j?.isAdjusted?e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:w,type:"text",value:v,onChange:e=>{const s=e.target.value;I(s)&&N(s)},onBlur:F,onKeyDown:D,className:"w-full px-3 py-2.5 bg-white border-2 border-amber-400 rounded-lg text-slate-900 text-right font-mono text-sm focus:outline-none focus:ring-4 focus:ring-amber-100 focus:border-amber-500 shadow-lg",placeholder:"0.00"}),e.jsxs("div",{className:"absolute -top-2 -right-2 flex gap-1",children:[e.jsx("button",{onClick:F,className:"w-5 h-5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"✓"}),e.jsx("button",{onClick:()=>{f(null),N("")},className:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"×"})]})]}):e.jsxs("div",{onClick:()=>!l&&S(t,null,!0),className:"px-3 py-2.5 rounded-lg font-mono text-sm transition-all duration-200 min-h-[40px] flex items-center justify-end "+(l?"bg-gradient-to-r from-amber-100 to-yellow-100 text-amber-800 font-semibold border border-amber-300 shadow-sm":"hover:bg-amber-100 text-slate-800 cursor-pointer border border-transparent hover:border-amber-300 hover:shadow-sm"),children:[e.jsx("span",{className:l?"text-amber-900":"text-slate-700",children:A(p[t]||0)||"—"}),!l&&e.jsx(m,{size:12,className:"ml-2 opacity-0 group-hover:opacity-40 text-amber-500 transition-opacity"})]})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium "+(l?"bg-blue-100 text-blue-800 border border-blue-200":"bg-slate-100 text-slate-700 border border-slate-200"),children:l?e.jsxs(e.Fragment,{children:[e.jsx(o,{size:10,className:"mr-1"}),"Auto"]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{size:10,className:"mr-1"}),"Manual"]})})})]},t)})(s))]},s))})]})})}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(o,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"font-bold text-slate-900",children:"How to Use"})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Click any editable cell to modify values with enhanced input controls"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Use Enter to save changes or Escape to cancel editing"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Expand/collapse sections using the arrow controls"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Formula cells automatically calculate based on inputs"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(r,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"font-bold text-slate-900",children:"Professional Features"})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Color-coded sections for easy visual navigation"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Adjusted column for scenario analysis and modifications"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Professional number formatting with proper alignment"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Enhanced editing experience with save/cancel controls"]})]})]})]})]})]})},Ae=({data:t,modelInputs:a,onModelInputChange:i,calculateDCF:n,formatCurrency:o,formatPercent:c})=>{const[d,m]=s.useState(!1),b=a.scenario?.scenarios||[],y=s.useMemo(()=>b.map(e=>{try{const s={...t.statements.incomeStatement},a=s.totalRevenue||{},i={};Object.keys(a).forEach(s=>{const t=parseInt(s);if(0===t)i[s]=a[s];else{const r=1+e.revenueGrowth/100;i[s]=a[0]*Math.pow(r,t)}});const r=s.operatingIncome||{},l={};Object.keys(r).forEach(s=>{if(0===parseInt(s))l[s]=r[s];else{const t=a[s]||0,n=i[s]||0,o=r[s]||0;if(t>0){const a=o/t+e.marginImprovement/100;l[s]=n*a}else l[s]=o}});const o={...t,statements:{...t.statements,incomeStatement:{...s,totalRevenue:i,operatingIncome:l}}},c=n(o);return{...e,...c,weightedValue:c.enterpriseValue*(e.probability/100)}}catch(s){return{...e,enterpriseValue:0,equityValue:0,weightedValue:0}}}),[b,t,n]),j=y.reduce((e,s)=>e+s.weightedValue,0),f=(e,s,t)=>{const a=b.map((a,i)=>i===e?{...a,[s]:t}:a);i("scenario","scenarios",a)},v=({scenario:s,index:t})=>e.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scenario Name"}),e.jsx("input",{type:"text",value:s.name,onChange:e=>f(t,"name",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter scenario name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Probability (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:s.probability,onChange:e=>f(t,"probability",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue Growth (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.revenueGrowth,onChange:e=>f(t,"revenueGrowth",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margin Change (%)"}),e.jsx("input",{type:"number",step:"0.1",value:s.marginImprovement,onChange:e=>f(t,"marginImprovement",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("div",{className:"flex justify-end mt-4 gap-2",children:e.jsxs("button",{onClick:()=>(e=>{const s=b.filter((s,t)=>t!==e);i("scenario","scenarios",s)})(t),className:"px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(g,{size:16}),"Delete"]})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("p",{className:"text-gray-600",children:"Create and compare multiple financial scenarios with different assumptions and probabilities."})}),e.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(l,{size:16}),"Add Scenario"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Assumptions"}),b.map((s,t)=>e.jsx(v,{scenario:s,index:t},t)),d&&e.jsx("div",{className:"border-2 border-dashed border-blue-300 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h5",{className:"font-medium",children:"Add New Scenario"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const e={name:`Scenario ${b.length+1}`,probability:Math.max(0,100-b.reduce((e,s)=>e+s.probability,0)),revenueGrowth:10,marginImprovement:0};i("scenario","scenarios",[...b,e]),m(!1)},className:"px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Add"}),e.jsx("button",{onClick:()=>m(!1),className:"px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})})]}),y.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Analysis Results"}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(x,{size:20,className:"text-blue-600"}),e.jsx("h5",{className:"font-semibold text-blue-800",children:"Probability-Weighted Valuation"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-800",children:o(j)}),e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"Expected value based on scenario probabilities"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:y.map((s,t)=>e.jsxs(u.div,{className:"bg-white rounded-lg border p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("h6",{className:"font-semibold text-gray-800",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{children:[s.probability,"% probability"]}),s.revenueGrowth>15?e.jsx(r,{size:14,className:"text-green-500"}):s.revenueGrowth<5?e.jsx(h,{size:14,className:"text-red-500"}):e.jsx(p,{size:14,className:"text-gray-500"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Enterprise Value"}),e.jsx("div",{className:"text-xl font-bold text-gray-800",children:o(s.enterpriseValue)})]}),e.jsxs("div",{className:"text-xs space-y-1 text-gray-600",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Revenue Growth:"}),e.jsx("span",{className:"font-medium",children:c(s.revenueGrowth)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Margin Change:"}),e.jsxs("span",{className:"font-medium "+(s.marginImprovement>=0?"text-green-600":"text-red-600"),children:[s.marginImprovement>=0?"+":"",c(s.marginImprovement)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Weighted Value:"}),e.jsx("span",{className:"font-medium",children:o(s.weightedValue)})]})]})]})]},t))}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h5",{className:"font-semibold mb-4",children:"Scenario Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o(Math.max(...y.map(e=>e.enterpriseValue)))}),e.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o(Math.min(...y.map(e=>e.enterpriseValue)))}),e.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o(j)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:o(Math.max(...y.map(e=>e.enterpriseValue))-Math.min(...y.map(e=>e.enterpriseValue)))}),e.jsx("div",{className:"text-sm text-gray-600",children:"Value Range"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Total Probability:"})," ",b.reduce((e,s)=>e+s.probability,0),"%",100!==b.reduce((e,s)=>e+s.probability,0)&&e.jsx("span",{className:"text-orange-600 ml-2",children:"⚠ Probabilities should sum to 100%"})]})})]})]}),0===b.length&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(x,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No scenarios created yet."}),e.jsx("p",{className:"text-sm mt-2",children:'Click "Add Scenario" to get started with scenario modeling.'})]})]})},Ee=({data:t,modelInputs:a,onModelInputChange:i,calculateDCF:r,formatCurrency:n,formatPercent:o})=>{const[c,d]=s.useState(null),m=a.sensitivity||{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},u={revenue:{name:"Revenue Growth",unit:"%",description:"Annual revenue growth rate",baseValue:15,isPercentage:!0},grossMargin:{name:"Gross Margin",unit:"%",description:"Gross profit margin improvement",baseValue:45,isPercentage:!0},discountRate:{name:"Discount Rate (WACC)",unit:"%",description:"Weighted average cost of capital",baseValue:a.dcf?.discountRate||10,isPercentage:!0},terminalGrowthRate:{name:"Terminal Growth Rate",unit:"%",description:"Long-term growth rate assumption",baseValue:a.dcf?.terminalGrowthRate||2.5,isPercentage:!0},taxRate:{name:"Tax Rate",unit:"%",description:"Corporate tax rate",baseValue:a.dcf?.taxRate||25,isPercentage:!0}},h=s.useMemo(()=>r(),[t,a,r]),g=s.useMemo(()=>{const e={};return m.variables.forEach(s=>{const i=m.ranges[s],r=u[s];if(!i||!r)return;const l=(i.max-i.min)/8,n=[];for(let e=0;e<9;e++){const o=i.min+l*e;let c={...t},d={...a.dcf,[s]:(r.isPercentage,o)};if("revenue"===s||"grossMargin"===s){const e={...t.statements.incomeStatement};if("revenue"===s){const s=e.totalRevenue||{},t={};Object.keys(s).forEach(e=>{const a=parseInt(e);if(0===a)t[e]=s[e];else{const i=1+o/100;t[e]=s[0]*Math.pow(i,a)}}),e.totalRevenue=t}if("grossMargin"===s){const s=e.operatingIncome||{},t=e.totalRevenue||{},a={};Object.keys(s).forEach(e=>{const i=t[e]||0,r=s[e]||0;if(i>0){const s=r/i+o/100;a[e]=i*s}else a[e]=r}),e.operatingIncome=a}c={...t,statements:{...t.statements,incomeStatement:e}}}const m=(()=>{try{const e={discountRate:d.discountRate||10,terminalGrowthRate:d.terminalGrowthRate||2.5,projectionYears:d.projectionYears||5,taxRate:d.taxRate||25},s=c.statements.incomeStatement.operatingIncome||{};let t=[];if(Object.keys(s).forEach(e=>{parseInt(e)>=0&&t.push(s[e]||0)}),0===t.length)return{enterpriseValue:0,equityValue:0};let a=0;const i=1+e.discountRate/100;t.forEach((s,t)=>{if(t>0&&t<=e.projectionYears){const r=s*(1-e.taxRate/100)/Math.pow(i,t);a+=r}});const r=t[t.length-1]||0,l=r*(1+e.terminalGrowthRate/100)*(1-e.taxRate/100)/((e.discountRate-e.terminalGrowthRate)/100),n=l/Math.pow(i,e.projectionYears),o=a+n;return{enterpriseValue:o,equityValue:o,presentValueOperations:a,presentValueTerminal:n,terminalValue:l}}catch(e){return{enterpriseValue:0,equityValue:0}}})();n.push({variable:o,valuation:m.enterpriseValue,changeFromBase:(m.enterpriseValue-h.enterpriseValue)/h.enterpriseValue*100})}e[s]={definition:r,range:i,dataPoints:n}}),e},[t,a,m,h,r]),j=s.useMemo(()=>Object.entries(g).map(([e,s])=>{const t=Math.max(...s.dataPoints.map(e=>Math.abs(e.changeFromBase)));return{variable:e,definition:s.definition,maxImpact:t,positiveImpact:Math.max(...s.dataPoints.map(e=>e.changeFromBase)),negativeImpact:Math.min(...s.dataPoints.map(e=>e.changeFromBase))}}).sort((e,s)=>s.maxImpact-e.maxImpact),[g]),f=(e,s,t)=>{const a={...m.ranges,[e]:{...m.ranges[e],[s]:parseFloat(t)}};i("sensitivity","ranges",a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Analyze how changes in key variables impact enterprise valuation. Higher sensitivity indicates greater risk and importance for due diligence."}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsxs("span",{children:["Base Case: ",n(h.enterpriseValue)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{size:14}),e.jsxs("span",{children:[m.variables.length," variables analyzed"]})]})]})]}),e.jsxs("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[e.jsx(y,{size:16}),"Configure"]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("h4",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[e.jsx(x,{size:20}),"Impact Ranking (Tornado Chart)"]}),e.jsx("div",{className:"space-y-3",children:j.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-sm font-medium",children:[t+1,". ",s.definition.name]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["±",s.maxImpact.toFixed(1),"%"]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-100 rounded",children:[e.jsx("div",{className:"absolute left-1/2 h-full bg-red-400 rounded-l",style:{width:Math.abs(s.negativeImpact)/Math.max(Math.abs(s.negativeImpact),s.positiveImpact)*50+"%",transform:"translateX(-100%)"}}),e.jsx("div",{className:"absolute left-1/2 h-full bg-green-400 rounded-r",style:{width:s.positiveImpact/Math.max(Math.abs(s.negativeImpact),s.positiveImpact)*50+"%"}}),e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-400 transform -translate-x-0.5"}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-between px-2 text-xs font-medium text-white",children:[e.jsxs("span",{children:[s.negativeImpact.toFixed(1),"%"]}),e.jsxs("span",{children:["+",s.positiveImpact.toFixed(1),"%"]})]})]})]},s.variable))})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Variable Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[m.variables.map(s=>{const t=g[s];return t?e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium",children:t.definition.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.definition.description})]}),e.jsx("button",{onClick:()=>(e=>{const s=m.variables.filter(s=>s!==e),{[e]:t,...a}=m.ranges;i("sensitivity","variables",s),i("sensitivity","ranges",a)})(s),className:"text-red-500 hover:bg-red-50 p-1 rounded",children:e.jsx(p,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Min Value (",t.definition.unit,")"]}),e.jsx("input",{type:"number",step:"0.1",value:t.range.min,onChange:e=>f(s,"min",e.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Max Value (",t.definition.unit,")"]}),e.jsx("input",{type:"number",step:"0.1",value:t.range.max,onChange:e=>f(s,"max",e.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"h-16 bg-gray-50 rounded p-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Valuation Sensitivity"}),e.jsx("div",{className:"flex items-end justify-between h-8",children:t.dataPoints.map((s,a)=>e.jsx("div",{className:"w-1 rounded-t "+(s.changeFromBase>0?"bg-green-400":s.changeFromBase<0?"bg-red-400":"bg-blue-400"),style:{height:Math.abs(s.changeFromBase)/50*100+"%",minHeight:"2px"},title:`${s.variable}${t.definition.unit}: ${n(s.valuation)}`},a))})]})]},s):null}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(l,{size:24,className:"mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Add Variable"}),e.jsx("div",{className:"space-y-2",children:Object.keys(u).filter(e=>!m.variables.includes(e)).map(s=>e.jsx("button",{onClick:()=>(e=>{if(!m.variables.includes(e)&&u[e]){const s=[...m.variables,e],t={...m.ranges,[e]:{min:-10,max:10}};i("sensitivity","variables",s),i("sensitivity","ranges",t)}})(s),className:"block w-full px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:u[s].name},s))})]})})]})]}),c&&g[c]&&e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("h4",{className:"font-semibold text-lg mb-4",children:["Detailed Analysis: ",g[c].definition.name]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium mb-3",children:"Data Points"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:g[c].dataPoints.map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-gray-50 rounded",children:[e.jsxs("span",{children:[s.variable,g[c].definition.unit]}),e.jsx("span",{className:"font-medium",children:n(s.valuation)}),e.jsxs("span",{className:"font-medium "+(s.changeFromBase>0?"text-green-600":s.changeFromBase<0?"text-red-600":"text-gray-600"),children:[s.changeFromBase>0?"+":"",s.changeFromBase.toFixed(1),"%"]})]},t))})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Range Impact:"}),e.jsxs("span",{className:"font-medium",children:["±",Math.max(...g[c].dataPoints.map(e=>Math.abs(e.changeFromBase))).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Max Upside:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["+",Math.max(...g[c].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Max Downside:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[Math.min(...g[c].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]})]})]})]})]})]})},Pe=({dcfData:t,sensitivityData:a,scenarioData:i,formatCurrency:l,formatPercent:n})=>{const[o,c]=s.useState("dcf-waterfall"),[d,m]=s.useState(!0),h=[{id:"dcf-waterfall",label:"DCF Waterfall",icon:x,category:"dcf"},{id:"cashflow-trend",label:"Cash Flow Trend",icon:r,category:"dcf"},{id:"sensitivity-tornado",label:"Sensitivity Tornado",icon:b,category:"sensitivity"},{id:"scenario-distribution",label:"Scenario Distribution",icon:v,category:"scenario"},{id:"valuation-bridge",label:"Valuation Bridge",icon:x,category:"combined"}],p=s.useMemo(()=>{if(!t?.years)return[];let e=0;const s=[];t.years.forEach((t,a)=>{const i=e;e+=t.presentValue,s.push({name:`Year ${t.year}`,value:t.presentValue,cumulative:e,start:i,freeCashFlow:t.freeCashFlow,category:"operations"})});const a=e;return e+=t.presentValueTerminal,s.push({name:"Terminal Value",value:t.presentValueTerminal,cumulative:e,start:a,category:"terminal"}),s},[t]),g=s.useMemo(()=>t?.years?t.years.map((e,s)=>({year:`Year ${e.year}`,freeCashFlow:e.freeCashFlow,presentValue:e.presentValue,revenue:e.revenue,operatingIncome:e.operatingIncome,workingCapitalChange:e.workingCapitalChange,capex:Math.abs(e.capex)})):[],[t]),y=s.useMemo(()=>a?Object.entries(a).map(([e,s])=>{const t=Math.max(...s.dataPoints.map(e=>e.changeFromBase)),a=Math.min(...s.dataPoints.map(e=>e.changeFromBase));return{variable:s.definition.name,upside:t,downside:Math.abs(a),range:t-a}}).sort((e,s)=>s.range-e.range):[],[a]),N=s.useMemo(()=>i?.length?i.map((e,s)=>({name:e.name,value:e.enterpriseValue,probability:e.probability,weightedValue:e.weightedValue,fill:`hsl(${137.5*s%360}, 70%, 50%)`})):[],[i]),w=({active:s,payload:t,label:a,chartType:i})=>{if(!s||!t||!t.length)return null;return e.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-800",children:a}),t.map((s,t)=>{return e.jsx("p",{style:{color:s.color},className:"text-sm",children:`${s.dataKey}: ${a=s.value,i=s.dataKey,i?.includes("Percent")||i?.includes("Rate")?n(a):l(a)}`},t);var a,i})]})},C=()=>e.jsx(ne,{width:"100%",height:400,children:e.jsxs(oe,{data:p,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{tickFormatter:e=>l(e)}),e.jsx(xe,{content:e.jsx(w,{chartType:"waterfall"})}),e.jsx(ue,{dataKey:"value",fill:"#3B82F6"})]})}),k=()=>e.jsx(ne,{width:"100%",height:400,children:e.jsxs(be,{data:g,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"year"}),e.jsx(me,{tickFormatter:e=>l(e)}),e.jsx(xe,{content:e.jsx(w,{chartType:"trend"})}),e.jsx(ye,{}),e.jsx(je,{type:"monotone",dataKey:"freeCashFlow",stroke:"#10B981",strokeWidth:3,name:"Free Cash Flow"}),e.jsx(je,{type:"monotone",dataKey:"presentValue",stroke:"#3B82F6",strokeWidth:2,name:"Present Value"}),e.jsx(je,{type:"monotone",dataKey:"revenue",stroke:"#8B5CF6",strokeWidth:2,name:"Revenue"})]})}),R=()=>e.jsx(ne,{width:"100%",height:400,children:e.jsxs(oe,{data:y,layout:"horizontal",margin:{top:20,right:30,left:100,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{type:"number",tickFormatter:e=>`${e.toFixed(1)}%`}),e.jsx(me,{type:"category",dataKey:"variable"}),e.jsx(xe,{formatter:(e,s)=>[`${e.toFixed(1)}%`,s],labelFormatter:e=>`Variable: ${e}`}),e.jsx(ue,{dataKey:"upside",fill:"#10B981",name:"Upside Impact"}),e.jsx(ue,{dataKey:"downside",fill:"#EF4444",name:"Downside Impact"})]})}),M=()=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ne,{width:"100%",height:300,children:e.jsxs(he,{children:[e.jsx(pe,{data:N,cx:"50%",cy:"50%",outerRadius:80,dataKey:"probability",label:({name:e,probability:s})=>`${e}: ${s}%`,children:N.map((s,t)=>e.jsx(ge,{fill:s.fill},`cell-${t}`))}),e.jsx(xe,{formatter:e=>`${e}%`})]})}),e.jsx(ne,{width:"100%",height:300,children:e.jsxs(oe,{data:N,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{tickFormatter:e=>l(e)}),e.jsx(xe,{content:e.jsx(w,{chartType:"scenario"})}),e.jsx(ue,{dataKey:"value",fill:"#8B5CF6",name:"Enterprise Value"})]})})]}),S=()=>{const s=[{name:"PV of Operations",value:t?.cumulativePV||0,type:"positive"},{name:"PV of Terminal",value:t?.presentValueTerminal||0,type:"positive"},{name:"Enterprise Value",value:t?.enterpriseValue||0,type:"total"}];return e.jsx(ne,{width:"100%",height:400,children:e.jsxs(oe,{data:s,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{tickFormatter:e=>l(e)}),e.jsx(xe,{content:e.jsx(w,{chartType:"bridge"})}),e.jsx(ue,{dataKey:"value",fill:e=>"total"===e.type?"#1F2937":"#3B82F6"})]})})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[e.jsx(x,{size:20}),"Data Visualization"]}),e.jsx("p",{className:"text-gray-600",children:"Interactive charts and graphs to visualize valuation results and sensitivity analysis."})]}),e.jsxs("button",{onClick:()=>m(!d),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 "+(d?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:[d?e.jsx(j,{size:14}):e.jsx(f,{size:14}),d?"Hide Details":"Show Details"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:h.map(s=>{const t=s.icon;return e.jsxs(u.button,{onClick:()=>c(s.id),className:"p-3 rounded-lg border-2 transition-all text-center "+(o===s.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(t,{size:20,className:"mx-auto mb-2"}),e.jsx("div",{className:"text-xs font-medium",children:s.label})]},s.id)})}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"font-semibold text-lg",children:h.find(e=>e.id===o)?.label}),d&&e.jsx("span",{className:"text-sm text-gray-500",children:(()=>{switch(o){case"dcf-waterfall":return"Shows the contribution of each year's cash flows and terminal value to total enterprise value.";case"cashflow-trend":return"Displays the trend of free cash flows, present values, and key financial metrics over time.";case"sensitivity-tornado":return"Illustrates how changes in key variables impact enterprise value, ranked by sensitivity.";case"scenario-distribution":return"Compares different scenarios by probability weights and resulting enterprise values.";case"valuation-bridge":return"Breaks down enterprise value into operating value and terminal value components.";default:return""}})()})]}),e.jsx("div",{className:"min-h-[400px]",children:(()=>{switch(o){case"dcf-waterfall":default:return e.jsx(C,{});case"cashflow-trend":return e.jsx(k,{});case"sensitivity-tornado":return e.jsx(R,{});case"scenario-distribution":return e.jsx(M,{});case"valuation-bridge":return e.jsx(S,{})}})()})]}),d&&e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Key Insights"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:["dcf-waterfall"===o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Operations Contribution"}),e.jsx("div",{className:"text-lg font-bold text-blue-800",children:t?.cumulativePV?`${(t.cumulativePV/t.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Terminal Contribution"}),e.jsx("div",{className:"text-lg font-bold text-purple-800",children:t?.presentValueTerminal?`${(t.presentValueTerminal/t.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Avg. Annual FCF"}),e.jsx("div",{className:"text-lg font-bold text-green-800",children:t?.freeCashFlows?l(t.freeCashFlows.reduce((e,s)=>e+s,0)/t.freeCashFlows.length):"N/A"})]})]}),"sensitivity-tornado"===o&&y.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Highest Risk Variable"}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:y[0]?.variable}),e.jsxs("div",{className:"text-sm text-red-600",children:["±",y[0]?.range.toFixed(1),"% impact"]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-yellow-600 font-medium",children:"Medium Risk Variables"}),e.jsx("div",{className:"text-lg font-bold text-yellow-800",children:y.slice(1,3).map(e=>e.variable).join(", ")})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Lowest Risk Variable"}),e.jsx("div",{className:"text-lg font-bold text-green-800",children:y[y.length-1]?.variable})]})]})]})]})]})},Oe=({modelInputs:t,onModelInputChange:a,formatPercent:i})=>{const[l,n]=s.useState(!0),[c,d]=s.useState("inputs"),m=t.dcf.wacc||{riskFreeRate:4.5,marketRiskPremium:6,beta:1.2,smallCompanyPremium:3,companySpecificRisk:2,debtInterestRate:6.5,taxRate:25,marketValueEquity:1e5,marketValueDebt:3e4,buildUpMethod:{riskFreeRate:4.5,equityRiskPremium:6,sizeRiskPremium:3,industryRiskPremium:2,companySpecificRisk:2},industryWACC:10.5,industryBeta:1.1,industryDebtEquityRatio:.3},x=s.useMemo(()=>{const e={...m,...t.dcf.wacc},s=e.riskFreeRate+e.beta*e.marketRiskPremium+e.smallCompanyPremium+e.companySpecificRisk,a=e.buildUpMethod.riskFreeRate+e.buildUpMethod.equityRiskPremium+e.buildUpMethod.sizeRiskPremium+e.buildUpMethod.industryRiskPremium+e.buildUpMethod.companySpecificRisk,i=e.debtInterestRate*(1-e.taxRate/100),r=e.marketValueEquity+e.marketValueDebt,l=e.marketValueEquity/r,n=e.marketValueDebt/r,o=s/100*l+i/100*n,c=a/100*l+i/100*n;return{costOfEquityCAPM:s,costOfEquityBuildUp:a,costOfDebtAfterTax:i,equityWeight:100*l,debtWeight:100*n,waccCAPM:100*o,waccBuildUp:100*c,finalWACC:100*((o+c)/2),totalCapital:r,debtToEquityRatio:e.marketValueDebt/e.marketValueEquity}},[m,t.dcf.wacc]),h=(e,s)=>{const i={...m,...t.dcf.wacc,[e]:parseFloat(s)||0};a("dcf","wacc",i)},p=[{id:"inputs",label:"Inputs",icon:y},{id:"calculation",label:"Calculation",icon:o},{id:"benchmarks",label:"Benchmarks",icon:r}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[e.jsx(o,{size:20}),"WACC Calculator"]}),e.jsx("p",{className:"text-gray-600",children:"Professional weighted average cost of capital calculation using CAPM and build-up methods."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{return e=x.finalWACC,void a("dcf","discountRate",e);var e},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Apply to DCF"}),e.jsx("button",{onClick:()=>n(!l),className:"px-3 py-2 rounded-lg text-sm transition-colors "+(l?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-600"),children:l?"Hide Details":"Show Details"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(u.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(N,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"FINAL WACC"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:i(x.finalWACC)}),e.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Risk-adjusted average"})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(r,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"COST OF EQUITY"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:i(x.costOfEquityCAPM)}),e.jsx("div",{className:"text-sm text-green-600 mt-1",children:"CAPM method"})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(w,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"COST OF DEBT"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:i(x.costOfDebtAfterTax)}),e.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"After-tax"})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(C,{size:20,className:"text-orange-600"}),e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"DEBT/EQUITY"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[x.debtToEquityRatio.toFixed(2),"x"]}),e.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Capital structure"})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:p.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>d(s.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(c===s.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[e.jsx(t,{size:16}),s.label]},s.id)})}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["inputs"===c&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"WACC Input Parameters"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"Cost of Equity (CAPM Method)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Risk-Free Rate (%)"}),e.jsx("input",{type:"number",step:"0.1",value:t.dcf.wacc?.riskFreeRate||m.riskFreeRate,onChange:e=>h("riskFreeRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"10-year Treasury rate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Risk Premium (%)"}),e.jsx("input",{type:"number",step:"0.1",value:t.dcf.wacc?.marketRiskPremium||m.marketRiskPremium,onChange:e=>h("marketRiskPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Expected market return - risk-free rate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Beta (β)"}),e.jsx("input",{type:"number",step:"0.1",value:t.dcf.wacc?.beta||m.beta,onChange:e=>h("beta",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Systematic risk relative to market"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Small Company Premium (%)"}),e.jsx("input",{type:"number",step:"0.1",value:t.dcf.wacc?.smallCompanyPremium||m.smallCompanyPremium,onChange:e=>h("smallCompanyPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Size-related risk premium"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company-Specific Risk (%)"}),e.jsx("input",{type:"number",step:"0.1",value:t.dcf.wacc?.companySpecificRisk||m.companySpecificRisk,onChange:e=>h("companySpecificRisk",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Unsystematic risk premium"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-4 text-purple-800",children:"Capital Structure & Cost of Debt"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Equity ($000s)"}),e.jsx("input",{type:"number",value:t.dcf.wacc?.marketValueEquity||m.marketValueEquity,onChange:e=>h("marketValueEquity",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Debt ($000s)"}),e.jsx("input",{type:"number",value:t.dcf.wacc?.marketValueDebt||m.marketValueDebt,onChange:e=>h("marketValueDebt",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre-Tax Cost of Debt (%)"}),e.jsx("input",{type:"number",step:"0.1",value:t.dcf.wacc?.debtInterestRate||m.debtInterestRate,onChange:e=>h("debtInterestRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Interest rate on debt"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),e.jsx("input",{type:"number",step:"0.1",value:t.dcf.wacc?.taxRate||t.dcf.taxRate,onChange:e=>h("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Corporate tax rate"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h6",{className:"font-medium mb-2",children:"Capital Structure"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Equity Weight:"}),e.jsx("span",{className:"font-medium",children:i(x.equityWeight)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Debt Weight:"}),e.jsx("span",{className:"font-medium",children:i(x.debtWeight)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{children:"Total Capital:"}),e.jsxs("span",{className:"font-medium",children:["$",(x.totalCapital/1e3).toFixed(0),"M"]})]})]})]})]})]})]})]}),"calculation"===c&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"WACC Calculation Breakdown"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"CAPM Method"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Risk-Free Rate:"}),e.jsx("span",{className:"font-medium",children:i(t.dcf.wacc?.riskFreeRate||m.riskFreeRate)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beta × Market Risk Premium:"}),e.jsx("span",{className:"font-medium",children:i((t.dcf.wacc?.beta||m.beta)*(t.dcf.wacc?.marketRiskPremium||m.marketRiskPremium))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Small Company Premium:"}),e.jsx("span",{className:"font-medium",children:i(t.dcf.wacc?.smallCompanyPremium||m.smallCompanyPremium)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Company-Specific Risk:"}),e.jsx("span",{className:"font-medium",children:i(t.dcf.wacc?.companySpecificRisk||m.companySpecificRisk)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[e.jsx("span",{children:"Cost of Equity (CAPM):"}),e.jsx("span",{children:i(x.costOfEquityCAPM)})]})]})]}),e.jsxs("div",{className:"p-6 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h5",{className:"font-medium mb-4 text-green-800",children:"Build-up Method"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Risk-Free Rate:"}),e.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.riskFreeRate)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Equity Risk Premium:"}),e.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.equityRiskPremium)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Size Risk Premium:"}),e.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.sizeRiskPremium)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Industry Risk Premium:"}),e.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.industryRiskPremium)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Company-Specific Risk:"}),e.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.companySpecificRisk)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[e.jsx("span",{children:"Cost of Equity (Build-up):"}),e.jsx("span",{children:i(x.costOfEquityBuildUp)})]})]})]})]}),e.jsxs("div",{className:"p-6 bg-gray-50 rounded-lg border",children:[e.jsx("h5",{className:"font-medium mb-4",children:"Final WACC Calculation"}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"WACC (CAPM Method):"}),e.jsx("span",{className:"font-medium",children:i(x.waccCAPM)})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["[",i(x.costOfEquityCAPM)," × ",i(x.equityWeight),"] + [",i(x.costOfDebtAfterTax)," × ",i(x.debtWeight),"]"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"WACC (Build-up Method):"}),e.jsx("span",{className:"font-medium",children:i(x.waccBuildUp)})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["[",i(x.costOfEquityBuildUp)," × ",i(x.equityWeight),"] + [",i(x.costOfDebtAfterTax)," × ",i(x.debtWeight),"]"]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Risk-Adjusted WACC:"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:i(x.finalWACC)})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Average of CAPM and Build-up methods"})]})]})]})]}),"benchmarks"===c&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Industry Benchmarks & Validation"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Your Company"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"WACC:"}),e.jsx("span",{className:"font-semibold",children:i(x.finalWACC)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beta:"}),e.jsx("span",{className:"font-semibold",children:(t.dcf.wacc?.beta||m.beta).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"D/E Ratio:"}),e.jsxs("span",{className:"font-semibold",children:[x.debtToEquityRatio.toFixed(2),"x"]})]})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h6",{className:"font-medium text-green-800 mb-2",children:"Industry Average"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"WACC:"}),e.jsx("span",{className:"font-semibold",children:i(m.industryWACC)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beta:"}),e.jsx("span",{className:"font-semibold",children:m.industryBeta.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"D/E Ratio:"}),e.jsxs("span",{className:"font-semibold",children:[m.industryDebtEquityRatio.toFixed(2),"x"]})]})]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[e.jsx("h6",{className:"font-medium text-yellow-800 mb-2",children:"Variance"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"WACC Diff:"}),e.jsxs("span",{className:"font-semibold "+(x.finalWACC>m.industryWACC?"text-red-600":"text-green-600"),children:[x.finalWACC>m.industryWACC?"+":"",i(x.finalWACC-m.industryWACC)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Beta Diff:"}),e.jsxs("span",{className:"font-semibold "+((t.dcf.wacc?.beta||m.beta)>m.industryBeta?"text-red-600":"text-green-600"),children:[(t.dcf.wacc?.beta||m.beta)>m.industryBeta?"+":"",((t.dcf.wacc?.beta||m.beta)-m.industryBeta).toFixed(2)]})]})]})]})]}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(k,{size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Validation Guidelines"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• WACC should be within ±2% of industry average for similar companies"}),e.jsx("li",{children:"• Beta should reflect business risk relative to market (typically 0.8-1.5 for most companies)"}),e.jsx("li",{children:"• Cost of equity should exceed risk-free rate by at least 4-6% for private companies"}),e.jsx("li",{children:"• Debt/equity ratio should align with industry norms and company strategy"}),e.jsx("li",{children:"• Consider economic conditions and company-specific factors"})]})]})]})})]})]})]})},Te=({data:t,modelInputs:a,onModelInputChange:i,formatCurrency:l,formatPercent:n})=>{const[c,d]=s.useState(!1),[m,h]=s.useState(!0),[p,g]=s.useState("results"),b=s.useMemo(()=>{const{discountRate:e,terminalGrowthRate:s,projectionYears:i,taxRate:r}=a.dcf,l=t.statements,n=a.dcf.workingCapital||{receivablesDays:45,inventoryDays:60,payablesDays:30},o=a.dcf.capex||{capexAsPercentOfRevenue:3.5,depreciationRate:7},c={years:[],freeCashFlows:[],presentValues:[],workingCapitalChanges:[],capexAmounts:[],unleveredFreeCashFlow:[],cumulativePV:0,terminalValue:0,presentValueTerminal:0,enterpriseValue:0,equityValue:0,impliedShare:0},d=l.incomeStatement.totalRevenue?.[0]||1e5;for(let t=1;t<=i;t++){const s={year:t,revenue:l.incomeStatement.totalRevenue?.[t]||0,operatingIncome:l.incomeStatement.operatingIncome?.[t]||0,nopat:0,workingCapitalChange:0,capex:0,depreciation:0,freeCashFlow:0,presentValue:0};s.nopat=s.operatingIncome*(1-r/100);const a=s.revenue,i=t>1?l.incomeStatement.totalRevenue?.[t-1]||0:d,m=a*n.receivablesDays/365,x=a*n.inventoryDays/365,u=a*n.payablesDays/365,h=m-i*n.receivablesDays/365,p=x-i*n.inventoryDays/365,g=u-i*n.payablesDays/365;s.workingCapitalChange=-(h+p-g),s.capex=-a*o.capexAsPercentOfRevenue/100,s.depreciation=Math.abs(s.capex)/o.depreciationRate,s.freeCashFlow=s.nopat+s.depreciation+s.capex+s.workingCapitalChange;const b=Math.pow(1+e/100,t);s.presentValue=s.freeCashFlow/b,c.years.push(s),c.freeCashFlows.push(s.freeCashFlow),c.presentValues.push(s.presentValue),c.workingCapitalChanges.push(s.workingCapitalChange),c.capexAmounts.push(s.capex),c.unleveredFreeCashFlow.push(s.freeCashFlow),c.cumulativePV+=s.presentValue}const m=(c.years[c.years.length-1]?.freeCashFlow||0)*(1+s/100);c.terminalValue=m/((e-s)/100);const x=Math.pow(1+e/100,i);c.presentValueTerminal=c.terminalValue/x,c.enterpriseValue=c.cumulativePV+c.presentValueTerminal;c.equityValue=c.enterpriseValue-0;const u=a.dcf.sharesOutstanding||1e3;return c.impliedShare=c.equityValue/u,c},[t,a]),j=(e,s,t)=>{const r={...a.dcf,[e]:{...a.dcf[e],[s]:parseFloat(t)||0}};i("dcf",e,r[e])},f=(e,s)=>{i("dcf",e,parseFloat(s)||0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[e.jsx(o,{size:20}),"Advanced DCF Valuation"]}),e.jsx("p",{className:"text-gray-600",children:"Professional-grade DCF with working capital analysis, capex modeling, and detailed cash flow projections."})]}),e.jsx("div",{className:"flex gap-2",children:["results","charts","wacc","assumptions"].map(s=>e.jsxs("button",{onClick:()=>g(s),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 "+(p===s?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:["results"===s&&e.jsx(w,{size:14}),"charts"===s&&e.jsx(x,{size:14}),"wacc"===s&&e.jsx(o,{size:14}),"assumptions"===s&&e.jsx(y,{size:14}),s.charAt(0).toUpperCase()+s.slice(1)]},s))})]}),"results"===p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(u.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(w,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"ENTERPRISE VALUE"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:l(b.enterpriseValue)}),e.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["PV Operations: ",l(b.cumulativePV)]})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(r,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EQUITY VALUE"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:l(b.equityValue)}),e.jsxs("div",{className:"text-sm text-blue-600 mt-1",children:["Per Share: ",l(b.impliedShare)]})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(x,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"TERMINAL VALUE"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-800",children:l(b.terminalValue)}),e.jsxs("div",{className:"text-sm text-purple-600 mt-1",children:["PV: ",l(b.presentValueTerminal)]})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(C,{size:20,className:"text-orange-600"}),e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"IMPLIED MULTIPLE"})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[(b.enterpriseValue/(t.statements.incomeStatement.totalRevenue?.[1]||1)).toFixed(1),"x"]}),e.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"EV/Revenue (Year 1)"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Detailed Cash Flow Analysis"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Year"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Operating Income"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"NOPAT"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Depreciation"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Capex"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"ΔWorking Capital"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Free Cash Flow"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Present Value"})]})}),e.jsxs("tbody",{children:[b.years.map((s,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium",children:s.year}),e.jsx("td",{className:"p-3 text-right",children:l(s.revenue)}),e.jsx("td",{className:"p-3 text-right",children:l(s.operatingIncome)}),e.jsx("td",{className:"p-3 text-right",children:l(s.nopat)}),e.jsxs("td",{className:"p-3 text-right text-green-600",children:["+",l(s.depreciation)]}),e.jsx("td",{className:"p-3 text-right text-red-600",children:l(s.capex)}),e.jsxs("td",{className:"p-3 text-right "+(s.workingCapitalChange>=0?"text-green-600":"text-red-600"),children:[s.workingCapitalChange>=0?"+":"",l(s.workingCapitalChange)]}),e.jsx("td",{className:"p-3 text-right font-medium",children:l(s.freeCashFlow)}),e.jsx("td",{className:"p-3 text-right font-medium",children:l(s.presentValue)})]},t)),e.jsxs("tr",{className:"border-b-2 border-gray-300 bg-blue-50",children:[e.jsx("td",{className:"p-3 font-bold",children:"Terminal"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3 text-right font-bold",children:l(b.terminalValue)}),e.jsx("td",{className:"p-3 text-right font-bold",children:l(b.presentValueTerminal)})]}),e.jsxs("tr",{className:"bg-gray-100 font-bold",children:[e.jsx("td",{className:"p-3",children:"TOTAL"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3 text-right text-lg",children:l(b.enterpriseValue)})]})]})]})})]})]}),"charts"===p&&e.jsx(Pe,{dcfData:b,sensitivityData:null,scenarioData:null,formatCurrency:l,formatPercent:n}),"wacc"===p&&e.jsx(Oe,{modelInputs:a,onModelInputChange:i,formatPercent:n}),"assumptions"===p&&e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Model Assumptions"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Core Assumptions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Rate (WACC) %"}),e.jsx("input",{type:"number",step:"0.1",value:a.dcf.discountRate,onChange:e=>f("discountRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terminal Growth Rate %"}),e.jsx("input",{type:"number",step:"0.1",value:a.dcf.terminalGrowthRate,onChange:e=>f("terminalGrowthRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate %"}),e.jsx("input",{type:"number",step:"0.1",value:a.dcf.taxRate,onChange:e=>f("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Working Capital"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Receivables (Days)"}),e.jsx("input",{type:"number",value:a.dcf.workingCapital?.receivablesDays||45,onChange:e=>j("workingCapital","receivablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Inventory (Days)"}),e.jsx("input",{type:"number",value:a.dcf.workingCapital?.inventoryDays||60,onChange:e=>j("workingCapital","inventoryDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payables (Days)"}),e.jsx("input",{type:"number",value:a.dcf.workingCapital?.payablesDays||30,onChange:e=>j("workingCapital","payablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Capital Expenditure"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capex (% of Revenue)"}),e.jsx("input",{type:"number",step:"0.1",value:a.dcf.capex?.capexAsPercentOfRevenue||3.5,onChange:e=>j("capex","capexAsPercentOfRevenue",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Depreciation Period (Years)"}),e.jsx("input",{type:"number",value:a.dcf.capex?.depreciationRate||7,onChange:e=>j("capex","depreciationRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shares Outstanding (000s)"}),e.jsx("input",{type:"number",value:a.dcf.sharesOutstanding||1e3,onChange:e=>f("sharesOutstanding",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]})]})]})},Ve=({data:t,formatCurrency:a,formatPercent:i})=>{const[n,o]=s.useState("multiples"),[c,d]=s.useState("ev_revenue"),[m,h]=s.useState(!1),[p,g]=s.useState([{id:1,name:"MedSpa Corp",ticker:"MSPA",marketCap:45e4,enterpriseValue:52e4,revenue:18e4,ebitda:45e3,netIncome:28e3,employees:1200,founded:2015,geography:"US",businessModel:"B2C Medical Spa Chain"},{id:2,name:"Wellness Holdings",ticker:"WELL",marketCap:68e4,enterpriseValue:75e4,revenue:22e4,ebitda:55e3,netIncome:35e3,employees:1800,founded:2012,geography:"US",businessModel:"Integrated Wellness Platform"},{id:3,name:"Aesthetic Solutions Inc",ticker:"AEST",marketCap:32e4,enterpriseValue:38e4,revenue:125e3,ebitda:32e3,netIncome:18e3,employees:850,founded:2018,geography:"US",businessModel:"Medical Device & Services"},{id:4,name:"Premium Health Group",ticker:"PHG",marketCap:92e4,enterpriseValue:105e4,revenue:31e4,ebitda:78e3,netIncome:48e3,employees:2500,founded:2010,geography:"US",businessModel:"Premium Healthcare Services"}]),b=s.useMemo(()=>p.map(e=>({...e,multiples:{ev_revenue:e.enterpriseValue/e.revenue,ev_ebitda:e.enterpriseValue/e.ebitda,pe_ratio:e.marketCap/e.netIncome,revenue_per_employee:e.revenue/e.employees,market_cap_revenue:e.marketCap/e.revenue}})),[p]),y=s.useMemo(()=>{const e=b.map(e=>e.multiples),s=e=>({mean:e.reduce((e,s)=>e+s,0)/e.length,median:e.sort((e,s)=>e-s)[Math.floor(e.length/2)],min:Math.min(...e),max:Math.max(...e),p25:e.sort((e,s)=>e-s)[Math.floor(.25*e.length)],p75:e.sort((e,s)=>e-s)[Math.floor(.75*e.length)]});return{ev_revenue:s(e.map(e=>e.ev_revenue)),ev_ebitda:s(e.map(e=>e.ev_ebitda)),pe_ratio:s(e.map(e=>e.pe_ratio)),revenue_per_employee:s(e.map(e=>e.revenue_per_employee)),market_cap_revenue:s(e.map(e=>e.market_cap_revenue))}},[b]),j=s.useMemo(()=>{const e=t.statements.incomeStatement.totalRevenue?.[1]||1e5,s=1.15*(t.statements.incomeStatement.operatingIncome?.[1]||5e4),a=.7*(t.statements.incomeStatement.operatingIncome?.[1]||5e4);return{ev_revenue:{mean:e*y.ev_revenue.mean,median:e*y.ev_revenue.median,p25:e*y.ev_revenue.p25,p75:e*y.ev_revenue.p75},ev_ebitda:{mean:s*y.ev_ebitda.mean,median:s*y.ev_ebitda.median,p25:s*y.ev_ebitda.p25,p75:s*y.ev_ebitda.p75},pe_ratio:{mean:a*y.pe_ratio.mean,median:a*y.pe_ratio.median,p25:a*y.pe_ratio.p25,p75:a*y.pe_ratio.p75}}},[t,y]),f={ev_revenue:{name:"EV/Revenue",description:"Enterprise Value / Annual Revenue"},ev_ebitda:{name:"EV/EBITDA",description:"Enterprise Value / EBITDA"},pe_ratio:{name:"P/E Ratio",description:"Market Cap / Net Income"},revenue_per_employee:{name:"Revenue/Employee",description:"Revenue per Employee"},market_cap_revenue:{name:"Market Cap/Revenue",description:"Market Cap / Revenue"}},v=[{id:"multiples",label:"Trading Multiples",icon:x},{id:"analysis",label:"Valuation Analysis",icon:M},{id:"companies",label:"Comparable Set",icon:R}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[e.jsx(R,{size:20}),"Comparable Company Analysis"]}),e.jsx("p",{className:"text-gray-600",children:"Market-based valuation using trading multiples from similar public companies."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[e.jsx(l,{size:16}),"Add Comparable"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(u.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(x,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EV/REVENUE"})]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[y.ev_revenue.median.toFixed(1),"x"]}),e.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Median multiple"})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(r,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"IMPLIED VALUE"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-800",children:a(j.ev_revenue.median)}),e.jsx("div",{className:"text-sm text-green-600 mt-1",children:"EV/Revenue basis"})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(w,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"VALUATION RANGE"})]}),e.jsxs("div",{className:"text-lg font-bold text-purple-800",children:[a(j.ev_revenue.p25)," - ",a(j.ev_revenue.p75)]}),e.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"25th - 75th percentile"})]}),e.jsxs(u.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(R,{size:20,className:"text-orange-600"}),e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"PEER COUNT"})]}),e.jsx("div",{className:"text-2xl font-bold text-orange-800",children:p.length}),e.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Comparable companies"})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:v.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>o(s.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(n===s.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[e.jsx(t,{size:16}),s.label]},s.id)})}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["multiples"===n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Trading Multiples Analysis"}),e.jsx("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(f).map(([s,t])=>e.jsx("option",{value:s,children:t.name},s))})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Company"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Market Cap"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Enterprise Value"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"EV/Revenue"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"EV/EBITDA"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"P/E Ratio"})]})}),e.jsxs("tbody",{children:[b.map((s,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.ticker})]})}),e.jsx("td",{className:"p-3 text-right",children:a(s.marketCap)}),e.jsx("td",{className:"p-3 text-right",children:a(s.enterpriseValue)}),e.jsx("td",{className:"p-3 text-right",children:a(s.revenue)}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[s.multiples.ev_revenue.toFixed(1),"x"]}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[s.multiples.ev_ebitda.toFixed(1),"x"]}),e.jsxs("td",{className:"p-3 text-right font-medium",children:[s.multiples.pe_ratio.toFixed(1),"x"]})]},s.id)),e.jsxs("tr",{className:"border-t-2 border-gray-300 bg-blue-50 font-semibold",children:[e.jsx("td",{className:"p-3",children:"Market Statistics"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsx("td",{className:"p-3"}),e.jsxs("td",{className:"p-3 text-right",children:[y.ev_revenue.median.toFixed(1),"x"]}),e.jsxs("td",{className:"p-3 text-right",children:[y.ev_ebitda.median.toFixed(1),"x"]}),e.jsxs("td",{className:"p-3 text-right",children:[y.pe_ratio.median.toFixed(1),"x"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h6",{className:"font-medium mb-3",children:"Multiple Distribution"}),e.jsx("div",{className:"space-y-3",children:Object.entries(y).slice(0,3).map(([s,t])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:f[s].name}),e.jsxs("span",{className:"font-medium",children:[t.median.toFixed(1),"x"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:(t.median-t.min)/(t.max-t.min)*100+"%"}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[t.min.toFixed(1),"x"]}),e.jsxs("span",{children:[t.max.toFixed(1),"x"]})]})]},s))})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Companies Analyzed:"}),e.jsx("span",{className:"font-medium",children:p.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Median Market Cap:"}),e.jsx("span",{className:"font-medium",children:a(p.sort((e,s)=>e.marketCap-s.marketCap)[Math.floor(p.length/2)]?.marketCap||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Median Revenue:"}),e.jsx("span",{className:"font-medium",children:a(p.sort((e,s)=>e.revenue-s.revenue)[Math.floor(p.length/2)]?.revenue||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Avg Founded Year:"}),e.jsx("span",{className:"font-medium",children:Math.round(p.reduce((e,s)=>e+s.founded,0)/p.length)})]})]})]})]})]}),"analysis"===n&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Valuation Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-4",children:"Implied Valuation by Multiple"}),e.jsx("div",{className:"space-y-4",children:Object.entries(j).map(([s,t])=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium",children:f[s].name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[y[s].median.toFixed(1),"x median"]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"25th Percentile:"}),e.jsx("span",{className:"font-medium",children:a(t.p25)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Median:"}),e.jsx("span",{className:"font-bold text-blue-600",children:a(t.median)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"75th Percentile:"}),e.jsx("span",{className:"font-medium",children:a(t.p75)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mean:"}),e.jsx("span",{className:"font-medium",children:a(t.mean)})]})]})]},s))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-4",children:"Valuation Summary"}),e.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Recommended Range"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[a((j.ev_revenue.p25+j.ev_ebitda.p25)/2)," -",a((j.ev_revenue.p75+j.ev_ebitda.p75)/2)]}),e.jsx("div",{className:"text-sm text-blue-600",children:"Blended 25th-75th percentile"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Midpoint Valuation"}),e.jsx("div",{className:"text-xl font-bold text-blue-800",children:a((j.ev_revenue.median+j.ev_ebitda.median)/2)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Average of median multiples"})]})]})}),e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(M,{size:16,className:"text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"font-medium text-yellow-800 mb-1",children:"Valuation Considerations"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• Consider company-specific growth and margin profiles"}),e.jsx("li",{children:"• Adjust for differences in business model and scale"}),e.jsx("li",{children:"• Factor in market conditions and sector trends"}),e.jsx("li",{children:"• Apply appropriate discount for private company liquidity"})]})]})]})})]})]})]}),"companies"===n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Comparable Company Set"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(S,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search companies...",className:"pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("button",{className:"px-3 py-2 border rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(F,{size:16}),"Filter"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:p.map(s=>e.jsxs(u.div,{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-semibold text-gray-800",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.ticker," • ",s.geography]})]}),e.jsx("button",{onClick:()=>{return e=s.id,void g(p.filter(s=>s.id!==e));var e},className:"text-red-500 hover:bg-red-50 p-1 rounded",children:"×"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Market Cap:"}),e.jsx("span",{className:"font-medium",children:a(s.marketCap)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Revenue:"}),e.jsx("span",{className:"font-medium",children:a(s.revenue)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"EV/Revenue:"}),e.jsxs("span",{className:"font-medium",children:[(s.enterpriseValue/s.revenue).toFixed(1),"x"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Founded:"}),e.jsx("span",{className:"font-medium",children:s.founded})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx("div",{className:"text-xs text-gray-600",children:s.businessModel})})]},s.id))})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Add Comparable Company"}),e.jsxs("form",{onSubmit:e=>{e.preventDefault();const s=new FormData(e.target);(e=>{const s={id:Date.now(),...e,marketCap:parseFloat(e.marketCap)||0,enterpriseValue:parseFloat(e.enterpriseValue)||0,revenue:parseFloat(e.revenue)||0,ebitda:parseFloat(e.ebitda)||0,netIncome:parseFloat(e.netIncome)||0,employees:parseInt(e.employees)||0,founded:parseInt(e.founded)||(new Date).getFullYear()};g([...p,s]),h(!1)})(Object.fromEntries(s))},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx("input",{name:"name",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ticker"}),e.jsx("input",{name:"ticker",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Cap ($000s)"}),e.jsx("input",{name:"marketCap",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enterprise Value ($000s)"}),e.jsx("input",{name:"enterpriseValue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue ($000s)"}),e.jsx("input",{name:"revenue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA ($000s)"}),e.jsx("input",{name:"ebitda",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Model"}),e.jsx("input",{name:"businessModel",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Company"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]})})]})},Be=({data:t,onDataChange:a})=>{const[i,l]=s.useState("setup"),[o,c]=s.useState(null),[d,m]=s.useState(!1),[h,p]=s.useState(0),[g,b]=s.useState({iterations:1e4,confidenceLevel:.95,randomSeed:null,enableCorrelation:!1}),[j,f]=s.useState({revenueGrowthRate:{type:"normal",parameters:{mean:.1,stdDev:.03},name:"Revenue Growth Rate",enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.12,mode:.15,max:.18},name:"FCF Margin",enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},name:"WACC",enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},name:"Terminal Growth Rate",enabled:!0}}),[v,N]=s.useState([[1,.3,-.2,.1],[.3,1,-.4,.2],[-.2,-.4,1,-.3],[.1,.2,-.3,1]]),w=[{value:"normal",label:"Normal",parameters:["mean","stdDev"]},{value:"triangular",label:"Triangular",parameters:["min","mode","max"]},{value:"uniform",label:"Uniform",parameters:["min","max"]},{value:"lognormal",label:"Log-Normal",parameters:["mu","sigma"]},{value:"beta",label:"Beta",parameters:["alpha","beta"]}],C=s.useCallback(async()=>{try{m(!0),p(0);const e=Object.fromEntries(Object.entries(j).filter(([e,s])=>s.enabled));if(0===Object.keys(e).length)throw new Error("No distributions are enabled. Please enable at least one variable distribution to run the simulation.");const s={iterations:g.iterations,confidenceLevel:g.confidenceLevel,randomSeed:g.randomSeed,correlationMatrix:g.enableCorrelation?v:null,onProgress:p},a=t?.statements?.incomeStatement,i=t?.periods?.length-1||2,r={currentRevenue:1e3*(a?.totalRevenue?.[i]||1e6),currentPrice:100,sharesOutstanding:1e6,currentOperatingIncome:1e3*(a?.operatingIncome?.[i]||15e4),...Object.fromEntries(Object.entries(e).map(([e,s])=>[e,s.parameters.mean||s.parameters.mode||(s.parameters.min+s.parameters.max)/2]))},l=await De.runDCFSimulation(r,e,s);c(l)}catch(e){alert(`Monte Carlo simulation failed: ${e.message}`)}finally{m(!1),p(0)}},[j,g,v,t]),k=s.useCallback(()=>{De.stopSimulation(),m(!1)},[]),R=s.useCallback((e,s)=>{f(t=>({...t,[e]:{...t[e],...s}}))},[]),M=s.useCallback((e,s,t)=>{N(a=>{const i=a.map(e=>[...e]);return i[e][s]=t,i[s][e]=t,i})},[]),S=s.useMemo(()=>{if(!o?.results)return[];const e=o.results.map(e=>e.pricePerShare),s=Math.min(...e),t=(Math.max(...e)-s)/50,a=Array(50).fill(0).map((e,a)=>({bin:s+a*t,count:0,frequency:0}));return e.forEach(e=>{const i=Math.min(Math.floor((e-s)/t),49);a[i].count++}),a.forEach(s=>{s.frequency=s.count/e.length}),a},[o]),F=s.useMemo(()=>o?.results?o.results.slice(0,1e3).map((e,s)=>({x:100*e.inputs.revenueGrowthRate,y:e.pricePerShare,upside:e.upside})):[],[o]),T=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),V=[{id:"setup",label:"Setup",icon:y},{id:"run",label:"Run Simulation",icon:I},{id:"results",label:"Results",icon:x},{id:"analysis",label:"Analysis",icon:r}];return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center",children:[e.jsx(D,{className:"inline-block mr-2"}),"Monte Carlo Simulation"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Advanced risk analysis using probabilistic modeling • Generate thousands of scenarios • Measure uncertainty"})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex space-x-2",children:V.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>l(s.id),className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 "+(i===s.id?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[e.jsx(t,{size:16}),s.label]},s.id)})})}),e.jsx("div",{className:"mt-6",children:e.jsxs(A,{mode:"wait",children:["setup"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🎛️ Simulation Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Iterations"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:g.iterations,onChange:e=>b(s=>({...s,iterations:parseInt(e.target.value)})),min:"1000",max:"100000",step:"1000"}),e.jsx("small",{className:"text-gray-400",children:"Leave empty for random"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Confidence Level"}),e.jsxs("select",{className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:g.confidenceLevel,onChange:e=>b(s=>({...s,confidenceLevel:parseFloat(e.target.value)})),children:[e.jsx("option",{value:.9,children:"90%"}),e.jsx("option",{value:.95,children:"95%"}),e.jsx("option",{value:.99,children:"99%"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Random Seed (Optional)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:g.randomSeed||"",onChange:e=>b(s=>({...s,randomSeed:e.target.value?parseInt(e.target.value):null})),placeholder:"Leave empty for random"})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 rounded focus:ring-blue-500",checked:g.enableCorrelation,onChange:e=>b(s=>({...s,enableCorrelation:e.target.checked}))}),e.jsx("span",{children:"Enable Variable Correlation"})]})})]})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Variable Distributions"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Object.entries(j).map(([s,t])=>e.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:t.enabled,onChange:e=>R(s,{enabled:e.target.checked})}),e.jsx("span",{className:"font-medium",children:t.name})]})}),t.enabled&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Distribution Type"}),e.jsx("select",{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.type,onChange:e=>{const t=e.target.value;w.find(e=>e.value===t);const a={};"normal"===t?(a.mean=.1,a.stdDev=.02):"triangular"===t?(a.min=.05,a.mode=.1,a.max=.15):"uniform"===t&&(a.min=.05,a.max=.15),R(s,{type:t,parameters:a})},children:w.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:w.find(e=>e.value===t.type)?.parameters.map(a=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300",children:a.charAt(0).toUpperCase()+a.slice(1)}),e.jsx("input",{className:"w-full px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",type:"number",value:t.parameters[a]||"",onChange:e=>R(s,{parameters:{...t.parameters,[a]:parseFloat(e.target.value)}}),step:"0.001"})]},a))})]})]},s))})]}),g.enableCorrelation&&e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🔗 Correlation Matrix"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),Object.keys(j).map(s=>e.jsx("th",{children:j[s].name},s))]})}),e.jsx("tbody",{children:Object.keys(j).map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-medium text-gray-200 p-2 border border-gray-600",children:j[s].name}),Object.keys(j).map((s,a)=>e.jsx("td",{className:"p-2 border border-gray-600",children:e.jsx("input",{type:"number",value:v[t][a],onChange:e=>M(t,a,parseFloat(e.target.value)),min:"-1",max:"1",step:"0.1",disabled:t===a,className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-700 disabled:text-gray-400"})},a))]},s))})]})})]})]})},"setup"),"run"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{children:"🚀 Simulation Control"}),e.jsx("div",{className:"flex items-center space-x-2",children:d?e.jsxs("button",{onClick:k,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[e.jsx(E,{size:16}),e.jsx("span",{children:"Stop Simulation"})]}):e.jsxs("button",{onClick:C,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",disabled:Object.values(j).every(e=>!e.enabled),children:[e.jsx(I,{size:16}),e.jsx("span",{children:"Run Simulation"})]})})]}),d&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})}),e.jsxs("div",{className:"text-sm text-gray-400 text-center",children:[h.toFixed(1),"% Complete (",Math.floor(h*g.iterations/100)," / ",g.iterations," iterations)"]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📋 Simulation Preview"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Iterations"}),e.jsx("div",{className:"text-xl font-bold text-white",children:g.iterations.toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Variables"}),e.jsx("div",{className:"text-xl font-bold text-white",children:Object.values(j).filter(e=>e.enabled).length})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Confidence Level"}),e.jsxs("div",{className:"text-xl font-bold text-white",children:[(100*g.confidenceLevel).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Correlation"}),e.jsx("div",{className:"text-xl font-bold text-white",children:g.enableCorrelation?"Enabled":"Disabled"})]})]})]})]})},"run"),"results"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white flex items-center",children:"📊 Simulation Results"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[e.jsx(P,{size:16}),"Export Results"]}),e.jsxs("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[e.jsx(n,{size:16}),"Generate Report"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(o.analysis.statistics).map(([s,t])=>e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===s?"💰 Price per Share":"enterpriseValue"===s?"🏢 Enterprise Value":"📈 Upside %"}),e.jsx("div",{className:"text-2xl font-bold text-green-400 mb-2",children:"upside"===s?`${t.mean.toFixed(1)}%`:T(t.mean)}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-300",children:[e.jsxs("div",{children:["Median: ","upside"===s?`${t.median.toFixed(1)}%`:T(t.median)]}),e.jsxs("div",{children:["Std Dev: ","upside"===s?`${t.stdDev.toFixed(1)}%`:T(t.stdDev)]}),e.jsxs("div",{children:["Min: ","upside"===s?`${t.min.toFixed(1)}%`:T(t.min)]}),e.jsxs("div",{children:["Max: ","upside"===s?`${t.max.toFixed(1)}%`:T(t.max)]})]})]},s))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{children:"📊 Price Distribution"}),e.jsx(ne,{width:"100%",height:300,children:e.jsxs(fe,{data:S,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"bin",tickFormatter:T}),e.jsx(me,{}),e.jsx(xe,{formatter:(e,s)=>[`${(100*e).toFixed(2)}%`,"Frequency"],labelFormatter:e=>`Price: ${T(e)}`}),e.jsx(ve,{type:"monotone",dataKey:"frequency",stroke:"#3B82F6",fill:"#3B82F6",fillOpacity:.6})]})})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{children:"🎯 Sensitivity Scatter Plot"}),e.jsx(ne,{width:"100%",height:300,children:e.jsxs(Ne,{data:F,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"x",name:"Revenue Growth Rate",tickFormatter:e=>`${e.toFixed(1)}%`}),e.jsx(me,{dataKey:"y",name:"Price per Share",tickFormatter:T}),e.jsx(xe,{formatter:(e,s)=>["Revenue Growth Rate"===s?`${e.toFixed(2)}%`:T(e),s]}),e.jsx(we,{name:"Scenarios",fill:"#10B981",children:F.map((s,t)=>e.jsx(ge,{fill:s.upside>0?"#10B981":"#EF4444"},`cell-${t}`))})]})})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(O,{size:48,className:"text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Results Available"}),e.jsx("p",{className:"text-gray-400",children:"Run a simulation to see results here."})]})},"results"),"analysis"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:o?.analysis?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"⚠️ Risk Metrics"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(o.analysis.riskMetrics).map(([s,t])=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"var95"===s?"Value at Risk (95%)":"cvar95"===s?"Conditional VaR (95%)":"probabilityOfLoss"===s?"Probability of Loss":"Sharpe Ratio"}),e.jsx("div",{className:"text-xl font-bold text-red-400 mb-1",children:"probabilityOfLoss"===s?`${(100*t).toFixed(1)}%`:T(t)}),e.jsx("div",{className:"text-xs text-gray-400",children:"Risk measure"})]},s))})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:["📊 Confidence Intervals (",(100*o.analysis.confidenceIntervals.pricePerShare?.level).toFixed(0),"%)"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(o.analysis.confidenceIntervals).map(([s,t])=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===s?"Price per Share":"enterpriseValue"===s?"Enterprise Value":"Upside %"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Lower Bound:"}),e.jsx("span",{className:"font-medium text-white",children:"upside"===s?`${t.lowerBound.toFixed(1)}%`:T(t.lowerBound)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Upper Bound:"}),e.jsx("span",{className:"font-medium text-white",children:"upside"===s?`${t.upperBound.toFixed(1)}%`:T(t.upperBound)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Width:"}),e.jsx("span",{className:"font-medium text-blue-400",children:"upside"===s?`${t.width.toFixed(1)}%`:T(t.width)})]})]})]},s))})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Percentile Analysis"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-600",children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-300",children:"Metric"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"5th %ile"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"25th %ile"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"50th %ile"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"75th %ile"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"95th %ile"})]})}),e.jsx("tbody",{children:Object.entries(o.analysis.percentiles).map(([s,t])=>e.jsxs("tr",{className:"border-b border-gray-600",children:[e.jsx("td",{className:"p-3 text-sm text-white",children:"pricePerShare"===s?"Price per Share":"enterpriseValue"===s?"Enterprise Value":"Upside %"}),e.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===s?`${t.p5.toFixed(1)}%`:T(t.p5)}),e.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===s?`${t.p25.toFixed(1)}%`:T(t.p25)}),e.jsx("td",{className:"p-3 text-sm text-right text-blue-400 font-medium",children:"upside"===s?`${t.p50.toFixed(1)}%`:T(t.p50)}),e.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===s?`${t.p75.toFixed(1)}%`:T(t.p75)}),e.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===s?`${t.p95.toFixed(1)}%`:T(t.p95)})]},s))})]})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(O,{size:48,className:"text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Analysis Available"}),e.jsx("p",{className:"text-gray-400",children:"Run a simulation to see analysis here."})]})},"analysis")]})})]})},qe=({data:a,adjustedValues:i,onDataChange:r})=>{const[l,n]=s.useState("dcf"),[o,c]=s.useState({dcf:{discountRate:10,terminalGrowthRate:2.5,projectionYears:5,terminalValueMultiple:10,taxRate:25,sharesOutstanding:1e3,workingCapital:{receivablesDays:45,inventoryDays:60,payablesDays:30,receivablesGrowth:2,inventoryGrowth:1.5,payablesGrowth:1.8},capex:{capexAsPercentOfRevenue:3.5,depreciationRate:7,maintenanceCapex:2}},ratios:{compareToIndustry:!0,industryAverages:{grossMargin:45,operatingMargin:15,netMargin:8,currentRatio:2.1,debtToEquity:.5}},sensitivity:{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},scenario:{scenarios:[{name:"Base Case",probability:50,revenueGrowth:15,marginImprovement:0},{name:"Bull Case",probability:25,revenueGrowth:25,marginImprovement:2},{name:"Bear Case",probability:25,revenueGrowth:5,marginImprovement:-2}]}}),d=s.useMemo(()=>{const e=a.statements.incomeStatement,s=a.periods,t={revenue:[],grossProfit:[],operatingIncome:[],margins:{gross:[],operating:[],net:[]},growth:{revenue:[],operating:[]}};return s.forEach((a,r)=>{const l=r===s.length-1,n=l&&i?.totalRevenue?i.totalRevenue:e.totalRevenue?.[r]||0,o=l&&i?.totalCostOfGoodsSold?i.totalCostOfGoodsSold:e.totalCostOfGoodsSold?.[r]||0,c=l&&i?.grossProfit?i.grossProfit:e.grossProfit?.[r]||n-o,d=l&&i?.operatingIncome?i.operatingIncome:e.operatingIncome?.[r]||0;if(t.revenue.push(n),t.grossProfit.push(c),t.operatingIncome.push(d),t.margins.gross.push(n?c/n*100:0),t.margins.operating.push(n?d/n*100:0),r>0){const s=e.totalRevenue?.[r-1]||0,a=e.operatingIncome?.[r-1]||0;t.growth.revenue.push(s?(n-s)/s*100:0),t.growth.operating.push(a?(d-a)/a*100:0)}}),t},[a]),m=(e=null)=>{const{discountRate:s,terminalGrowthRate:t,projectionYears:i,taxRate:r}=o.dcf,l=e||a;let n;if(e?(n=[],l.periods.forEach((e,s)=>{s>0&&s<=i&&n.push(l.statements.incomeStatement.operatingIncome?.[s]||0)})):n=d.operatingIncome.slice(1,i+1),0===n.length)return{enterpriseValue:0,equityValue:0,sharePrice:0};let c=0;const m=1+s/100;n.forEach((e,s)=>{const t=e*(1-r/100)/Math.pow(m,s+1);c+=t});const x=(n[n.length-1]||0)*(1+t/100)*(1-r/100)/((s-t)/100),u=x/Math.pow(m,i),h=c+u;return{enterpriseValue:h,equityValue:h,presentValueOperations:c,presentValueTerminal:u,terminalValue:x}};m();const u=[{id:"dcf",label:"DCF Valuation",icon:w,description:"Discounted Cash Flow analysis"},{id:"ratios",label:"Ratio Analysis",icon:x,description:"Financial ratio comparison"},{id:"sensitivity",label:"Sensitivity Analysis",icon:b,description:"Variable impact analysis"},{id:"scenario",label:"Scenario Modeling",icon:M,description:"Multi-scenario projections"},{id:"comparable",label:"Comparable Analysis",icon:R,description:"Market-based valuation"},{id:"montecarlo",label:"Monte Carlo",icon:D,description:"Probabilistic risk analysis"}],h=(e,s,t)=>{c(a=>({...a,[e]:{...a[e],[s]:t}}))},p=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(1e3*e),g=e=>`${e.toFixed(1)}%`;return e.jsxs("div",{className:"h-full bg-gray-900 text-white p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Select a modeling approach to analyze your financial data"})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:u.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>n(s.id),className:(l===s.id?"bg-blue-600 text-white border-blue-500 shadow-lg":"bg-gray-800 text-gray-300 border-gray-700 hover:bg-gray-700 hover:text-white hover:border-gray-600")+" flex items-center gap-3 px-4 py-3 rounded-lg border transition-all duration-200",children:[e.jsx(t,{size:18,className:l===s.id?"text-white":"text-blue-400"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.id)})}),e.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.createElement(u.find(e=>e.id===l)?.icon,{size:20,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:u.find(e=>e.id===l)?.label}),e.jsx("p",{className:"text-gray-400 text-sm",children:u.find(e=>e.id===l)?.description})]})]})})]}),e.jsxs("div",{children:["dcf"===l&&e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[e.jsx(w,{size:20,className:"text-blue-400"}),"DCF Valuation Model"]}),e.jsx(Te,{data:a,modelInputs:o,onModelInputChange:h,formatCurrency:p,formatPercent:g})]}),"ratios"===l&&e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[e.jsx(x,{size:20}),"Financial Ratio Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Profitability Ratios"}),e.jsxs("div",{className:"space-y-3",children:[d.margins.gross.map((s,t)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Gross Margin:"]}),e.jsx("span",{className:"font-medium",children:g(s)})]},t)),d.margins.operating.map((s,t)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Operating Margin:"]}),e.jsx("span",{className:"font-medium",children:g(s)})]},t))]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Growth Rates"}),e.jsxs("div",{className:"space-y-3",children:[d.growth.revenue.map((s,t)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Revenue Growth:"]}),e.jsx("span",{className:"font-medium "+(s>=0?"text-green-600":"text-red-600"),children:g(s)})]},t)),d.growth.operating.map((s,t)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:[a.periods[t+1]," Operating Growth:"]}),e.jsx("span",{className:"font-medium "+(s>=0?"text-green-600":"text-red-600"),children:g(s)})]},t))]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Industry Comparison"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"p-3 bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Industry Avg"}),e.jsxs("div",{className:"text-sm",children:["Gross Margin: ",g(o.ratios.industryAverages.grossMargin)]}),e.jsxs("div",{className:"text-sm",children:["Operating Margin: ",g(o.ratios.industryAverages.operatingMargin)]}),e.jsxs("div",{className:"text-sm",children:["Net Margin: ",g(o.ratios.industryAverages.netMargin)]})]})})]})]})]}),"sensitivity"===l&&e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[e.jsx(b,{size:20}),"Sensitivity Analysis"]}),e.jsx(Ee,{data:a,modelInputs:o,onModelInputChange:h,calculateDCF:m,formatCurrency:p,formatPercent:g})]}),"scenario"===l&&e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[e.jsx(M,{size:20}),"Scenario Modeling"]}),e.jsx(Ae,{data:a,modelInputs:o,onModelInputChange:h,calculateDCF:m,formatCurrency:p,formatPercent:g})]}),"comparable"===l&&e.jsx("div",{className:"p-6",children:e.jsx(Ve,{data:a,formatCurrency:p,formatPercent:g})}),"montecarlo"===l&&e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(D,{size:20}),"Monte Carlo Simulation"]}),e.jsx(Be,{data:a,onDataChange:r})]})]})]})},ze=({data:t,adjustedValues:a,modelInputs:i,calculateDCF:l,formatCurrency:n,formatPercentage:o})=>{const c=s.useMemo(()=>{try{if(!t?.statements?.incomeStatement)return null;const s=t.statements.incomeStatement,i=Object.keys(s.totalRevenue||{}).sort((e,s)=>parseInt(e)-parseInt(s));if(i.length<2)return null;const o=i[i.length-1],c=i[i.length-2],d=i[0],m=a?.totalRevenue||s.totalRevenue?.[o]||0,u=s.totalRevenue?.[c]||0,h=s.totalRevenue?.[d]||0,p=a?.grossProfit||s.grossProfit?.[o]||0,g=s.grossProfit?.[c]||0,b=a?.operatingIncome||s.operatingIncome?.[o]||0,y=s.operatingIncome?.[c]||0,j=(a?.totalCostOfGoodsSold||s.totalCostOfGoodsSold,s.totalCostOfGoodsSold,u?(m-u)/u*100:0),f=h&&i.length>2?100*(Math.pow(m/h,1/(i.length-1))-1):0,v=y?(b-y)/y*100:0,w=m&&0!==m?p/m*100:0,C=u&&0!==u?g/u*100:0,k=m&&0!==m?b/m*100:0,R=u&&0!==u?y/u*100:0,S=isFinite(w)&&isFinite(C)?w-C:0,F=isFinite(k)&&isFinite(R)?k-R:0;let I=null;if(l)try{I=l(t)}catch(e){}const A=[{name:"Energy Devices",value:Number(s.energyDevices?.[o])||0},{name:"Injectables",value:Number(s.injectables?.[o])||0},{name:"Wellness",value:Number(s.wellness?.[o])||0},{name:"Weightloss",value:Number(s.weightloss?.[o])||0},{name:"Retail Sales",value:Number(s.retailSales?.[o])||0},{name:"Surgery",value:Number(s.surgery?.[o])||0}].filter(e=>e.value>0&&isFinite(e.value)),E=s.totalAssets?.[o]||1.2*m,P=s.totalEquity?.[o]||.6*E,O=s.totalDebt?.[o]||.3*E,q=s.currentAssets?.[o]||.4*E,z=s.currentLiabilities?.[o]||.2*E,L=s.inventory?.[o]||.15*m,G=s.accountsReceivable?.[o]||.1*m,$=s.cashAndEquivalents?.[o]||.1*E,U=E&&0!==E?b/E*100:0,W=P&&0!==P?b/P*100:0,_=P&&0!==P?O/P:0,K=z&&0!==z?q/z:0,Y=z&&0!==z?(q-L)/z:0,H=E&&0!==E?m/E:0,Q=L&&0!==L?.7*m/L:0,J=G&&0!==G?m/G:0,X=z&&0!==z?$/z:0,Z=q-z,ee=m&&0!==m?Z/m:0,se=Q>0&&J>0?365/Q+365/J:0,te=se>0?se-30:0,ae=0!==g?v/j:0,ie=100*(k-R),re=P&&0!==P?E/P:0,le=s.interestExpense?.[o]?b/s.interestExpense[o]:0,ne=s.debtService?.[o]?b/s.debtService[o]:0,oe=s.employeeCount?.[o]?m/s.employeeCount[o]:0,ce=s.sharesOutstanding?.[o]?m/s.sharesOutstanding[o]:0,de=s.sharesOutstanding?.[o]&&P?P/s.sharesOutstanding[o]:0,me={grossMargin:65,operatingMargin:18,returnOnAssets:8,returnOnEquity:15,currentRatio:2.5,debtToEquity:.4,assetTurnover:.8,revenueGrowth:8},xe={grossMargin:w-me.grossMargin,operatingMargin:k-me.operatingMargin,returnOnAssets:U-me.returnOnAssets,returnOnEquity:W-me.returnOnEquity,currentRatio:K-me.currentRatio,debtToEquity:me.debtToEquity-_,assetTurnover:H-me.assetTurnover,revenueGrowth:j-me.revenueGrowth},ue=[{title:"Revenue Growth",value:`${j>0?"+":""}${isFinite(j)?j.toFixed(1):"0.0"}%`,trend:j>0?"up":"down",description:"Year-over-year revenue growth rate",icon:r,benchmark:me.revenueGrowth,performance:xe.revenueGrowth},{title:"Gross Margin",value:`${isFinite(w)?w.toFixed(1):"0.0"}%`,trend:S>0?"up":"down",description:`${S>0?"+":""}${isFinite(S)?S.toFixed(1):"0.0"}% vs prior year`,icon:N,benchmark:me.grossMargin,performance:xe.grossMargin},{title:"Operating Margin",value:`${isFinite(k)?k.toFixed(1):"0.0"}%`,trend:F>0?"up":"down",description:`${F>0?"+":""}${isFinite(F)?F.toFixed(1):"0.0"}% vs prior year`,icon:x,benchmark:me.operatingMargin,performance:xe.operatingMargin},{title:"Return on Assets",value:`${isFinite(U)?U.toFixed(1):"0.0"}%`,trend:U>me.returnOnAssets?"up":"down",description:"Asset utilization efficiency",icon:M,benchmark:me.returnOnAssets,performance:xe.returnOnAssets},{title:"Return on Equity",value:`${isFinite(W)?W.toFixed(1):"0.0"}%`,trend:W>me.returnOnEquity?"up":"down",description:"Shareholder value generation",icon:T,benchmark:me.returnOnEquity,performance:xe.returnOnEquity},{title:"Current Ratio",value:`${isFinite(K)?K.toFixed(1):"0.0"}x`,trend:K>2?"up":K>1.5?"neutral":"down",description:"Short-term liquidity strength",icon:V,benchmark:me.currentRatio,performance:xe.currentRatio},{title:"Asset Turnover",value:`${isFinite(H)?H.toFixed(1):"0.0"}x`,trend:H>me.assetTurnover?"up":"down",description:"Revenue per dollar of assets",icon:D,benchmark:me.assetTurnover,performance:xe.assetTurnover},{title:"Debt-to-Equity",value:`${isFinite(_)?_.toFixed(1):"0.0"}x`,trend:_<me.debtToEquity?"up":"down",description:"Financial leverage position",icon:B,benchmark:me.debtToEquity,performance:xe.debtToEquity}],he=[{name:"Current Ratio",value:K,formatted:`${K.toFixed(2)}x`,benchmark:2.5,status:K>=2.5?"excellent":K>=2?"good":K>=1.5?"fair":"poor"},{name:"Quick Ratio",value:Y,formatted:`${Y.toFixed(2)}x`,benchmark:1.5,status:Y>=1.5?"excellent":Y>=1?"good":Y>=.8?"fair":"poor"},{name:"Cash Ratio",value:X,formatted:`${X.toFixed(2)}x`,benchmark:.5,status:X>=.5?"excellent":X>=.3?"good":X>=.2?"fair":"poor"},{name:"Working Capital",value:Z,formatted:n(Z),benchmark:.15*m,status:Z>=.15*m?"excellent":Z>=0?"good":"poor"}],pe=[{name:"Asset Turnover",value:H,formatted:`${H.toFixed(2)}x`,description:"Revenue generation per asset dollar"},{name:"Inventory Turnover",value:Q,formatted:`${Q.toFixed(1)}x`,description:"Inventory management efficiency"},{name:"Receivables Turnover",value:J,formatted:`${J.toFixed(1)}x`,description:"Collection efficiency"},{name:"Operating Cycle",value:se,formatted:`${se.toFixed(0)} days`,description:"Cash-to-cash cycle duration"}],ge=[{name:"Financial Leverage",value:re,formatted:`${re.toFixed(1)}x`,level:re<2?"low":re<3?"moderate":"high"},{name:"Debt-to-Equity",value:_,formatted:`${_.toFixed(2)}x`,level:_<.3?"low":_<.6?"moderate":"high"},{name:"Interest Coverage",value:le,formatted:`${le.toFixed(1)}x`,level:le>10?"low":le>5?"moderate":"high"}];return{periods:i,latest:o,previous:c,revenue:{latest:m,previous:u,growth:j,cagr:f},profitability:{grossMargin:w,grossMarginChange:S,operatingMargin:k,operatingMarginChange:F,operatingLeverage:ae,profitabilityTrend:ie},financial:{returnOnAssets:U,returnOnEquity:W,assetTurnover:H,totalAssets:E,totalEquity:P,totalDebt:O,workingCapital:Z,workingCapitalRatio:ee},liquidity:{currentRatio:K,quickRatio:Y,cashRatio:X,cashAndEquivalents:$,currentAssets:q,currentLiabilities:z},efficiency:{inventoryTurnover:Q,receivablesTurnover:J,operatingCycle:se,cashConversionCycle:te},risk:{debtToEquity:_,financialLeverage:re,interestCoverage:le,debtServiceCoverage:ne},market:{revenuePerEmployee:oe,revenuePerShare:ce,bookValuePerShare:de},benchmarks:{industry:me,comparison:xe},dcf:I,revenueBreakdown:A,kpis:ue,liquidityMetrics:he,efficiencyMetrics:pe,riskMetrics:ge}}catch(e){return null}},[t,l]);if(!c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"mx-auto h-12 w-12 text-yellow-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Insufficient Data"}),e.jsx("p",{className:"text-gray-500",children:"Please ensure financial data is loaded to generate analysis results."})]})});const d=({title:s,value:t,trend:a,description:i,icon:l,benchmark:n,performance:o})=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 hover:border-gray-600 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+("up"===a?"bg-green-900/30 text-green-400":"down"===a?"bg-red-900/30 text-red-400":"bg-gray-700 text-gray-400"),children:e.jsx(l,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-300",children:s}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:i})]})]}),"up"===a&&e.jsx(r,{className:"h-5 w-5 text-green-400 flex-shrink-0"}),"down"===a&&e.jsx(h,{className:"h-5 w-5 text-red-400 flex-shrink-0"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:t}),n&&e.jsxs("div",{className:"border-t border-gray-700 pt-3 mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Industry Avg:"}),e.jsx("span",{className:"text-gray-300",children:"number"==typeof n?n.toFixed(1)+(s.includes("%")?"%":s.includes("x")?"x":""):n})]}),e.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-gray-400",children:"vs Industry:"}),e.jsxs("span",{className:"font-medium "+(o>0?"text-green-400":o<0?"text-red-400":"text-gray-300"),children:[o>0?"+":"",o?.toFixed(1)||"0.0"]})]})]})]});return e.jsxs("div",{className:"space-y-6 p-6 bg-gray-900 text-white h-full",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center",children:[e.jsx(x,{className:"h-6 w-6 text-blue-400 mr-3"}),"Financial Analysis Results"]}),e.jsx("p",{className:"text-gray-400",children:"Comprehensive analysis of your company's financial performance and valuation"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.kpis.map((s,t)=>e.jsx(d,{...s},t))}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-gray-700",children:[e.jsx("button",{className:"px-6 py-3 text-sm font-medium text-white bg-blue-600 border-r border-gray-700",children:"Liquidity Analysis"}),e.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white border-r border-gray-700",children:"Efficiency Metrics"}),e.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white border-r border-gray-700",children:"Risk Assessment"}),e.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white",children:"Benchmarking"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(V,{className:"h-5 w-5 text-blue-400 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Liquidity Position Analysis"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.liquidityMetrics.map((s,t)=>e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-200",children:s.name}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+("excellent"===s.status?"bg-green-900/30 text-green-400":"good"===s.status?"bg-blue-900/30 text-blue-400":"fair"===s.status?"bg-yellow-900/30 text-yellow-400":"bg-red-900/30 text-red-400"),children:s.status})]}),e.jsx("div",{className:"text-xl font-bold text-white mb-1",children:s.formatted}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Benchmark: ","number"==typeof s.benchmark?s.benchmark.toFixed(1)+"x":n(s.benchmark)]})]},t))}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-750 rounded-lg border border-gray-600",children:[e.jsxs("h4",{className:"font-medium text-gray-200 mb-3 flex items-center",children:[e.jsx(f,{className:"h-4 w-4 text-blue-400 mr-2"}),"Liquidity Analysis Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Working Capital:"}),e.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.financial.workingCapital)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Cash Position:"}),e.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.liquidity.cashAndEquivalents)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Current Assets:"}),e.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.liquidity.currentAssets)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Current Liabilities:"}),e.jsx("span",{className:"text-white ml-2 font-medium",children:n(c.liquidity.currentLiabilities)})]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(D,{className:"h-5 w-5 text-orange-400 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Operational Efficiency Metrics"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:c.efficiencyMetrics.map((s,t)=>e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[e.jsx("div",{className:"text-sm font-medium text-gray-200 mb-2",children:s.name}),e.jsx("div",{className:"text-xl font-bold text-white mb-1",children:s.formatted}),e.jsx("div",{className:"text-xs text-gray-400",children:s.description})]},t))}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(q,{className:"h-4 w-4 text-orange-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Cash Conversion"})]}),e.jsxs("div",{className:"text-lg font-bold text-white",children:[c.efficiency.cashConversionCycle.toFixed(0)," days"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Time to convert inventory to cash"})]}),e.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(z,{className:"h-4 w-4 text-orange-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Asset Productivity"})]}),e.jsxs("div",{className:"text-lg font-bold text-white",children:[c.financial.assetTurnover.toFixed(2),"x"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Revenue per dollar of assets"})]}),e.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-orange-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Revenue/Employee"})]}),e.jsx("div",{className:"text-lg font-bold text-white",children:c.market.revenuePerEmployee>0?n(c.market.revenuePerEmployee):"N/A"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Productivity per employee"})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(O,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Financial Risk Assessment"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:c.riskMetrics.map((s,t)=>e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-200",children:s.name}),e.jsxs("span",{className:"px-2 py-1 rounded text-xs font-medium "+("low"===s.level?"bg-green-900/30 text-green-400":"moderate"===s.level?"bg-yellow-900/30 text-yellow-400":"bg-red-900/30 text-red-400"),children:[s.level," risk"]})]}),e.jsx("div",{className:"text-xl font-bold text-white",children:s.formatted})]},t))}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-750 rounded-lg border border-gray-600",children:[e.jsxs("h4",{className:"font-medium text-gray-200 mb-3 flex items-center",children:[e.jsx(V,{className:"h-4 w-4 text-red-400 mr-2"}),"Risk Analysis Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Financial Leverage:"}),e.jsxs("span",{className:"ml-2 font-medium "+(c.risk.financialLeverage<2?"text-green-400":c.risk.financialLeverage<3?"text-yellow-400":"text-red-400"),children:[c.risk.financialLeverage.toFixed(1),"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Interest Coverage:"}),e.jsxs("span",{className:"ml-2 font-medium "+(c.risk.interestCoverage>10?"text-green-400":c.risk.interestCoverage>5?"text-yellow-400":"text-red-400"),children:[c.risk.interestCoverage.toFixed(1),"x"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[e.jsx(b,{className:"h-5 w-5 text-purple-400 mr-2"}),"Performance Trends"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-200 mb-3",children:"Revenue Analysis"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Latest Period:"}),e.jsx("span",{className:"font-semibold text-white",children:n(c.revenue.latest)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"YoY Growth:"}),e.jsxs("span",{className:"font-semibold "+(c.revenue.growth>0?"text-green-400":"text-red-400"),children:[c.revenue.growth>0?"+":"",c.revenue.growth.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"CAGR:"}),e.jsxs("span",{className:"font-semibold text-gray-200",children:[c.revenue.cagr.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-200 mb-3",children:"Profitability Margins"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Gross Margin:"}),e.jsxs("span",{className:"font-semibold text-white",children:[c.profitability.grossMargin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Operating Margin:"}),e.jsxs("span",{className:"font-semibold text-white",children:[c.profitability.operatingMargin.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Margin Change:"}),e.jsxs("span",{className:"font-semibold "+(c.profitability.grossMarginChange>0?"text-green-400":"text-red-400"),children:[c.profitability.grossMarginChange>0?"+":"",c.profitability.grossMarginChange.toFixed(1),"pp"]})]})]})]})]})]}),c.dcf&&e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[e.jsx(w,{className:"h-5 w-5 text-green-400 mr-2"}),"DCF Valuation Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-900/30 border border-green-700 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:n(c.dcf.enterpriseValue)}),e.jsx("div",{className:"text-sm text-green-300",children:"Enterprise Value"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-900/30 border border-blue-700 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:n(c.dcf.sharePrice)}),e.jsx("div",{className:"text-sm text-blue-300",children:"Price per Share"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-300",children:n(c.dcf.terminalValue)}),e.jsx("div",{className:"text-sm text-gray-400",children:"Terminal Value"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[e.jsx(v,{className:"h-5 w-5 text-orange-400 mr-2"}),"Business Unit Performance"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.revenueBreakdown.map((s,t)=>{const a=c.revenue.latest?s.value/c.revenue.latest*100:0;return e.jsxs("div",{className:"p-4 bg-gray-700 border border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-gray-200",children:s.name}),e.jsxs("span",{className:"text-sm text-gray-400",children:[a.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-lg font-semibold text-white mb-1",children:n(s.value)}),e.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${Math.min(a,100)}%`}})})]},t)})})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[e.jsx(L,{className:"h-5 w-5 text-green-400 mr-2"}),"Key Financial Insights"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-200 mb-2",children:"Strengths"}),e.jsxs("ul",{className:"space-y-1 text-sm text-gray-400",children:[c.revenue.growth>0&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 text-green-500 mr-2"}),"Positive revenue growth trajectory"]}),c.profitability.grossMargin>60&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 text-green-500 mr-2"}),"Strong gross margin above 60%"]}),c.profitability.grossMarginChange>0&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 text-green-500 mr-2"}),"Improving profitability margins"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 text-green-500 mr-2"}),"Diversified healthcare revenue streams"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-200 mb-2",children:"Areas for Focus"}),e.jsxs("ul",{className:"space-y-1 text-sm text-gray-400",children:[c.revenue.growth<5&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(O,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Revenue growth below industry benchmarks"]}),c.profitability.operatingMargin<20&&e.jsxs("li",{className:"flex items-center",children:[e.jsx(O,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Operating margin optimization opportunities"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(O,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Monitor competitive positioning in key segments"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(O,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Consider strategic initiatives for growth acceleration"]})]})]})]})]})]})},Le=({activeStep:t,onStepChange:a,dataCompleteness:i,modelingProgress:l,analysisProgress:n,validationErrors:c={}})=>{const[m,h]=s.useState(null),p=e=>{switch(e){case"data":return i>=80?"completed":i>0?"in-progress":"pending";case"modeling":return i<50?"disabled":l>=80?"completed":l>0?"in-progress":"available";case"analysis":return i<80||l<50?"disabled":n>=80?"completed":n>0?"in-progress":"available";default:return"pending"}},g=[{id:"data",title:"Data Entry",subtitle:"Financial statements & inputs",icon:G,progress:i,description:"Import or manually input your company's financial statements including income statement, balance sheet, and cash flow data.",validationFields:["revenue","expenses","assets"],helpContent:{title:"Data Entry Guidelines",items:["Ensure all financial figures are in the same currency","Use consistent time periods across all statements","Review data for obvious errors or inconsistencies","Include at least 3 years of historical data for better analysis"]}},{id:"modeling",title:"Financial Modeling",subtitle:"DCF, LBO & scenario analysis",icon:o,progress:l,description:"Configure valuation parameters, build financial models, and run scenario analyses to understand value drivers.",validationFields:["discountRate","growthAssumptions","margins"],helpContent:{title:"Modeling Best Practices",items:["Set realistic discount rates based on industry benchmarks","Use conservative growth assumptions for terminal value","Consider multiple scenarios (base, bull, bear cases)","Validate model outputs against comparable companies"]}},{id:"analysis",title:"Analysis & Results",subtitle:"Insights, reports & recommendations",icon:x,progress:n,description:"Review valuation results, sensitivity analysis, and generate comprehensive reports with actionable insights.",validationFields:["valuation","sensitivity","recommendations"],helpContent:{title:"Analysis Interpretation",items:["Compare results across different valuation methods","Pay attention to key value drivers in sensitivity analysis","Consider qualitative factors not captured in models","Document assumptions and limitations in your analysis"]}}],b=e=>{switch(e){case"completed":return"text-emerald-400";case"in-progress":return"text-blue-400";case"available":return"text-slate-300";case"disabled":return"text-slate-500";default:return"text-slate-400"}},y=(e,s)=>{switch(e){case"completed":return"bg-emerald-500/10 border-emerald-400/20";case"in-progress":return"bg-blue-500/10 border-blue-400/20";case"available":return"bg-slate-700/30 border-slate-600/20";case"disabled":return"bg-slate-800/30 border-slate-700/10";default:return"bg-slate-700/20 border-slate-600/10"}},j=(s,t,a)=>{const i=s.icon;return"completed"===t?e.jsx(L,{size:20,className:"text-emerald-400"}):"disabled"===t?e.jsx(i,{size:20,className:"text-slate-500"}):c[s.id]?.length>0?e.jsx(O,{size:20,className:"text-amber-400"}):"in-progress"===t?e.jsx(W,{size:20,className:"text-blue-400"}):e.jsx(i,{size:20,className:a?"text-white":b(t)})},f=(s,t)=>{const a=2*Math.PI*18,i=a,r=a-s/100*a;return e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"w-10 h-10 transform -rotate-90",viewBox:"0 0 40 40",children:[e.jsx("circle",{cx:"20",cy:"20",r:18,stroke:"currentColor",strokeWidth:"2",fill:"none",className:"text-slate-700"}),e.jsx("circle",{cx:"20",cy:"20",r:18,stroke:s>=80?"#10b981":s>=50?"#3b82f6":s>0?"#f59e0b":"#64748b",strokeWidth:"2",fill:"none",strokeDasharray:i,strokeDashoffset:r,className:"transition-all duration-500 ease-in-out",strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-slate-300",children:[Math.round(s),"%"]})})]})},v=({step:s,isVisible:t,onClose:a})=>t?e.jsxs(u.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute top-full left-0 mt-2 w-80 bg-slate-800 border border-slate-600 rounded-lg p-4 shadow-xl z-50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($,{size:16,className:"text-blue-400"}),e.jsx("h4",{className:"font-medium text-white",children:s.helpContent.title})]}),e.jsx("p",{className:"text-sm text-slate-300 mb-3",children:s.description}),e.jsx("ul",{className:"space-y-2",children:s.helpContent.items.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-400",children:[e.jsx(d,{size:14,className:"text-blue-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},t))}),e.jsx("button",{onClick:a,className:"absolute top-2 right-2 text-slate-400 hover:text-white transition-colors",children:"×"})]}):null;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(r,{size:20,className:"text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Analysis Workflow"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Follow these steps to complete your analysis"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-slate-300",children:"Overall Progress"}),e.jsxs("div",{className:"text-xs text-slate-400",children:[Math.round((i+l+n)/3),"% Complete"]})]}),e.jsx("div",{className:"w-16 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx(u.div,{className:"h-full bg-gradient-to-r from-blue-500 to-emerald-500",initial:{width:0},animate:{width:(i+l+n)/3+"%"},transition:{duration:.8,ease:"easeOut"}})})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:g.map((s,i)=>{const r=p(s.id),l=t===s.id,n="disabled"===r,o=c[s.id]?.length>0;return e.jsxs("div",{className:"relative",children:[e.jsxs(u.button,{onClick:()=>!n&&a(s.id),disabled:n,className:`\n                  w-full p-4 rounded-xl border transition-all duration-200 text-left relative overflow-hidden\n                  ${l?"bg-blue-600 border-blue-500 shadow-lg shadow-blue-600/20":y(r)}\n                  ${n||l?"":"hover:border-slate-500 hover:bg-slate-700/40"}\n                  ${n?"cursor-not-allowed opacity-60":"cursor-pointer"}\n                  ${o?"border-amber-400/40":"border-slate-600/30"}\n                `,whileHover:n||l?{}:{scale:1.02},whileTap:n?{}:{scale:.98},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`\n                      flex items-center justify-center w-10 h-10 rounded-lg transition-all\n                      ${l?"bg-white/20":"completed"===r?"bg-emerald-500/20":"bg-slate-600/30"}\n                    `,children:j(s,r,l)}),e.jsxs("div",{className:"text-xs font-medium text-slate-400",children:["Step ",i+1]})]}),s.progress>0&&e.jsx("div",{className:"flex-shrink-0",children:f(s.progress)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:`font-semibold ${l?"text-white":b(r)}`,children:s.title}),e.jsx("p",{className:"text-sm "+(l?"text-blue-100":"text-slate-400"),children:s.subtitle})]}),o&&e.jsxs("div",{className:"mt-2 text-xs text-amber-400",children:[c[s.id].length," validation issue(s)"]}),l&&e.jsx(u.div,{className:"absolute bottom-0 left-0 right-0 h-1 bg-white/30",layoutId:"activeIndicator"})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),h(m===s.id?null:s.id)},className:"absolute top-2 right-2 p-1.5 text-slate-400 hover:text-white transition-colors opacity-0 group-hover:opacity-100",children:e.jsx($,{size:14})}),e.jsx(v,{step:s,isVisible:m===s.id,onClose:()=>h(null)}),i<g.length-1&&e.jsx("div",{className:"absolute top-1/2 -right-2 transform -translate-y-1/2 z-10",children:e.jsx(d,{size:16,className:`\n                      ${"disabled"!==p(g[i+1].id)?"text-slate-400":"text-slate-600"}\n                    `})})]},s.id)})}),e.jsxs("div",{className:"mt-6 grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(U,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-medium text-slate-400",children:"Data Quality"})]}),e.jsxs("div",{className:"text-lg font-semibold text-white",children:[i,"%"]})]}),e.jsxs("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(o,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-medium text-slate-400",children:"Models Built"})]}),e.jsxs("div",{className:"text-lg font-semibold text-white",children:[Math.round(l),"%"]})]}),e.jsxs("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(x,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-medium text-slate-400",children:"Analysis Done"})]}),e.jsxs("div",{className:"text-lg font-semibold text-white",children:[Math.round(n),"%"]})]})]})]})},Ge=({data:t,onDataChange:a})=>{const[i,r]=s.useState("inputs"),[l,n]=s.useState(null),[c,d]=s.useState(!1),[m,h]=s.useState({symbol:"COMPANY",companyName:"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,equityContribution:.35,seniorDebtMultiple:4,subordinatedDebtMultiple:1.5,seniorInterestRate:.055,subordinatedInterestRate:.095,ebitdaGrowthRate:.06,capexAsPercentOfRevenue:.03,nwcAsPercentOfRevenue:.02,holdingPeriod:5,exitMultiple:10,transactionFees:.02,managementFees:.02,taxRate:.21}),p=s.useCallback(e=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),g=s.useCallback(e=>`${(100*e).toFixed(1)}%`,[]),b=s.useCallback(async()=>{try{d(!0);const e={symbol:m.symbol,companyName:m.companyName,purchasePrice:m.purchasePrice,ebitda:m.ebitda,revenue:m.revenue,assumptions:{debt:{seniorDebtMultiple:m.seniorDebtMultiple,subordinatedDebtMultiple:m.subordinatedDebtMultiple,seniorInterestRate:m.seniorInterestRate,subordinatedInterestRate:m.subordinatedInterestRate},operating:{ebitdaGrowthRate:m.ebitdaGrowthRate,capexAsPercentOfRevenue:m.capexAsPercentOfRevenue,nwcAsPercentOfRevenue:m.nwcAsPercentOfRevenue,taxRate:m.taxRate},exit:{exitMultiple:m.exitMultiple},transaction:{holdingPeriod:m.holdingPeriod,transactionFees:m.transactionFees}}},s=ke.buildLBOModel(e);n(s),a&&a({lboModel:{inputs:m,results:s,timestamp:(new Date).toISOString()}})}catch(e){alert(`Error: ${e.message}`)}finally{d(!1)}},[m,a]),y=s.useCallback((e,s)=>{h(t=>({...t,[e]:"string"==typeof s?parseFloat(s)||0:s}))},[]);return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_,{className:"text-blue-600",size:28}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Advanced LBO Modeling"}),e.jsx("p",{className:"text-gray-600",children:"Professional leveraged buyout analysis"})]})]}),e.jsxs(u.button,{onClick:b,disabled:c,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(c?"bg-gray-300 text-gray-500":"bg-blue-600 hover:bg-blue-700 text-white"),children:[e.jsx(o,{size:18}),e.jsx("span",{children:c?"Calculating...":"Calculate LBO"})]})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"inputs",label:"Model Inputs",icon:w},{id:"results",label:"Results & Analysis",icon:x}].map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>r(s.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(i===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[e.jsx(t,{size:16}),e.jsx("span",{children:s.label})]},s.id)})})}),"inputs"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Transaction"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Price"}),e.jsx("input",{type:"number",value:m.purchasePrice,onChange:e=>y("purchasePrice",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsx("p",{className:"text-xs text-gray-500",children:p(m.purchasePrice)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current EBITDA"}),e.jsx("input",{type:"number",value:m.ebitda,onChange:e=>y("ebitda",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Holding Period"}),e.jsx("input",{type:"number",value:m.holdingPeriod,onChange:e=>y("holdingPeriod",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Financing"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Debt Multiple"}),e.jsx("input",{type:"number",step:"0.1",value:m.seniorDebtMultiple,onChange:e=>y("seniorDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sub Debt Multiple"}),e.jsx("input",{type:"number",step:"0.1",value:m.subordinatedDebtMultiple,onChange:e=>y("subordinatedDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Rate (%)"}),e.jsx("input",{type:"number",step:"0.001",value:100*m.seniorInterestRate,onChange:e=>y("seniorInterestRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Operating"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA Growth (%)"}),e.jsx("input",{type:"number",step:"0.01",value:100*m.ebitdaGrowthRate,onChange:e=>y("ebitdaGrowthRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exit Multiple"}),e.jsx("input",{type:"number",step:"0.1",value:m.exitMultiple,onChange:e=>y("exitMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),e.jsx("input",{type:"number",step:"0.01",value:100*m.taxRate,onChange:e=>y("taxRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})]})}),"results"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g(l.baseCase?.returnsAnalysis?.irr||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"IRR"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(l.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"MOIC"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[(l.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Leverage"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:p(l.baseCase?.exitAnalysis?.equityProceeds||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Exit Value"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Transaction Structure"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Purchase Price:"}),e.jsx("span",{className:"font-medium",children:p(l.transactionStructure?.purchasePrice)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Total Debt:"}),e.jsx("span",{className:"font-medium",children:p(l.transactionStructure?.totalDebt)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Equity Investment:"}),e.jsx("span",{className:"font-medium",children:p(l.transactionStructure?.equityContribution)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Entry Multiple:"}),e.jsxs("span",{className:"font-medium",children:[(l.transactionStructure?.entryMultiple||0).toFixed(1),"x"]})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Debt/EBITDA:"}),e.jsxs("span",{className:"font-medium",children:[(l.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Equity %:"}),e.jsx("span",{className:"font-medium",children:g(l.transactionStructure?.equityPercentage||0)})]})]})]})]}),l.scenarios&&Object.keys(l.scenarios).length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Analysis"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("th",{className:"text-left py-2",children:"Scenario"}),e.jsx("th",{className:"text-right py-2",children:"IRR"}),e.jsx("th",{className:"text-right py-2",children:"MOIC"}),e.jsx("th",{className:"text-right py-2",children:"Exit Value"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 font-medium",children:"Base Case"}),e.jsx("td",{className:"text-right py-2",children:g(l.baseCase?.returnsAnalysis?.irr||0)}),e.jsxs("td",{className:"text-right py-2",children:[(l.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),e.jsx("td",{className:"text-right py-2",children:p(l.baseCase?.exitAnalysis?.equityProceeds||0)})]}),Object.entries(l.scenarios).map(([s,t])=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2",children:s}),e.jsx("td",{className:"text-right py-2",children:g(t.returnsAnalysis?.irr||0)}),e.jsxs("td",{className:"text-right py-2",children:[(t.returnsAnalysis?.moic||0).toFixed(1),"x"]}),e.jsx("td",{className:"text-right py-2",children:p(t.exitAnalysis?.equityProceeds||0)})]},s))]})]})})]})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(x,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Run LBO calculation to see results"})]})})]})},$e=({data:t,onDataChange:a})=>{const[i,l]=s.useState("income"),[c,d]=s.useState({revenue:[1e5,105e3,110250,115763,121551],costOfGoodsSold:[6e4,63e3,66150,69458,72931],grossProfit:[4e4,42e3,44100,46305,48620],operatingExpenses:[25e3,26250,27563,28941,30388],ebitda:[15e3,15750,16538,17364,18232],depreciation:[3e3,3150,3308,3473,3647],ebit:[12e3,12600,13230,13891,14585],interestExpense:[2e3,1800,1580,1340,1080],ebt:[1e4,10800,11650,12551,13505],taxes:[2100,2268,2447,2636,2836],netIncome:[7900,8532,9203,9915,10669],cash:[5e3,8532,12735,17650,23319],accountsReceivable:[8333,8750,9188,9647,10129],inventory:[1e4,10500,11025,11576,12155],totalCurrentAssets:[23333,27782,32948,38873,45603],ppe:[5e4,51850,53543,55070,56423],totalAssets:[73333,79632,86491,93943,102026],accountsPayable:[5e3,5250,5513,5789,6078],shortTermDebt:[3e3,2e3,1e3,0,0],totalCurrentLiabilities:[8e3,7250,6513,5789,6078],longTermDebt:[25e3,23e3,21e3,19e3,17e3],totalLiabilities:[33e3,30250,27513,24789,23078],shareholderEquity:[40333,49382,58978,69154,78948],totalLiabilitiesEquity:[73333,79632,86491,93943,102026],operatingCashFlow:[8567,10233,11345,12464,13584],capex:[-5e3,-4850,-5e3,-5e3,-5e3],investingCashFlow:[-5e3,-4850,-5e3,-5e3,-5e3],debtRepayment:[-2e3,-2e3,-2e3,-2e3,-2e3],financingCashFlow:[-2e3,-2e3,-2e3,-2e3,-2e3],netCashFlow:[1567,3383,4345,5464,6584],endingCash:[5e3,8383,12728,18192,24776]}),[m,x]=s.useState({revenueGrowthRate:.05,cogsPercentOfRevenue:.6,opexGrowthRate:.05,taxRate:.21,depreciationRate:.06,capexPercentOfRevenue:.05,debtPaydown:2e3}),[h,p]=s.useState([]),g=["Year 1","Year 2","Year 3","Year 4","Year 5"],y=s.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(1e3*e):"$0",[]),j=s.useCallback(()=>{const e={...c};for(let t=1;t<5;t++){e.revenue[t]=e.revenue[t-1]*(1+m.revenueGrowthRate),e.costOfGoodsSold[t]=e.revenue[t]*m.cogsPercentOfRevenue,e.grossProfit[t]=e.revenue[t]-e.costOfGoodsSold[t],e.operatingExpenses[t]=e.operatingExpenses[t-1]*(1+m.opexGrowthRate),e.ebitda[t]=e.grossProfit[t]-e.operatingExpenses[t],e.depreciation[t]=e.ppe[t-1]*m.depreciationRate,e.ebit[t]=e.ebitda[t]-e.depreciation[t],e.interestExpense[t]=.06*e.longTermDebt[t-1],e.ebt[t]=e.ebit[t]-e.interestExpense[t],e.taxes[t]=Math.max(0,e.ebt[t]*m.taxRate),e.netIncome[t]=e.ebt[t]-e.taxes[t];const s=e.revenue[t]*m.capexPercentOfRevenue;e.ppe[t]=e.ppe[t-1]+s-e.depreciation[t],e.longTermDebt[t]=Math.max(0,e.longTermDebt[t-1]-m.debtPaydown),e.shortTermDebt[t]=Math.max(0,e.shortTermDebt[t-1]-1e3),e.accountsReceivable[t]=.083*e.revenue[t],e.inventory[t]=.1*e.costOfGoodsSold[t],e.accountsPayable[t]=.05*e.costOfGoodsSold[t];const a=e.accountsReceivable[t]-e.accountsReceivable[t-1]+(e.inventory[t]-e.inventory[t-1])-(e.accountsPayable[t]-e.accountsPayable[t-1]);e.operatingCashFlow[t]=e.netIncome[t]+e.depreciation[t]-a,e.capex[t]=-s,e.investingCashFlow[t]=e.capex[t],e.debtRepayment[t]=-m.debtPaydown,e.financingCashFlow[t]=e.debtRepayment[t],e.netCashFlow[t]=e.operatingCashFlow[t]+e.investingCashFlow[t]+e.financingCashFlow[t],e.endingCash[t]=e.cash[t-1]+e.netCashFlow[t],e.cash[t]=e.endingCash[t],e.totalCurrentAssets[t]=e.cash[t]+e.accountsReceivable[t]+e.inventory[t],e.totalAssets[t]=e.totalCurrentAssets[t]+e.ppe[t],e.totalCurrentLiabilities[t]=e.accountsPayable[t]+e.shortTermDebt[t],e.totalLiabilities[t]=e.totalCurrentLiabilities[t]+e.longTermDebt[t],e.shareholderEquity[t]=e.totalAssets[t]-e.totalLiabilities[t],e.totalLiabilitiesEquity[t]=e.totalLiabilities[t]+e.shareholderEquity[t]}d(e);const s=[];for(let t=0;t<5;t++){Math.abs(e.totalAssets[t]-e.totalLiabilitiesEquity[t])>1&&s.push(`Balance sheet doesn't balance in ${g[t]}`)}p(s)},[c,m,g]),f=s.useCallback((e,s)=>{x(t=>({...t,[e]:parseFloat(s)||0}))},[]),v=[{id:"income",label:"Income Statement",icon:r},{id:"balance",label:"Balance Sheet",icon:H},{id:"cashflow",label:"Cash Flow",icon:b},{id:"assumptions",label:"Assumptions",icon:o}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(n,{className:"text-green-600",size:28}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"3-Statement Financial Model"}),e.jsx("p",{className:"text-gray-600",children:"Integrated Income Statement, Balance Sheet & Cash Flow"})]})]}),e.jsxs(u.button,{onClick:j,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[e.jsx(K,{size:16}),e.jsx("span",{children:"Recalculate"})]})]}),0===h.length?e.jsxs("div",{className:"mb-6 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center",children:[e.jsx(L,{className:"text-green-500 mr-2",size:20}),e.jsx("span",{className:"text-green-800 font-medium",children:"Model is balanced and consistent"})]}):e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Y,{className:"text-red-500 mr-2",size:20}),e.jsx("h3",{className:"font-semibold text-red-800",children:"Validation Errors"})]}),e.jsx("ul",{className:"text-sm text-red-700",children:h.map((s,t)=>e.jsxs("li",{children:["• ",s]},t))})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:v.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>l(s.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(i===s.id?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[e.jsx(t,{size:16}),e.jsx("span",{children:s.label})]},s.id)})})}),"income"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Income Statement ($000s)"}),g.map(s=>e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:s},s))]})}),e.jsx("tbody",{children:[{label:"Revenue",key:"revenue"},{label:"Cost of Goods Sold",key:"costOfGoodsSold"},{label:"Gross Profit",key:"grossProfit"},{label:"Operating Expenses",key:"operatingExpenses"},{label:"EBITDA",key:"ebitda"},{label:"Depreciation",key:"depreciation"},{label:"EBIT",key:"ebit"},{label:"Interest Expense",key:"interestExpense"},{label:"EBT",key:"ebt"},{label:"Taxes",key:"taxes"},{label:"Net Income",key:"netIncome"}].map(s=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 px-4 font-medium",children:s.label}),c[s.key]?.map((s,t)=>e.jsx("td",{className:"text-right py-2 px-4",children:y(s)},t))]},s.key))})]})})}),"balance"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Balance Sheet ($000s)"}),g.map(s=>e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:s},s))]})}),e.jsxs("tbody",{children:[e.jsx("tr",{className:"bg-gray-100",children:e.jsx("td",{colSpan:6,className:"py-2 px-4 font-semibold",children:"ASSETS"})}),[{label:"Cash",key:"cash"},{label:"Accounts Receivable",key:"accountsReceivable"},{label:"Inventory",key:"inventory"},{label:"Total Current Assets",key:"totalCurrentAssets"},{label:"PP&E",key:"ppe"},{label:"Total Assets",key:"totalAssets"}].map(s=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 px-4",children:s.label}),c[s.key]?.map((s,t)=>e.jsx("td",{className:"text-right py-2 px-4",children:y(s)},t))]},s.key)),e.jsx("tr",{className:"bg-gray-100",children:e.jsx("td",{colSpan:6,className:"py-2 px-4 font-semibold",children:"LIABILITIES & EQUITY"})}),[{label:"Accounts Payable",key:"accountsPayable"},{label:"Short-term Debt",key:"shortTermDebt"},{label:"Total Current Liabilities",key:"totalCurrentLiabilities"},{label:"Long-term Debt",key:"longTermDebt"},{label:"Total Liabilities",key:"totalLiabilities"},{label:"Shareholder Equity",key:"shareholderEquity"},{label:"Total Liab. & Equity",key:"totalLiabilitiesEquity"}].map(s=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 px-4",children:s.label}),c[s.key]?.map((s,t)=>e.jsx("td",{className:"text-right py-2 px-4",children:y(s)},t))]},s.key))]})]})})}),"cashflow"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Cash Flow Statement ($000s)"}),g.map(s=>e.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:s},s))]})}),e.jsx("tbody",{children:[{label:"Operating Cash Flow",key:"operatingCashFlow"},{label:"CapEx",key:"capex"},{label:"Investing Cash Flow",key:"investingCashFlow"},{label:"Debt Repayment",key:"debtRepayment"},{label:"Financing Cash Flow",key:"financingCashFlow"},{label:"Net Cash Flow",key:"netCashFlow"},{label:"Ending Cash",key:"endingCash"}].map(s=>e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("td",{className:"py-2 px-4",children:s.label}),c[s.key]?.map((s,t)=>e.jsx("td",{className:"text-right py-2 px-4",children:y(s)},t))]},s.key))})]})})}),"assumptions"===i&&e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Key Assumptions"}),e.jsx("div",{className:"space-y-3",children:[{label:"Revenue Growth Rate (%)",key:"revenueGrowthRate",isPercent:!0},{label:"COGS % of Revenue",key:"cogsPercentOfRevenue",isPercent:!0},{label:"OpEx Growth Rate (%)",key:"opexGrowthRate",isPercent:!0},{label:"Tax Rate (%)",key:"taxRate",isPercent:!0},{label:"CapEx % of Revenue",key:"capexPercentOfRevenue",isPercent:!0},{label:"Annual Debt Paydown ($000s)",key:"debtPaydown",isPercent:!1}].map(s=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s.label}),e.jsx("input",{type:"number",step:"0.01",value:s.isPercent?100*m[s.key]:m[s.key],onChange:e=>f(s.key,s.isPercent?(e.target.value||0)/100:e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]},s.key))})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Model Metrics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"5-Year Revenue CAGR:"}),e.jsxs("span",{className:"font-medium",children:[(100*(Math.pow(c.revenue[4]/c.revenue[0],1/4)-1)).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"5-Year EBITDA CAGR:"}),e.jsxs("span",{className:"font-medium",children:[(100*(Math.pow(c.ebitda[4]/c.ebitda[0],1/4)-1)).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Exit EBITDA Margin:"}),e.jsxs("span",{className:"font-medium",children:[(c.ebitda[4]/c.revenue[4]*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Exit Debt/EBITDA:"}),e.jsxs("span",{className:"font-medium",children:[(c.longTermDebt[4]/c.ebitda[4]).toFixed(1),"x"]})]})]})]})]})})]})},Ue=({data:t,onDataChange:a,calculateDCF:i,lboModelingEngine:r})=>{const[n,o]=s.useState("scenarios"),[c,d]=s.useState([{id:1,name:"Base Case",probability:40,revenueGrowth:5,marginExpansion:.5,exitMultiple:10,capexIntensity:3,isBase:!0},{id:2,name:"Bull Case",probability:30,revenueGrowth:8,marginExpansion:1.5,exitMultiple:12,capexIntensity:2.5,isBase:!1},{id:3,name:"Bear Case",probability:30,revenueGrowth:2,marginExpansion:-.5,exitMultiple:8,capexIntensity:4,isBase:!1}]),[m,h]=s.useState({modelType:"dcf",outputMetric:"enterpriseValue",includeCorrelations:!1,numSimulations:1e3}),[p,b]=s.useState(null),[y,j]=s.useState(!1),f=s.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),v=s.useCallback(e=>`${(e||0).toFixed(1)}%`,[]),N=s.useCallback(async()=>{j(!0);try{const e=[];for(const n of c){let s=null;if("dcf"===m.modelType){const e={...t,statements:{...t.statements,incomeStatement:{...t.statements.incomeStatement,totalRevenue:t.statements.incomeStatement.totalRevenue?.map((e,s)=>0===s?e:e*Math.pow(1+n.revenueGrowth/100,s))}}};s=i?i(e):null}else if("lbo"===m.modelType&&r){const e={symbol:t.symbol||"COMPANY",companyName:t.companyName||"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,assumptions:{operating:{ebitdaGrowthRate:n.revenueGrowth/100,capexAsPercentOfRevenue:n.capexIntensity/100},exit:{exitMultiple:n.exitMultiple}}};s=r.buildLBOModel(e)}e.push({...n,result:s,enterpriseValue:s?.enterpriseValue||s?.baseCase?.exitAnalysis?.enterpriseValue||0,equityValue:s?.equityValue||s?.baseCase?.exitAnalysis?.equityProceeds||0,irr:s?.irr||s?.baseCase?.returnsAnalysis?.irr||0,moic:s?.moic||s?.baseCase?.returnsAnalysis?.moic||0})}const s=e.reduce((e,s)=>e+s.enterpriseValue*s.probability/100,0),a={min:Math.min(...e.map(e=>e.enterpriseValue)),max:Math.max(...e.map(e=>e.enterpriseValue)),range:Math.max(...e.map(e=>e.enterpriseValue))-Math.min(...e.map(e=>e.enterpriseValue))},l=Math.sqrt(e.reduce((e,t)=>{const a=t.enterpriseValue-s;return e+a*a*t.probability/100},0));b({scenarios:e,summary:{weightedValue:s,valueRange:a,standardDeviation:l,coefficientOfVariation:l/s,probabilityOfPositiveReturn:e.filter(e=>e.enterpriseValue>(t.currentMarketCap||1e9)).reduce((e,s)=>e+s.probability,0)},chartData:e.map(e=>({name:e.name,value:e.enterpriseValue,probability:e.probability,irr:100*e.irr,moic:e.moic}))})}catch(e){alert(`Error running scenario analysis: ${e.message}`)}finally{j(!1)}},[c,m,t,i,r]),w=s.useCallback(()=>{const e={id:Date.now(),name:`Scenario ${c.length+1}`,probability:Math.max(0,100-c.reduce((e,s)=>e+s.probability,0)),revenueGrowth:5,marginExpansion:0,exitMultiple:10,capexIntensity:3,isBase:!1};d(s=>[...s,e])},[c]),C=s.useCallback((e,s,t)=>{d(a=>a.map(a=>a.id===e?{...a,[s]:parseFloat(t)||t}:a))},[]),k=s.useCallback(e=>{d(s=>s.filter(s=>s.id!==e&&!s.isBase))},[]),R=s.useMemo(()=>c.reduce((e,s)=>e+s.probability,0),[c]);return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(x,{className:"text-purple-600",size:28}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Scenario Analysis"}),e.jsx("p",{className:"text-gray-600",children:"Cross-model scenario planning & risk assessment"})]})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsxs(u.button,{onClick:N,disabled:y||100!==R,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(y||100!==R?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:y||100!==R?{}:{scale:1.02},children:[e.jsx(I,{size:18}),e.jsx("span",{children:y?"Running...":"Run Analysis"})]})})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model Type"}),e.jsxs("select",{value:m.modelType,onChange:e=>h(s=>({...s,modelType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"dcf",children:"DCF Valuation"}),e.jsx("option",{value:"lbo",children:"LBO Analysis"}),e.jsx("option",{value:"3statement",children:"3-Statement Model"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Output Metric"}),e.jsxs("select",{value:m.outputMetric,onChange:e=>h(s=>({...s,outputMetric:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"enterpriseValue",children:"Enterprise Value"}),e.jsx("option",{value:"equityValue",children:"Equity Value"}),e.jsx("option",{value:"irr",children:"IRR"}),e.jsx("option",{value:"moic",children:"MOIC"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulations"}),e.jsx("input",{type:"number",value:m.numSimulations,onChange:e=>h(s=>({...s,numSimulations:parseInt(e.target.value)||1e3})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.includeCorrelations,onChange:e=>h(s=>({...s,includeCorrelations:e.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Include Correlations"})]})})]})}),100!==R&&e.jsxs("div",{className:"mb-6 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center",children:[e.jsx(O,{className:"text-amber-500 mr-2",size:20}),e.jsxs("span",{className:"text-amber-800",children:["Total probability is ",R,"%. Adjust scenarios to sum to 100%."]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Scenarios"}),e.jsxs(u.button,{onClick:w,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[e.jsx(l,{size:16}),e.jsx("span",{children:"Add Scenario"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Scenario"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Probability (%)"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Revenue Growth (%)"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Margin Expansion (bps)"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Exit Multiple"}),e.jsx("th",{className:"text-right py-3 px-4",children:"CapEx Intensity (%)"}),e.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 "+(s.isBase?"bg-blue-50":""),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"text",value:s.name,onChange:e=>C(s.id,"name",e.target.value),disabled:s.isBase,className:"border border-gray-300 rounded px-2 py-1 "+(s.isBase?"bg-gray-100":"")})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsx("input",{type:"number",step:"1",value:s.probability,onChange:e=>C(s.id,"probability",e.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsx("input",{type:"number",step:"0.1",value:s.revenueGrowth,onChange:e=>C(s.id,"revenueGrowth",e.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsx("input",{type:"number",step:"0.1",value:s.marginExpansion,onChange:e=>C(s.id,"marginExpansion",e.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsx("input",{type:"number",step:"0.1",value:s.exitMultiple,onChange:e=>C(s.id,"exitMultiple",e.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsx("input",{type:"number",step:"0.1",value:s.capexIntensity,onChange:e=>C(s.id,"capexIntensity",e.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),e.jsx("td",{className:"text-center py-3 px-4",children:!s.isBase&&e.jsx("button",{onClick:()=>k(s.id),className:"text-red-600 hover:text-red-800",children:e.jsx(g,{size:16})})})]},s.id))})]})})]}),p&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f(p.summary.weightedValue)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f(p.summary.valueRange.max)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:f(p.summary.valueRange.min)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:v(p.summary.probabilityOfPositiveReturn)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Success Probability"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Results"}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(oe,{data:p.chartData,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{tickFormatter:e=>f(e)}),e.jsx(xe,{formatter:e=>[f(e),"Enterprise Value"]}),e.jsx(ue,{dataKey:"value",fill:"#8884d8"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Risk Metrics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Standard Deviation:"}),e.jsx("span",{className:"font-medium",children:f(p.summary.standardDeviation)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Coefficient of Variation:"}),e.jsxs("span",{className:"font-medium",children:[(100*p.summary.coefficientOfVariation).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Value at Risk (5%):"}),e.jsx("span",{className:"font-medium",children:f(p.summary.valueRange.min)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Upside Potential:"}),e.jsx("span",{className:"font-medium",children:f(p.summary.valueRange.range)})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Scenario Returns"}),e.jsx("div",{className:"space-y-2 text-sm",children:p.scenarios.map(s=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.name,":"]}),e.jsx("span",{className:"font-medium",children:"irr"===m.outputMetric?v(s.irr):"moic"===m.outputMetric?`${s.moic.toFixed(1)}x`:f(s[m.outputMetric])})]},s.id))})]})]})]}),!p&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(x,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Configure scenarios and run analysis to see results"})]})]})},We=({data:t,onDataChange:a})=>{const[i,n]=s.useState("overview"),[o,c]=s.useState([{symbol:"SPY",name:"SPDR S&P 500 ETF",price:445.67,change:2.34,changePercent:.53,category:"index"},{symbol:"QQQ",name:"Invesco QQQ Trust",price:378.91,change:-1.45,changePercent:-.38,category:"index"},{symbol:"VIX",name:"CBOE Volatility Index",price:18.45,change:.87,changePercent:4.95,category:"volatility"},{symbol:"DXY",name:"US Dollar Index",price:102.45,change:-.23,changePercent:-.22,category:"currency"},{symbol:"^TNX",name:"10-Year Treasury Yield",price:4.25,change:.05,changePercent:1.19,category:"rates"}]),[d,m]=s.useState({indices:{"S&P 500":{value:4456.78,change:23.45,changePercent:.53},NASDAQ:{value:13789.45,change:-45.67,changePercent:-.33},DOW:{value:34567.89,change:156.78,changePercent:.46},"Russell 2000":{value:1987.65,change:12.34,changePercent:.63}},sectors:[{name:"Technology",change:1.2,weight:23.5},{name:"Healthcare",change:.8,weight:13.2},{name:"Financial",change:-.4,weight:12.8},{name:"Consumer Disc.",change:.6,weight:10.9},{name:"Communication",change:-.2,weight:9.1},{name:"Industrials",change:.9,weight:8.7}],economicIndicators:{"Fed Funds Rate":{value:5.25,change:0,unit:"%"},"10Y Treasury":{value:4.25,change:.05,unit:"%"},"Inflation (CPI)":{value:3.1,change:-.2,unit:"%"},Unemployment:{value:3.8,change:.1,unit:"%"},"GDP Growth":{value:2.4,change:.1,unit:"%"}}}),[g,j]=s.useState([{id:1,type:"price",symbol:"SPY",condition:"above",value:450,active:!0},{id:2,type:"volatility",symbol:"VIX",condition:"above",value:20,active:!0}]),[f,v]=s.useState(""),[N,w]=s.useState(!1),C=s.useCallback(e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),[]),k=s.useCallback(e=>`${e>=0?"+":""}${e.toFixed(2)}%`,[]),R=s.useCallback(e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",[]),M=s.useCallback(e=>e>0?r:e<0?h:p,[]);s.useEffect(()=>{const e=setInterval(()=>{c(e=>e.map(e=>({...e,price:e.price+2*(Math.random()-.5),change:e.change+.5*(Math.random()-.5),changePercent:e.changePercent+.1*(Math.random()-.5)})))},5e3);return()=>clearInterval(e)},[]);const S=s.useCallback(async()=>{if(f.trim()){w(!0);try{await new Promise(e=>setTimeout(e,1e3));const e={symbol:f.toUpperCase(),name:`${f.toUpperCase()} Inc.`,price:200*Math.random()+50,change:10*(Math.random()-.5),changePercent:5*(Math.random()-.5),category:"stock"};c(s=>[...s,e]),v("")}catch(e){}finally{w(!1)}}},[f]),F=s.useCallback(e=>{c(s=>s.filter(s=>s.symbol!==e))},[]),D=s.useMemo(()=>{const e=new Date;return Array.from({length:30},(s,t)=>({time:new Date(e.getTime()-24*(29-t)*60*60*1e3).toLocaleDateString(),SPY:440+10*Math.sin(.2*t)+5*Math.random(),QQQ:370+15*Math.sin(.25*t)+8*Math.random(),VIX:20+5*Math.sin(.3*t)+3*Math.random()}))},[]),I=s.useMemo(()=>[{pair:"SPY vs QQQ",correlation:.85,strength:"Strong Positive"},{pair:"SPY vs VIX",correlation:-.72,strength:"Strong Negative"},{pair:"QQQ vs VIX",correlation:-.68,strength:"Moderate Negative"},{pair:"SPY vs DXY",correlation:-.45,strength:"Moderate Negative"}],[]);return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{className:"text-blue-600",size:28}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Market Data Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Real-time market insights & valuation integration"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(u.button,{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[e.jsx(K,{size:16}),e.jsx("span",{children:"Sync Data"})]}),e.jsxs(u.button,{className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[e.jsx(y,{size:16}),e.jsx("span",{children:"Settings"})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Market Overview",icon:Q},{id:"watchlist",label:"Watchlist",icon:x},{id:"charts",label:"Charts & Analysis",icon:J},{id:"alerts",label:"Alerts",icon:X}].map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>n(s.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(i===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[e.jsx(t,{size:16}),e.jsx("span",{children:s.label})]},s.id)})})}),"overview"===i&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Major Indices"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(d.indices).map(([s,t])=>{const a=M(t.change);return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:s}),e.jsx("div",{className:"text-xl font-bold text-gray-800",children:t.value.toLocaleString()}),e.jsxs("div",{className:`flex items-center space-x-1 text-sm ${R(t.change)}`,children:[e.jsx(a,{size:14}),e.jsxs("span",{children:[t.change>0?"+":"",t.change.toFixed(2)]}),e.jsxs("span",{children:["(",k(t.changePercent),")"]})]})]},s)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sector Performance"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:d.sectors.map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.weight,"% weight"]})]}),e.jsx("div",{className:`font-semibold ${R(s.change)}`,children:k(s.change)})]},s.name))})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Economic Indicators"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(d.economicIndicators).map(([s,t])=>e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:s}),e.jsxs("div",{className:"text-lg font-bold text-gray-800",children:[t.value,t.unit]}),e.jsxs("div",{className:`text-sm ${R(t.change)}`,children:[t.change>0?"+":"",t.change,t.unit]})]},s))})]})]}),"watchlist"===i&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Enter symbol (e.g., AAPL, MSFT)",value:f,onChange:e=>v(e.target.value.toUpperCase()),onKeyPress:e=>"Enter"===e.key&&S(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsxs(u.button,{onClick:S,disabled:N||!f.trim(),className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(N||!f.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"),whileHover:!N&&f.trim()?{scale:1.02}:{},children:[e.jsx(l,{size:16}),e.jsx("span",{children:N?"Adding...":"Add"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-300",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Symbol"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Name"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Price"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Change"}),e.jsx("th",{className:"text-right py-3 px-4",children:"Change %"}),e.jsx("th",{className:"text-center py-3 px-4",children:"Category"}),e.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(s=>{const t=M(s.change);return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-800",children:s.symbol}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.name}),e.jsx("td",{className:"text-right py-3 px-4 font-medium",children:C(s.price)}),e.jsx("td",{className:`text-right py-3 px-4 ${R(s.change)}`,children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx(t,{size:14}),e.jsxs("span",{children:[s.change>0?"+":"",s.change.toFixed(2)]})]})}),e.jsx("td",{className:`text-right py-3 px-4 font-medium ${R(s.changePercent)}`,children:k(s.changePercent)}),e.jsx("td",{className:"text-center py-3 px-4",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("index"===s.category?"bg-blue-100 text-blue-800":"stock"===s.category?"bg-green-100 text-green-800":"volatility"===s.category?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:s.category})}),e.jsx("td",{className:"text-center py-3 px-4",children:e.jsx("button",{onClick:()=>F(s.symbol),className:"text-red-600 hover:text-red-800",children:e.jsx(p,{size:16})})})]},s.symbol)})})]})})]}),"charts"===i&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"30-Day Price Performance"}),e.jsx("div",{className:"h-80",children:e.jsx(ne,{width:"100%",height:"100%",children:e.jsxs(be,{data:D,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"time"}),e.jsx(me,{}),e.jsx(xe,{}),e.jsx(je,{type:"monotone",dataKey:"SPY",stroke:"#3B82F6",strokeWidth:2,name:"S&P 500"}),e.jsx(je,{type:"monotone",dataKey:"QQQ",stroke:"#10B981",strokeWidth:2,name:"NASDAQ"}),e.jsx(je,{type:"monotone",dataKey:"VIX",stroke:"#EF4444",strokeWidth:2,name:"VIX"})]})})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Correlation Analysis"}),e.jsx("div",{className:"space-y-3",children:I.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:s.pair}),e.jsx("div",{className:"text-sm text-gray-600",children:s.strength})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-lg font-bold "+(Math.abs(s.correlation)>.7?"text-red-600":Math.abs(s.correlation)>.4?"text-yellow-600":"text-green-600"),children:s.correlation.toFixed(2)}),e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full "+(Math.abs(s.correlation)>.7?"bg-red-600":Math.abs(s.correlation)>.4?"bg-yellow-600":"bg-green-600"),style:{width:100*Math.abs(s.correlation)+"%"}})})]})]},t))})]})]}),"alerts"===i&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Active Alerts"}),e.jsx("div",{className:"space-y-3",children:g.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{className:"text-yellow-600",size:20}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-800",children:[s.symbol," ",s.type," alert"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Notify when ",s.type," goes ",s.condition," ",s.value]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(s.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.active?"Active":"Inactive"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",children:e.jsx(p,{size:16})})]})]},s.id))})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Market Status"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[e.jsx(L,{className:"text-green-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:"US Markets"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Open (6h 23m remaining)"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[e.jsx(Y,{className:"text-yellow-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:"European Markets"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Closed"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[e.jsx(Y,{className:"text-red-600",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:"Asian Markets"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Closed"})]})]})]})]})]})]})},_e=({data:t,dcfResults:a,lboResults:i,financialModel:l,scenarioResults:n,onDataChange:o})=>{const[c,d]=s.useState("unified"),[m,x]=s.useState({iterations:1e4,confidenceLevel:.95,correlationsEnabled:!0,crossModelAnalysis:!0,riskMetrics:["var","cvar","downside"]}),[h,p]=s.useState(null),[g,y]=s.useState(!1),[j,f]=s.useState(0),v=s.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),N=s.useCallback(e=>`${(100*e).toFixed(1)}%`,[]),w=s.useCallback(async()=>{y(!0),f(0);try{const e={dcf:null,lbo:null,correlation:null,portfolio:null,riskMetrics:null};if(a&&m.crossModelAnalysis){const s={revenueGrowthRate:{type:"normal",parameters:{mean:.05,stdDev:.02},enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.1,mode:.15,max:.2},enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},enabled:!0}},i={currentRevenue:1e3*t?.statements?.incomeStatement?.totalRevenue?.[0]||1e6,currentPrice:100,sharesOutstanding:1e6,...a};f(25),e.dcf=await De.runDCFSimulation(i,s,{iterations:m.iterations,confidenceLevel:m.confidenceLevel,onProgress:e=>f(25+.25*e)})}if(i&&m.crossModelAnalysis){const s={ebitdaGrowthRate:{type:"normal",parameters:{mean:.06,stdDev:.02},enabled:!0},exitMultiple:{type:"triangular",parameters:{min:8,mode:10,max:12},enabled:!0},leverageRatio:{type:"normal",parameters:{mean:5.5,stdDev:.5},enabled:!0}};f(50),e.lbo=await De.runLBOSimulation(i.inputs||{},s,{iterations:m.iterations,confidenceLevel:m.confidenceLevel,onProgress:e=>f(50+.25*e)})}e.dcf&&e.lbo&&m.correlationsEnabled&&(f(75),e.correlation=C(e.dcf,e.lbo)),f(90),e.riskMetrics=R(e),n&&n.scenarios&&(e.portfolio=S(e,n)),f(100),p(e),o&&o({monteCarloIntegrated:{settings:m,results:e,timestamp:(new Date).toISOString()}})}catch(e){alert(`Simulation error: ${e.message}`)}finally{y(!1),f(0)}},[a,i,n,m,t,o]),C=s.useCallback((e,s)=>{const t=e.simulations?.map(e=>e.pricePerShare)||[],a=s.simulations?.map(e=>e.irr)||[];if(0===t.length||0===a.length)return null;const i=k(t,a);return{dcfLboCorrelation:i,interpretation:Math.abs(i)>.7?"Strong":Math.abs(i)>.4?"Moderate":"Weak",riskImplication:i>0?"Aligned Risk":"Hedged Risk"}},[]),k=(e,s)=>{const t=Math.min(e.length,s.length);if(0===t)return 0;const a=e.slice(0,t).reduce((e,s)=>e+s,0),i=s.slice(0,t).reduce((e,s)=>e+s,0),r=e.slice(0,t).reduce((e,t,a)=>e+t*s[a],0),l=e.slice(0,t).reduce((e,s)=>e+s*s,0),n=s.slice(0,t).reduce((e,s)=>e+s*s,0),o=t*r-a*i,c=Math.sqrt((t*l-a*a)*(t*n-i*i));return 0===c?0:o/c},R=s.useCallback(e=>{const s={};return e.dcf?.analysis&&(s.dcf={var95:e.dcf.analysis.percentiles?.pricePerShare?.p5||0,expectedValue:e.dcf.analysis.summary?.mean||0,volatility:e.dcf.analysis.summary?.standardDeviation||0}),e.lbo?.analysis&&(s.lbo={var95:e.lbo.analysis.percentiles?.irr?.p5||0,expectedValue:e.lbo.analysis.summary?.mean||0,volatility:e.lbo.analysis.summary?.standardDeviation||0}),s},[]),S=s.useCallback((e,s)=>s.scenarios.reduce((s,t)=>{const a=t.probability/100;return e.dcf&&(s.dcfWeighted=(s.dcfWeighted||0)+(e.dcf.analysis?.summary?.mean||0)*a),e.lbo&&(s.lboWeighted=(s.lboWeighted||0)+(e.lbo.analysis?.summary?.mean||0)*a),s},{}),[]),F=[{id:"unified",label:"Unified Analysis",icon:D},{id:"dcf",label:"DCF Monte Carlo",icon:r},{id:"lbo",label:"LBO Monte Carlo",icon:M},{id:"correlation",label:"Cross-Model Risk",icon:b}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{className:"text-purple-600",size:28}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Monte Carlo Integration Hub"}),e.jsx("p",{className:"text-gray-600",children:"Cross-model risk analysis & unified simulations"})]})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsxs(u.button,{onClick:w,disabled:g,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(g?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:g?{}:{scale:1.02},whileTap:g?{}:{scale:.98},children:[e.jsx(I,{size:18}),e.jsx("span",{children:g?"Running...":"Run Integrated Simulation"})]})})]}),g&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Simulation Progress"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[j.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${j}%`}})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Simulation Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Iterations"}),e.jsx("input",{type:"number",value:m.iterations,onChange:e=>x(s=>({...s,iterations:parseInt(e.target.value)||1e4})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confidence Level"}),e.jsxs("select",{value:m.confidenceLevel,onChange:e=>x(s=>({...s,confidenceLevel:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:.9,children:"90%"}),e.jsx("option",{value:.95,children:"95%"}),e.jsx("option",{value:.99,children:"99%"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.correlationsEnabled,onChange:e=>x(s=>({...s,correlationsEnabled:e.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Cross-Model Correlations"})]})}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.crossModelAnalysis,onChange:e=>x(s=>({...s,crossModelAnalysis:e.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Cross-Model Analysis"})]})})]})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:F.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>d(s.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(c===s.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[e.jsx(t,{size:16}),e.jsx("span",{children:s.label})]},s.id)})})}),h?e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:["unified"===c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[h.dcf&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:v(h.dcf.analysis?.summary?.mean||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"DCF Expected Value"})]}),h.lbo&&e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N(h.lbo.analysis?.summary?.mean||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"LBO Expected IRR"})]}),h.correlation&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:(h.correlation.dcfLboCorrelation||0).toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-600",children:"DCF-LBO Correlation"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:m.iterations.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Simulations Run"})]})]}),h.correlation&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Cross-Model Risk Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Correlation Strength"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:h.correlation.interpretation}),e.jsx("div",{className:"text-sm text-gray-600",children:h.correlation.riskImplication})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Risk Diversification"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.abs(h.correlation.dcfLboCorrelation)<.5?"High":"Low"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Portfolio benefit"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Confidence Level"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N(m.confidenceLevel)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Statistical confidence"})]})]})]}),h.portfolio&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Portfolio-Weighted Analysis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Scenario-Weighted DCF"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:v(h.portfolio.dcfWeighted||0)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Scenario-Weighted LBO IRR"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:N(h.portfolio.lboWeighted||0)})]})]})]})]}),"dcf"===c&&h.dcf&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"DCF Monte Carlo Results"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:v(h.dcf.analysis?.summary?.mean||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Mean Value"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:v(h.dcf.analysis?.percentiles?.pricePerShare?.p95||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"95th Percentile"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:v(h.dcf.analysis?.percentiles?.pricePerShare?.p5||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"5th Percentile"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:v(h.dcf.analysis?.summary?.standardDeviation||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Std Deviation"})]})]})]}),"lbo"===c&&h.lbo&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"LBO Monte Carlo Results"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:N(h.lbo.analysis?.summary?.mean||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Mean IRR"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:N(h.lbo.analysis?.percentiles?.irr?.p95||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"95th Percentile IRR"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:N(h.lbo.analysis?.percentiles?.irr?.p5||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"5th Percentile IRR"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:[((h.lbo.analysis?.percentiles?.moic?.p95||0)+(h.lbo.analysis?.percentiles?.moic?.p5||0))/2,"x"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg MOIC"})]})]})]})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(D,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Configure settings and run integrated simulation to see cross-model analysis"}),e.jsx("p",{className:"text-sm mt-2",children:a||i?"Ready to run comprehensive Monte Carlo analysis":"Run DCF and/or LBO analysis first to enable Monte Carlo integration"})]})]})},Ke=({financialData:t,currentMetric:a,analysisContext:i="general",onInsightClick:l,isVisible:n=!0,onToggle:o})=>{const[m,h]=s.useState({assumptions:!0,benchmarks:!0,insights:!0,suggestions:!1});s.useMemo(()=>({healthcare:{revenueGrowth:{min:8,median:15,max:25,unit:"%"},ebitdaMargin:{min:18,median:28,max:40,unit:"%"},grossMargin:{min:65,median:75,max:85,unit:"%"},roe:{min:12,median:18,max:25,unit:"%"}},technology:{revenueGrowth:{min:15,median:25,max:50,unit:"%"},ebitdaMargin:{min:20,median:35,max:50,unit:"%"},grossMargin:{min:70,median:80,max:90,unit:"%"},roe:{min:15,median:22,max:35,unit:"%"}},manufacturing:{revenueGrowth:{min:3,median:8,max:15,unit:"%"},ebitdaMargin:{min:10,median:18,max:25,unit:"%"},grossMargin:{min:25,median:35,max:45,unit:"%"},roe:{min:8,median:15,max:22,unit:"%"}}}),[]);const p=(()=>{const e=[];if(!t?.statements?.incomeStatement)return[{type:"info",title:"Getting Started",content:"Import financial data to see contextual insights and benchmarks.",action:"Import Data"}];const s=t.statements.incomeStatement,r=s.totalRevenue?.[2]||0,l=s.operatingIncome?.[2]||0;if(r>0){const s=l/r*100;e.push({type:"benchmark",title:"Operating Margin Analysis",content:`Current operating margin of ${s.toFixed(1)}% compares to healthcare industry median of 28%.`,metric:s,benchmark:28,status:s>=28?"above":s>=20?"within":"below"})}return"dcf"===i&&e.push({type:"assumption",title:"DCF Model Assumptions",content:"Consider industry-specific discount rates and terminal growth assumptions.",suggestions:["Healthcare companies typically use 8-12% WACC","Terminal growth rates should reflect long-term GDP growth (2-3%)","Consider regulatory risks in discount rate adjustments"]}),a?.includes("revenue")&&e.push({type:"insight",title:"Revenue Growth Drivers",content:"Analyze revenue composition and growth sustainability.",suggestions:["Break down revenue by service line","Assess recurring vs. one-time revenue","Evaluate market expansion opportunities"]}),e})(),g=e=>{h(s=>({...s,[e]:!s[e]}))},b=(s,t,a,i)=>{const r=i-a,l=Math.max(0,Math.min(100,(s-a)/r*100)),n=Math.max(0,Math.min(100,(t-a)/r*100));return e.jsxs("div",{className:"relative h-2 bg-slate-200 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 h-full bg-blue-200 rounded-full",style:{width:`${n}%`}}),e.jsx("div",{className:"absolute top-0 h-full w-1 bg-blue-600 rounded-full",style:{left:`${n}%`}}),e.jsx("div",{className:"absolute top-0 h-full w-1 bg-amber-500 rounded-full",style:{left:`${l}%`}})]})};return n?e.jsxs(u.div,{initial:{x:320,opacity:0},animate:{x:0,opacity:1},exit:{x:320,opacity:0},className:"fixed right-0 top-16 bottom-0 w-80 bg-slate-50 border-l border-slate-200 shadow-xl z-40 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:e.jsx(x,{size:16,className:"text-blue-600"})}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"Contextual Insights"})]}),o&&e.jsx("button",{onClick:o,className:"p-1.5 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(Z,{size:16,className:"text-slate-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[e.jsxs("button",{onClick:()=>g("assumptions"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{size:16,className:"text-amber-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Key Assumptions"})]}),m.assumptions?e.jsx(c,{size:16,className:"text-slate-400"}):e.jsx(d,{size:16,className:"text-slate-400"})]}),e.jsx(A,{children:m.assumptions&&e.jsx(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Discount Rate"}),e.jsx("span",{className:"font-mono text-slate-900",children:"10.0%"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Terminal Growth"}),e.jsx("span",{className:"font-mono text-slate-900",children:"2.5%"})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Tax Rate"}),e.jsx("span",{className:"font-mono text-slate-900",children:"25.0%"})]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[e.jsxs("button",{onClick:()=>g("benchmarks"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:16,className:"text-emerald-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Industry Benchmarks"})]}),m.benchmarks?e.jsx(c,{size:16,className:"text-slate-400"}):e.jsx(d,{size:16,className:"text-slate-400"})]}),e.jsx(A,{children:m.benchmarks&&e.jsx(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Revenue Growth"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Healthcare Industry"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsx("span",{children:"8%"}),e.jsx("span",{className:"font-medium",children:"15% (median)"}),e.jsx("span",{children:"25%"})]}),b(12,15,8,25)]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-slate-600",children:"EBITDA Margin"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Healthcare Industry"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsx("span",{children:"18%"}),e.jsx("span",{className:"font-medium",children:"28% (median)"}),e.jsx("span",{children:"40%"})]}),b(24,28,18,40)]})]})})})]}),e.jsx("div",{className:"space-y-3",children:p.map((s,t)=>((s,t)=>{const a={info:"text-blue-500 bg-blue-50",benchmark:"text-emerald-500 bg-emerald-50",assumption:"text-amber-500 bg-amber-50",insight:"text-purple-500 bg-purple-50"},i={info:C,benchmark:M,assumption:O,insight:ee}[s.type]||C,r=a[s.type]||a.info;return e.jsx(u.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"p-4 bg-white rounded-lg border border-slate-200 hover:border-slate-300 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${r}`,children:e.jsx(i,{size:16})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-sm mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 mb-3",children:s.content}),void 0!==s.metric&&void 0!==s.benchmark&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsxs("span",{children:["Current: ",s.metric.toFixed(1),"%"]}),e.jsxs("span",{children:["Benchmark: ",s.benchmark,"%"]})]}),b(s.metric,s.benchmark,0,Math.max(1.5*s.benchmark,1.2*s.metric))]}),s.suggestions&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"space-y-1",children:s.suggestions.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs text-slate-600",children:[e.jsx(d,{size:12,className:"text-slate-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},t))})}),s.action&&e.jsx("button",{onClick:()=>l?.(s),className:"mt-3 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 text-xs font-medium rounded-md transition-colors",children:s.action})]})]})},t)})(s,t))}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[e.jsxs("button",{onClick:()=>g("suggestions"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{size:16,className:"text-purple-600"}),e.jsx("span",{className:"font-medium text-slate-900",children:"Smart Suggestions"})]}),m.suggestions?e.jsx(c,{size:16,className:"text-slate-400"}):e.jsx(d,{size:16,className:"text-slate-400"})]}),e.jsx(A,{children:m.suggestions&&e.jsx(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx(x,{size:14,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-900 mb-1",children:"Create Revenue vs CapEx Chart"}),e.jsx("div",{className:"text-xs text-blue-700",children:"Visualize the relationship between revenue growth and capital expenditure"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-emerald-50 rounded-lg",children:[e.jsx(r,{size:14,className:"text-emerald-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-emerald-900 mb-1",children:"Add Sensitivity Analysis"}),e.jsx("div",{className:"text-xs text-emerald-700",children:"Test how valuation changes with different assumptions"})]})]})]})})})]})]})})]}):null},Ye=({financialData:t,currentView:a,analysisContext:i,onCreateChart:r,onDismiss:n})=>{const[o,c]=s.useState([]),[m,h]=s.useState(new Set),p={line:{icon:J,name:"Line Chart",description:"Show trends over time",color:"text-blue-500 bg-blue-50"},bar:{icon:x,name:"Bar Chart",description:"Compare values across categories",color:"text-emerald-500 bg-emerald-50"},scatter:{icon:se,name:"Scatter Plot",description:"Explore relationships between metrics",color:"text-purple-500 bg-purple-50"},pie:{icon:v,name:"Pie Chart",description:"Show composition and proportions",color:"text-amber-500 bg-amber-50"},waterfall:{icon:b,name:"Waterfall Chart",description:"Show sequential changes in values",color:"text-teal-500 bg-teal-50"}},g=s.useMemo(()=>{if(!t?.statements?.incomeStatement)return[];const e=[],s=t.statements.incomeStatement,r=t.periods||[];if(s.totalRevenue&&r.length>=3){const t=r.map((e,t)=>s.totalRevenue[t]).filter(e=>null!=e);t.length>=3&&e.push({id:"revenue-trend",type:"line",title:"Revenue Growth Trend",description:"Visualize revenue performance over time with growth rate analysis",priority:"high",data:{xAxis:r,yAxis:t,metrics:["Total Revenue","Growth Rate"],chartType:"line"},insight:`Revenue shows ${t[t.length-1]>t[0]?"positive":"negative"} trend`,relevance:"analysis"===a?.9:.7})}const l=r.length-1,n=["energyDevices","injectables","wellness","weightloss","retailSales","surgery"].map(e=>({name:e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),value:s[e]?.[l]||0})).filter(e=>e.value>0);if(n.length>=3&&e.push({id:"revenue-composition",type:"pie",title:"Revenue Composition Analysis",description:"Break down revenue by business segments",priority:"medium",data:{segments:n,chartType:"pie"},insight:`${n.length} active revenue segments identified`,relevance:"data"===a?.8:.6}),s.totalRevenue&&s.operatingIncome&&r.length>=3){const t=r.map((e,t)=>{const a=s.totalRevenue[t],i=s.operatingIncome[t];return a>0?i/a*100:0}).filter(e=>0!==e);t.length>=3&&e.push({id:"margin-trend",type:"line",title:"Operating Margin Trend",description:"Track profitability efficiency over time",priority:"high",data:{xAxis:r,yAxis:t,format:"percentage",chartType:"line"},insight:"Operating margin "+(t[t.length-1]>t[0]?"improving":"declining"),relevance:"analysis"===a?.9:.7})}const o=["totalCostOfGoodsSold","totalSalariesBenefits","totalOperatingExpense"].map(e=>({name:e.replace(/total|([A-Z])/g," $1").trim().replace(/^./,e=>e.toUpperCase()),value:s[e]?.[l]||0})).filter(e=>e.value>0);if(o.length>=2&&e.push({id:"cost-structure",type:"bar",title:"Cost Structure Analysis",description:"Compare major cost categories",priority:"medium",data:{categories:o,chartType:"bar"},insight:`${o.length} major cost categories tracked`,relevance:"modeling"===a?.8:.6}),s.totalRevenue&&s.operatingIncome&&r.length>=4){const t=r.map((e,t)=>s.totalRevenue[t]||0),a=r.map((e,t)=>s.operatingIncome[t]||0);t.some(e=>e>0)&&a.some(e=>e>0)&&e.push({id:"revenue-operating-correlation",type:"scatter",title:"Revenue vs Operating Income",description:"Analyze operational efficiency relationship",priority:"medium",data:{xAxis:t,yAxis:a,xLabel:"Revenue",yLabel:"Operating Income",chartType:"scatter"},insight:"Explore operational leverage and efficiency",relevance:"dcf"===i?.8:.6})}if(t.statements?.cashFlowStatement){const s=t.statements.cashFlowStatement,i=[{name:"Operating Cash Flow",value:s.operatingCashFlow?.[l]||0},{name:"Investing Cash Flow",value:s.investingCashFlow?.[l]||0},{name:"Financing Cash Flow",value:s.financingCashFlow?.[l]||0}].filter(e=>0!==e.value);i.length>=2&&e.push({id:"cash-flow-waterfall",type:"waterfall",title:"Cash Flow Components",description:"Visualize cash flow generation and usage",priority:"high",data:{components:i,chartType:"waterfall"},insight:"Understand cash flow dynamics",relevance:"analysis"===a?.9:.7})}return e.sort((e,s)=>{const t={high:3,medium:2,low:1},a=t[e.priority]+e.relevance;return t[s.priority]+s.relevance-a})},[t,a,i]),y=s.useMemo(()=>g.filter(e=>!m.has(e.id)),[g,m]);s.useEffect(()=>{c(y.slice(0,4))},[y]);const j=e=>{switch(e){case"high":return"border-red-200 bg-red-50";case"medium":return"border-yellow-200 bg-yellow-50";default:return"border-gray-200 bg-gray-50"}},f=s=>{switch(s){case"high":return e.jsx(D,{size:12,className:"text-red-500"});case"medium":return e.jsx(M,{size:12,className:"text-yellow-500"});default:return e.jsx(ee,{size:12,className:"text-gray-500"})}};return 0===o.length?null:e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-slate-200 shadow-sm p-4 mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:e.jsx(x,{size:16,className:"text-blue-600"})}),e.jsx("h3",{className:"font-semibold text-slate-900",children:"Smart Chart Suggestions"}),e.jsxs("div",{className:"px-2 py-1 bg-blue-50 text-blue-700 text-xs font-medium rounded-full",children:[o.length," suggested"]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(A,{children:o.map((s,t)=>{const a=p[s.type],i=a.icon;return e.jsxs(u.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{delay:.1*t},className:`relative p-4 rounded-lg border ${j(s.priority)} hover:shadow-md transition-all duration-200 group`,children:[e.jsx("button",{onClick:()=>{return e=s.id,h(s=>new Set([...s,e])),void(n&&n(e));var e},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1 hover:bg-white rounded-full transition-all duration-200",children:e.jsx(Z,{size:14,className:"text-slate-400 hover:text-slate-600"})}),e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[f(s.priority),e.jsxs("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:[s.priority," Priority"]})]}),e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.color}`,children:e.jsx(i,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-slate-900 text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-xs text-slate-600 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"px-2 py-1 bg-slate-100 text-slate-700 rounded-md font-medium",children:a.name}),e.jsx("span",{className:"text-slate-500",children:"•"}),e.jsx("span",{className:"text-slate-500",children:s.insight})]})]})]}),e.jsxs("button",{onClick:()=>(e=>{r&&r(e)})(s),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 text-sm font-medium rounded-md transition-colors duration-200",children:[e.jsx(l,{size:14}),"Create Chart",e.jsx(d,{size:14})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-slate-500",children:[e.jsx("span",{children:"Relevance to current view"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-16 h-1.5 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-300",style:{width:100*s.relevance+"%"}})}),e.jsxs("span",{className:"font-medium",children:[Math.round(100*s.relevance),"%"]})]})]})]},s.id)})})}),y.length>o.length&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("button",{onClick:()=>c(y.slice(0,o.length+2)),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:["Show ",Math.min(2,y.length-o.length)," more suggestions"]})})]})},He="1.0.0",Qe="financeanalyst_",Je={enabled:!0,threshold:1024},Xe={maxSize:52428800,cleanupThreshold:.8},Ze={dcfModel:{version:"1.0",required:["symbol","assumptions","projections","valuation"],structure:{symbol:"string",assumptions:"object",projections:"object",valuation:"object",metadata:"object"}},lboModel:{version:"1.0",required:["symbol","transaction","financing","returns"],structure:{symbol:"string",transaction:"object",financing:"object",returns:"object",metadata:"object"}},monteCarloResults:{version:"1.0",required:["modelType","iterations","results","statistics"],structure:{modelType:"string",iterations:"number",results:"array",statistics:"object",metadata:"object"}},userPreferences:{version:"1.0",required:["theme","layout"],structure:{theme:"string",layout:"object",notifications:"object",privacy:"object"}},marketData:{version:"1.0",required:["symbol","data","timestamp"],structure:{symbol:"string",data:"object",timestamp:"number",source:"string"}}};const es=new class{constructor(){this.isAvailable=this.checkStorageAvailability(),this.compressionWorker=null,this.initializeCompression(),this.setupQuotaMonitoring()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return Ce.log("ERROR","localStorage not available",{error:e.message}),!1}}initializeCompression(){"CompressionStream"in window?this.compressionAvailable=!0:this.compressionAvailable=!1}setupQuotaMonitoring(){"storage"in navigator&&"estimate"in navigator.storage&&this.monitorQuota()}async monitorQuota(){try{const e=await navigator.storage.estimate(),s=e.usage/e.quota;s>Xe.cleanupThreshold&&(Ce.log("WARN","Storage quota threshold exceeded",{usage:e.usage,quota:e.quota,ratio:s}),await this.performCleanup())}catch(e){Ce.log("ERROR","Failed to monitor storage quota",{error:e.message})}}generateKey(e,s){return`${Qe}${e}_${s}`}validateData(e,s){const t=Ze[s];if(!t)throw new Error(`Unknown schema type: ${s}`);for(const a of t.required)if(!(a in e))throw new Error(`Missing required field: ${a}`);for(const[a,i]of Object.entries(t.structure))if(a in e){const s=Array.isArray(e[a])?"array":typeof e[a];if(s!==i)throw new Error(`Invalid type for ${a}: expected ${i}, got ${s}`)}return!0}async compressData(e){const s=JSON.stringify(e);if(s.length<Je.threshold||!this.compressionAvailable)return{data:s,compressed:!1};try{return{data:await this.simpleCompress(s),compressed:!0}}catch(t){return Ce.log("WARN","Compression failed, storing uncompressed",{error:t.message}),{data:s,compressed:!1}}}async simpleCompress(e){return btoa(encodeURIComponent(e))}async decompressData(e,s){if(!s)return e;try{return decodeURIComponent(atob(e))}catch(t){throw Ce.log("ERROR","Decompression failed",{error:t.message}),new Error("Failed to decompress data")}}async setItem(e,s,t,a={}){if(!this.isAvailable)throw new Error("Storage not available");try{Ze[e]&&this.validateData(t,e);const i={version:He,schemaVersion:Ze[e]?.version||"1.0",timestamp:Date.now(),data:t,metadata:{type:e,identifier:s,size:JSON.stringify(t).length,...a.metadata}},{data:r,compressed:l}=await this.compressData(i),n={compressed:l,data:r},o=this.generateKey(e,s);return localStorage.setItem(o,JSON.stringify(n)),Ce.log("DEBUG","Data stored successfully",{key:o,type:e,identifier:s,compressed:l,size:r.length}),!0}catch(i){throw Ce.log("ERROR","Failed to store data",{type:e,identifier:s,error:i.message}),i}}async getItem(e,s){if(!this.isAvailable)return null;try{const t=this.generateKey(e,s),a=localStorage.getItem(t);if(!a)return null;const i=JSON.parse(a),r=await this.decompressData(i.data,i.compressed),l=JSON.parse(r);return l.version!==He&&Ce.log("WARN","Version mismatch detected",{stored:l.version,current:He}),Ce.log("DEBUG","Data retrieved successfully",{key:t,type:e,identifier:s,age:Date.now()-l.timestamp}),l.data}catch(t){return Ce.log("ERROR","Failed to retrieve data",{type:e,identifier:s,error:t.message}),null}}removeItem(e,s){if(!this.isAvailable)return!1;try{const t=this.generateKey(e,s);return localStorage.removeItem(t),Ce.log("DEBUG","Data removed successfully",{key:t,type:e,identifier:s}),!0}catch(t){return Ce.log("ERROR","Failed to remove data",{type:e,identifier:s,error:t.message}),!1}}listItems(e){if(!this.isAvailable)return[];const s=this.generateKey(e,""),t=[];for(let a=0;a<localStorage.length;a++){const e=localStorage.key(a);if(e&&e.startsWith(s)){const a=e.replace(s,"");t.push(a)}}return t}async performCleanup(){const e=Date.now()-2592e6;let s=0;for(let a=localStorage.length-1;a>=0;a--){const i=localStorage.key(a);if(i&&i.startsWith(Qe))try{const t=localStorage.getItem(i),a=JSON.parse(t),r=await this.decompressData(a.data,a.compressed);JSON.parse(r).timestamp<e&&(localStorage.removeItem(i),s++)}catch(t){localStorage.removeItem(i),s++}}return Ce.log("INFO","Storage cleanup completed",{cleanedCount:s}),s}async getStorageStats(){let e=0,s=0;const t={};for(let i=0;i<localStorage.length;i++){const a=localStorage.key(i);if(a&&a.startsWith(Qe)){e+=localStorage.getItem(a).length,s++;const i=a.split("_")[1];i&&(t[i]=(t[i]||0)+1)}}const a=await this.getQuotaInfo();return{totalSize:e,itemCount:s,typeStats:t,quota:a,usageRatio:a?e/a.quota:0}}async getQuotaInfo(){if("storage"in navigator&&"estimate"in navigator.storage)try{return await navigator.storage.estimate()}catch(e){Ce.log("ERROR","Failed to get quota info",{error:e.message})}return null}clearAll(){if(!this.isAvailable)return!1;const e=[];for(let s=0;s<localStorage.length;s++){const t=localStorage.key(s);t&&t.startsWith(Qe)&&e.push(t)}return e.forEach(e=>localStorage.removeItem(e)),Ce.log("INFO","All application data cleared",{clearedCount:e.length}),!0}};const ss=new class{constructor(){this.storage=es}async saveDCFModel(e,s){try{const t={symbol:e.toUpperCase(),assumptions:s.assumptions||{},projections:s.projections||{},valuation:s.valuation||{},metadata:{createdAt:Date.now(),lastModified:Date.now(),version:"1.0",modelType:"DCF",...s.metadata}};return await this.storage.setItem("dcfModel",e.toUpperCase(),t),Ce.log("INFO","DCF model saved",{symbol:e,valuation:t.valuation.intrinsicValue}),!0}catch(t){throw Ce.log("ERROR","Failed to save DCF model",{symbol:e,error:t.message}),t}}async getDCFModel(e){try{const s=await this.storage.getItem("dcfModel",e.toUpperCase());return s&&Ce.log("DEBUG","DCF model retrieved",{symbol:e}),s}catch(s){return Ce.log("ERROR","Failed to retrieve DCF model",{symbol:e,error:s.message}),null}}async listDCFModels(){return this.storage.listItems("dcfModel")}async deleteDCFModel(e){return this.storage.removeItem("dcfModel",e.toUpperCase())}async saveLBOModel(e,s){try{const t={symbol:e.toUpperCase(),transaction:s.transaction||{},financing:s.financing||{},returns:s.returns||{},metadata:{createdAt:Date.now(),lastModified:Date.now(),version:"1.0",modelType:"LBO",...s.metadata}};return await this.storage.setItem("lboModel",e.toUpperCase(),t),Ce.log("INFO","LBO model saved",{symbol:e,irr:t.returns.irr,moic:t.returns.moic}),!0}catch(t){throw Ce.log("ERROR","Failed to save LBO model",{symbol:e,error:t.message}),t}}async getLBOModel(e){try{const s=await this.storage.getItem("lboModel",e.toUpperCase());return s&&Ce.log("DEBUG","LBO model retrieved",{symbol:e}),s}catch(s){return Ce.log("ERROR","Failed to retrieve LBO model",{symbol:e,error:s.message}),null}}async listLBOModels(){return this.storage.listItems("lboModel")}async deleteLBOModel(e){return this.storage.removeItem("lboModel",e.toUpperCase())}async saveMonteCarloResults(e,s){try{const t={modelType:s.modelType||"DCF",iterations:s.iterations||1e4,results:s.results||[],statistics:s.statistics||{},metadata:{createdAt:Date.now(),modelId:e,symbol:s.symbol,version:"1.0",...s.metadata}};return await this.storage.setItem("monteCarloResults",e,t),Ce.log("INFO","Monte Carlo results saved",{modelId:e,iterations:t.iterations,mean:t.statistics.mean}),!0}catch(t){throw Ce.log("ERROR","Failed to save Monte Carlo results",{modelId:e,error:t.message}),t}}async getMonteCarloResults(e){try{const s=await this.storage.getItem("monteCarloResults",e);return s&&Ce.log("DEBUG","Monte Carlo results retrieved",{modelId:e}),s}catch(s){return Ce.log("ERROR","Failed to retrieve Monte Carlo results",{modelId:e,error:s.message}),null}}async listMonteCarloResults(){return this.storage.listItems("monteCarloResults")}async deleteMonteCarloResults(e){return this.storage.removeItem("monteCarloResults",e)}async saveMarketData(e,s,t=15){try{const a={symbol:e.toUpperCase(),data:s,timestamp:Date.now(),source:s.source||"unknown",expiresAt:Date.now()+60*t*1e3};return await this.storage.setItem("marketData",e.toUpperCase(),a),Ce.log("DEBUG","Market data cached",{symbol:e,source:a.source,ttlMinutes:t}),!0}catch(a){throw Ce.log("ERROR","Failed to cache market data",{symbol:e,error:a.message}),a}}async getMarketData(e){try{const s=await this.storage.getItem("marketData",e.toUpperCase());return s&&s.expiresAt>Date.now()?(Ce.log("DEBUG","Market data cache hit",{symbol:e}),s.data):(s&&(await this.deleteMarketData(e),Ce.log("DEBUG","Market data cache expired",{symbol:e})),null)}catch(s){return Ce.log("ERROR","Failed to retrieve market data",{symbol:e,error:s.message}),null}}async deleteMarketData(e){return this.storage.removeItem("marketData",e.toUpperCase())}async saveUserPreferences(e){try{const s={theme:e.theme||"light",layout:e.layout||{},notifications:e.notifications||{},privacy:e.privacy||{},metadata:{lastUpdated:Date.now(),version:"1.0"}};return await this.storage.setItem("userPreferences","default",s),Ce.log("INFO","User preferences saved",{theme:s.theme}),!0}catch(s){throw Ce.log("ERROR","Failed to save user preferences",{error:s.message}),s}}async getUserPreferences(){try{const e=await this.storage.getItem("userPreferences","default");return e&&Ce.log("DEBUG","User preferences retrieved"),e}catch(e){return Ce.log("ERROR","Failed to retrieve user preferences",{error:e.message}),null}}async saveWatchlist(e,s){try{const t={name:e,symbols:s.map(e=>e.toUpperCase()),metadata:{createdAt:Date.now(),lastModified:Date.now(),symbolCount:s.length}};return await this.storage.setItem("watchlist",e,t),Ce.log("INFO","Watchlist saved",{name:e,symbolCount:s.length}),!0}catch(t){throw Ce.log("ERROR","Failed to save watchlist",{name:e,error:t.message}),t}}async getWatchlist(e){try{const s=await this.storage.getItem("watchlist",e);return s&&Ce.log("DEBUG","Watchlist retrieved",{name:e}),s}catch(s){return Ce.log("ERROR","Failed to retrieve watchlist",{name:e,error:s.message}),null}}async listWatchlists(){return this.storage.listItems("watchlist")}async deleteWatchlist(e){return this.storage.removeItem("watchlist",e)}async exportAllData(){try{const e={timestamp:Date.now(),version:"1.0",data:{dcfModels:{},lboModels:{},monteCarloResults:{},watchlists:{},userPreferences:null}},s=await this.listDCFModels();for(const r of s)e.data.dcfModels[r]=await this.getDCFModel(r);const t=await this.listLBOModels();for(const r of t)e.data.lboModels[r]=await this.getLBOModel(r);const a=await this.listMonteCarloResults();for(const r of a)e.data.monteCarloResults[r]=await this.getMonteCarloResults(r);const i=await this.listWatchlists();for(const r of i)e.data.watchlists[r]=await this.getWatchlist(r);return e.data.userPreferences=await this.getUserPreferences(),Ce.log("INFO","Data export completed",{dcfCount:s.length,lboCount:t.length,mcCount:a.length,watchlistCount:i.length}),e}catch(e){throw Ce.log("ERROR","Failed to export data",{error:e.message}),e}}async importData(e){try{let s=0;if(e.data.dcfModels)for(const[t,a]of Object.entries(e.data.dcfModels))await this.saveDCFModel(t,a),s++;if(e.data.lboModels)for(const[t,a]of Object.entries(e.data.lboModels))await this.saveLBOModel(t,a),s++;if(e.data.monteCarloResults)for(const[t,a]of Object.entries(e.data.monteCarloResults))await this.saveMonteCarloResults(t,a),s++;if(e.data.watchlists)for(const[t,a]of Object.entries(e.data.watchlists))await this.saveWatchlist(t,a.symbols),s++;return e.data.userPreferences&&(await this.saveUserPreferences(e.data.userPreferences),s++),Ce.log("INFO","Data import completed",{importCount:s}),s}catch(s){throw Ce.log("ERROR","Failed to import data",{error:s.message}),s}}async getFinancialDataStats(){return{...await this.storage.getStorageStats(),financialData:{dcfModels:(await this.listDCFModels()).length,lboModels:(await this.listLBOModels()).length,monteCarloResults:(await this.listMonteCarloResults()).length,watchlists:(await this.listWatchlists()).length}}}async cleanupExpiredMarketData(){const e=this.storage.listItems("marketData");let s=0;for(const t of e){const e=await this.storage.getItem("marketData",t);e&&e.expiresAt<=Date.now()&&(await this.deleteMarketData(t),s++)}return Ce.log("INFO","Expired market data cleaned",{cleanedCount:s}),s}},ts=({data:a,onDataChange:i,savedAnalyses:r,onAnalysesChange:l})=>{const[o,c]=s.useState("excel"),[d,m]=s.useState(!1),[x,u]=s.useState(!1),[h,p]=s.useState(null),[g,b]=s.useState(null),[y,j]=s.useState(null),[f,v]=s.useState([{id:1,name:"Standard 3-Statement Model",category:"General",lastUsed:"2024-01-15",uses:42},{id:2,name:"SaaS DCF Template",category:"Technology",lastUsed:"2024-01-10",uses:28},{id:3,name:"LBO Analysis Template",category:"Private Equity",lastUsed:"2024-01-05",uses:35}]),[N,w]=s.useState([{id:1,name:"John Smith",email:"john@company.com",role:"Analyst",lastActive:"2 min ago",avatar:"JS"},{id:2,name:"Sarah Johnson",email:"sarah@company.com",role:"VP",lastActive:"1 hour ago",avatar:"SJ"}]);t.useEffect(()=>{k()},[]);const k=async()=>{try{const e=await ss.getFinancialDataStats();j(e)}catch(e){Ce.log("ERROR","Failed to load storage stats",{error:e.message})}},M=async()=>{m(!0),p(null);try{const e=await ss.exportAllData(),s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`financeanalyst_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),p({type:"success",message:"Data exported successfully",details:{dcfModels:Object.keys(e.data.dcfModels).length,lboModels:Object.keys(e.data.lboModels).length,monteCarloResults:Object.keys(e.data.monteCarloResults).length,watchlists:Object.keys(e.data.watchlists).length}}),Ce.log("INFO","Data export completed",{totalItems:Object.keys(e.data.dcfModels).length+Object.keys(e.data.lboModels).length+Object.keys(e.data.monteCarloResults).length+Object.keys(e.data.watchlists).length})}catch(e){p({type:"error",message:"Export failed",details:e.message}),Ce.log("ERROR","Data export failed",{error:e.message})}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Data Management"}),e.jsx("button",{onClick:onClose,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"×"})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"excel",label:"Excel Integration",icon:U},{id:"templates",label:"Templates",icon:te},{id:"collaboration",label:"Collaboration",icon:R},{id:"export",label:"Export",icon:P},{id:"import",label:"Import",icon:ae},{id:"stats",label:"Statistics",icon:G}].map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>c(s.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(o===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.id)})})}),e.jsxs("div",{className:"p-6",children:["excel"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Excel Integration"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Connect your Excel spreadsheets to FinanceAnalyst for seamless data synchronization."})]})]})}),e.jsx("button",{onClick:M,disabled:d,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Export All Data"]})}),h&&e.jsx("div",{className:"border rounded-lg p-4 "+("success"===h.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-start",children:["success"===h.type?e.jsx(L,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):e.jsx(Y,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium "+("success"===h.type?"text-green-900":"text-red-900"),children:h.message}),"success"===h.type&&h.details&&e.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[e.jsx("p",{children:"Exported items:"}),e.jsxs("ul",{className:"list-disc list-inside ml-4",children:[e.jsxs("li",{children:[h.details.dcfModels," DCF Models"]}),e.jsxs("li",{children:[h.details.lboModels," LBO Models"]}),e.jsxs("li",{children:[h.details.monteCarloResults," Monte Carlo Results"]}),e.jsxs("li",{children:[h.details.watchlists," Watchlists"]})]})]}),"error"===h.type&&e.jsx("p",{className:"text-sm text-red-700 mt-1",children:h.details})]})]})})]}),"templates"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.category}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Last used: ",s.lastUsed]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Uses: ",s.uses]})]},s.id))})]}),"collaboration"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Collaboration"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Role: ",s.role]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Last active: ",s.lastActive]})]},s.id))})]}),"export"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900",children:"Export Your Data"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Download all your financial models, analysis results, and preferences as a backup file."})]})]})}),e.jsx("button",{onClick:M,disabled:d,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Export All Data"]})}),h&&e.jsx("div",{className:"border rounded-lg p-4 "+("success"===h.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-start",children:["success"===h.type?e.jsx(L,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):e.jsx(Y,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium "+("success"===h.type?"text-green-900":"text-red-900"),children:h.message}),"success"===h.type&&h.details&&e.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[e.jsx("p",{children:"Exported items:"}),e.jsxs("ul",{className:"list-disc list-inside ml-4",children:[e.jsxs("li",{children:[h.details.dcfModels," DCF Models"]}),e.jsxs("li",{children:[h.details.lboModels," LBO Models"]}),e.jsxs("li",{children:[h.details.monteCarloResults," Monte Carlo Results"]}),e.jsxs("li",{children:[h.details.watchlists," Watchlists"]})]})]}),"error"===h.type&&e.jsx("p",{className:"text-sm text-red-700 mt-1",children:h.details})]})]})})]}),"import"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Y,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-amber-900",children:"Import Data"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"Import data from a backup file. This will add to your existing data."})]})]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx(n,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Choose backup file"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Select a JSON backup file to import"}),e.jsx("input",{type:"file",accept:".json",onChange:async e=>{const s=e.target.files[0];if(s){u(!0),b(null);try{const e=await s.text(),t=JSON.parse(e);if(!t.data||!t.version)throw new Error("Invalid backup file format");const a=await ss.importData(t);b({type:"success",message:"Data imported successfully",details:{importCount:a,timestamp:new Date(t.timestamp).toLocaleString()}}),await k(),Ce.log("INFO","Data import completed",{importCount:a})}catch(t){b({type:"error",message:"Import failed",details:t.message}),Ce.log("ERROR","Data import failed",{error:t.message})}finally{u(!1),e.target.value=""}}},disabled:x,className:"hidden"})]})]}),x&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(ie,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Importing data..."})]}),g&&e.jsx("div",{className:"border rounded-lg p-4 "+("success"===g.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-start",children:["success"===g.type?e.jsx(L,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):e.jsx(Y,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium "+("success"===g.type?"text-green-900":"text-red-900"),children:g.message}),"success"===g.type&&g.details&&e.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[e.jsxs("p",{children:["Imported ",g.details.importCount," items"]}),e.jsxs("p",{children:["Backup created: ",g.details.timestamp]})]}),"error"===g.type&&e.jsx("p",{className:"text-sm text-red-700 mt-1",children:g.details})]})]})})]}),"stats"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Storage Statistics"}),y?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Storage Usage"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Size:"}),e.jsx("span",{className:"font-medium",children:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(y.totalSize)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Items:"}),e.jsx("span",{className:"font-medium",children:y.itemCount})]}),y.quota&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Usage:"}),e.jsxs("span",{className:"font-medium",children:[(100*y.usageRatio).toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Financial Data"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"DCF Models:"}),e.jsx("span",{className:"font-medium",children:y.financialData.dcfModels})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"LBO Models:"}),e.jsx("span",{className:"font-medium",children:y.financialData.lboModels})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Monte Carlo Results:"}),e.jsx("span",{className:"font-medium",children:y.financialData.monteCarloResults})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Watchlists:"}),e.jsx("span",{className:"font-medium",children:y.financialData.watchlists})]})]})]})]}):e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ie,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Loading statistics..."})]})]})]})]})})},as={healthcare:{name:"Healthcare & Life Sciences",metrics:{revenueGrowth:{p25:8,median:15,p75:25,unit:"%",description:"Annual revenue growth rate"},ebitdaMargin:{p25:18,median:28,p75:40,unit:"%",description:"EBITDA as percentage of revenue"},grossMargin:{p25:65,median:75,p75:85,unit:"%",description:"Gross profit margin"},operatingMargin:{p25:12,median:20,p75:32,unit:"%",description:"Operating income as percentage of revenue"},netMargin:{p25:8,median:15,p75:25,unit:"%",description:"Net income margin"},roe:{p25:12,median:18,p75:25,unit:"%",description:"Return on equity"},roa:{p25:6,median:10,p75:15,unit:"%",description:"Return on assets"},debtToEquity:{p25:.2,median:.4,p75:.8,unit:"x",description:"Total debt to equity ratio"},currentRatio:{p25:1.2,median:1.8,p75:2.5,unit:"x",description:"Current assets to current liabilities"},assetTurnover:{p25:.6,median:.9,p75:1.3,unit:"x",description:"Revenue to total assets ratio"},wacc:{p25:8,median:10,p75:12,unit:"%",description:"Weighted average cost of capital"},terminalGrowth:{p25:2,median:2.5,p75:3,unit:"%",description:"Long-term terminal growth rate"}}},technology:{name:"Technology & Software",metrics:{revenueGrowth:{p25:15,median:25,p75:50,unit:"%",description:"Annual revenue growth rate"},ebitdaMargin:{p25:20,median:35,p75:50,unit:"%",description:"EBITDA as percentage of revenue"},grossMargin:{p25:70,median:80,p75:90,unit:"%",description:"Gross profit margin"},operatingMargin:{p25:15,median:25,p75:40,unit:"%",description:"Operating income as percentage of revenue"},netMargin:{p25:10,median:18,p75:30,unit:"%",description:"Net income margin"},roe:{p25:15,median:22,p75:35,unit:"%",description:"Return on equity"},roa:{p25:8,median:15,p75:25,unit:"%",description:"Return on assets"},debtToEquity:{p25:.1,median:.3,p75:.6,unit:"x",description:"Total debt to equity ratio"},currentRatio:{p25:1.5,median:2.2,p75:3.5,unit:"x",description:"Current assets to current liabilities"},assetTurnover:{p25:.4,median:.7,p75:1.1,unit:"x",description:"Revenue to total assets ratio"},wacc:{p25:9,median:12,p75:15,unit:"%",description:"Weighted average cost of capital"},terminalGrowth:{p25:2.5,median:3,p75:3.5,unit:"%",description:"Long-term terminal growth rate"}}},manufacturing:{name:"Manufacturing & Industrial",metrics:{revenueGrowth:{p25:3,median:8,p75:15,unit:"%",description:"Annual revenue growth rate"},ebitdaMargin:{p25:10,median:18,p75:25,unit:"%",description:"EBITDA as percentage of revenue"},grossMargin:{p25:25,median:35,p75:45,unit:"%",description:"Gross profit margin"},operatingMargin:{p25:6,median:12,p75:20,unit:"%",description:"Operating income as percentage of revenue"},netMargin:{p25:4,median:8,p75:15,unit:"%",description:"Net income margin"},roe:{p25:8,median:15,p75:22,unit:"%",description:"Return on equity"},roa:{p25:4,median:8,p75:12,unit:"%",description:"Return on assets"},debtToEquity:{p25:.3,median:.6,p75:1.2,unit:"x",description:"Total debt to equity ratio"},currentRatio:{p25:1.1,median:1.5,p75:2.2,unit:"x",description:"Current assets to current liabilities"},assetTurnover:{p25:.8,median:1.2,p75:1.8,unit:"x",description:"Revenue to total assets ratio"},wacc:{p25:7,median:9,p75:11,unit:"%",description:"Weighted average cost of capital"},terminalGrowth:{p25:1.5,median:2,p75:2.5,unit:"%",description:"Long-term terminal growth rate"}}},retail:{name:"Retail & Consumer",metrics:{revenueGrowth:{p25:2,median:6,p75:12,unit:"%",description:"Annual revenue growth rate"},ebitdaMargin:{p25:8,median:15,p75:22,unit:"%",description:"EBITDA as percentage of revenue"},grossMargin:{p25:30,median:40,p75:55,unit:"%",description:"Gross profit margin"},operatingMargin:{p25:3,median:8,p75:15,unit:"%",description:"Operating income as percentage of revenue"},netMargin:{p25:2,median:5,p75:10,unit:"%",description:"Net income margin"},roe:{p25:10,median:16,p75:25,unit:"%",description:"Return on equity"},roa:{p25:3,median:6,p75:10,unit:"%",description:"Return on assets"},debtToEquity:{p25:.4,median:.7,p75:1.3,unit:"x",description:"Total debt to equity ratio"},currentRatio:{p25:.9,median:1.3,p75:1.8,unit:"x",description:"Current assets to current liabilities"},assetTurnover:{p25:1.2,median:1.8,p75:2.5,unit:"x",description:"Revenue to total assets ratio"},wacc:{p25:8,median:10,p75:12,unit:"%",description:"Weighted average cost of capital"},terminalGrowth:{p25:1.5,median:2,p75:2.5,unit:"%",description:"Long-term terminal growth rate"}}}};class is extends t.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,s){}render(){return this.state.hasError?this.props.fallback||e.jsx("div",{className:"p-8 text-center text-red-400",children:"Something went wrong. Please refresh the page."}):this.props.children}}const rs=()=>{const[t,r]=s.useState("spreadsheet"),[l,o]=s.useState({lbo:null,threeStatement:null,scenarios:null,marketData:null,monteCarlo:null}),[c,d]=s.useState(Re),[m,x]=s.useState({}),[h,p]=s.useState({dcf:{discountRate:10,terminalGrowthRate:2.5,projectionYears:5,taxRate:25},scenario:{scenarios:[]}}),[g,y]=s.useState(!1),[j]=s.useState(null),[f]=s.useState("healthcare"),[v]=s.useState(()=>{try{const e=localStorage.getItem("recentCommands");return e?JSON.parse(e):[]}catch(e){return[]}}),[N,w]=s.useState(()=>{try{const e=localStorage.getItem("privateAnalyses");return e?JSON.parse(e):[]}catch(e){return[]}}),[C,k]=s.useState(!1),[R,M]=s.useState("ready"),[,S]=s.useState(null),[F,D]=s.useState(0),[I,E]=s.useState(0),[O,T]=s.useState({});((e="healthcare",t={})=>{const[a,i]=s.useState(null),[r,l]=s.useState(!1),[n,o]=s.useState({}),c=s.useMemo(()=>as[e]||as.healthcare,[e]),d=s.useMemo(()=>{const e={};return Object.entries(t).forEach(([s,t])=>{const a=c.metrics[s];if(a&&"number"==typeof t){const i=m(t,a);e[s]={value:t,benchmark:a,position:i,percentile:x(t,a),recommendation:u(t,a,i)}}}),e},[t,c]),m=(e,s)=>e>=s.p75?"top-quartile":e>=s.median?"above-median":e>=s.p25?"below-median":"bottom-quartile",x=(e,s)=>{if(e>=s.p75)return 75+25*Math.min((e-s.p75)/(.5*s.p75),1);if(e>=s.median)return 50+(e-s.median)/(s.p75-s.median)*25;if(e>=s.p25)return 25+(e-s.p25)/(s.median-s.p25)*25;{const t=Math.max((s.p25-e)/(.5*s.p25),0);return Math.max(25-25*t,0)}},u=(e,s,t)=>({"top-quartile":{type:"positive",message:"Excellent performance - above industry top quartile",action:"Maintain current performance and identify best practices to share"},"above-median":{type:"good",message:"Above-average performance - in top half of industry",action:"Look for opportunities to reach top quartile performance"},"below-median":{type:"caution",message:"Below industry median - improvement opportunities exist",action:"Analyze top performers to identify improvement strategies"},"bottom-quartile":{type:"concern",message:"Below industry 25th percentile - significant improvement needed",action:"Priority focus area - develop comprehensive improvement plan"}}[t]),h=async(e=!1)=>{if(a&&!e)return a;l(!0);try{await new Promise(e=>setTimeout(e,500));const e={industry:c,lastUpdated:(new Date).toISOString(),dataSource:"Industry Research Database",sampleSize:"500+ companies",coveragePeriod:"Last 3 years"};return i(e),e}catch(s){return null}finally{l(!1)}};s.useEffect(()=>{o(d)},[d]),s.useEffect(()=>{h()},[e]),Object.keys(as),c.name})(f,{revenueGrowth:12,ebitdaMargin:24,operatingMargin:18,wacc:h.dcf.discountRate||10,terminalGrowth:h.dcf.terminalGrowthRate||2.5});const V=()=>{if(!c?.statements)return 0;let e=0,s=0;["totalRevenue","totalCostOfGoodsSold","operatingIncome","netIncome"].forEach(t=>{s+=3,void 0!==c.statements.incomeStatement?.[t]?.[2]&&(e+=3)});let t=0;["energyDevices","injectables","wellness","weightloss","retailSales","surgery"].forEach(e=>{void 0!==c.statements.incomeStatement?.[e]?.[2]&&t++}),t>=3&&(e+=2,s+=2),["totalAssets","totalLiabilities","totalEquity"].forEach(t=>{s+=1,void 0!==c.statements.balanceSheet?.[t]?.[2]&&(e+=1)}),["operatingCashFlow","investingCashFlow","financingCashFlow"].forEach(t=>{s+=1,void 0!==c.statements.cashFlowStatement?.[t]?.[2]&&(e+=1)});const a=Math.round(e/s*100);return void 0!==c?.statements?.incomeStatement?.totalRevenue?.[2]&&void 0!==c?.statements?.incomeStatement?.operatingIncome?.[2]?Math.max(a,80):a},B=()=>{let e=0;h?.dcf?.discountRate&&h?.dcf?.terminalGrowthRate&&(e+=40);return V()>=80&&(e+=20),h?.scenario?.scenarios&&h.scenario.scenarios.length>0&&(e+=20),m&&Object.keys(m).length>0&&(e+=20),Math.min(e,100)},q=()=>{y(!g)};s.useEffect(()=>{I>60&&!g&&y(!0)},[I,g]);s.useEffect(()=>{M("modified"),D(B()),E((()=>{let e=0;const s=V(),t=B();return s>50&&t>30&&(e=60),s>80&&t>60&&(e=100),e})()),T((()=>{const e={},s=[];c?.statements?(c.statements.incomeStatement?.totalRevenue||s.push("Missing revenue data"),c.statements.balanceSheet?.totalAssets||s.push("Missing balance sheet data"),c.statements.cashFlowStatement?.operatingCashFlow||s.push("Missing cash flow data")):s.push("No financial statements found"),s.length>0&&(e.data=s);const t=[];(!h.dcf.discountRate||h.dcf.discountRate<=0)&&t.push("Invalid discount rate"),(!h.dcf.terminalGrowthRate||h.dcf.terminalGrowthRate<0)&&t.push("Invalid terminal growth rate"),t.length>0&&(e.modeling=t);const a=[],i=V(),r=B();return i<50&&a.push("Insufficient data for analysis"),r<30&&a.push("Models not configured"),a.length>0&&(e.analysis=a),e})())},[c,m,h]);const z=({status:s,label:t})=>{const a={ready:{color:"text-green-400",bg:"bg-green-400/10",icon:L},modified:{color:"text-yellow-400",bg:"bg-yellow-400/10",icon:W},saving:{color:"text-blue-400",bg:"bg-blue-400/10",icon:b},error:{color:"text-red-400",bg:"bg-red-400/10",icon:Y}},i=a[s]||a.ready,r=i.icon;return e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full ${i.bg}`,children:[e.jsx(r,{size:14,className:i.color}),e.jsx("span",{className:`text-sm ${i.color}`,children:t})]})};return e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white",children:[e.jsx(a,{}),e.jsxs("div",{className:"flex flex-col min-h-screen pt-16",children:[e.jsx("div",{className:"bg-slate-800/80 backdrop-blur-sm border-b border-slate-700/50",children:e.jsxs("div",{className:"px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(n,{size:24,className:"text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Private Analysis"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Professional financial modeling and valuation"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{status:R,label:"ready"===R?"Data Ready":"modified"===R?"Unsaved Changes":"saving"===R?"Saving...":"Error"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:q,className:"text-slate-300 hover:text-white border border-slate-600 hover:border-slate-500 "+(g?"bg-blue-500/20 border-blue-400":""),children:[e.jsx(re,{size:16}),"Insights"]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{const e=prompt("Enter analysis name:");e&&(async e=>{if(e){k(!0),M("saving");try{const t={id:Date.now(),name:e,data:c,adjustedValues:m,modelInputs:h,completeness:V(),createdAt:(new Date).toISOString(),lastModified:(new Date).toISOString()},a=[...N,t];w(a);try{localStorage.setItem("privateAnalyses",JSON.stringify(a))}catch(s){throw new Error("Failed to save analysis to localStorage")}M("ready"),S(new Date)}catch(s){M("error")}finally{k(!1)}}})(e)},disabled:C,className:"text-slate-300 hover:text-white border border-slate-600 hover:border-slate-500",children:[e.jsx(le,{size:16}),"Save"]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{},className:"text-slate-300 hover:text-white border border-slate-600 hover:border-slate-500",children:[e.jsx(ae,{size:16}),"Import"]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{},className:"text-slate-300 hover:text-white border border-slate-600 hover:border-slate-500",children:[e.jsx(P,{size:16}),"Export"]})]})]})]}),e.jsx(Le,{activeStep:(e=>{switch(e){case"spreadsheet":default:return"data";case"modeling":return"modeling";case"analysis":return"analysis";case"lbo":return"lbo";case"threestatement":return"threestatement";case"scenarios":return"scenarios";case"marketdata":return"marketdata";case"montecarlo":return"montecarlo"}})(t),onStepChange:e=>{switch(e){case"data":default:r("spreadsheet");break;case"modeling":r("modeling");break;case"analysis":r("analysis")}},dataCompleteness:V(),modelingProgress:F,analysisProgress:I,validationErrors:O})]})}),e.jsx(A,{children:N.length>0&&e.jsxs(u.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-slate-800/50 border-b border-slate-700/50 px-8 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx(G,{size:16,className:"text-slate-400"}),e.jsx("h3",{className:"text-sm font-medium text-slate-300",children:"Recent Analyses"})]}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:N.slice(-5).map(s=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-700/50 rounded-lg border border-slate-600/50",children:[e.jsx("button",{onClick:()=>(e=>{const s=N.find(s=>s.id===e);s&&(d(s.data),x(s.adjustedValues||{}),p(s.modelInputs||h),M("ready"))})(s.id),className:"text-slate-200 hover:text-white font-medium text-sm",children:s.name}),e.jsx("div",{className:"w-px h-4 bg-slate-600"}),e.jsx("button",{onClick:()=>(e=>{try{const s=N.filter(s=>s.id!==e);w(s),localStorage.setItem("privateAnalyses",JSON.stringify(s))}catch(s){}})(s.id),className:"text-slate-400 hover:text-red-400 transition-colors",children:"×"})]},s.id))})]})}),e.jsx("div",{className:`flex-1 bg-slate-900 overflow-auto ${g?"pr-80":""} transition-all duration-300`,children:e.jsxs(u.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,ease:"easeOut"},className:"min-h-full",children:[("analysis"===t||"modeling"===t)&&e.jsx("div",{className:"p-6 pb-0",children:e.jsx(Ye,{financialData:c,currentView:t,analysisContext:"analysis"===t?"dcf":"general",onCreateChart:e=>{}})}),"spreadsheet"===t&&e.jsx(is,{fallback:e.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading spreadsheet. Please refresh the page."}),children:e.jsx(Ie,{data:c,onDataChange:d,onAdjustedValuesChange:x})}),"modeling"===t&&e.jsx(is,{fallback:e.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading modeling tools. Please refresh the page."}),children:e.jsx(qe,{data:c,adjustedValues:m,onDataChange:d})}),"analysis"===t&&e.jsx(is,{fallback:e.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading analysis results. Please check your data and refresh."}),children:e.jsx(ze,{data:c,adjustedValues:m,modelInputs:h,calculateDCF:e=>Fe(e,h),formatCurrency:Se,formatPercentage:Me})}),"lbo"===t&&e.jsx(is,{fallback:e.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading LBO tool. Please check your data."}),children:e.jsx(Ge,{data:c,onDataChange:e=>o(s=>({...s,lbo:e}))})}),"threestatement"===t&&e.jsx(is,{fallback:e.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading financial model workspace."}),children:e.jsx($e,{data:c,onDataChange:e=>o(s=>({...s,threeStatement:e}))})}),"scenarios"===t&&e.jsx(is,{fallback:e.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading scenario analysis."}),children:e.jsx(Ue,{data:c,onDataChange:e=>o(s=>({...s,scenarios:e})),calculateDCF:e=>Fe(e,h),lboModelingEngine:null})}),"marketdata"===t&&e.jsx(We,{data:c,onDataChange:e=>o(s=>({...s,marketData:e}))}),"montecarlo"===t&&e.jsx(_e,{data:c,dcfResults:l.dcf,lboResults:l.lbo,financialModel:l.threeStatement,scenarioResults:l.scenarios,onDataChange:e=>o(s=>({...s,monteCarlo:e}))}),"import-export"===t&&e.jsx(ts,{data:c,onDataChange:d,savedAnalyses:N,onAnalysesChange:w})]},t)}),e.jsx(Ke,{financialData:c,currentMetric:j,analysisContext:"analysis"===t?"dcf":t,onInsightClick:e=>{},isVisible:g,onToggle:q})]})]})};export{rs as default};
//# sourceMappingURL=PrivateAnalysis-Dv5q5Gy7.js.map
