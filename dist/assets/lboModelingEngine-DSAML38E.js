const e={ERROR:0,WARN:1,INFO:2,DEBUG:3,TRACE:4},t={logLevel:e.INFO,enableMetrics:!0,enablePerformanceTracking:!0,enableErrorTracking:!0,maxLogHistory:1e3,metricsRetentionPeriod:864e5};const a=new class{constructor(e={}){this.config={...t,...e},this.logs=[],this.metrics=new Map,this.performanceData=new Map,this.errorCounts=new Map,this.startTime=Date.now()}log(t,a,i={}){if((e[t.toUpperCase()]||e.INFO)<=this.config.logLevel){const e={timestamp:(new Date).toISOString(),level:t.toUpperCase(),message:a,metadata:i,id:this.generateLogId()};this.logs.push(e),this.trimLogs(),this.outputToConsole(e)}}logApiRequest(e,t,a={}){const i=this.generateRequestId(),r=Date.now();return this.log("INFO","ðŸš€ API Request Started",{requestId:i,service:e,endpoint:t,params:this.sanitizeParams(a),startTime:r}),this.performanceData.set(i,{service:e,endpoint:t,startTime:r,params:this.sanitizeParams(a)}),i}logApiResponse(e,t,a=null,i=null){const r=this.performanceData.get(e);if(!r)return void this.log("WARN","No performance data found for request",{requestId:e});const n=Date.now()-r.startTime,{service:s,endpoint:o}=r;t?(this.log("INFO","âœ… API Request Completed",{requestId:e,service:s,endpoint:o,duration:n,responseSize:this.getResponseSize(a),success:!0}),this.recordMetric(s,"success",1)):(this.log("ERROR","âŒ API Request Failed",{requestId:e,service:s,endpoint:o,duration:n,error:i?{message:i.message,code:i.code,status:i.response?.status,statusText:i.response?.statusText}:null,success:!1}),this.recordMetric(s,"error",1),this.recordError(s,i)),this.recordMetric(s,"duration",n),this.recordMetric(s,"requests",1),this.performanceData.delete(e)}logRateLimit(e,t,a=null){this.log("WARN","â±ï¸ Rate Limit Hit",{service:e,waitTime:t,remainingRequests:a,action:"throttling"}),this.recordMetric(e,"rateLimitHits",1)}logCircuitBreaker(e,t,a,i={}){const r={OPEN:"ðŸš¨",HALF_OPEN:"ðŸ”„",CLOSED:"âœ…"}[t]||"ðŸ”§";this.log("WARN",`${r} Circuit Breaker ${a}`,{service:e,state:t,action:a,...i}),this.recordMetric(e,`circuitBreaker_${t.toLowerCase()}`,1)}logCache(e,t,a={}){const i={hit:"ðŸŽ¯",miss:"âŒ",set:"ðŸ’¾",clear:"ðŸ—‘ï¸"}[e]||"ðŸ“¦";this.log("DEBUG",`${i} Cache ${e.toUpperCase()}`,{operation:e,key:this.sanitizeCacheKey(t),...a}),this.recordMetric("cache",e,1)}recordMetric(e,t,a){if(!this.config.enableMetrics)return;const i=`${e}.${t}`,r=Date.now();this.metrics.has(i)||this.metrics.set(i,{values:[],total:0,count:0,min:1/0,max:-1/0,avg:0});const n=this.metrics.get(i);n.values.push({value:a,timestamp:r}),n.total+=a,n.count+=1,n.min=Math.min(n.min,a),n.max=Math.max(n.max,a),n.avg=n.total/n.count,this.cleanOldMetrics(i)}recordError(e,t){if(!this.config.enableErrorTracking||!t)return;const a=`${e}.${t.message}`,i=this.errorCounts.get(a)||0;this.errorCounts.set(a,i+1)}getMetrics(){const e={uptime:Date.now()-this.startTime,totalLogs:this.logs.length,services:{},cache:{},errors:{}};for(const[t,a]of this.metrics.entries()){const[i,r]=t.split(".");"cache"===i?e.cache[r]={total:a.total,count:a.count,avg:a.avg}:(e.services[i]||(e.services[i]={}),e.services[i][r]={total:a.total,count:a.count,min:a.min===1/0?0:a.min,max:a.max===-1/0?0:a.max,avg:a.avg})}for(const[t,a]of this.errorCounts.entries()){const[i,...r]=t.split("."),n=r.join(".");e.errors[i]||(e.errors[i]={}),e.errors[i][n]=a}return e}getRecentLogs(e=100,t=null){let a=[...this.logs];return t&&(a=a.filter(e=>e.level===t.toUpperCase())),a.slice(-e).reverse()}clear(){this.logs=[],this.metrics.clear(),this.performanceData.clear(),this.errorCounts.clear(),this.startTime=Date.now()}generateLogId(){return`log_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateRequestId(){return`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}sanitizeParams(e){const t={...e};return t.apikey&&(t.apikey="***"),t.api_key&&(t.api_key="***"),t.token&&(t.token="***"),t}sanitizeCacheKey(e){return e.length>50?`${e.substring(0,47)}...`:e}getResponseSize(e){if(!e)return 0;try{return JSON.stringify(e).length}catch{return 0}}trimLogs(){this.logs.length>this.config.maxLogHistory&&(this.logs=this.logs.slice(-this.config.maxLogHistory))}cleanOldMetrics(e){const t=this.metrics.get(e),a=Date.now()-this.config.metricsRetentionPeriod;t.values=t.values.filter(e=>e.timestamp>a)}outputToConsole(e){const{level:t,message:a,metadata:i}=e;new Date(e.timestamp).toLocaleTimeString()}};const i=new class{constructor(){this.modelCache=new Map,this.assumptions=this.getDefaultAssumptions()}getDefaultAssumptions(){return{transaction:{holdingPeriod:5,managementRollover:.1,transactionFees:.02,financingFees:.015},debt:{seniorDebtMultiple:4,subordinatedDebtMultiple:1.5,totalDebtMultiple:5.5,seniorInterestRate:.055,subordinatedInterestRate:.095,mandatoryPaydown:.05,cashSweep:.5},operating:{ebitdaGrowthRate:.05,capexAsPercentOfRevenue:.03,nwcAsPercentOfRevenue:.02,taxRate:.21},exit:{exitMultiple:null,exitMultipleRange:[.8,1.2],publicMarketDiscount:.1},fees:{managementFeeRate:.02,carriedInterestRate:.2,hurdle:.08}}}buildLBOModel(e,t={}){const{symbol:a,companyName:i,purchasePrice:r,ebitda:n,revenue:s,marketData:o={},peerData:l={},assumptions:c={}}=e,u={...this.assumptions,...c},h=this.calculateTransactionStructure(r,n,u),m=this.calculateLBOScenario(e,h,u,"Base Case"),g={};if(!1!==t.upside){const t={...u,operating:{...u.operating,ebitdaGrowthRate:1.3*u.operating.ebitdaGrowthRate},exit:{...u.exit,exitMultiple:1.1*(u.exit.exitMultiple||10)}};g.upside=this.calculateLBOScenario(e,h,t,"Upside Case")}if(!1!==t.downside){const t={...u,operating:{...u.operating,ebitdaGrowthRate:.7*u.operating.ebitdaGrowthRate},exit:{...u.exit,exitMultiple:.9*(u.exit.exitMultiple||10)}};g.downside=this.calculateLBOScenario(e,h,t,"Downside Case")}const d=this.performLBOSensitivityAnalysis(e,h,u);return{symbol:a,companyName:i,modelType:"LBO",timestamp:(new Date).toISOString(),transactionStructure:h,baseCase:m,scenarios:g,sensitivityAnalysis:d,assumptions:u,summary:this.generateLBOSummary(m,g,h)}}calculateTransactionStructure(e,t,a){const{debt:i,transaction:r}=a,n=t*i.seniorDebtMultiple,s=n+t*i.subordinatedDebtMultiple,o=e*r.transactionFees,l=s*r.financingFees,c=e+o+l,u=Math.max(c-s,.2*c),h=e*r.managementRollover,m=Math.max(u-h,0),g=c-u,d=Math.min(n,.8*g);return{purchasePrice:e,transactionFees:o,financingFees:l,totalUses:c,seniorDebt:d,subordinatedDebt:g-d,totalDebt:g,equityContribution:u,sponsorEquity:m,managementRollover:h,debtToEbitda:g/t,equityToTotalCapital:u/c}}calculateLBOScenario(e,t,a,i){const{ebitda:r,revenue:n}=e,{holdingPeriod:s}=a.transaction,o=this.projectLBOOperatingPerformance(n,r,a.operating,s),l=this.calculateDebtSchedule(t,o,a.debt,s),c=this.calculateEquityCashFlows(o,l,a),u=this.calculateExitAnalysis(o[s-1],l[s-1],t,a),h=this.calculateReturnsMetrics(t.sponsorEquity,c,u.netProceeds,s);return{scenarioName:i,operatingProjections:o,debtSchedule:l,equityCashFlows:c,exitAnalysis:u,returnsAnalysis:h,keyMetrics:this.calculateLBOKeyMetrics(t,u,h)}}projectLBOOperatingPerformance(e,t,a,i){const r=[];let n=e,s=t;for(let o=1;o<=i;o++){const e=a.ebitdaGrowthRate;s*=1+e,n*=1+e;const t=s/n,i=n*a.capexAsPercentOfRevenue,l=1===o?n*a.nwcAsPercentOfRevenue:(n-r[o-2].revenue)*a.nwcAsPercentOfRevenue,c=s*a.taxRate,u=s-c-i-l;r.push({year:o,revenue:n,ebitda:s,ebitdaMargin:t,capex:i,nwcChange:l,taxes:c,unleveredFCF:u})}return r}calculateDebtSchedule(e,t,a,i){const r=[];let n=e.seniorDebt,s=e.subordinatedDebt,o=e.revolvingDebt||0;const l={...a,revolvingRate:a.revolvingRate||.045,minCashBalance:a.minCashBalance||1e7,maxLeverageRatio:a.maxLeverageRatio||6,minCoverageRatio:a.minCoverageRatio||1.25,maxCapexRatio:a.maxCapexRatio||.05};for(let c=1;c<=i;c++){const i=t[c-1],u=n*a.seniorInterestRate,h=s*a.subordinatedInterestRate,m=u+h,g=i.unleveredFCF-m,d=Math.min(n*a.mandatoryPaydown,n),p=Math.max(0,g-d),b=p*a.cashSweep,v=d+b,R=Math.min(v,n),x=Math.max(0,v-R);n=Math.max(0,n-R),s=Math.max(0,s-x);const M=(n+s+o)/i.ebitda,y=i.ebitda/m,f=(i.capex||0)/i.revenue,C={leverageCompliance:M<=l.maxLeverageRatio,coverageCompliance:y>=l.minCoverageRatio,capexCompliance:f<=l.maxCapexRatio,leverageRatio:M,coverageRatio:y,capexRatio:f},w=g/(m+d);r.push({year:c,beginningBalance:{senior:1===c?e.seniorDebt:r[c-2].endingBalance.senior,subordinated:1===c?e.subordinatedDebt:r[c-2].endingBalance.subordinated,revolving:1===c?e.revolvingDebt||0:r[c-2].endingBalance.revolving},interestExpense:{senior:u,subordinated:h,revolving:o*l.revolvingRate,total:m+o*l.revolvingRate},principalPayment:{senior:R,subordinated:x,revolving:0,total:v},endingBalance:{senior:n,subordinated:s,revolving:o,total:n+s+o},cashAvailableForDebt:g,excessCash:p-b,mandatoryPaydown:d,cashSweep:b,dscr:w,covenantTests:C,netDebtToEbitda:(n+s+o)/i.ebitda,ebitdaToInterest:i.ebitda/m})}return r}calculateEquityCashFlows(e,t,a){return e.map((e,i)=>{const r=t[i],n=a.fees.managementFeeRate*(a.transaction.sponsorEquity||0),s=r.excessCash-n;return{year:e.year,unleveredFCF:e.unleveredFCF,interestExpense:r.interestExpense.total,principalPayment:r.principalPayment.total,managementFees:n,cashFlowToEquity:Math.max(0,s)}})}calculateExitAnalysis(e,t,a,i){const r=i.exit.exitMultiple||10,n=e.ebitda,s=n*r,o=t.endingBalance.total,l=s-o,c=l,u=a.sponsorEquity,h=Math.max(0,c-u)*i.fees.carriedInterestRate;return{exitEbitda:n,exitMultiple:r,enterpriseValue:s,totalDebtAtExit:o,grossProceeds:l,carriedInterest:h,netProceeds:l-h,managementProceeds:l*(a.managementRollover/a.equityContribution)}}calculateReturnsMetrics(e,t,a,i){if(!e||e<=0)return{irr:NaN,moic:NaN,totalCashReturned:0,initialInvestment:e||0,holdingPeriod:i,annualizedReturn:NaN};const r=[-Math.abs(e)];t.forEach(e=>{r.push(e.cashFlowToEquity||0)}),r.length>1?r[r.length-1]+=a||0:r.push(a||0);const n=this.calculateIRR(r),s=t.reduce((e,t)=>e+(t.cashFlowToEquity||0),0)+(a||0),o=s/Math.abs(e);return{irr:isNaN(n)?0:n,moic:isNaN(o)?0:o,totalCashReturned:s,initialInvestment:Math.abs(e),holdingPeriod:i,annualizedReturn:isNaN(o)||o<=0?0:Math.pow(o,1/i)-1,cashFlows:r}}calculateIRR(e,t={}){if(!e||e.length<2)return NaN;if(e.every(e=>0===e))return 0;if(0===e.slice(1).reduce((t,a,i)=>t+(Math.sign(a)!==Math.sign(e[i])?1:0),0))return e[0]<0?-1:1/0;const{tolerance:a=1e-8,maxIterations:i=200,initialGuess:r=.1}=t;let n=this.newtonRaphsonIRR(e,r,a,i);return!isNaN(n)&&isFinite(n)||(n=this.bisectionIRR(e,a,i)),!isNaN(n)&&isFinite(n)||(n=this.secantIRR(e,a,i)),n}newtonRaphsonIRR(e,t,a,i){let r=t;for(let n=0;n<i;n++){let t=0,i=0;for(let a=0;a<e.length;a++){const n=Math.pow(1+r,a);t+=e[a]/n,a>0&&(i-=a*e[a]/(n*(1+r)))}if(Math.abs(t)<a)return r;if(Math.abs(i)<a)break;const n=r-t/i;if(r=n<-.99?-.99:n>50?50:n,Math.abs(n-r)<a)return n;r=n}return r}bisectionIRR(e,t,a){let i=-.99,r=5;const n=this.calculateNPV(e,i);if(n*this.calculateNPV(e,r)>0)return NaN;for(let s=0;s<a;s++){const a=(i+r)/2,s=this.calculateNPV(e,a);if(Math.abs(s)<t)return a;if(n*s<0?r=a:i=a,Math.abs(r-i)<t)return(i+r)/2}return(i+r)/2}secantIRR(e,t,a){let i=0,r=.1;for(let n=0;n<a;n++){const a=this.calculateNPV(e,i),n=this.calculateNPV(e,r);if(Math.abs(n)<t)return r;if(Math.abs(n-a)<t)break;const s=r-n*(r-i)/(n-a);if(Math.abs(s-r)<t)return s;i=r,r=s}return r}calculateNPV(e,t){return e.reduce((e,a,i)=>e+a/Math.pow(1+t,i),0)}calculateLBOKeyMetrics(e,t,a,i=[]){const r=e.purchasePrice/(e.entryMultiple||10),n=r>0?e.purchasePrice/r:null,s=Math.max(...i.map(e=>e.netDebtToEbitda||0)),o=Math.min(...i.map(e=>e.ebitdaToInterest||1/0)),l=i.length>0?i.reduce((e,t)=>e+(t.dscr||0),0)/i.length:0,c=t.exitMultiple-(n||10),u=a.moic-1-c,h=e.totalDebt/e.equityContribution;return{entryMultiple:n,entryLeverage:e.debtToEbitda,equityContribution:e.equityContribution,debtToEquity:h,exitMultiple:t.exitMultiple,exitLeverage:t.totalDebtAtExit/t.exitEbitda,irr:a.irr,moic:a.moic,totalReturn:a.totalCashReturned,leverageReduction:e.totalDebt-t.totalDebtAtExit,peakLeverage:s,minCoverage:o,avgDSCR:l,multipleExpansion:c,operationalImprovement:u,leverageContribution:h>1?(a.moic-1)*(h-1)/h:0,breakdownLeverage:i.length>0?Math.max(...i.map(e=>e.leverageRatio||0)):null,covenantBreaches:i.filter(e=>e.covenantTests&&(!e.covenantTests.leverageCompliance||!e.covenantTests.coverageCompliance)).length,equityEfficiency:a.totalCashReturned/e.equityContribution,timeToRecoverEquity:this.calculateTimeToRecoverEquity(a.cashFlows,e.equityContribution)}}calculateTimeToRecoverEquity(e,t){if(!e||0===e.length)return null;let a=0;for(let i=1;i<e.length;i++)if(a+=e[i],a>=t)return i;return null}performLBOSensitivityAnalysis(e,t,a){const i={};return Object.entries({ebitdaGrowthRate:[-.02,-.01,0,.01,.02],exitMultiple:[-1,-.5,0,.5,1],debtMultiple:[-.5,-.25,0,.25,.5]}).forEach(([r,n])=>{i[r]=n.map(i=>{const n={...a};if("ebitdaGrowthRate"===r)n.operating.ebitdaGrowthRate+=i;else if("exitMultiple"===r)n.exit.exitMultiple=(n.exit.exitMultiple||10)+i;else if("debtMultiple"===r){const a=t.debtToEbitda+i,r={...t,totalDebt:e.ebitda*a};r.equityContribution=t.totalUses-r.totalDebt}try{const a=this.calculateLBOScenario(e,t,n,`${r}_${i}`);return{variation:i,irr:a.returnsAnalysis.irr,moic:a.returnsAnalysis.moic}}catch(s){return{variation:i,irr:null,moic:null,error:s.message}}})}),i}generateLBOSummary(e,t,a){const i=[e,...Object.values(t)],r=i.map(e=>e.returnsAnalysis.irr).filter(e=>null!==e),n=i.map(e=>e.returnsAnalysis.moic).filter(e=>null!==e);return{returnRange:{irrMin:Math.min(...r),irrMax:Math.max(...r),irrAverage:r.reduce((e,t)=>e+t,0)/r.length,moicMin:Math.min(...n),moicMax:Math.max(...n),moicAverage:n.reduce((e,t)=>e+t,0)/n.length},investmentHighlights:this.generateInvestmentHighlights(e,a),riskFactors:this.generateRiskFactors(e,a)}}generateInvestmentHighlights(e,t){const a=[],i=e.returnsAnalysis.irr,r=e.returnsAnalysis.moic;return i>.2&&a.push(`Strong projected IRR of ${(100*i).toFixed(1)}%`),r>2.5&&a.push(`Attractive multiple of ${r.toFixed(1)}x invested capital`),t.debtToEbitda<5&&a.push(`Conservative leverage at ${t.debtToEbitda.toFixed(1)}x EBITDA`),a}generateRiskFactors(e,t){const a=[];return t.debtToEbitda>6&&a.push(`High leverage at ${t.debtToEbitda.toFixed(1)}x EBITDA`),e.returnsAnalysis.irr<.15&&a.push(`Below-target IRR of ${(100*e.returnsAnalysis.irr).toFixed(1)}%`),a}};export{a,i as l};
//# sourceMappingURL=lboModelingEngine-DSAML38E.js.map
