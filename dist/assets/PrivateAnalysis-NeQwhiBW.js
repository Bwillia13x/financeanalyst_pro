import{r as e,j as s,p as t,O as a,Q as r,o as l,R as i,U as n,F as c,V as o,q as d,Y as m,Z as x,_ as u,$ as h,a0 as p,a1 as g,a2 as b,a3 as j,z as y,x as f,I as v,G as N,a4 as w,y as C,S as k,a5 as M,a6 as R,a7 as S,a8 as F,D,T as I,a9 as A,aa as E,ab as P,ac as O,ad as V,i as T,v as B,ae as q,s as L,af as z,ag as G,ah as $,ai as U,X as W,aj as _,ak as K,al as Y,am as H,an as Q,ao as J,ap as X,aq as Z,ar as ee}from"./react-vendor-BWiQdkVb.js";import{H as se}from"./Header-BLfrZqKV.js";import{B as te}from"./Button-C0m44oek.js";import{S as ae}from"./SEOHead-DrWvJWRJ.js";import{m as re,A as le}from"./ui-vendor-x_EeA8uv.js";import{ResponsiveContainer as ie,BarChart as ne,CartesianGrid as ce,XAxis as oe,YAxis as de,Tooltip as me,Bar as xe,PieChart as ue,Pie as he,Cell as pe,LineChart as ge,Legend as be,Line as je,AreaChart as ye,Area as fe,ScatterChart as ve,Scatter as Ne}from"./charts-vendor-CB3i9QZK.js";import{a as we,l as Ce}from"./lboModelingEngine-DSAML38E.js";import{g as ke,b as Me,f as Re}from"./defaultFinancialData-BqNGcy_-.js";import"./vendor-uZFMUkl0.js";import"./index-Dc3K68ej.js";import"./utils-vendor-Cj_bvvWu.js";import"./state-vendor-D3vL4m0Q.js";const Se=new class{constructor(){this.workers=[],this.isRunning=!1,this.currentSimulation=null}async runDCFSimulation(e,s,t={}){const{iterations:a=1e4,confidenceLevel:r=.95,correlationMatrix:l=null,randomSeed:i=null}=t;we.log("INFO","Starting DCF Monte Carlo simulation",{iterations:a,variables:Object.keys(s).length}),this.isRunning=!0;const n=Date.now();try{i&&this.setSeed(i);const c=this.generateCorrelatedSamples(s,a,l),o=[],d=t.onProgress;for(let t=0;t<a;t++){if(!this.isRunning)throw new Error("Simulation cancelled");const r=this.createScenarioInputs(e,c[t],s),l=this.calculateDCFScenario(r);o.push({iteration:t+1,pricePerShare:l.pricePerShare,enterpriseValue:l.enterpriseValue,upside:l.upside,inputs:r}),d&&t%Math.floor(a/100)===0&&d(t/a*100)}const m=this.analyzeResults(o,r),x=Date.now();return we.log("INFO","DCF Monte Carlo simulation completed",{iterations:a,duration:x-n,meanPrice:m.statistics.mean}),{type:"DCF_MONTE_CARLO",timestamp:(new Date).toISOString(),parameters:{iterations:a,confidenceLevel:r,randomSeed:i},results:o,analysis:m,duration:x-n}}catch(c){throw this.isRunning=!1,we.log("ERROR","DCF Monte Carlo simulation failed",{error:c.message}),c}finally{this.isRunning=!1}}async runLBOSimulation(e,s,t={}){const{iterations:a=1e4,confidenceLevel:r=.95,correlationMatrix:l=null,randomSeed:i=null}=t;we.log("INFO","Starting LBO Monte Carlo simulation",{iterations:a,variables:Object.keys(s).length}),this.isRunning=!0;const n=Date.now();try{i&&this.setSeed(i);const c=this.generateCorrelatedSamples(s,a,l),o=[],d=t.onProgress;for(let t=0;t<a;t++){if(!this.isRunning)throw new Error("Simulation cancelled");const r=this.createScenarioInputs(e,c[t],s),l=this.calculateLBOScenario(r);o.push({iteration:t+1,irr:l.irr,moic:l.moic,totalReturn:l.totalReturn,inputs:r}),d&&t%Math.floor(a/100)===0&&d(t/a*100)}const m=this.analyzeResults(o,r,["irr","moic","totalReturn"]),x=Date.now();return we.log("INFO","LBO Monte Carlo simulation completed",{iterations:a,duration:x-n,meanIRR:m.statistics.irr?.mean}),{type:"LBO_MONTE_CARLO",timestamp:(new Date).toISOString(),parameters:{iterations:a,confidenceLevel:r,randomSeed:i},results:o,analysis:m,duration:x-n}}catch(c){throw this.isRunning=!1,we.log("ERROR","LBO Monte Carlo simulation failed",{error:c.message}),c}finally{this.isRunning=!1}}generateCorrelatedSamples(e,s,t){const a=Object.keys(e),r=a.length,l=[],i=[];for(let n=0;n<s;n++){const s={};a.forEach(t=>{const a=e[t];s[t]=this.sampleFromDistribution(a)}),i.push(s)}if(t&&t.length===r){const e=this.choleskyDecomposition(t);for(let t=0;t<s;t++){const s={},r=a.map(e=>i[t][e]),n=this.applyCorrelation(r,e);a.forEach((e,t)=>{s[e]=n[t]}),l.push(s)}}else l.push(...i);return l}sampleFromDistribution(e){const{type:s,parameters:t}=e;switch(s){case"normal":return this.normalRandom(t.mean,t.stdDev);case"lognormal":const e=this.normalRandom(t.mu,t.sigma);return Math.exp(e);case"uniform":return t.min+Math.random()*(t.max-t.min);case"triangular":return this.triangularRandom(t.min,t.mode,t.max);case"beta":return this.betaRandom(t.alpha,t.beta);case"exponential":return this.exponentialRandom(t.lambda);case"weibull":return this.weibullRandom(t.shape,t.scale);case"pareto":return this.paretoRandom(t.scale,t.shape);case"student_t":return this.studentTRandom(t.df);case"chi_squared":return this.chiSquaredRandom(t.df);default:throw new Error(`Unsupported distribution type: ${s}`)}}exponentialRandom(e){return-Math.log(1-Math.random())/e}weibullRandom(e,s){const t=Math.random();return s*Math.pow(-Math.log(1-t),1/e)}paretoRandom(e,s){const t=Math.random();return e/Math.pow(t,1/s)}studentTRandom(e){if(e<=0)throw new Error("Degrees of freedom must be positive");const s=this.normalRandom(0,1),t=this.chiSquaredRandom(e);return s/Math.sqrt(t/e)}chiSquaredRandom(e){if(e<=0)throw new Error("Degrees of freedom must be positive");return 2*this.gammaRandom(e/2)}normalRandom(e=0,s=1){if(void 0!==this.spareNormal){const t=this.spareNormal;return this.spareNormal=void 0,t*s+e}const t=Math.random(),a=Math.random(),r=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*a),l=Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*a);return this.spareNormal=l,r*s+e}triangularRandom(e,s,t){const a=Math.random();return a<(s-e)/(t-e)?e+Math.sqrt(a*(t-e)*(s-e)):t-Math.sqrt((1-a)*(t-e)*(t-s))}betaRandom(e,s){const t=this.gammaRandom(e);return t/(t+this.gammaRandom(s))}gammaRandom(e){if(!(e>=1))return this.gammaRandom(e+1)*Math.pow(Math.random(),1/e);{const s=e-1/3,t=1/Math.sqrt(9*s);for(;;){let e,a;do{e=this.normalRandom(),a=1+t*e}while(a<=0);a*=a*a;const r=Math.random();if(r<1-.0331*e*e*e*e)return s*a;if(Math.log(r)<.5*e*e+s*(1-a+Math.log(a)))return s*a}}}choleskyDecomposition(e){const s=e.length,t=Array(s).fill().map(()=>Array(s).fill(0));for(let a=0;a<s;a++)for(let s=0;s<=a;s++)if(a===s){let a=0;for(let e=0;e<s;e++)a+=t[s][e]*t[s][e];t[s][s]=Math.sqrt(e[s][s]-a)}else{let r=0;for(let e=0;e<s;e++)r+=t[a][e]*t[s][e];t[a][s]=(e[a][s]-r)/t[s][s]}return t}applyCorrelation(e,s){const t=e.length,a=Array(t).fill(0);for(let r=0;r<t;r++)for(let t=0;t<=r;t++)a[r]+=s[r][t]*e[t];return a}createScenarioInputs(e,s,t){const a={...e};return Object.entries(s).forEach(([e,s])=>{const r=t[e];r.applyTo?a[r.applyTo]=s:a[e]=s}),a}calculateDCFScenario(e){const{currentRevenue:s=1e9,revenueGrowthRate:t=.1,fcfMargin:a=.15,wacc:r=.1,terminalGrowthRate:l=.025,sharesOutstanding:i=1e8,currentPrice:n=100}=e;let c=0,o=s;for(let x=1;x<=5;x++){o*=1+t;c+=o*a/Math.pow(1+r,x)}const d=c+o*a*(1+l)/(r-l)/Math.pow(1+r,5),m=d/i;return{pricePerShare:m,enterpriseValue:d,upside:(m-n)/n*100}}calculateLBOScenario(e){const{ebitda:s=1e8,ebitdaGrowthRate:t=.05,exitMultiple:a=10,debtMultiple:r=5,holdingPeriod:l=5}=e,i=s*r,n=10*s-i,c=s*Math.pow(1+t,l)*a-.5*i,o=c/n;return{irr:Math.pow(o,1/l)-1,moic:o,totalReturn:c}}analyzeResults(e,s,t=["pricePerShare","enterpriseValue","upside"]){const a={statistics:{},percentiles:{},confidenceIntervals:{},riskMetrics:{},distributionTests:{},correlations:{}};return t.forEach(t=>{const r=e.map(e=>e[t]).filter(e=>null!==e&&!isNaN(e)).sort((e,s)=>e-s);if(0===r.length)return;const l=r.reduce((e,s)=>e+s,0)/r.length,i=r.reduce((e,s)=>e+Math.pow(s-l,2),0)/r.length,n=Math.sqrt(i),c=Math.sqrt(i*r.length/(r.length-1));a.statistics[t]={mean:l,median:this.percentile(r,.5),mode:this.calculateMode(r),stdDev:n,sampleStdDev:c,variance:i,min:r[0],max:r[r.length-1],range:r[r.length-1]-r[0],count:r.length,trimmedMean:this.calculateTrimmedMean(r,.1),mad:this.calculateMAD(r),iqr:this.percentile(r,.75)-this.percentile(r,.25)},a.percentiles[t]={p1:this.percentile(r,.01),p5:this.percentile(r,.05),p10:this.percentile(r,.1),p25:this.percentile(r,.25),p50:this.percentile(r,.5),p75:this.percentile(r,.75),p90:this.percentile(r,.9),p95:this.percentile(r,.95),p99:this.percentile(r,.99)};const o=1-s,d=this.percentile(r,o/2),m=this.percentile(r,1-o/2);a.confidenceIntervals[t]={level:s,lowerBound:d,upperBound:m,width:m-d,bootstrapCI:this.calculateBootstrapCI(r,s)};const x=this.percentile(r,.05),u=this.percentile(r,.01),h=r.slice(0,Math.floor(.05*r.length)).reduce((e,s)=>e+s,0)/Math.floor(.05*r.length),p=r.slice(0,Math.floor(.01*r.length)).reduce((e,s)=>e+s,0)/Math.floor(.01*r.length);a.riskMetrics[t]={var95:x,var99:u,cvar95:h,cvar99:p,skewness:this.calculateSkewness(r,l,n),kurtosis:this.calculateKurtosis(r,l,n),excessKurtosis:this.calculateKurtosis(r,l,n)-3,expectedShortfall:h,maxDrawdown:this.calculateMaxDrawdown(r),sharpeRatio:this.calculateSharpeRatio(r,.02),sortinoRatio:this.calculateSortinoRatio(r,l)},a.distributionTests[t]={jarqueBera:this.jarqueBeraTest(r),kolmogorovSmirnov:this.ksTestNormality(r),shapiroWilk:r.length<=5e3?this.shapiroWilkTest(r):null}}),t.length>1&&(a.correlations=this.calculateCorrelationMatrix(e,t)),a}calculateMode(e){const s={};e.forEach(e=>{const t=Math.round(100*e)/100;s[t]=(s[t]||0)+1});const t=Math.max(...Object.values(s)),a=Object.keys(s).filter(e=>s[e]===t);return 1===a.length?parseFloat(a[0]):null}calculateTrimmedMean(e,s=.1){const t=Math.floor(e.length*s),a=e.slice(t,-t||void 0);return a.reduce((e,s)=>e+s,0)/a.length}calculateMAD(e){const s=this.percentile(e,.5),t=e.map(e=>Math.abs(e-s)).sort((e,s)=>e-s);return this.percentile(t,.5)}calculateBootstrapCI(e,s,t=1e3){const a=[];for(let l=0;l<t;l++){const s=[];for(let t=0;t<e.length;t++)s.push(e[Math.floor(Math.random()*e.length)]);a.push(s.reduce((e,s)=>e+s,0)/s.length)}a.sort((e,s)=>e-s);const r=1-s;return{lowerBound:this.percentile(a,r/2),upperBound:this.percentile(a,1-r/2)}}calculateMaxDrawdown(e){let s=e[0],t=0;for(const a of e){a>s&&(s=a);const e=(s-a)/s;e>t&&(t=e)}return t}calculateSharpeRatio(e,s=.02){const t=e.reduce((e,s)=>e+s,0)/e.length,a=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/e.length,r=Math.sqrt(a);return r>0?(t-s)/r:0}calculateSortinoRatio(e,s){const t=e.map(e=>e-s),a=t.filter(e=>e<0);if(0===a.length)return 1/0;const r=Math.sqrt(a.reduce((e,s)=>e+s*s,0)/a.length),l=t.reduce((e,s)=>e+s,0)/t.length;return r>0?l/r:0}jarqueBeraTest(e){const s=e.length,t=e.reduce((e,s)=>e+s,0)/s,a=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/s,r=Math.sqrt(a),l=this.calculateSkewness(e,t,r),i=this.calculateKurtosis(e,t,r),n=s/6*(Math.pow(l,2)+Math.pow(i-3,2)/4),c=1-this.chiSquaredCDF(n,2);return{statistic:n,pValue:c,isNormal:c>.05}}chiSquaredCDF(e,s){return e<=0?0:this.incompleteGamma(s/2,e/2)}incompleteGamma(e,s){if(0===s)return 0;if(s<e+1){let t=1/e,a=1/e;for(let r=1;r<100&&(a*=s/(e+r),t+=a,!(a<1e-15));r++);return Math.exp(-s+e*Math.log(s)-this.logGamma(e))*t}return 1-this.incompleteGamma(e,s)}logGamma(e){const s=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let t=0,a=1.000000000190015,r=e,l=r=e,i=e+5.5;for(i-=(e+.5)*Math.log(i);t<6;t++)a+=s[t]/++l;return-i+Math.log(2.5066282746310007*a/r)}ksTestNormality(e){const s=e.length,t=e.reduce((e,s)=>e+s,0)/s,a=e.reduce((e,s)=>e+Math.pow(s-t,2),0)/s,r=Math.sqrt(a);let l=0;for(let n=0;n<s;n++){const a=(n+1)/s,i=this.normalCDF((e[n]-t)/r),c=Math.abs(a-i);c>l&&(l=c)}const i=1.36/Math.sqrt(s);return{statistic:l,critical:i,isNormal:l<i}}normalCDF(e){return.5*(1+this.erf(e/Math.sqrt(2)))}erf(e){const s=e<0?-1:1,t=1/(1+.3275911*(e=Math.abs(e)));return s*(1-((((1.061405429*t-1.453152027)*t+1.421413741)*t-.284496736)*t+.254829592)*t*Math.exp(-e*e))}shapiroWilkTest(e){const s=e.length;if(s<3||s>5e3)return null;const t=[...e].sort((e,s)=>e-s),a=e.reduce((e,s)=>e+s,0)/s;let r=0;for(let i=0;i<s;i++)r+=Math.pow(t[i]-a,2);const l=0/r;return{statistic:l,isNormal:l>.9}}calculateCorrelationMatrix(e,s){const t={};for(let a=0;a<s.length;a++){t[s[a]]={};for(let r=0;r<s.length;r++)if(a===r)t[s[a]][s[r]]=1;else{const l=e.map(e=>e[s[a]]).filter(e=>null!==e&&!isNaN(e)),i=e.map(e=>e[s[r]]).filter(e=>null!==e&&!isNaN(e));t[s[a]][s[r]]=this.calculateCorrelation(l,i)}}return t}calculateCorrelation(e,s){if(e.length!==s.length||0===e.length)return 0;const t=e.length,a=e.reduce((e,s)=>e+s,0)/t,r=s.reduce((e,s)=>e+s,0)/t;let l=0,i=0,n=0;for(let o=0;o<t;o++){const t=e[o]-a,c=s[o]-r;l+=t*c,i+=t*t,n+=c*c}const c=Math.sqrt(i*n);return c>0?l/c:0}percentile(e,s){const t=s*(e.length-1),a=Math.floor(t),r=Math.ceil(t),l=t-a;return a===r?e[a]:e[a]*(1-l)+e[r]*l}calculateSkewness(e,s,t){const a=e.length;return a/((a-1)*(a-2))*e.reduce((e,a)=>e+Math.pow((a-s)/t,3),0)}calculateKurtosis(e,s,t){const a=e.length;return a*(a+1)/((a-1)*(a-2)*(a-3))*e.reduce((e,a)=>e+Math.pow((a-s)/t,4),0)-3*Math.pow(a-1,2)/((a-2)*(a-3))}setSeed(e){this.seed=e,this.random=()=>(this.seed=(9301*this.seed+49297)%233280,this.seed/233280),Math.random=this.random}stopSimulation(){this.isRunning=!1}isSimulationRunning(){return this.isRunning}},Fe=({data:d,onDataChange:m,onAdjustedValuesChange:x})=>{const[u,h]=e.useState("incomeStatement"),[p,g]=e.useState({}),[b,j]=e.useState({revenue:!0,costOfGoodsSold:!0,operatingExpenses:!0,salariesBenefits:!0,grossProfit:!0,operatingIncome:!0,incomeBeforeTax:!0,otherIncomeExpense:!0,currentAssets:!0,nonCurrentAssets:!0,currentLiabilities:!0,nonCurrentLiabilities:!0,equity:!0,operatingActivities:!0,investingActivities:!0,financingActivities:!0}),[y,f]=e.useState(null),[v,N]=e.useState(""),w=e.useRef(null);e.useEffect(()=>{if(d?.statements?.incomeStatement&&0===Object.keys(p).length){const e={},s=d.statements.incomeStatement;Object.keys(s).forEach(t=>{s[t]&&void 0!==s[t][2]&&(e[t]=s[t][2])}),g(e),x&&x(e)}},[d,p,x]);const C={revenue:{title:"Revenue",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"energyDevices",label:"Energy Devices",level:1},{key:"injectables",label:"Injectables",level:1},{key:"wellness",label:"Wellness",level:1},{key:"weightloss",label:"Weightloss",level:1},{key:"retailSales",label:"Retail Sales",level:1},{key:"surgery",label:"Surgery",level:1},{key:"totalRevenue",label:"Total Revenue",level:0,bold:!0,formula:!0}]},costOfGoodsSold:{title:"Cost of Goods Sold",color:"bg-red-50 border-red-300",headerBg:"bg-red-600",textColor:"text-red-900",items:[{key:"energyDeviceSupplies",label:"Energy Device Supplies",level:1},{key:"injectablesCogs",label:"Injectables",level:1},{key:"wellnessCogs",label:"Wellness",level:1},{key:"weightlossCogs",label:"Weightloss",level:1},{key:"retailProducts",label:"Retail Products",level:1},{key:"surgicalSupplies",label:"Surgical Supplies",level:1},{key:"totalCostOfGoodsSold",label:"Total Cost of Goods Sold",level:0,bold:!0,formula:!0}]},grossProfit:{title:"Gross Profit",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"grossProfit",label:"Gross Profit",level:0,bold:!0,formula:!0}]},salariesBenefits:{title:"Salaries & Benefits",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"employeeBenefits",label:"Employee Benefits",level:1},{key:"payroll",label:"Payroll",level:1},{key:"payrollTaxes",label:"Payroll Taxes",level:1},{key:"totalSalariesBenefits",label:"Total Salaries & Benefits",level:0,bold:!0,formula:!0}]},operatingExpenses:{title:"Operating Expenses",color:"bg-orange-50 border-orange-300",headerBg:"bg-orange-600",textColor:"text-orange-900",items:[{key:"marketing",label:"Marketing",level:1},{key:"automobile",label:"Automobile",level:1},{key:"creditCardBankCharges",label:"Credit Card and Bank Charges",level:1},{key:"donations",label:"Donations",level:1},{key:"computerTelephoneUtilities",label:"Computer, Telephone, and Utilities",level:1},{key:"depreciation",label:"Depreciation",level:1},{key:"duesSubscriptions",label:"Dues & Subscriptions",level:1},{key:"education",label:"Education",level:1},{key:"equipmentRental",label:"Equipment Rental",level:1},{key:"insurance",label:"Insurance",level:1},{key:"interestExpense",label:"Interest Expense",level:1},{key:"travelMealsEntertainment",label:"Travel, Meals, and Entertainment",level:1},{key:"rent",label:"Rent",level:1},{key:"officeExpenses",label:"Office Expenses",level:1},{key:"professionalFees",label:"Professional Fees",level:1},{key:"repairsMaintenance",label:"Repairs & Maintenance",level:1},{key:"localTax",label:"Local Tax",level:1},{key:"stateTax",label:"State Tax",level:1},{key:"totalOperatingExpense",label:"Total Operating Expense",level:0,bold:!0,formula:!0}]},operatingIncome:{title:"Operating Income",color:"bg-teal-50 border-teal-300",headerBg:"bg-teal-600",textColor:"text-teal-900",items:[{key:"operatingIncome",label:"Operating Income",level:0,bold:!0}]},otherIncomeExpense:{title:"Other Income / (Expense)",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-600",textColor:"text-slate-900",items:[{key:"gainOnAssetSale",label:"Gain (Loss) On Asset Sale",level:1},{key:"interestIncome",label:"Interest Income",level:1},{key:"otherExpenses",label:"Other Expenses",level:1},{key:"totalOtherIncomeExpense",label:"Total Other Income / (Expenses)",level:0,bold:!0,formula:!0}]},incomeBeforeTax:{title:"Net Income Before Taxes",color:"bg-amber-50 border-amber-300",headerBg:"bg-amber-600",textColor:"text-amber-900",items:[{key:"incomeBeforeTax",label:"Net Income Before Taxes",level:0,bold:!0}]}},k={currentAssets:{title:"Current Assets",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"cash",label:"Cash and Cash Equivalents",level:1},{key:"receivables",label:"Accounts Receivable",level:1},{key:"inventory",label:"Inventory",level:1},{key:"prepaidExpenses",label:"Prepaid Expenses",level:1},{key:"otherCurrentAssets",label:"Other Current Assets",level:1},{key:"totalCurrentAssets",label:"Total Current Assets",level:0,formula:!0,bold:!0}]},nonCurrentAssets:{title:"Non-Current Assets",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"ppe",label:"Property, Plant & Equipment",level:1},{key:"accumulatedDepreciation",label:"Less: Accumulated Depreciation",level:1},{key:"netPPE",label:"Net Property, Plant & Equipment",level:1,formula:!0},{key:"intangibleAssets",label:"Intangible Assets",level:1},{key:"goodwill",label:"Goodwill",level:1},{key:"otherNonCurrentAssets",label:"Other Non-Current Assets",level:1},{key:"totalNonCurrentAssets",label:"Total Non-Current Assets",level:0,formula:!0,bold:!0}]},totalAssets:{title:"Total Assets",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalAssets",label:"Total Assets",level:0,formula:!0,bold:!0}]},currentLiabilities:{title:"Current Liabilities",color:"bg-red-50 border-red-300",headerBg:"bg-red-600",textColor:"text-red-900",items:[{key:"accountsPayable",label:"Accounts Payable",level:1},{key:"accruedExpenses",label:"Accrued Expenses",level:1},{key:"shortTermDebt",label:"Short-term Debt",level:1},{key:"currentPortionLongTermDebt",label:"Current Portion of Long-term Debt",level:1},{key:"otherCurrentLiabilities",label:"Other Current Liabilities",level:1},{key:"totalCurrentLiabilities",label:"Total Current Liabilities",level:0,formula:!0,bold:!0}]},nonCurrentLiabilities:{title:"Non-Current Liabilities",color:"bg-orange-50 border-orange-300",headerBg:"bg-orange-600",textColor:"text-orange-900",items:[{key:"longTermDebt",label:"Long-term Debt",level:1},{key:"deferredTaxLiabilities",label:"Deferred Tax Liabilities",level:1},{key:"otherNonCurrentLiabilities",label:"Other Non-Current Liabilities",level:1},{key:"totalNonCurrentLiabilities",label:"Total Non-Current Liabilities",level:0,formula:!0,bold:!0}]},totalLiabilities:{title:"Total Liabilities",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalLiabilities",label:"Total Liabilities",level:0,formula:!0,bold:!0}]},equity:{title:"Shareholders' Equity",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"commonStock",label:"Common Stock",level:1},{key:"retainedEarnings",label:"Retained Earnings",level:1},{key:"otherEquity",label:"Other Comprehensive Income",level:1},{key:"totalEquity",label:"Total Shareholders' Equity",level:0,formula:!0,bold:!0}]},totalLiabilitiesEquity:{title:"Total Liabilities and Equity",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"totalLiabilitiesEquity",label:"Total Liabilities and Shareholders' Equity",level:0,formula:!0,bold:!0}]}},M={operatingActivities:{title:"Operating Activities",color:"bg-emerald-50 border-emerald-300",headerBg:"bg-emerald-600",textColor:"text-emerald-900",items:[{key:"netIncome",label:"Net Income",level:1},{key:"depreciation",label:"Depreciation and Amortization",level:1},{key:"receivablesChange",label:"Change in Accounts Receivable",level:1},{key:"inventoryChange",label:"Change in Inventory",level:1},{key:"payablesChange",label:"Change in Accounts Payable",level:1},{key:"otherOperatingChanges",label:"Other Operating Changes",level:1},{key:"netCashFromOperating",label:"Net Cash from Operating Activities",level:0,formula:!0,bold:!0}]},investingActivities:{title:"Investing Activities",color:"bg-blue-50 border-blue-300",headerBg:"bg-blue-600",textColor:"text-blue-900",items:[{key:"capex",label:"Capital Expenditures",level:1},{key:"acquisitions",label:"Acquisitions",level:1},{key:"assetSales",label:"Asset Sales",level:1},{key:"otherInvestingActivities",label:"Other Investing Activities",level:1},{key:"netCashFromInvesting",label:"Net Cash from Investing Activities",level:0,formula:!0,bold:!0}]},financingActivities:{title:"Financing Activities",color:"bg-purple-50 border-purple-300",headerBg:"bg-purple-600",textColor:"text-purple-900",items:[{key:"debtIssuance",label:"Debt Issuance",level:1},{key:"debtRepayment",label:"Debt Repayment",level:1},{key:"equityIssuance",label:"Equity Issuance",level:1},{key:"dividends",label:"Dividends Paid",level:1},{key:"otherFinancingActivities",label:"Other Financing Activities",level:1},{key:"netCashFromFinancing",label:"Net Cash from Financing Activities",level:0,formula:!0,bold:!0}]},netCashFlow:{title:"Net Cash Flow",color:"bg-slate-50 border-slate-300",headerBg:"bg-slate-700",textColor:"text-slate-900",items:[{key:"netCashFlow",label:"Net Change in Cash",level:0,formula:!0,bold:!0},{key:"beginningCash",label:"Cash at Beginning of Period",level:1},{key:"endingCash",label:"Cash at End of Period",level:0,formula:!0,bold:!0}]}},R=(()=>{switch(u){case"balanceSheet":return k;case"cashFlow":return M;default:return C}})(),S=(e,s,t=!1)=>{f({rowKey:e,periodIndex:s,isAdjusted:t});let a="";a=t?p[e]||"":d.statements.incomeStatement[e]?.[s]||"",N(a.toString())},F=()=>{if(y){const{rowKey:e,periodIndex:s,isAdjusted:t}=y,a=parseFloat(v)||0;if(t){const s={...p,[e]:a};g(s),x&&x(s)}else{const t={...d};t.statements.incomeStatement[e]||(t.statements.incomeStatement[e]={}),t.statements.incomeStatement[e][s]=a,m(t)}f(null),N("")}},D=e=>{"Enter"===e.key?(e.preventDefault(),F()):"Escape"===e.key?(e.preventDefault(),f(null),N("")):"Tab"===e.key&&(e.preventDefault(),F())},I=e=>/^-?\d*\.?\d*$/.test(e)||""===e,A=e=>{if(!e&&0!==e)return"";const s="string"==typeof e?parseFloat(e):e;if(isNaN(s))return"";const t=Math.abs(s);let a;return t>=1e6?(a=new Intl.NumberFormat("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}).format(s/1e6),a+="M"):a=t>=1e3?new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(s):new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s),a};e.useEffect(()=>{y&&w.current&&(w.current.focus(),w.current.select())},[y]);return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 pb-8",children:[s.jsx("div",{className:"bg-white border-b border-slate-200 shadow-sm",children:s.jsx("div",{className:"max-w-full mx-auto px-8 py-6",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(t,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Financial Spreadsheet"}),s.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Professional financial modeling workspace"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:()=>{const e=prompt('Enter period label (e.g., "Year 5"):');if(e){const s={...d};s.periods=[...s.periods,e],m(s)}},className:"px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition-all duration-200 shadow-sm hover:shadow-md font-medium",children:[s.jsx(a,{size:16}),"Add Period"]}),s.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"px-4 py-2.5 bg-white border border-slate-300 rounded-lg text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium shadow-sm",children:[s.jsx("option",{value:"incomeStatement",children:"Income Statement"}),s.jsx("option",{value:"balanceSheet",children:"Balance Sheet"}),s.jsx("option",{value:"cashFlow",children:"Cash Flow Statement"})]})]})]})})}),s.jsxs("div",{className:"max-w-full mx-auto p-8",children:[s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 shadow-lg",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gradient-to-r from-slate-800 to-slate-900 text-white",children:s.jsxs("tr",{children:[s.jsx("th",{className:"min-w-[320px] px-6 py-4 text-left text-sm font-semibold tracking-wider",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(r,{size:16,className:"text-slate-300"}),"Account Description"]})}),s.jsx("th",{className:"w-20 px-4 py-4 text-center text-sm font-semibold",children:"Units"}),d.periods.map((e,t)=>s.jsx("th",{className:"min-w-[140px] px-4 py-4 text-center text-sm font-semibold",children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{children:e}),s.jsx("span",{className:"text-xs text-slate-300 font-normal",children:"Actual"})]})},t)),s.jsx("th",{className:"min-w-[140px] px-4 py-4 text-center text-sm font-semibold bg-gradient-to-r from-amber-600 to-yellow-600 border-l-2 border-amber-400",children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{children:"Adjusted"}),s.jsx("span",{className:"text-xs text-amber-100 font-normal",children:"Modified"})]})}),s.jsx("th",{className:"w-28 px-4 py-4 text-center text-sm font-semibold",children:s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx(l,{size:14}),"Type"]})})]})}),s.jsx("tbody",{className:"divide-y divide-slate-100",children:Object.entries(R).map(([e,t])=>s.jsxs(i.Fragment,{children:[s.jsx("tr",{className:`${t.headerBg||"bg-slate-600"} border-b-2 border-slate-300`,children:s.jsx("td",{colSpan:d.periods.length+4,className:"py-4 px-6",children:s.jsxs("div",{className:"flex items-center gap-3 text-white w-full text-left group",children:[s.jsxs("button",{onClick:()=>(e=>{j(s=>({...s,[e]:!s[e]}))})(e),className:"flex items-center gap-3 text-white hover:text-slate-200 transition-colors flex-1",children:[s.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-white/20 group-hover:bg-white/30 transition-colors",children:b[e]?s.jsx(n,{size:14}):s.jsx(c,{size:14})}),s.jsx("span",{className:"font-bold text-lg",children:t.title})]}),s.jsx("button",{onClick:e=>{e.stopPropagation(),(()=>{if(prompt("Enter row label:")){const e={...d};m(e)}})()},className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"Add custom row",children:s.jsx(a,{size:16})})]})})}),b[e]&&t.items.map(e=>(e=>{const{key:t,label:a,level:r,formula:i,bold:n}=e,c=1===r?"pl-8":2===r?"pl-12":"pl-4",m=n?"font-bold":0===r?"font-semibold":"font-medium",x=0===r?"text-slate-900":"text-slate-700",u=0===r?"bg-slate-50/70":"bg-white",h=0===r?"border-slate-200":"border-slate-100";return s.jsxs("tr",{className:`${u} border-b ${h} hover:bg-slate-50 transition-all duration-150 group`,children:[s.jsx("td",{className:`px-6 py-4 ${c} ${m} text-sm ${x}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[0===r&&s.jsx("div",{className:"w-1.5 h-4 bg-gradient-to-b from-blue-500 to-blue-600 rounded-full flex-shrink-0 shadow-sm"}),s.jsx("span",{className:"leading-tight",children:a}),i&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(l,{size:14,className:"text-blue-500/80 flex-shrink-0"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium px-1.5 py-0.5 bg-blue-50 rounded-md",children:"AUTO"})]})]})}),s.jsx("td",{className:"px-4 py-4 text-center",children:s.jsx("span",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-100 px-2 py-1 rounded-md",children:"$ 000s"})}),d.periods.map((e,a)=>s.jsx("td",{className:"px-4 py-4 text-right",children:y?.rowKey!==t||y?.periodIndex!==a||y?.isAdjusted?s.jsxs("div",{onClick:()=>!i&&S(t,a),className:"px-3 py-2.5 rounded-lg font-mono text-sm transition-all duration-200 min-h-[40px] flex items-center justify-end "+(i?"bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800 font-semibold border border-blue-200 shadow-sm":"hover:bg-slate-100 text-slate-800 cursor-pointer border border-transparent hover:border-slate-200 hover:shadow-sm group-hover:bg-slate-50"),children:[s.jsx("span",{className:i?"text-blue-900":"text-slate-700",children:A(d.statements.incomeStatement[t]?.[a])||"—"}),!i&&s.jsx(o,{size:12,className:"ml-2 opacity-0 group-hover:opacity-40 text-slate-400 transition-opacity"})]}):s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:w,type:"text",value:v,onChange:e=>{const s=e.target.value;I(s)&&N(s)},onBlur:F,onKeyDown:D,className:"w-full px-3 py-2.5 bg-white border-2 border-blue-400 rounded-lg text-slate-900 text-right font-mono text-sm focus:outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-500 shadow-lg",placeholder:"0.00"}),s.jsxs("div",{className:"absolute -top-2 -right-2 flex gap-1",children:[s.jsx("button",{onClick:F,className:"w-5 h-5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"✓"}),s.jsx("button",{onClick:()=>{f(null),N("")},className:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"×"})]})]})},a)),s.jsx("td",{className:"px-4 py-4 text-right bg-gradient-to-r from-amber-50 to-yellow-50 border-l-2 border-amber-300",children:y?.rowKey===t&&y?.isAdjusted?s.jsxs("div",{className:"relative",children:[s.jsx("input",{ref:w,type:"text",value:v,onChange:e=>{const s=e.target.value;I(s)&&N(s)},onBlur:F,onKeyDown:D,className:"w-full px-3 py-2.5 bg-white border-2 border-amber-400 rounded-lg text-slate-900 text-right font-mono text-sm focus:outline-none focus:ring-4 focus:ring-amber-100 focus:border-amber-500 shadow-lg",placeholder:"0.00"}),s.jsxs("div",{className:"absolute -top-2 -right-2 flex gap-1",children:[s.jsx("button",{onClick:F,className:"w-5 h-5 bg-emerald-500 hover:bg-emerald-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"✓"}),s.jsx("button",{onClick:()=>{f(null),N("")},className:"w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs transition-colors",children:"×"})]})]}):s.jsxs("div",{onClick:()=>!i&&S(t,null,!0),className:"px-3 py-2.5 rounded-lg font-mono text-sm transition-all duration-200 min-h-[40px] flex items-center justify-end "+(i?"bg-gradient-to-r from-amber-100 to-yellow-100 text-amber-800 font-semibold border border-amber-300 shadow-sm":"hover:bg-amber-100 text-slate-800 cursor-pointer border border-transparent hover:border-amber-300 hover:shadow-sm"),children:[s.jsx("span",{className:i?"text-amber-900":"text-slate-700",children:A(p[t]||0)||"—"}),!i&&s.jsx(o,{size:12,className:"ml-2 opacity-0 group-hover:opacity-40 text-amber-500 transition-opacity"})]})}),s.jsx("td",{className:"px-4 py-4 text-center",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium "+(i?"bg-blue-100 text-blue-800 border border-blue-200":"bg-slate-100 text-slate-700 border border-slate-200"),children:i?s.jsxs(s.Fragment,{children:[s.jsx(l,{size:10,className:"mr-1"}),"Auto"]}):s.jsxs(s.Fragment,{children:[s.jsx(o,{size:10,className:"mr-1"}),"Manual"]})})})]},t)})(e))]},e))})]})})}),s.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl p-6 border border-slate-200 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(l,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h3",{className:"font-bold text-slate-900",children:"How to Use"})]}),s.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Click any editable cell to modify values with enhanced input controls"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Use Enter to save changes or Escape to cancel editing"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Expand/collapse sections using the arrow controls"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-blue-500 font-bold",children:"•"}),"Formula cells automatically calculate based on inputs"]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl p-6 border border-slate-200 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(t,{className:"w-5 h-5 text-green-600"})}),s.jsx("h3",{className:"font-bold text-slate-900",children:"Professional Features"})]}),s.jsxs("ul",{className:"space-y-2 text-sm text-slate-700",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Color-coded sections for easy visual navigation"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Adjusted column for scenario analysis and modifications"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Professional number formatting with proper alignment"]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx("span",{className:"text-green-500 font-bold",children:"•"}),"Enhanced editing experience with save/cancel controls"]})]})]})]})]})]})},De=({data:r,modelInputs:l,onModelInputChange:i,calculateDCF:n,formatCurrency:c,formatPercent:o})=>{const[h,p]=e.useState(!1),g=l.scenario?.scenarios||[],b=e.useMemo(()=>g.map(e=>{try{const s={...r.statements.incomeStatement},t=s.totalRevenue||{},a={};Object.keys(t).forEach(s=>{const r=parseInt(s);if(0===r)a[s]=t[s];else{const l=1+e.revenueGrowth/100;a[s]=t[0]*Math.pow(l,r)}});const l=s.operatingIncome||{},i={};Object.keys(l).forEach(s=>{if(0===parseInt(s))i[s]=l[s];else{const r=t[s]||0,n=a[s]||0,c=l[s]||0;if(r>0){const t=c/r+e.marginImprovement/100;i[s]=n*t}else i[s]=c}});const c={...r,statements:{...r.statements,incomeStatement:{...s,totalRevenue:a,operatingIncome:i}}},o=n(c);return{...e,...o,weightedValue:o.enterpriseValue*(e.probability/100)}}catch(s){return{...e,enterpriseValue:0,equityValue:0,weightedValue:0}}}),[g,r,n]),j=b.reduce((e,s)=>e+s.weightedValue,0),y=(e,s,t)=>{const a=g.map((a,r)=>r===e?{...a,[s]:t}:a);i("scenario","scenarios",a)},f=({scenario:e,index:t})=>s.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scenario Name"}),s.jsx("input",{type:"text",value:e.name,onChange:e=>y(t,"name",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter scenario name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Probability (%)"}),s.jsx("input",{type:"number",min:"0",max:"100",value:e.probability,onChange:e=>y(t,"probability",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue Growth (%)"}),s.jsx("input",{type:"number",step:"0.1",value:e.revenueGrowth,onChange:e=>y(t,"revenueGrowth",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Margin Change (%)"}),s.jsx("input",{type:"number",step:"0.1",value:e.marginImprovement,onChange:e=>y(t,"marginImprovement",parseFloat(e.target.value)||0),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsx("div",{className:"flex justify-end mt-4 gap-2",children:s.jsxs("button",{onClick:()=>(e=>{const s=g.filter((s,t)=>t!==e);i("scenario","scenarios",s)})(t),className:"px-3 py-1 text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center gap-1",children:[s.jsx(u,{size:16}),"Delete"]})})]});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{children:s.jsx("p",{className:"text-gray-600",children:"Create and compare multiple financial scenarios with different assumptions and probabilities."})}),s.jsxs("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[s.jsx(a,{size:16}),"Add Scenario"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Assumptions"}),g.map((e,t)=>s.jsx(f,{scenario:e,index:t},t)),h&&s.jsx("div",{className:"border-2 border-dashed border-blue-300 rounded-lg p-4",children:s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h5",{className:"font-medium",children:"Add New Scenario"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{const e={name:`Scenario ${g.length+1}`,probability:Math.max(0,100-g.reduce((e,s)=>e+s.probability,0)),revenueGrowth:10,marginImprovement:0};i("scenario","scenarios",[...g,e]),p(!1)},className:"px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Add"}),s.jsx("button",{onClick:()=>p(!1),className:"px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})})]}),b.length>0&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Scenario Analysis Results"}),s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(d,{size:20,className:"text-blue-600"}),s.jsx("h5",{className:"font-semibold text-blue-800",children:"Probability-Weighted Valuation"})]}),s.jsx("div",{className:"text-3xl font-bold text-blue-800",children:c(j)}),s.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"Expected value based on scenario probabilities"})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:b.map((e,a)=>s.jsxs(re.div,{className:"bg-white rounded-lg border p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{children:[s.jsx("h6",{className:"font-semibold text-gray-800",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsxs("span",{children:[e.probability,"% probability"]}),e.revenueGrowth>15?s.jsx(t,{size:14,className:"text-green-500"}):e.revenueGrowth<5?s.jsx(m,{size:14,className:"text-red-500"}):s.jsx(x,{size:14,className:"text-gray-500"})]})]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Enterprise Value"}),s.jsx("div",{className:"text-xl font-bold text-gray-800",children:c(e.enterpriseValue)})]}),s.jsxs("div",{className:"text-xs space-y-1 text-gray-600",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Revenue Growth:"}),s.jsx("span",{className:"font-medium",children:o(e.revenueGrowth)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Margin Change:"}),s.jsxs("span",{className:"font-medium "+(e.marginImprovement>=0?"text-green-600":"text-red-600"),children:[e.marginImprovement>=0?"+":"",o(e.marginImprovement)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Weighted Value:"}),s.jsx("span",{className:"font-medium",children:c(e.weightedValue)})]})]})]})]},a))}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h5",{className:"font-semibold mb-4",children:"Scenario Statistics"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:c(Math.max(...b.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:c(Math.min(...b.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c(j)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-800",children:c(Math.max(...b.map(e=>e.enterpriseValue))-Math.min(...b.map(e=>e.enterpriseValue)))}),s.jsx("div",{className:"text-sm text-gray-600",children:"Value Range"})]})]}),s.jsx("div",{className:"mt-4 pt-4 border-t",children:s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("strong",{children:"Total Probability:"})," ",g.reduce((e,s)=>e+s.probability,0),"%",100!==g.reduce((e,s)=>e+s.probability,0)&&s.jsx("span",{className:"text-orange-600 ml-2",children:"⚠ Probabilities should sum to 100%"})]})})]})]}),0===g.length&&s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(d,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"No scenarios created yet."}),s.jsx("p",{className:"text-sm mt-2",children:'Click "Add Scenario" to get started with scenario modeling.'})]})]})},Ie=({data:t,modelInputs:r,onModelInputChange:l,calculateDCF:i,formatCurrency:n,formatPercent:c})=>{const[o,m]=e.useState(null),u=r.sensitivity||{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},g={revenue:{name:"Revenue Growth",unit:"%",description:"Annual revenue growth rate",baseValue:15,isPercentage:!0},grossMargin:{name:"Gross Margin",unit:"%",description:"Gross profit margin improvement",baseValue:45,isPercentage:!0},discountRate:{name:"Discount Rate (WACC)",unit:"%",description:"Weighted average cost of capital",baseValue:r.dcf?.discountRate||10,isPercentage:!0},terminalGrowthRate:{name:"Terminal Growth Rate",unit:"%",description:"Long-term growth rate assumption",baseValue:r.dcf?.terminalGrowthRate||2.5,isPercentage:!0},taxRate:{name:"Tax Rate",unit:"%",description:"Corporate tax rate",baseValue:r.dcf?.taxRate||25,isPercentage:!0}},b=e.useMemo(()=>i(),[t,r,i]),j=e.useMemo(()=>{const e={};return u.variables.forEach(s=>{const a=u.ranges[s],l=g[s];if(!a||!l)return;const i=(a.max-a.min)/8,n=[];for(let e=0;e<9;e++){const c=a.min+i*e;let o={...t},d={...r.dcf,[s]:(l.isPercentage,c)};if("revenue"===s||"grossMargin"===s){const e={...t.statements.incomeStatement};if("revenue"===s){const s=e.totalRevenue||{},t={};Object.keys(s).forEach(e=>{const a=parseInt(e);if(0===a)t[e]=s[e];else{const r=1+c/100;t[e]=s[0]*Math.pow(r,a)}}),e.totalRevenue=t}if("grossMargin"===s){const s=e.operatingIncome||{},t=e.totalRevenue||{},a={};Object.keys(s).forEach(e=>{const r=t[e]||0,l=s[e]||0;if(r>0){const s=l/r+c/100;a[e]=r*s}else a[e]=l}),e.operatingIncome=a}o={...t,statements:{...t.statements,incomeStatement:e}}}const m=(()=>{try{const e={discountRate:d.discountRate||10,terminalGrowthRate:d.terminalGrowthRate||2.5,projectionYears:d.projectionYears||5,taxRate:d.taxRate||25},s=o.statements.incomeStatement.operatingIncome||{};let t=[];if(Object.keys(s).forEach(e=>{parseInt(e)>=0&&t.push(s[e]||0)}),0===t.length)return{enterpriseValue:0,equityValue:0};let a=0;const r=1+e.discountRate/100;t.forEach((s,t)=>{if(t>0&&t<=e.projectionYears){const l=s*(1-e.taxRate/100)/Math.pow(r,t);a+=l}});const l=t[t.length-1]||0,i=l*(1+e.terminalGrowthRate/100)*(1-e.taxRate/100)/((e.discountRate-e.terminalGrowthRate)/100),n=i/Math.pow(r,e.projectionYears),c=a+n;return{enterpriseValue:c,equityValue:c,presentValueOperations:a,presentValueTerminal:n,terminalValue:i}}catch(e){return{enterpriseValue:0,equityValue:0}}})();n.push({variable:c,valuation:m.enterpriseValue,changeFromBase:(m.enterpriseValue-b.enterpriseValue)/b.enterpriseValue*100})}e[s]={definition:l,range:a,dataPoints:n}}),e},[t,r,u,b,i]),y=e.useMemo(()=>Object.entries(j).map(([e,s])=>{const t=Math.max(...s.dataPoints.map(e=>Math.abs(e.changeFromBase)));return{variable:e,definition:s.definition,maxImpact:t,positiveImpact:Math.max(...s.dataPoints.map(e=>e.changeFromBase)),negativeImpact:Math.min(...s.dataPoints.map(e=>e.changeFromBase))}}).sort((e,s)=>s.maxImpact-e.maxImpact),[j]),f=(e,s,t)=>{const a={...u.ranges,[e]:{...u.ranges[e],[s]:parseFloat(t)}};l("sensitivity","ranges",a)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600 mb-4",children:"Analyze how changes in key variables impact enterprise valuation. Higher sensitivity indicates greater risk and importance for due diligence."}),s.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),s.jsxs("span",{children:["Base Case: ",n(b.enterpriseValue)]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{size:14}),s.jsxs("span",{children:[u.variables.length," variables analyzed"]})]})]})]}),s.jsxs("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2",children:[s.jsx(p,{size:16}),"Configure"]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("h4",{className:"font-semibold text-lg mb-4 flex items-center gap-2",children:[s.jsx(d,{size:20}),"Impact Ranking (Tornado Chart)"]}),s.jsx("div",{className:"space-y-3",children:y.map((e,t)=>s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("span",{className:"text-sm font-medium",children:[t+1,". ",e.definition.name]}),s.jsxs("span",{className:"text-xs text-gray-500",children:["±",e.maxImpact.toFixed(1),"%"]})]}),s.jsxs("div",{className:"relative h-8 bg-gray-100 rounded",children:[s.jsx("div",{className:"absolute left-1/2 h-full bg-red-400 rounded-l",style:{width:Math.abs(e.negativeImpact)/Math.max(Math.abs(e.negativeImpact),e.positiveImpact)*50+"%",transform:"translateX(-100%)"}}),s.jsx("div",{className:"absolute left-1/2 h-full bg-green-400 rounded-r",style:{width:e.positiveImpact/Math.max(Math.abs(e.negativeImpact),e.positiveImpact)*50+"%"}}),s.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-gray-400 transform -translate-x-0.5"}),s.jsxs("div",{className:"absolute inset-0 flex items-center justify-between px-2 text-xs font-medium text-white",children:[s.jsxs("span",{children:[e.negativeImpact.toFixed(1),"%"]}),s.jsxs("span",{children:["+",e.positiveImpact.toFixed(1),"%"]})]})]})]},e.variable))})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Variable Configuration"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[u.variables.map(e=>{const t=j[e];return t?s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium",children:t.definition.name}),s.jsx("p",{className:"text-xs text-gray-500",children:t.definition.description})]}),s.jsx("button",{onClick:()=>(e=>{const s=u.variables.filter(s=>s!==e),{[e]:t,...a}=u.ranges;l("sensitivity","variables",s),l("sensitivity","ranges",a)})(e),className:"text-red-500 hover:bg-red-50 p-1 rounded",children:s.jsx(x,{size:16})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Min Value (",t.definition.unit,")"]}),s.jsx("input",{type:"number",step:"0.1",value:t.range.min,onChange:s=>f(e,"min",s.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Max Value (",t.definition.unit,")"]}),s.jsx("input",{type:"number",step:"0.1",value:t.range.max,onChange:s=>f(e,"max",s.target.value),className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"h-16 bg-gray-50 rounded p-2",children:[s.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Valuation Sensitivity"}),s.jsx("div",{className:"flex items-end justify-between h-8",children:t.dataPoints.map((e,a)=>s.jsx("div",{className:"w-1 rounded-t "+(e.changeFromBase>0?"bg-green-400":e.changeFromBase<0?"bg-red-400":"bg-blue-400"),style:{height:Math.abs(e.changeFromBase)/50*100+"%",minHeight:"2px"},title:`${e.variable}${t.definition.unit}: ${n(e.valuation)}`},a))})]})]},e):null}),s.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(a,{size:24,className:"mx-auto mb-2 text-gray-400"}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Add Variable"}),s.jsx("div",{className:"space-y-2",children:Object.keys(g).filter(e=>!u.variables.includes(e)).map(e=>s.jsx("button",{onClick:()=>(e=>{if(!u.variables.includes(e)&&g[e]){const s=[...u.variables,e],t={...u.ranges,[e]:{min:-10,max:10}};l("sensitivity","variables",s),l("sensitivity","ranges",t)}})(e),className:"block w-full px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:g[e].name},e))})]})})]})]}),o&&j[o]&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("h4",{className:"font-semibold text-lg mb-4",children:["Detailed Analysis: ",j[o].definition.name]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-3",children:"Data Points"}),s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:j[o].dataPoints.map((e,t)=>s.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-gray-50 rounded",children:[s.jsxs("span",{children:[e.variable,j[o].definition.unit]}),s.jsx("span",{className:"font-medium",children:n(e.valuation)}),s.jsxs("span",{className:"font-medium "+(e.changeFromBase>0?"text-green-600":e.changeFromBase<0?"text-red-600":"text-gray-600"),children:[e.changeFromBase>0?"+":"",e.changeFromBase.toFixed(1),"%"]})]},t))})]}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Range Impact:"}),s.jsxs("span",{className:"font-medium",children:["±",Math.max(...j[o].dataPoints.map(e=>Math.abs(e.changeFromBase))).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Max Upside:"}),s.jsxs("span",{className:"font-medium text-green-600",children:["+",Math.max(...j[o].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Max Downside:"}),s.jsxs("span",{className:"font-medium text-red-600",children:[Math.min(...j[o].dataPoints.map(e=>e.changeFromBase)).toFixed(1),"%"]})]})]})]})]})]})]})},Ae=({dcfData:a,sensitivityData:r,scenarioData:l,formatCurrency:i,formatPercent:n})=>{const[c,o]=e.useState("dcf-waterfall"),[m,x]=e.useState(!0),u=[{id:"dcf-waterfall",label:"DCF Waterfall",icon:d,category:"dcf"},{id:"cashflow-trend",label:"Cash Flow Trend",icon:t,category:"dcf"},{id:"sensitivity-tornado",label:"Sensitivity Tornado",icon:h,category:"sensitivity"},{id:"scenario-distribution",label:"Scenario Distribution",icon:j,category:"scenario"},{id:"valuation-bridge",label:"Valuation Bridge",icon:d,category:"combined"}],p=e.useMemo(()=>{if(!a?.years)return[];let e=0;const s=[];a.years.forEach((t,a)=>{const r=e;e+=t.presentValue,s.push({name:`Year ${t.year}`,value:t.presentValue,cumulative:e,start:r,freeCashFlow:t.freeCashFlow,category:"operations"})});const t=e;return e+=a.presentValueTerminal,s.push({name:"Terminal Value",value:a.presentValueTerminal,cumulative:e,start:t,category:"terminal"}),s},[a]),y=e.useMemo(()=>a?.years?a.years.map((e,s)=>({year:`Year ${e.year}`,freeCashFlow:e.freeCashFlow,presentValue:e.presentValue,revenue:e.revenue,operatingIncome:e.operatingIncome,workingCapitalChange:e.workingCapitalChange,capex:Math.abs(e.capex)})):[],[a]),f=e.useMemo(()=>r?Object.entries(r).map(([e,s])=>{const t=Math.max(...s.dataPoints.map(e=>e.changeFromBase)),a=Math.min(...s.dataPoints.map(e=>e.changeFromBase));return{variable:s.definition.name,upside:t,downside:Math.abs(a),range:t-a}}).sort((e,s)=>s.range-e.range):[],[r]),v=e.useMemo(()=>l?.length?l.map((e,s)=>({name:e.name,value:e.enterpriseValue,probability:e.probability,weightedValue:e.weightedValue,fill:`hsl(${137.5*s%360}, 70%, 50%)`})):[],[l]),N=({active:e,payload:t,label:a,chartType:r})=>{if(!e||!t||!t.length)return null;return s.jsxs("div",{className:"bg-white p-3 border rounded-lg shadow-lg",children:[s.jsx("p",{className:"font-medium text-gray-800",children:a}),t.map((e,t)=>{return s.jsx("p",{style:{color:e.color},className:"text-sm",children:`${e.dataKey}: ${a=e.value,r=e.dataKey,r?.includes("Percent")||r?.includes("Rate")?n(a):i(a)}`},t);var a,r})]})},w=()=>s.jsx(ie,{width:"100%",height:400,children:s.jsxs(ne,{data:p,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"name"}),s.jsx(de,{tickFormatter:e=>i(e)}),s.jsx(me,{content:s.jsx(N,{chartType:"waterfall"})}),s.jsx(xe,{dataKey:"value",fill:"#3B82F6"})]})}),C=()=>s.jsx(ie,{width:"100%",height:400,children:s.jsxs(ge,{data:y,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"year"}),s.jsx(de,{tickFormatter:e=>i(e)}),s.jsx(me,{content:s.jsx(N,{chartType:"trend"})}),s.jsx(be,{}),s.jsx(je,{type:"monotone",dataKey:"freeCashFlow",stroke:"#10B981",strokeWidth:3,name:"Free Cash Flow"}),s.jsx(je,{type:"monotone",dataKey:"presentValue",stroke:"#3B82F6",strokeWidth:2,name:"Present Value"}),s.jsx(je,{type:"monotone",dataKey:"revenue",stroke:"#8B5CF6",strokeWidth:2,name:"Revenue"})]})}),k=()=>s.jsx(ie,{width:"100%",height:400,children:s.jsxs(ne,{data:f,layout:"horizontal",margin:{top:20,right:30,left:100,bottom:5},children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{type:"number",tickFormatter:e=>`${e.toFixed(1)}%`}),s.jsx(de,{type:"category",dataKey:"variable"}),s.jsx(me,{formatter:(e,s)=>[`${e.toFixed(1)}%`,s],labelFormatter:e=>`Variable: ${e}`}),s.jsx(xe,{dataKey:"upside",fill:"#10B981",name:"Upside Impact"}),s.jsx(xe,{dataKey:"downside",fill:"#EF4444",name:"Downside Impact"})]})}),M=()=>s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsx(ie,{width:"100%",height:300,children:s.jsxs(ue,{children:[s.jsx(he,{data:v,cx:"50%",cy:"50%",outerRadius:80,dataKey:"probability",label:({name:e,probability:s})=>`${e}: ${s}%`,children:v.map((e,t)=>s.jsx(pe,{fill:e.fill},`cell-${t}`))}),s.jsx(me,{formatter:e=>`${e}%`})]})}),s.jsx(ie,{width:"100%",height:300,children:s.jsxs(ne,{data:v,children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"name"}),s.jsx(de,{tickFormatter:e=>i(e)}),s.jsx(me,{content:s.jsx(N,{chartType:"scenario"})}),s.jsx(xe,{dataKey:"value",fill:"#8B5CF6",name:"Enterprise Value"})]})})]}),R=()=>{const e=[{name:"PV of Operations",value:a?.cumulativePV||0,type:"positive"},{name:"PV of Terminal",value:a?.presentValueTerminal||0,type:"positive"},{name:"Enterprise Value",value:a?.enterpriseValue||0,type:"total"}];return s.jsx(ie,{width:"100%",height:400,children:s.jsxs(ne,{data:e,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"name"}),s.jsx(de,{tickFormatter:e=>i(e)}),s.jsx(me,{content:s.jsx(N,{chartType:"bridge"})}),s.jsx(xe,{dataKey:"value",fill:e=>"total"===e.type?"#1F2937":"#3B82F6"})]})})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(d,{size:20}),"Data Visualization"]}),s.jsx("p",{className:"text-gray-600",children:"Interactive charts and graphs to visualize valuation results and sensitivity analysis."})]}),s.jsxs("button",{onClick:()=>x(!m),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-2 "+(m?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:[m?s.jsx(g,{size:14}):s.jsx(b,{size:14}),m?"Hide Details":"Show Details"]})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:u.map(e=>{const t=e.icon;return s.jsxs(re.button,{onClick:()=>o(e.id),className:"p-3 rounded-lg border-2 transition-all text-center "+(c===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white hover:border-gray-300 text-gray-700"),whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(t,{size:20,className:"mx-auto mb-2"}),s.jsx("div",{className:"text-xs font-medium",children:e.label})]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h4",{className:"font-semibold text-lg",children:u.find(e=>e.id===c)?.label}),m&&s.jsx("span",{className:"text-sm text-gray-500",children:(()=>{switch(c){case"dcf-waterfall":return"Shows the contribution of each year's cash flows and terminal value to total enterprise value.";case"cashflow-trend":return"Displays the trend of free cash flows, present values, and key financial metrics over time.";case"sensitivity-tornado":return"Illustrates how changes in key variables impact enterprise value, ranked by sensitivity.";case"scenario-distribution":return"Compares different scenarios by probability weights and resulting enterprise values.";case"valuation-bridge":return"Breaks down enterprise value into operating value and terminal value components.";default:return""}})()})]}),s.jsx("div",{className:"min-h-[400px]",children:(()=>{switch(c){case"dcf-waterfall":default:return s.jsx(w,{});case"cashflow-trend":return s.jsx(C,{});case"sensitivity-tornado":return s.jsx(k,{});case"scenario-distribution":return s.jsx(M,{});case"valuation-bridge":return s.jsx(R,{})}})()})]}),m&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Key Insights"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:["dcf-waterfall"===c&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Operations Contribution"}),s.jsx("div",{className:"text-lg font-bold text-blue-800",children:a?.cumulativePV?`${(a.cumulativePV/a.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),s.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Terminal Contribution"}),s.jsx("div",{className:"text-lg font-bold text-purple-800",children:a?.presentValueTerminal?`${(a.presentValueTerminal/a.enterpriseValue*100).toFixed(1)}%`:"N/A"})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Avg. Annual FCF"}),s.jsx("div",{className:"text-lg font-bold text-green-800",children:a?.freeCashFlows?i(a.freeCashFlows.reduce((e,s)=>e+s,0)/a.freeCashFlows.length):"N/A"})]})]}),"sensitivity-tornado"===c&&f.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-red-600 font-medium",children:"Highest Risk Variable"}),s.jsx("div",{className:"text-lg font-bold text-red-800",children:f[0]?.variable}),s.jsxs("div",{className:"text-sm text-red-600",children:["±",f[0]?.range.toFixed(1),"% impact"]})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-yellow-600 font-medium",children:"Medium Risk Variables"}),s.jsx("div",{className:"text-lg font-bold text-yellow-800",children:f.slice(1,3).map(e=>e.variable).join(", ")})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Lowest Risk Variable"}),s.jsx("div",{className:"text-lg font-bold text-green-800",children:f[f.length-1]?.variable})]})]})]})]})]})},Ee=({modelInputs:a,onModelInputChange:r,formatPercent:i})=>{const[n,c]=e.useState(!0),[o,d]=e.useState("inputs"),m=a.dcf.wacc||{riskFreeRate:4.5,marketRiskPremium:6,beta:1.2,smallCompanyPremium:3,companySpecificRisk:2,debtInterestRate:6.5,taxRate:25,marketValueEquity:1e5,marketValueDebt:3e4,buildUpMethod:{riskFreeRate:4.5,equityRiskPremium:6,sizeRiskPremium:3,industryRiskPremium:2,companySpecificRisk:2},industryWACC:10.5,industryBeta:1.1,industryDebtEquityRatio:.3},x=e.useMemo(()=>{const e={...m,...a.dcf.wacc},s=e.riskFreeRate+e.beta*e.marketRiskPremium+e.smallCompanyPremium+e.companySpecificRisk,t=e.buildUpMethod.riskFreeRate+e.buildUpMethod.equityRiskPremium+e.buildUpMethod.sizeRiskPremium+e.buildUpMethod.industryRiskPremium+e.buildUpMethod.companySpecificRisk,r=e.debtInterestRate*(1-e.taxRate/100),l=e.marketValueEquity+e.marketValueDebt,i=e.marketValueEquity/l,n=e.marketValueDebt/l,c=s/100*i+r/100*n,o=t/100*i+r/100*n;return{costOfEquityCAPM:s,costOfEquityBuildUp:t,costOfDebtAfterTax:r,equityWeight:100*i,debtWeight:100*n,waccCAPM:100*c,waccBuildUp:100*o,finalWACC:100*((c+o)/2),totalCapital:l,debtToEquityRatio:e.marketValueDebt/e.marketValueEquity}},[m,a.dcf.wacc]),u=(e,s)=>{const t={...m,...a.dcf.wacc,[e]:parseFloat(s)||0};r("dcf","wacc",t)},h=[{id:"inputs",label:"Inputs",icon:p},{id:"calculation",label:"Calculation",icon:l},{id:"benchmarks",label:"Benchmarks",icon:t}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(l,{size:20}),"WACC Calculator"]}),s.jsx("p",{className:"text-gray-600",children:"Professional weighted average cost of capital calculation using CAPM and build-up methods."})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{return e=x.finalWACC,void r("dcf","discountRate",e);var e},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Apply to DCF"}),s.jsx("button",{onClick:()=>c(!n),className:"px-3 py-2 rounded-lg text-sm transition-colors "+(n?"bg-gray-200 text-gray-700":"bg-gray-100 text-gray-600"),children:n?"Hide Details":"Show Details"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(re.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(y,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"FINAL WACC"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-800",children:i(x.finalWACC)}),s.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Risk-adjusted average"})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(t,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"COST OF EQUITY"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:i(x.costOfEquityCAPM)}),s.jsx("div",{className:"text-sm text-green-600 mt-1",children:"CAPM method"})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(f,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"COST OF DEBT"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-800",children:i(x.costOfDebtAfterTax)}),s.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"After-tax"})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(v,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"DEBT/EQUITY"})]}),s.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[x.debtToEquityRatio.toFixed(2),"x"]}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Capital structure"})]})]}),s.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:h.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>d(e.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(o===e.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[s.jsx(t,{size:16}),e.label]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["inputs"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"WACC Input Parameters"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"Cost of Equity (CAPM Method)"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Risk-Free Rate (%)"}),s.jsx("input",{type:"number",step:"0.1",value:a.dcf.wacc?.riskFreeRate||m.riskFreeRate,onChange:e=>u("riskFreeRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"10-year Treasury rate"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Risk Premium (%)"}),s.jsx("input",{type:"number",step:"0.1",value:a.dcf.wacc?.marketRiskPremium||m.marketRiskPremium,onChange:e=>u("marketRiskPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Expected market return - risk-free rate"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Beta (β)"}),s.jsx("input",{type:"number",step:"0.1",value:a.dcf.wacc?.beta||m.beta,onChange:e=>u("beta",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Systematic risk relative to market"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Small Company Premium (%)"}),s.jsx("input",{type:"number",step:"0.1",value:a.dcf.wacc?.smallCompanyPremium||m.smallCompanyPremium,onChange:e=>u("smallCompanyPremium",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Size-related risk premium"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company-Specific Risk (%)"}),s.jsx("input",{type:"number",step:"0.1",value:a.dcf.wacc?.companySpecificRisk||m.companySpecificRisk,onChange:e=>u("companySpecificRisk",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Unsystematic risk premium"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4 text-purple-800",children:"Capital Structure & Cost of Debt"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Equity ($000s)"}),s.jsx("input",{type:"number",value:a.dcf.wacc?.marketValueEquity||m.marketValueEquity,onChange:e=>u("marketValueEquity",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Value of Debt ($000s)"}),s.jsx("input",{type:"number",value:a.dcf.wacc?.marketValueDebt||m.marketValueDebt,onChange:e=>u("marketValueDebt",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre-Tax Cost of Debt (%)"}),s.jsx("input",{type:"number",step:"0.1",value:a.dcf.wacc?.debtInterestRate||m.debtInterestRate,onChange:e=>u("debtInterestRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Interest rate on debt"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),s.jsx("input",{type:"number",step:"0.1",value:a.dcf.wacc?.taxRate||a.dcf.taxRate,onChange:e=>u("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Corporate tax rate"})]}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-2",children:"Capital Structure"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Equity Weight:"}),s.jsx("span",{className:"font-medium",children:i(x.equityWeight)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Debt Weight:"}),s.jsx("span",{className:"font-medium",children:i(x.debtWeight)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2",children:[s.jsx("span",{children:"Total Capital:"}),s.jsxs("span",{className:"font-medium",children:["$",(x.totalCapital/1e3).toFixed(0),"M"]})]})]})]})]})]})]})]}),"calculation"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"WACC Calculation Breakdown"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("h5",{className:"font-medium mb-4 text-blue-800",children:"CAPM Method"}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Risk-Free Rate:"}),s.jsx("span",{className:"font-medium",children:i(a.dcf.wacc?.riskFreeRate||m.riskFreeRate)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta × Market Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i((a.dcf.wacc?.beta||m.beta)*(a.dcf.wacc?.marketRiskPremium||m.marketRiskPremium))})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Small Company Premium:"}),s.jsx("span",{className:"font-medium",children:i(a.dcf.wacc?.smallCompanyPremium||m.smallCompanyPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Company-Specific Risk:"}),s.jsx("span",{className:"font-medium",children:i(a.dcf.wacc?.companySpecificRisk||m.companySpecificRisk)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[s.jsx("span",{children:"Cost of Equity (CAPM):"}),s.jsx("span",{children:i(x.costOfEquityCAPM)})]})]})]}),s.jsxs("div",{className:"p-6 bg-green-50 rounded-lg border border-green-200",children:[s.jsx("h5",{className:"font-medium mb-4 text-green-800",children:"Build-up Method"}),s.jsxs("div",{className:"space-y-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Risk-Free Rate:"}),s.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.riskFreeRate)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Equity Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.equityRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Size Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.sizeRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Industry Risk Premium:"}),s.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.industryRiskPremium)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Company-Specific Risk:"}),s.jsx("span",{className:"font-medium",children:i(m.buildUpMethod.companySpecificRisk)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",children:[s.jsx("span",{children:"Cost of Equity (Build-up):"}),s.jsx("span",{children:i(x.costOfEquityBuildUp)})]})]})]})]}),s.jsxs("div",{className:"p-6 bg-gray-50 rounded-lg border",children:[s.jsx("h5",{className:"font-medium mb-4",children:"Final WACC Calculation"}),s.jsxs("div",{className:"space-y-4 text-sm",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"WACC (CAPM Method):"}),s.jsx("span",{className:"font-medium",children:i(x.waccCAPM)})]}),s.jsxs("div",{className:"text-xs text-gray-600",children:["[",i(x.costOfEquityCAPM)," × ",i(x.equityWeight),"] + [",i(x.costOfDebtAfterTax)," × ",i(x.debtWeight),"]"]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{children:"WACC (Build-up Method):"}),s.jsx("span",{className:"font-medium",children:i(x.waccBuildUp)})]}),s.jsxs("div",{className:"text-xs text-gray-600",children:["[",i(x.costOfEquityBuildUp)," × ",i(x.equityWeight),"] + [",i(x.costOfDebtAfterTax)," × ",i(x.debtWeight),"]"]})]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-lg font-semibold",children:"Risk-Adjusted WACC:"}),s.jsx("span",{className:"text-2xl font-bold text-blue-600",children:i(x.finalWACC)})]}),s.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Average of CAPM and Build-up methods"})]})]})]})]}),"benchmarks"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Industry Benchmarks & Validation"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Your Company"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC:"}),s.jsx("span",{className:"font-semibold",children:i(x.finalWACC)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta:"}),s.jsx("span",{className:"font-semibold",children:(a.dcf.wacc?.beta||m.beta).toFixed(2)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"D/E Ratio:"}),s.jsxs("span",{className:"font-semibold",children:[x.debtToEquityRatio.toFixed(2),"x"]})]})]})]}),s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-green-800 mb-2",children:"Industry Average"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC:"}),s.jsx("span",{className:"font-semibold",children:i(m.industryWACC)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta:"}),s.jsx("span",{className:"font-semibold",children:m.industryBeta.toFixed(2)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"D/E Ratio:"}),s.jsxs("span",{className:"font-semibold",children:[m.industryDebtEquityRatio.toFixed(2),"x"]})]})]})]}),s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-2",children:"Variance"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"WACC Diff:"}),s.jsxs("span",{className:"font-semibold "+(x.finalWACC>m.industryWACC?"text-red-600":"text-green-600"),children:[x.finalWACC>m.industryWACC?"+":"",i(x.finalWACC-m.industryWACC)]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Beta Diff:"}),s.jsxs("span",{className:"font-semibold "+((a.dcf.wacc?.beta||m.beta)>m.industryBeta?"text-red-600":"text-green-600"),children:[(a.dcf.wacc?.beta||m.beta)>m.industryBeta?"+":"",((a.dcf.wacc?.beta||m.beta)-m.industryBeta).toFixed(2)]})]})]})]})]}),s.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(N,{size:16,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium text-blue-800 mb-2",children:"Validation Guidelines"}),s.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[s.jsx("li",{children:"• WACC should be within ±2% of industry average for similar companies"}),s.jsx("li",{children:"• Beta should reflect business risk relative to market (typically 0.8-1.5 for most companies)"}),s.jsx("li",{children:"• Cost of equity should exceed risk-free rate by at least 4-6% for private companies"}),s.jsx("li",{children:"• Debt/equity ratio should align with industry norms and company strategy"}),s.jsx("li",{children:"• Consider economic conditions and company-specific factors"})]})]})]})})]})]})]})},Pe=({data:a,modelInputs:r,onModelInputChange:i,formatCurrency:n,formatPercent:c})=>{const[o,m]=e.useState(!1),[x,u]=e.useState(!0),[h,g]=e.useState("results"),b=e.useMemo(()=>{const{discountRate:e,terminalGrowthRate:s,projectionYears:t,taxRate:l}=r.dcf,i=a.statements,n=r.dcf.workingCapital||{receivablesDays:45,inventoryDays:60,payablesDays:30},c=r.dcf.capex||{capexAsPercentOfRevenue:3.5,depreciationRate:7},o={years:[],freeCashFlows:[],presentValues:[],workingCapitalChanges:[],capexAmounts:[],unleveredFreeCashFlow:[],cumulativePV:0,terminalValue:0,presentValueTerminal:0,enterpriseValue:0,equityValue:0,impliedShare:0},d=i.incomeStatement.totalRevenue?.[0]||1e5;for(let a=1;a<=t;a++){const s={year:a,revenue:i.incomeStatement.totalRevenue?.[a]||0,operatingIncome:i.incomeStatement.operatingIncome?.[a]||0,nopat:0,workingCapitalChange:0,capex:0,depreciation:0,freeCashFlow:0,presentValue:0};s.nopat=s.operatingIncome*(1-l/100);const t=s.revenue,r=a>1?i.incomeStatement.totalRevenue?.[a-1]||0:d,m=t*n.receivablesDays/365,x=t*n.inventoryDays/365,u=t*n.payablesDays/365,h=m-r*n.receivablesDays/365,p=x-r*n.inventoryDays/365,g=u-r*n.payablesDays/365;s.workingCapitalChange=-(h+p-g),s.capex=-t*c.capexAsPercentOfRevenue/100,s.depreciation=Math.abs(s.capex)/c.depreciationRate,s.freeCashFlow=s.nopat+s.depreciation+s.capex+s.workingCapitalChange;const b=Math.pow(1+e/100,a);s.presentValue=s.freeCashFlow/b,o.years.push(s),o.freeCashFlows.push(s.freeCashFlow),o.presentValues.push(s.presentValue),o.workingCapitalChanges.push(s.workingCapitalChange),o.capexAmounts.push(s.capex),o.unleveredFreeCashFlow.push(s.freeCashFlow),o.cumulativePV+=s.presentValue}const m=(o.years[o.years.length-1]?.freeCashFlow||0)*(1+s/100);o.terminalValue=m/((e-s)/100);const x=Math.pow(1+e/100,t);o.presentValueTerminal=o.terminalValue/x,o.enterpriseValue=o.cumulativePV+o.presentValueTerminal;o.equityValue=o.enterpriseValue-0;const u=r.dcf.sharesOutstanding||1e3;return o.impliedShare=o.equityValue/u,o},[a,r]),j=(e,s,t)=>{const a={...r.dcf,[e]:{...r.dcf[e],[s]:parseFloat(t)||0}};i("dcf",e,a[e])},y=(e,s)=>{i("dcf",e,parseFloat(s)||0)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(l,{size:20}),"Advanced DCF Valuation"]}),s.jsx("p",{className:"text-gray-600",children:"Professional-grade DCF with working capital analysis, capex modeling, and detailed cash flow projections."})]}),s.jsx("div",{className:"flex gap-2",children:["results","charts","wacc","assumptions"].map(e=>s.jsxs("button",{onClick:()=>g(e),className:"px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 "+(h===e?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:["results"===e&&s.jsx(f,{size:14}),"charts"===e&&s.jsx(d,{size:14}),"wacc"===e&&s.jsx(l,{size:14}),"assumptions"===e&&s.jsx(p,{size:14}),e.charAt(0).toUpperCase()+e.slice(1)]},e))})]}),"results"===h&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(re.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(f,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"ENTERPRISE VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:n(b.enterpriseValue)}),s.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["PV Operations: ",n(b.cumulativePV)]})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(t,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EQUITY VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-800",children:n(b.equityValue)}),s.jsxs("div",{className:"text-sm text-blue-600 mt-1",children:["Per Share: ",n(b.impliedShare)]})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(d,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"TERMINAL VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-800",children:n(b.terminalValue)}),s.jsxs("div",{className:"text-sm text-purple-600 mt-1",children:["PV: ",n(b.presentValueTerminal)]})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(v,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"IMPLIED MULTIPLE"})]}),s.jsxs("div",{className:"text-2xl font-bold text-orange-800",children:[(b.enterpriseValue/(a.statements.incomeStatement.totalRevenue?.[1]||1)).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"EV/Revenue (Year 1)"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Detailed Cash Flow Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b bg-gray-50",children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Year"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Operating Income"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"NOPAT"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Depreciation"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Capex"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"ΔWorking Capital"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Free Cash Flow"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Present Value"})]})}),s.jsxs("tbody",{children:[b.years.map((e,t)=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3 font-medium",children:e.year}),s.jsx("td",{className:"p-3 text-right",children:n(e.revenue)}),s.jsx("td",{className:"p-3 text-right",children:n(e.operatingIncome)}),s.jsx("td",{className:"p-3 text-right",children:n(e.nopat)}),s.jsxs("td",{className:"p-3 text-right text-green-600",children:["+",n(e.depreciation)]}),s.jsx("td",{className:"p-3 text-right text-red-600",children:n(e.capex)}),s.jsxs("td",{className:"p-3 text-right "+(e.workingCapitalChange>=0?"text-green-600":"text-red-600"),children:[e.workingCapitalChange>=0?"+":"",n(e.workingCapitalChange)]}),s.jsx("td",{className:"p-3 text-right font-medium",children:n(e.freeCashFlow)}),s.jsx("td",{className:"p-3 text-right font-medium",children:n(e.presentValue)})]},t)),s.jsxs("tr",{className:"border-b-2 border-gray-300 bg-blue-50",children:[s.jsx("td",{className:"p-3 font-bold",children:"Terminal"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right font-bold",children:n(b.terminalValue)}),s.jsx("td",{className:"p-3 text-right font-bold",children:n(b.presentValueTerminal)})]}),s.jsxs("tr",{className:"bg-gray-100 font-bold",children:[s.jsx("td",{className:"p-3",children:"TOTAL"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3 text-right text-lg",children:n(b.enterpriseValue)})]})]})]})})]})]}),"charts"===h&&s.jsx(Ae,{dcfData:b,sensitivityData:null,scenarioData:null,formatCurrency:n,formatPercent:c}),"wacc"===h&&s.jsx(Ee,{modelInputs:r,onModelInputChange:i,formatPercent:c}),"assumptions"===h&&s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Model Assumptions"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Core Assumptions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Discount Rate (WACC) %"}),s.jsx("input",{type:"number",step:"0.1",value:r.dcf.discountRate,onChange:e=>y("discountRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terminal Growth Rate %"}),s.jsx("input",{type:"number",step:"0.1",value:r.dcf.terminalGrowthRate,onChange:e=>y("terminalGrowthRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate %"}),s.jsx("input",{type:"number",step:"0.1",value:r.dcf.taxRate,onChange:e=>y("taxRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Working Capital"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Receivables (Days)"}),s.jsx("input",{type:"number",value:r.dcf.workingCapital?.receivablesDays||45,onChange:e=>j("workingCapital","receivablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Inventory (Days)"}),s.jsx("input",{type:"number",value:r.dcf.workingCapital?.inventoryDays||60,onChange:e=>j("workingCapital","inventoryDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payables (Days)"}),s.jsx("input",{type:"number",value:r.dcf.workingCapital?.payablesDays||30,onChange:e=>j("workingCapital","payablesDays",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-3 text-gray-800",children:"Capital Expenditure"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capex (% of Revenue)"}),s.jsx("input",{type:"number",step:"0.1",value:r.dcf.capex?.capexAsPercentOfRevenue||3.5,onChange:e=>j("capex","capexAsPercentOfRevenue",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Depreciation Period (Years)"}),s.jsx("input",{type:"number",value:r.dcf.capex?.depreciationRate||7,onChange:e=>j("capex","depreciationRate",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shares Outstanding (000s)"}),s.jsx("input",{type:"number",value:r.dcf.sharesOutstanding||1e3,onChange:e=>y("sharesOutstanding",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]})]})]})},Oe=({data:r,formatCurrency:l,formatPercent:i})=>{const[n,c]=e.useState("multiples"),[o,m]=e.useState("ev_revenue"),[x,u]=e.useState(!1),[h,p]=e.useState([{id:1,name:"MedSpa Corp",ticker:"MSPA",marketCap:45e4,enterpriseValue:52e4,revenue:18e4,ebitda:45e3,netIncome:28e3,employees:1200,founded:2015,geography:"US",businessModel:"B2C Medical Spa Chain"},{id:2,name:"Wellness Holdings",ticker:"WELL",marketCap:68e4,enterpriseValue:75e4,revenue:22e4,ebitda:55e3,netIncome:35e3,employees:1800,founded:2012,geography:"US",businessModel:"Integrated Wellness Platform"},{id:3,name:"Aesthetic Solutions Inc",ticker:"AEST",marketCap:32e4,enterpriseValue:38e4,revenue:125e3,ebitda:32e3,netIncome:18e3,employees:850,founded:2018,geography:"US",businessModel:"Medical Device & Services"},{id:4,name:"Premium Health Group",ticker:"PHG",marketCap:92e4,enterpriseValue:105e4,revenue:31e4,ebitda:78e3,netIncome:48e3,employees:2500,founded:2010,geography:"US",businessModel:"Premium Healthcare Services"}]),g=e.useMemo(()=>h.map(e=>({...e,multiples:{ev_revenue:e.enterpriseValue/e.revenue,ev_ebitda:e.enterpriseValue/e.ebitda,pe_ratio:e.marketCap/e.netIncome,revenue_per_employee:e.revenue/e.employees,market_cap_revenue:e.marketCap/e.revenue}})),[h]),b=e.useMemo(()=>{const e=g.map(e=>e.multiples),s=e=>({mean:e.reduce((e,s)=>e+s,0)/e.length,median:e.sort((e,s)=>e-s)[Math.floor(e.length/2)],min:Math.min(...e),max:Math.max(...e),p25:e.sort((e,s)=>e-s)[Math.floor(.25*e.length)],p75:e.sort((e,s)=>e-s)[Math.floor(.75*e.length)]});return{ev_revenue:s(e.map(e=>e.ev_revenue)),ev_ebitda:s(e.map(e=>e.ev_ebitda)),pe_ratio:s(e.map(e=>e.pe_ratio)),revenue_per_employee:s(e.map(e=>e.revenue_per_employee)),market_cap_revenue:s(e.map(e=>e.market_cap_revenue))}},[g]),j=e.useMemo(()=>{const e=r.statements.incomeStatement.totalRevenue?.[1]||1e5,s=1.15*(r.statements.incomeStatement.operatingIncome?.[1]||5e4),t=.7*(r.statements.incomeStatement.operatingIncome?.[1]||5e4);return{ev_revenue:{mean:e*b.ev_revenue.mean,median:e*b.ev_revenue.median,p25:e*b.ev_revenue.p25,p75:e*b.ev_revenue.p75},ev_ebitda:{mean:s*b.ev_ebitda.mean,median:s*b.ev_ebitda.median,p25:s*b.ev_ebitda.p25,p75:s*b.ev_ebitda.p75},pe_ratio:{mean:t*b.pe_ratio.mean,median:t*b.pe_ratio.median,p25:t*b.pe_ratio.p25,p75:t*b.pe_ratio.p75}}},[r,b]),y={ev_revenue:{name:"EV/Revenue",description:"Enterprise Value / Annual Revenue"},ev_ebitda:{name:"EV/EBITDA",description:"Enterprise Value / EBITDA"},pe_ratio:{name:"P/E Ratio",description:"Market Cap / Net Income"},revenue_per_employee:{name:"Revenue/Employee",description:"Revenue per Employee"},market_cap_revenue:{name:"Market Cap/Revenue",description:"Market Cap / Revenue"}},v=[{id:"multiples",label:"Trading Multiples",icon:d},{id:"analysis",label:"Valuation Analysis",icon:C},{id:"companies",label:"Comparable Set",icon:w}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-semibold mb-2 flex items-center gap-2",children:[s.jsx(w,{size:20}),"Comparable Company Analysis"]}),s.jsx("p",{className:"text-gray-600",children:"Market-based valuation using trading multiples from similar public companies."})]}),s.jsx("div",{className:"flex gap-2",children:s.jsxs("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 text-sm",children:[s.jsx(a,{size:16}),"Add Comparable"]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(re.div,{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(d,{size:20,className:"text-blue-600"}),s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"EV/REVENUE"})]}),s.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[b.ev_revenue.median.toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-blue-600 mt-1",children:"Median multiple"})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4 border border-green-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(t,{size:20,className:"text-green-600"}),s.jsx("span",{className:"text-xs text-green-600 font-medium",children:"IMPLIED VALUE"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-800",children:l(j.ev_revenue.median)}),s.jsx("div",{className:"text-sm text-green-600 mt-1",children:"EV/Revenue basis"})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(f,{size:20,className:"text-purple-600"}),s.jsx("span",{className:"text-xs text-purple-600 font-medium",children:"VALUATION RANGE"})]}),s.jsxs("div",{className:"text-lg font-bold text-purple-800",children:[l(j.ev_revenue.p25)," - ",l(j.ev_revenue.p75)]}),s.jsx("div",{className:"text-sm text-purple-600 mt-1",children:"25th - 75th percentile"})]}),s.jsxs(re.div,{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(w,{size:20,className:"text-orange-600"}),s.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"PEER COUNT"})]}),s.jsx("div",{className:"text-2xl font-bold text-orange-800",children:h.length}),s.jsx("div",{className:"text-sm text-orange-600 mt-1",children:"Comparable companies"})]})]}),s.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:v.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>c(e.id),className:"flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-md transition-all "+(n===e.id?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[s.jsx(t,{size:16}),e.label]},e.id)})}),s.jsxs("div",{className:"bg-white rounded-lg border p-6",children:["multiples"===n&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Trading Multiples Analysis"}),s.jsx("select",{value:o,onChange:e=>m(e.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(y).map(([e,t])=>s.jsx("option",{value:e,children:t.name},e))})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b bg-gray-50",children:[s.jsx("th",{className:"text-left p-3 font-medium",children:"Company"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Market Cap"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Enterprise Value"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"EV/Revenue"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"EV/EBITDA"}),s.jsx("th",{className:"text-right p-3 font-medium",children:"P/E Ratio"})]})}),s.jsxs("tbody",{children:[g.map((e,t)=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3",children:s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.name}),s.jsx("div",{className:"text-xs text-gray-500",children:e.ticker})]})}),s.jsx("td",{className:"p-3 text-right",children:l(e.marketCap)}),s.jsx("td",{className:"p-3 text-right",children:l(e.enterpriseValue)}),s.jsx("td",{className:"p-3 text-right",children:l(e.revenue)}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.ev_revenue.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.ev_ebitda.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right font-medium",children:[e.multiples.pe_ratio.toFixed(1),"x"]})]},e.id)),s.jsxs("tr",{className:"border-t-2 border-gray-300 bg-blue-50 font-semibold",children:[s.jsx("td",{className:"p-3",children:"Market Statistics"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsx("td",{className:"p-3"}),s.jsxs("td",{className:"p-3 text-right",children:[b.ev_revenue.median.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right",children:[b.ev_ebitda.median.toFixed(1),"x"]}),s.jsxs("td",{className:"p-3 text-right",children:[b.pe_ratio.median.toFixed(1),"x"]})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-3",children:"Multiple Distribution"}),s.jsx("div",{className:"space-y-3",children:Object.entries(b).slice(0,3).map(([e,t])=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[s.jsx("span",{children:y[e].name}),s.jsxs("span",{className:"font-medium",children:[t.median.toFixed(1),"x"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:(t.median-t.min)/(t.max-t.min)*100+"%"}})}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[s.jsxs("span",{children:[t.min.toFixed(1),"x"]}),s.jsxs("span",{children:[t.max.toFixed(1),"x"]})]})]},e))})]}),s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h6",{className:"font-medium mb-3",children:"Key Statistics"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Companies Analyzed:"}),s.jsx("span",{className:"font-medium",children:h.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median Market Cap:"}),s.jsx("span",{className:"font-medium",children:l(h.sort((e,s)=>e.marketCap-s.marketCap)[Math.floor(h.length/2)]?.marketCap||0)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median Revenue:"}),s.jsx("span",{className:"font-medium",children:l(h.sort((e,s)=>e.revenue-s.revenue)[Math.floor(h.length/2)]?.revenue||0)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Avg Founded Year:"}),s.jsx("span",{className:"font-medium",children:Math.round(h.reduce((e,s)=>e+s.founded,0)/h.length)})]})]})]})]})]}),"analysis"===n&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Valuation Analysis"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Implied Valuation by Multiple"}),s.jsx("div",{className:"space-y-4",children:Object.entries(j).map(([e,t])=>s.jsxs("div",{className:"p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"font-medium",children:y[e].name}),s.jsxs("span",{className:"text-sm text-gray-500",children:[b[e].median.toFixed(1),"x median"]})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"25th Percentile:"}),s.jsx("span",{className:"font-medium",children:l(t.p25)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Median:"}),s.jsx("span",{className:"font-bold text-blue-600",children:l(t.median)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"75th Percentile:"}),s.jsx("span",{className:"font-medium",children:l(t.p75)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Mean:"}),s.jsx("span",{className:"font-medium",children:l(t.mean)})]})]})]},e))})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-4",children:"Valuation Summary"}),s.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Recommended Range"}),s.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[l((j.ev_revenue.p25+j.ev_ebitda.p25)/2)," -",l((j.ev_revenue.p75+j.ev_ebitda.p75)/2)]}),s.jsx("div",{className:"text-sm text-blue-600",children:"Blended 25th-75th percentile"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-blue-600 font-medium mb-1",children:"Midpoint Valuation"}),s.jsx("div",{className:"text-xl font-bold text-blue-800",children:l((j.ev_revenue.median+j.ev_ebitda.median)/2)}),s.jsx("div",{className:"text-sm text-blue-600",children:"Average of median multiples"})]})]})}),s.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(C,{size:16,className:"text-yellow-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h6",{className:"font-medium text-yellow-800 mb-1",children:"Valuation Considerations"}),s.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[s.jsx("li",{children:"• Consider company-specific growth and margin profiles"}),s.jsx("li",{children:"• Adjust for differences in business model and scale"}),s.jsx("li",{children:"• Factor in market conditions and sector trends"}),s.jsx("li",{children:"• Apply appropriate discount for private company liquidity"})]})]})]})})]})]})]}),"companies"===n&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h4",{className:"font-semibold text-lg",children:"Comparable Company Set"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx(k,{size:16,className:"absolute left-3 top-3 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search companies...",className:"pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("button",{className:"px-3 py-2 border rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[s.jsx(M,{size:16}),"Filter"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:h.map(e=>s.jsxs(re.div,{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",whileHover:{y:-2},children:[s.jsxs("div",{className:"flex justify-between items-start mb-3",children:[s.jsxs("div",{children:[s.jsx("h6",{className:"font-semibold text-gray-800",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[e.ticker," • ",e.geography]})]}),s.jsx("button",{onClick:()=>{return s=e.id,void p(h.filter(e=>e.id!==s));var s},className:"text-red-500 hover:bg-red-50 p-1 rounded",children:"×"})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Market Cap:"}),s.jsx("span",{className:"font-medium",children:l(e.marketCap)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Revenue:"}),s.jsx("span",{className:"font-medium",children:l(e.revenue)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"EV/Revenue:"}),s.jsxs("span",{className:"font-medium",children:[(e.enterpriseValue/e.revenue).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Founded:"}),s.jsx("span",{className:"font-medium",children:e.founded})]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t",children:s.jsx("div",{className:"text-xs text-gray-600",children:e.businessModel})})]},e.id))})]})]}),x&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[s.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Add Comparable Company"}),s.jsxs("form",{onSubmit:e=>{e.preventDefault();const s=new FormData(e.target);(e=>{const s={id:Date.now(),...e,marketCap:parseFloat(e.marketCap)||0,enterpriseValue:parseFloat(e.enterpriseValue)||0,revenue:parseFloat(e.revenue)||0,ebitda:parseFloat(e.ebitda)||0,netIncome:parseFloat(e.netIncome)||0,employees:parseInt(e.employees)||0,founded:parseInt(e.founded)||(new Date).getFullYear()};p([...h,s]),u(!1)})(Object.fromEntries(s))},children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),s.jsx("input",{name:"name",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ticker"}),s.jsx("input",{name:"ticker",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Market Cap ($000s)"}),s.jsx("input",{name:"marketCap",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enterprise Value ($000s)"}),s.jsx("input",{name:"enterpriseValue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue ($000s)"}),s.jsx("input",{name:"revenue",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA ($000s)"}),s.jsx("input",{name:"ebitda",type:"number",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Model"}),s.jsx("input",{name:"businessModel",type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add Company"}),s.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]})})]})},Ve=({data:a,onDataChange:l})=>{const[i,n]=e.useState("setup"),[c,o]=e.useState(null),[m,x]=e.useState(!1),[u,h]=e.useState(0),[g,b]=e.useState({iterations:1e4,confidenceLevel:.95,randomSeed:null,enableCorrelation:!1}),[j,y]=e.useState({revenueGrowthRate:{type:"normal",parameters:{mean:.1,stdDev:.03},name:"Revenue Growth Rate",enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.12,mode:.15,max:.18},name:"FCF Margin",enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},name:"WACC",enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},name:"Terminal Growth Rate",enabled:!0}}),[f,v]=e.useState([[1,.3,-.2,.1],[.3,1,-.4,.2],[-.2,-.4,1,-.3],[.1,.2,-.3,1]]),N=[{value:"normal",label:"Normal",parameters:["mean","stdDev"]},{value:"triangular",label:"Triangular",parameters:["min","mode","max"]},{value:"uniform",label:"Uniform",parameters:["min","max"]},{value:"lognormal",label:"Log-Normal",parameters:["mu","sigma"]},{value:"beta",label:"Beta",parameters:["alpha","beta"]}],w=e.useCallback(async()=>{try{x(!0),h(0);const e=Object.fromEntries(Object.entries(j).filter(([e,s])=>s.enabled));if(0===Object.keys(e).length)throw new Error("No distributions are enabled. Please enable at least one variable distribution to run the simulation.");const s={iterations:g.iterations,confidenceLevel:g.confidenceLevel,randomSeed:g.randomSeed,correlationMatrix:g.enableCorrelation?f:null,onProgress:h},t=a?.statements?.incomeStatement,r=a?.periods?.length-1||2,l={currentRevenue:1e3*(t?.totalRevenue?.[r]||1e6),currentPrice:100,sharesOutstanding:1e6,currentOperatingIncome:1e3*(t?.operatingIncome?.[r]||15e4),...Object.fromEntries(Object.entries(e).map(([e,s])=>[e,s.parameters.mean||s.parameters.mode||(s.parameters.min+s.parameters.max)/2]))},i=await Se.runDCFSimulation(l,e,s);o(i)}catch(e){alert(`Monte Carlo simulation failed: ${e.message}`)}finally{x(!1),h(0)}},[j,g,f,a]),C=e.useCallback(()=>{Se.stopSimulation(),x(!1)},[]),k=e.useCallback((e,s)=>{y(t=>({...t,[e]:{...t[e],...s}}))},[]),M=e.useCallback((e,s,t)=>{v(a=>{const r=a.map(e=>[...e]);return r[e][s]=t,r[s][e]=t,r})},[]),A=e.useMemo(()=>{if(!c?.results)return[];const e=c.results.map(e=>e.pricePerShare),s=Math.min(...e),t=(Math.max(...e)-s)/50,a=Array(50).fill(0).map((e,a)=>({bin:s+a*t,count:0,frequency:0}));return e.forEach(e=>{const r=Math.min(Math.floor((e-s)/t),49);a[r].count++}),a.forEach(s=>{s.frequency=s.count/e.length}),a},[c]),E=e.useMemo(()=>c?.results?c.results.slice(0,1e3).map((e,s)=>({x:100*e.inputs.revenueGrowthRate,y:e.pricePerShare,upside:e.upside})):[],[c]),P=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),O=[{id:"setup",label:"Setup",icon:p},{id:"run",label:"Run Simulation",icon:S},{id:"results",label:"Results",icon:d},{id:"analysis",label:"Analysis",icon:t}];return s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsx("div",{className:"mb-6",children:s.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[s.jsxs("h2",{className:"text-2xl font-bold text-white mb-2 flex items-center",children:[s.jsx(R,{className:"inline-block mr-2"}),"Monte Carlo Simulation"]}),s.jsx("p",{className:"text-gray-400 text-sm",children:"Advanced risk analysis using probabilistic modeling • Generate thousands of scenarios • Measure uncertainty"})]})}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"flex space-x-2",children:O.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>n(e.id),className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 "+(i===e.id?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[s.jsx(t,{size:16}),e.label]},e.id)})})}),s.jsx("div",{className:"mt-6",children:s.jsxs(le,{mode:"wait",children:["setup"===i&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🎛️ Simulation Settings"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Iterations"}),s.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:g.iterations,onChange:e=>b(s=>({...s,iterations:parseInt(e.target.value)})),min:"1000",max:"100000",step:"1000"}),s.jsx("small",{className:"text-gray-400",children:"Leave empty for random"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Confidence Level"}),s.jsxs("select",{className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:g.confidenceLevel,onChange:e=>b(s=>({...s,confidenceLevel:parseFloat(e.target.value)})),children:[s.jsx("option",{value:.9,children:"90%"}),s.jsx("option",{value:.95,children:"95%"}),s.jsx("option",{value:.99,children:"99%"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Random Seed (Optional)"}),s.jsx("input",{type:"number",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:g.randomSeed||"",onChange:e=>b(s=>({...s,randomSeed:e.target.value?parseInt(e.target.value):null})),placeholder:"Leave empty for random"})]}),s.jsx("div",{className:"space-y-2",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 rounded focus:ring-blue-500",checked:g.enableCorrelation,onChange:e=>b(s=>({...s,enableCorrelation:e.target.checked}))}),s.jsx("span",{children:"Enable Variable Correlation"})]})})]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Variable Distributions"}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:Object.entries(j).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded-lg p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("label",{className:"flex items-center space-x-2 text-gray-200",children:[s.jsx("input",{type:"checkbox",checked:t.enabled,onChange:s=>k(e,{enabled:s.target.checked})}),s.jsx("span",{className:"font-medium",children:t.name})]})}),t.enabled&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-200",children:"Distribution Type"}),s.jsx("select",{className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",value:t.type,onChange:s=>{const t=s.target.value;N.find(e=>e.value===t);const a={};"normal"===t?(a.mean=.1,a.stdDev=.02):"triangular"===t?(a.min=.05,a.mode=.1,a.max=.15):"uniform"===t&&(a.min=.05,a.max=.15),k(e,{type:t,parameters:a})},children:N.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:N.find(e=>e.value===t.type)?.parameters.map(a=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-300",children:a.charAt(0).toUpperCase()+a.slice(1)}),s.jsx("input",{className:"w-full px-2 py-1 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",type:"number",value:t.parameters[a]||"",onChange:s=>k(e,{parameters:{...t.parameters,[a]:parseFloat(s.target.value)}}),step:"0.001"})]},a))})]})]},e))})]}),g.enableCorrelation&&s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"🔗 Correlation Matrix"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{}),Object.keys(j).map(e=>s.jsx("th",{children:j[e].name},e))]})}),s.jsx("tbody",{children:Object.keys(j).map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{className:"font-medium text-gray-200 p-2 border border-gray-600",children:j[e].name}),Object.keys(j).map((e,a)=>s.jsx("td",{className:"p-2 border border-gray-600",children:s.jsx("input",{type:"number",value:f[t][a],onChange:e=>M(t,a,parseFloat(e.target.value)),min:"-1",max:"1",step:"0.1",disabled:t===a,className:"w-full px-2 py-1 bg-gray-800 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-700 disabled:text-gray-400"})},a))]},e))})]})})]})]})},"setup"),"run"===i&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{children:"🚀 Simulation Control"}),s.jsx("div",{className:"flex items-center space-x-2",children:m?s.jsxs("button",{onClick:C,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(F,{size:16}),s.jsx("span",{children:"Stop Simulation"})]}):s.jsxs("button",{onClick:w,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",disabled:Object.values(j).every(e=>!e.enabled),children:[s.jsx(S,{size:16}),s.jsx("span",{children:"Run Simulation"})]})})]}),m&&s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})}),s.jsxs("div",{className:"text-sm text-gray-400 text-center",children:[u.toFixed(1),"% Complete (",Math.floor(u*g.iterations/100)," / ",g.iterations," iterations)"]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 mt-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📋 Simulation Preview"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Iterations"}),s.jsx("div",{className:"text-xl font-bold text-white",children:g.iterations.toLocaleString()})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Variables"}),s.jsx("div",{className:"text-xl font-bold text-white",children:Object.values(j).filter(e=>e.enabled).length})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Confidence Level"}),s.jsxs("div",{className:"text-xl font-bold text-white",children:[(100*g.confidenceLevel).toFixed(0),"%"]})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-3 text-center",children:[s.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Correlation"}),s.jsx("div",{className:"text-xl font-bold text-white",children:g.enableCorrelation?"Enabled":"Disabled"})]})]})]})]})},"run"),"results"===i&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:c?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-xl font-semibold text-white flex items-center",children:"📊 Simulation Results"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(D,{size:16}),"Export Results"]}),s.jsxs("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 transition-colors",children:[s.jsx(r,{size:16}),"Generate Report"]})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(c.analysis.statistics).map(([e,t])=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"💰 Price per Share":"enterpriseValue"===e?"🏢 Enterprise Value":"📈 Upside %"}),s.jsx("div",{className:"text-2xl font-bold text-green-400 mb-2",children:"upside"===e?`${t.mean.toFixed(1)}%`:P(t.mean)}),s.jsxs("div",{className:"space-y-1 text-sm text-gray-300",children:[s.jsxs("div",{children:["Median: ","upside"===e?`${t.median.toFixed(1)}%`:P(t.median)]}),s.jsxs("div",{children:["Std Dev: ","upside"===e?`${t.stdDev.toFixed(1)}%`:P(t.stdDev)]}),s.jsxs("div",{children:["Min: ","upside"===e?`${t.min.toFixed(1)}%`:P(t.min)]}),s.jsxs("div",{children:["Max: ","upside"===e?`${t.max.toFixed(1)}%`:P(t.max)]})]})]},e))}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"📊 Price Distribution"}),s.jsx(ie,{width:"100%",height:300,children:s.jsxs(ye,{data:A,children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"bin",tickFormatter:P}),s.jsx(de,{}),s.jsx(me,{formatter:(e,s)=>[`${(100*e).toFixed(2)}%`,"Frequency"],labelFormatter:e=>`Price: ${P(e)}`}),s.jsx(fe,{type:"monotone",dataKey:"frequency",stroke:"#3B82F6",fill:"#3B82F6",fillOpacity:.6})]})})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{children:"🎯 Sensitivity Scatter Plot"}),s.jsx(ie,{width:"100%",height:300,children:s.jsxs(ve,{data:E,children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"x",name:"Revenue Growth Rate",tickFormatter:e=>`${e.toFixed(1)}%`}),s.jsx(de,{dataKey:"y",name:"Price per Share",tickFormatter:P}),s.jsx(me,{formatter:(e,s)=>["Revenue Growth Rate"===s?`${e.toFixed(2)}%`:P(e),s]}),s.jsx(Ne,{name:"Scenarios",fill:"#10B981",children:E.map((e,t)=>s.jsx(pe,{fill:e.upside>0?"#10B981":"#EF4444"},`cell-${t}`))})]})})]})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(I,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Results Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see results here."})]})},"results"),"analysis"===i&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:c?.analysis?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"⚠️ Risk Metrics"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(c.analysis.riskMetrics).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"var95"===e?"Value at Risk (95%)":"cvar95"===e?"Conditional VaR (95%)":"probabilityOfLoss"===e?"Probability of Loss":"Sharpe Ratio"}),s.jsx("div",{className:"text-xl font-bold text-red-400 mb-1",children:"probabilityOfLoss"===e?`${(100*t).toFixed(1)}%`:P(t)}),s.jsx("div",{className:"text-xs text-gray-400",children:"Risk measure"})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:["📊 Confidence Intervals (",(100*c.analysis.confidenceIntervals.pricePerShare?.level).toFixed(0),"%)"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(c.analysis.confidenceIntervals).map(([e,t])=>s.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-600",children:[s.jsx("h4",{className:"text-lg font-semibold text-white mb-3",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Lower Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${t.lowerBound.toFixed(1)}%`:P(t.lowerBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Upper Bound:"}),s.jsx("span",{className:"font-medium text-white",children:"upside"===e?`${t.upperBound.toFixed(1)}%`:P(t.upperBound)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Width:"}),s.jsx("span",{className:"font-medium text-blue-400",children:"upside"===e?`${t.width.toFixed(1)}%`:P(t.width)})]})]})]},e))})]}),s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:"📊 Percentile Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-300",children:"Metric"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"5th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"25th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"50th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"75th %ile"}),s.jsx("th",{className:"text-right p-3 text-sm font-medium text-gray-300",children:"95th %ile"})]})}),s.jsx("tbody",{children:Object.entries(c.analysis.percentiles).map(([e,t])=>s.jsxs("tr",{className:"border-b border-gray-600",children:[s.jsx("td",{className:"p-3 text-sm text-white",children:"pricePerShare"===e?"Price per Share":"enterpriseValue"===e?"Enterprise Value":"Upside %"}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p5.toFixed(1)}%`:P(t.p5)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p25.toFixed(1)}%`:P(t.p25)}),s.jsx("td",{className:"p-3 text-sm text-right text-blue-400 font-medium",children:"upside"===e?`${t.p50.toFixed(1)}%`:P(t.p50)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p75.toFixed(1)}%`:P(t.p75)}),s.jsx("td",{className:"p-3 text-sm text-right text-gray-300",children:"upside"===e?`${t.p95.toFixed(1)}%`:P(t.p95)})]},e))})]})})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(I,{size:48,className:"text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Analysis Available"}),s.jsx("p",{className:"text-gray-400",children:"Run a simulation to see analysis here."})]})},"analysis")]})})]})},Te=({data:t,adjustedValues:a,onDataChange:r})=>{const[l,n]=e.useState("dcf"),[c,o]=e.useState({dcf:{discountRate:10,terminalGrowthRate:2.5,projectionYears:5,terminalValueMultiple:10,taxRate:25,sharesOutstanding:1e3,workingCapital:{receivablesDays:45,inventoryDays:60,payablesDays:30,receivablesGrowth:2,inventoryGrowth:1.5,payablesGrowth:1.8},capex:{capexAsPercentOfRevenue:3.5,depreciationRate:7,maintenanceCapex:2}},ratios:{compareToIndustry:!0,industryAverages:{grossMargin:45,operatingMargin:15,netMargin:8,currentRatio:2.1,debtToEquity:.5}},sensitivity:{variables:["revenue","grossMargin","discountRate"],ranges:{revenue:{min:-20,max:20},grossMargin:{min:-5,max:5},discountRate:{min:8,max:15}}},scenario:{scenarios:[{name:"Base Case",probability:50,revenueGrowth:15,marginImprovement:0},{name:"Bull Case",probability:25,revenueGrowth:25,marginImprovement:2},{name:"Bear Case",probability:25,revenueGrowth:5,marginImprovement:-2}]}}),m=e.useMemo(()=>{const e=t.statements.incomeStatement,s=t.periods,r={revenue:[],grossProfit:[],operatingIncome:[],margins:{gross:[],operating:[],net:[]},growth:{revenue:[],operating:[]}};return s.forEach((t,l)=>{const i=l===s.length-1,n=i&&a?.totalRevenue?a.totalRevenue:e.totalRevenue?.[l]||0,c=i&&a?.totalCostOfGoodsSold?a.totalCostOfGoodsSold:e.totalCostOfGoodsSold?.[l]||0,o=i&&a?.grossProfit?a.grossProfit:e.grossProfit?.[l]||n-c,d=i&&a?.operatingIncome?a.operatingIncome:e.operatingIncome?.[l]||0;if(r.revenue.push(n),r.grossProfit.push(o),r.operatingIncome.push(d),r.margins.gross.push(n?o/n*100:0),r.margins.operating.push(n?d/n*100:0),l>0){const s=e.totalRevenue?.[l-1]||0,t=e.operatingIncome?.[l-1]||0;r.growth.revenue.push(s?(n-s)/s*100:0),r.growth.operating.push(t?(d-t)/t*100:0)}}),r},[t]),x=(e=null)=>{const{discountRate:s,terminalGrowthRate:a,projectionYears:r,taxRate:l}=c.dcf,i=e||t;let n;if(e?(n=[],i.periods.forEach((e,s)=>{s>0&&s<=r&&n.push(i.statements.incomeStatement.operatingIncome?.[s]||0)})):n=m.operatingIncome.slice(1,r+1),0===n.length)return{enterpriseValue:0,equityValue:0,sharePrice:0};let o=0;const d=1+s/100;n.forEach((e,s)=>{const t=e*(1-l/100)/Math.pow(d,s+1);o+=t});const x=(n[n.length-1]||0)*(1+a/100)*(1-l/100)/((s-a)/100),u=x/Math.pow(d,r),h=o+u;return{enterpriseValue:h,equityValue:h,presentValueOperations:o,presentValueTerminal:u,terminalValue:x}};x();const u=[{id:"dcf",label:"DCF Valuation",icon:f,description:"Discounted Cash Flow analysis"},{id:"ratios",label:"Ratio Analysis",icon:d,description:"Financial ratio comparison"},{id:"sensitivity",label:"Sensitivity Analysis",icon:h,description:"Variable impact analysis"},{id:"scenario",label:"Scenario Modeling",icon:C,description:"Multi-scenario projections"},{id:"comparable",label:"Comparable Analysis",icon:w,description:"Market-based valuation"},{id:"montecarlo",label:"Monte Carlo",icon:R,description:"Probabilistic risk analysis"}],p=(e,s,t)=>{o(a=>({...a,[e]:{...a[e],[s]:t}}))},g=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(1e3*e),b=e=>`${e.toFixed(1)}%`;return s.jsxs("div",{className:"h-full bg-gray-900 text-white p-6",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Financial Modeling"}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Select a modeling approach to analyze your financial data"})]})}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:u.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>n(e.id),className:(l===e.id?"bg-blue-600 text-white border-blue-500 shadow-lg":"bg-gray-800 text-gray-300 border-gray-700 hover:bg-gray-700 hover:text-white hover:border-gray-600")+" flex items-center gap-3 px-4 py-3 rounded-lg border transition-all duration-200",children:[s.jsx(t,{size:18,className:l===e.id?"text-white":"text-blue-400"}),s.jsx("span",{className:"font-medium",children:e.label})]},e.id)})}),s.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[i.createElement(u.find(e=>e.id===l)?.icon,{size:20,className:"text-blue-400"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-white",children:u.find(e=>e.id===l)?.label}),s.jsx("p",{className:"text-gray-400 text-sm",children:u.find(e=>e.id===l)?.description})]})]})})]}),s.jsxs("div",{children:["dcf"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(f,{size:20,className:"text-blue-400"}),"DCF Valuation Model"]}),s.jsx(Pe,{data:t,modelInputs:c,onModelInputChange:p,formatCurrency:g,formatPercent:b})]}),"ratios"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(d,{size:20}),"Financial Ratio Analysis"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Profitability Ratios"}),s.jsxs("div",{className:"space-y-3",children:[m.margins.gross.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Gross Margin:"]}),s.jsx("span",{className:"font-medium",children:b(e)})]},a)),m.margins.operating.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Operating Margin:"]}),s.jsx("span",{className:"font-medium",children:b(e)})]},a))]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Growth Rates"}),s.jsxs("div",{className:"space-y-3",children:[m.growth.revenue.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Revenue Growth:"]}),s.jsx("span",{className:"font-medium "+(e>=0?"text-green-600":"text-red-600"),children:b(e)})]},a)),m.growth.operating.map((e,a)=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-sm",children:[t.periods[a+1]," Operating Growth:"]}),s.jsx("span",{className:"font-medium "+(e>=0?"text-green-600":"text-red-600"),children:b(e)})]},a))]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-3 text-gray-200",children:"Industry Comparison"}),s.jsx("div",{className:"space-y-3",children:s.jsxs("div",{className:"p-3 bg-gray-700 rounded-lg",children:[s.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Industry Avg"}),s.jsxs("div",{className:"text-sm",children:["Gross Margin: ",b(c.ratios.industryAverages.grossMargin)]}),s.jsxs("div",{className:"text-sm",children:["Operating Margin: ",b(c.ratios.industryAverages.operatingMargin)]}),s.jsxs("div",{className:"text-sm",children:["Net Margin: ",b(c.ratios.industryAverages.netMargin)]})]})})]})]})]}),"sensitivity"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(h,{size:20}),"Sensitivity Analysis"]}),s.jsx(Ie,{data:t,modelInputs:c,onModelInputChange:p,calculateDCF:x,formatCurrency:g,formatPercent:b})]}),"scenario"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-white",children:[s.jsx(C,{size:20}),"Scenario Modeling"]}),s.jsx(De,{data:t,modelInputs:c,onModelInputChange:p,calculateDCF:x,formatCurrency:g,formatPercent:b})]}),"comparable"===l&&s.jsx("div",{className:"p-6",children:s.jsx(Oe,{data:t,formatCurrency:g,formatPercent:b})}),"montecarlo"===l&&s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[s.jsx(R,{size:20}),"Monte Carlo Simulation"]}),s.jsx(Ve,{data:t,onDataChange:r})]})]})]})},Be=({data:a,adjustedValues:r,modelInputs:l,calculateDCF:i,formatCurrency:n,formatPercentage:c})=>{const o=e.useMemo(()=>{try{if(!a?.statements?.incomeStatement)return null;const s=a.statements.incomeStatement,l=Object.keys(s.totalRevenue||{}).sort((e,s)=>parseInt(e)-parseInt(s));if(l.length<2)return null;const c=l[l.length-1],o=l[l.length-2],m=l[0],x=r?.totalRevenue||s.totalRevenue?.[c]||0,u=s.totalRevenue?.[o]||0,h=s.totalRevenue?.[m]||0,p=r?.grossProfit||s.grossProfit?.[c]||0,g=s.grossProfit?.[o]||0,b=r?.operatingIncome||s.operatingIncome?.[c]||0,j=s.operatingIncome?.[o]||0,f=(r?.totalCostOfGoodsSold||s.totalCostOfGoodsSold,s.totalCostOfGoodsSold,u?(x-u)/u*100:0),v=h&&l.length>2?100*(Math.pow(x/h,1/(l.length-1))-1):0,N=j?(b-j)/j*100:0,w=x&&0!==x?p/x*100:0,k=u&&0!==u?g/u*100:0,M=x&&0!==x?b/x*100:0,S=u&&0!==u?j/u*100:0,F=isFinite(w)&&isFinite(k)?w-k:0,D=isFinite(M)&&isFinite(S)?M-S:0;let I=null;if(i)try{I=i(a)}catch(e){}const O=[{name:"Energy Devices",value:Number(s.energyDevices?.[c])||0},{name:"Injectables",value:Number(s.injectables?.[c])||0},{name:"Wellness",value:Number(s.wellness?.[c])||0},{name:"Weightloss",value:Number(s.weightloss?.[c])||0},{name:"Retail Sales",value:Number(s.retailSales?.[c])||0},{name:"Surgery",value:Number(s.surgery?.[c])||0}].filter(e=>e.value>0&&isFinite(e.value)),V=s.totalAssets?.[c]||1.2*x,T=s.totalEquity?.[c]||.6*V,B=s.totalDebt?.[c]||.3*V,q=s.currentAssets?.[c]||.4*V,L=s.currentLiabilities?.[c]||.2*V,z=s.inventory?.[c]||.15*x,G=s.accountsReceivable?.[c]||.1*x,$=s.cashAndEquivalents?.[c]||.1*V,U=V&&0!==V?b/V*100:0,W=T&&0!==T?b/T*100:0,_=T&&0!==T?B/T:0,K=L&&0!==L?q/L:0,Y=L&&0!==L?(q-z)/L:0,H=V&&0!==V?x/V:0,Q=z&&0!==z?.7*x/z:0,J=G&&0!==G?x/G:0,X=L&&0!==L?$/L:0,Z=q-L,ee=x&&0!==x?Z/x:0,se=Q>0&&J>0?365/Q+365/J:0,te=se>0?se-30:0,ae=0!==g?N/f:0,re=100*(M-S),le=T&&0!==T?V/T:0,ie=s.interestExpense?.[c]?b/s.interestExpense[c]:0,ne=s.debtService?.[c]?b/s.debtService[c]:0,ce=s.employeeCount?.[c]?x/s.employeeCount[c]:0,oe=s.sharesOutstanding?.[c]?x/s.sharesOutstanding[c]:0,de=s.sharesOutstanding?.[c]&&T?T/s.sharesOutstanding[c]:0,me={grossMargin:65,operatingMargin:18,returnOnAssets:8,returnOnEquity:15,currentRatio:2.5,debtToEquity:.4,assetTurnover:.8,revenueGrowth:8},xe={grossMargin:w-me.grossMargin,operatingMargin:M-me.operatingMargin,returnOnAssets:U-me.returnOnAssets,returnOnEquity:W-me.returnOnEquity,currentRatio:K-me.currentRatio,debtToEquity:me.debtToEquity-_,assetTurnover:H-me.assetTurnover,revenueGrowth:f-me.revenueGrowth},ue=[{title:"Revenue Growth",value:`${f>0?"+":""}${isFinite(f)?f.toFixed(1):"0.0"}%`,trend:f>0?"up":"down",description:"Year-over-year revenue growth rate",icon:t,benchmark:me.revenueGrowth,performance:xe.revenueGrowth},{title:"Gross Margin",value:`${isFinite(w)?w.toFixed(1):"0.0"}%`,trend:F>0?"up":"down",description:`${F>0?"+":""}${isFinite(F)?F.toFixed(1):"0.0"}% vs prior year`,icon:y,benchmark:me.grossMargin,performance:xe.grossMargin},{title:"Operating Margin",value:`${isFinite(M)?M.toFixed(1):"0.0"}%`,trend:D>0?"up":"down",description:`${D>0?"+":""}${isFinite(D)?D.toFixed(1):"0.0"}% vs prior year`,icon:d,benchmark:me.operatingMargin,performance:xe.operatingMargin},{title:"Return on Assets",value:`${isFinite(U)?U.toFixed(1):"0.0"}%`,trend:U>me.returnOnAssets?"up":"down",description:"Asset utilization efficiency",icon:C,benchmark:me.returnOnAssets,performance:xe.returnOnAssets},{title:"Return on Equity",value:`${isFinite(W)?W.toFixed(1):"0.0"}%`,trend:W>me.returnOnEquity?"up":"down",description:"Shareholder value generation",icon:A,benchmark:me.returnOnEquity,performance:xe.returnOnEquity},{title:"Current Ratio",value:`${isFinite(K)?K.toFixed(1):"0.0"}x`,trend:K>2?"up":K>1.5?"neutral":"down",description:"Short-term liquidity strength",icon:E,benchmark:me.currentRatio,performance:xe.currentRatio},{title:"Asset Turnover",value:`${isFinite(H)?H.toFixed(1):"0.0"}x`,trend:H>me.assetTurnover?"up":"down",description:"Revenue per dollar of assets",icon:R,benchmark:me.assetTurnover,performance:xe.assetTurnover},{title:"Debt-to-Equity",value:`${isFinite(_)?_.toFixed(1):"0.0"}x`,trend:_<me.debtToEquity?"up":"down",description:"Financial leverage position",icon:P,benchmark:me.debtToEquity,performance:xe.debtToEquity}],he=[{name:"Current Ratio",value:K,formatted:`${K.toFixed(2)}x`,benchmark:2.5,status:K>=2.5?"excellent":K>=2?"good":K>=1.5?"fair":"poor"},{name:"Quick Ratio",value:Y,formatted:`${Y.toFixed(2)}x`,benchmark:1.5,status:Y>=1.5?"excellent":Y>=1?"good":Y>=.8?"fair":"poor"},{name:"Cash Ratio",value:X,formatted:`${X.toFixed(2)}x`,benchmark:.5,status:X>=.5?"excellent":X>=.3?"good":X>=.2?"fair":"poor"},{name:"Working Capital",value:Z,formatted:n(Z),benchmark:.15*x,status:Z>=.15*x?"excellent":Z>=0?"good":"poor"}],pe=[{name:"Asset Turnover",value:H,formatted:`${H.toFixed(2)}x`,description:"Revenue generation per asset dollar"},{name:"Inventory Turnover",value:Q,formatted:`${Q.toFixed(1)}x`,description:"Inventory management efficiency"},{name:"Receivables Turnover",value:J,formatted:`${J.toFixed(1)}x`,description:"Collection efficiency"},{name:"Operating Cycle",value:se,formatted:`${se.toFixed(0)} days`,description:"Cash-to-cash cycle duration"}],ge=[{name:"Financial Leverage",value:le,formatted:`${le.toFixed(1)}x`,level:le<2?"low":le<3?"moderate":"high"},{name:"Debt-to-Equity",value:_,formatted:`${_.toFixed(2)}x`,level:_<.3?"low":_<.6?"moderate":"high"},{name:"Interest Coverage",value:ie,formatted:`${ie.toFixed(1)}x`,level:ie>10?"low":ie>5?"moderate":"high"}];return{periods:l,latest:c,previous:o,revenue:{latest:x,previous:u,growth:f,cagr:v},profitability:{grossMargin:w,grossMarginChange:F,operatingMargin:M,operatingMarginChange:D,operatingLeverage:ae,profitabilityTrend:re},financial:{returnOnAssets:U,returnOnEquity:W,assetTurnover:H,totalAssets:V,totalEquity:T,totalDebt:B,workingCapital:Z,workingCapitalRatio:ee},liquidity:{currentRatio:K,quickRatio:Y,cashRatio:X,cashAndEquivalents:$,currentAssets:q,currentLiabilities:L},efficiency:{inventoryTurnover:Q,receivablesTurnover:J,operatingCycle:se,cashConversionCycle:te},risk:{debtToEquity:_,financialLeverage:le,interestCoverage:ie,debtServiceCoverage:ne},market:{revenuePerEmployee:ce,revenuePerShare:oe,bookValuePerShare:de},benchmarks:{industry:me,comparison:xe},dcf:I,revenueBreakdown:O,kpis:ue,liquidityMetrics:he,efficiencyMetrics:pe,riskMetrics:ge}}catch(e){return null}},[a,i]);if(!o)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx(I,{className:"mx-auto h-12 w-12 text-yellow-400 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Insufficient Data"}),s.jsx("p",{className:"text-gray-500",children:"Please ensure financial data is loaded to generate analysis results."})]})});const x=({title:e,value:a,trend:r,description:l,icon:i,benchmark:n,performance:c})=>s.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 hover:border-gray-600 transition-all duration-200",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 rounded-lg "+("up"===r?"bg-green-900/30 text-green-400":"down"===r?"bg-red-900/30 text-red-400":"bg-gray-700 text-gray-400"),children:s.jsx(i,{className:"h-5 w-5"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-300",children:e}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l})]})]}),"up"===r&&s.jsx(t,{className:"h-5 w-5 text-green-400 flex-shrink-0"}),"down"===r&&s.jsx(m,{className:"h-5 w-5 text-red-400 flex-shrink-0"})]}),s.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:a}),n&&s.jsxs("div",{className:"border-t border-gray-700 pt-3 mt-3",children:[s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsx("span",{className:"text-gray-400",children:"Industry Avg:"}),s.jsx("span",{className:"text-gray-300",children:"number"==typeof n?n.toFixed(1)+(e.includes("%")?"%":e.includes("x")?"x":""):n})]}),s.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[s.jsx("span",{className:"text-gray-400",children:"vs Industry:"}),s.jsxs("span",{className:"font-medium "+(c>0?"text-green-400":c<0?"text-red-400":"text-gray-300"),children:[c>0?"+":"",c?.toFixed(1)||"0.0"]})]})]})]});return s.jsxs("div",{className:"space-y-6 p-6 bg-gray-900 text-white h-full",children:[s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center",children:[s.jsx(d,{className:"h-6 w-6 text-blue-400 mr-3"}),"Financial Analysis Results"]}),s.jsx("p",{className:"text-gray-400",children:"Comprehensive analysis of your company's financial performance and valuation"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:o.kpis.map((e,t)=>s.jsx(x,{...e},t))}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",children:[s.jsxs("div",{className:"flex border-b border-gray-700",children:[s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-white bg-blue-600 border-r border-gray-700",children:"Liquidity Analysis"}),s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white border-r border-gray-700",children:"Efficiency Metrics"}),s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white border-r border-gray-700",children:"Risk Assessment"}),s.jsx("button",{className:"px-6 py-3 text-sm font-medium text-gray-400 hover:text-white",children:"Benchmarking"})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(E,{className:"h-5 w-5 text-blue-400 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Liquidity Position Analysis"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:o.liquidityMetrics.map((e,t)=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-200",children:e.name}),s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+("excellent"===e.status?"bg-green-900/30 text-green-400":"good"===e.status?"bg-blue-900/30 text-blue-400":"fair"===e.status?"bg-yellow-900/30 text-yellow-400":"bg-red-900/30 text-red-400"),children:e.status})]}),s.jsx("div",{className:"text-xl font-bold text-white mb-1",children:e.formatted}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Benchmark: ","number"==typeof e.benchmark?e.benchmark.toFixed(1)+"x":n(e.benchmark)]})]},t))}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-750 rounded-lg border border-gray-600",children:[s.jsxs("h4",{className:"font-medium text-gray-200 mb-3 flex items-center",children:[s.jsx(b,{className:"h-4 w-4 text-blue-400 mr-2"}),"Liquidity Analysis Summary"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Working Capital:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(o.financial.workingCapital)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Cash Position:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(o.liquidity.cashAndEquivalents)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Current Assets:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(o.liquidity.currentAssets)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Current Liabilities:"}),s.jsx("span",{className:"text-white ml-2 font-medium",children:n(o.liquidity.currentLiabilities)})]})]})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx(R,{className:"h-5 w-5 text-orange-400 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Operational Efficiency Metrics"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:o.efficiencyMetrics.map((e,t)=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[s.jsx("div",{className:"text-sm font-medium text-gray-200 mb-2",children:e.name}),s.jsx("div",{className:"text-xl font-bold text-white mb-1",children:e.formatted}),s.jsx("div",{className:"text-xs text-gray-400",children:e.description})]},t))}),s.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(O,{className:"h-4 w-4 text-orange-400 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Cash Conversion"})]}),s.jsxs("div",{className:"text-lg font-bold text-white",children:[o.efficiency.cashConversionCycle.toFixed(0)," days"]}),s.jsx("div",{className:"text-xs text-gray-400",children:"Time to convert inventory to cash"})]}),s.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(V,{className:"h-4 w-4 text-orange-400 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Asset Productivity"})]}),s.jsxs("div",{className:"text-lg font-bold text-white",children:[o.financial.assetTurnover.toFixed(2),"x"]}),s.jsx("div",{className:"text-xs text-gray-400",children:"Revenue per dollar of assets"})]}),s.jsxs("div",{className:"bg-gray-750 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(w,{className:"h-4 w-4 text-orange-400 mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Revenue/Employee"})]}),s.jsx("div",{className:"text-lg font-bold text-white",children:o.market.revenuePerEmployee>0?n(o.market.revenuePerEmployee):"N/A"}),s.jsx("div",{className:"text-xs text-gray-400",children:"Productivity per employee"})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx(I,{className:"h-5 w-5 text-red-400 mr-2"}),s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Financial Risk Assessment"})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:o.riskMetrics.map((e,t)=>s.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-200",children:e.name}),s.jsxs("span",{className:"px-2 py-1 rounded text-xs font-medium "+("low"===e.level?"bg-green-900/30 text-green-400":"moderate"===e.level?"bg-yellow-900/30 text-yellow-400":"bg-red-900/30 text-red-400"),children:[e.level," risk"]})]}),s.jsx("div",{className:"text-xl font-bold text-white",children:e.formatted})]},t))}),s.jsxs("div",{className:"mt-6 p-4 bg-gray-750 rounded-lg border border-gray-600",children:[s.jsxs("h4",{className:"font-medium text-gray-200 mb-3 flex items-center",children:[s.jsx(E,{className:"h-4 w-4 text-red-400 mr-2"}),"Risk Analysis Summary"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Financial Leverage:"}),s.jsxs("span",{className:"ml-2 font-medium "+(o.risk.financialLeverage<2?"text-green-400":o.risk.financialLeverage<3?"text-yellow-400":"text-red-400"),children:[o.risk.financialLeverage.toFixed(1),"x"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-400",children:"Interest Coverage:"}),s.jsxs("span",{className:"ml-2 font-medium "+(o.risk.interestCoverage>10?"text-green-400":o.risk.interestCoverage>5?"text-yellow-400":"text-red-400"),children:[o.risk.interestCoverage.toFixed(1),"x"]})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(h,{className:"h-5 w-5 text-purple-400 mr-2"}),"Performance Trends"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-3",children:"Revenue Analysis"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Latest Period:"}),s.jsx("span",{className:"font-semibold text-white",children:n(o.revenue.latest)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"YoY Growth:"}),s.jsxs("span",{className:"font-semibold "+(o.revenue.growth>0?"text-green-400":"text-red-400"),children:[o.revenue.growth>0?"+":"",o.revenue.growth.toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"CAGR:"}),s.jsxs("span",{className:"font-semibold text-gray-200",children:[o.revenue.cagr.toFixed(1),"%"]})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-3",children:"Profitability Margins"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Gross Margin:"}),s.jsxs("span",{className:"font-semibold text-white",children:[o.profitability.grossMargin.toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Operating Margin:"}),s.jsxs("span",{className:"font-semibold text-white",children:[o.profitability.operatingMargin.toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-400",children:"Margin Change:"}),s.jsxs("span",{className:"font-semibold "+(o.profitability.grossMarginChange>0?"text-green-400":"text-red-400"),children:[o.profitability.grossMarginChange>0?"+":"",o.profitability.grossMarginChange.toFixed(1),"pp"]})]})]})]})]})]}),o.dcf&&s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(f,{className:"h-5 w-5 text-green-400 mr-2"}),"DCF Valuation Summary"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center p-4 bg-green-900/30 border border-green-700 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-green-400",children:n(o.dcf.enterpriseValue)}),s.jsx("div",{className:"text-sm text-green-300",children:"Enterprise Value"})]}),s.jsxs("div",{className:"text-center p-4 bg-blue-900/30 border border-blue-700 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-400",children:n(o.dcf.sharePrice)}),s.jsx("div",{className:"text-sm text-blue-300",children:"Price per Share"})]}),s.jsxs("div",{className:"text-center p-4 bg-gray-700 border border-gray-600 rounded-lg",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-300",children:n(o.dcf.terminalValue)}),s.jsx("div",{className:"text-sm text-gray-400",children:"Terminal Value"})]})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(j,{className:"h-5 w-5 text-orange-400 mr-2"}),"Business Unit Performance"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.revenueBreakdown.map((e,t)=>{const a=o.revenue.latest?e.value/o.revenue.latest*100:0;return s.jsxs("div",{className:"p-4 bg-gray-700 border border-gray-600 rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"font-medium text-gray-200",children:e.name}),s.jsxs("span",{className:"text-sm text-gray-400",children:[a.toFixed(1),"%"]})]}),s.jsx("div",{className:"text-lg font-semibold text-white mb-1",children:n(e.value)}),s.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${Math.min(a,100)}%`}})})]},t)})})]}),s.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-white",children:[s.jsx(T,{className:"h-5 w-5 text-green-400 mr-2"}),"Key Financial Insights"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-2",children:"Strengths"}),s.jsxs("ul",{className:"space-y-1 text-sm text-gray-400",children:[o.revenue.growth>0&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Positive revenue growth trajectory"]}),o.profitability.grossMargin>60&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Strong gross margin above 60%"]}),o.profitability.grossMarginChange>0&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Improving profitability margins"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(T,{className:"h-4 w-4 text-green-500 mr-2"}),"Diversified healthcare revenue streams"]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-200 mb-2",children:"Areas for Focus"}),s.jsxs("ul",{className:"space-y-1 text-sm text-gray-400",children:[o.revenue.growth<5&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(I,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Revenue growth below industry benchmarks"]}),o.profitability.operatingMargin<20&&s.jsxs("li",{className:"flex items-center",children:[s.jsx(I,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Operating margin optimization opportunities"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(I,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Monitor competitive positioning in key segments"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(I,{className:"h-4 w-4 text-yellow-500 mr-2"}),"Consider strategic initiatives for growth acceleration"]})]})]})]})]})]})},qe=({data:t,onDataChange:a})=>{const[r,i]=e.useState("inputs"),[n,c]=e.useState(null),[o,m]=e.useState(!1),[x,u]=e.useState({symbol:"COMPANY",companyName:"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,equityContribution:.35,seniorDebtMultiple:4,subordinatedDebtMultiple:1.5,seniorInterestRate:.055,subordinatedInterestRate:.095,ebitdaGrowthRate:.06,capexAsPercentOfRevenue:.03,nwcAsPercentOfRevenue:.02,holdingPeriod:5,exitMultiple:10,transactionFees:.02,managementFees:.02,taxRate:.21}),h=e.useCallback(e=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),p=e.useCallback(e=>`${(100*e).toFixed(1)}%`,[]),g=e.useCallback(async()=>{try{m(!0);const e={symbol:x.symbol,companyName:x.companyName,purchasePrice:x.purchasePrice,ebitda:x.ebitda,revenue:x.revenue,assumptions:{debt:{seniorDebtMultiple:x.seniorDebtMultiple,subordinatedDebtMultiple:x.subordinatedDebtMultiple,seniorInterestRate:x.seniorInterestRate,subordinatedInterestRate:x.subordinatedInterestRate},operating:{ebitdaGrowthRate:x.ebitdaGrowthRate,capexAsPercentOfRevenue:x.capexAsPercentOfRevenue,nwcAsPercentOfRevenue:x.nwcAsPercentOfRevenue,taxRate:x.taxRate},exit:{exitMultiple:x.exitMultiple},transaction:{holdingPeriod:x.holdingPeriod,transactionFees:x.transactionFees}}},s=Ce.buildLBOModel(e);c(s),a&&a({lboModel:{inputs:x,results:s,timestamp:(new Date).toISOString()}})}catch(e){alert(`Error: ${e.message}`)}finally{m(!1)}},[x,a]),b=e.useCallback((e,s)=>{u(t=>({...t,[e]:"string"==typeof s?parseFloat(s)||0:s}))},[]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(B,{className:"text-blue-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Advanced LBO Modeling"}),s.jsx("p",{className:"text-gray-600",children:"Professional leveraged buyout analysis"})]})]}),s.jsxs(re.button,{onClick:g,disabled:o,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(o?"bg-gray-300 text-gray-500":"bg-blue-600 hover:bg-blue-700 text-white"),children:[s.jsx(l,{size:18}),s.jsx("span",{children:o?"Calculating...":"Calculate LBO"})]})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"inputs",label:"Model Inputs",icon:f},{id:"results",label:"Results & Analysis",icon:d}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>i(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(r===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),"inputs"===r&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Transaction"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Purchase Price"}),s.jsx("input",{type:"number",value:x.purchasePrice,onChange:e=>b("purchasePrice",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),s.jsx("p",{className:"text-xs text-gray-500",children:h(x.purchasePrice)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current EBITDA"}),s.jsx("input",{type:"number",value:x.ebitda,onChange:e=>b("ebitda",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Holding Period"}),s.jsx("input",{type:"number",value:x.holdingPeriod,onChange:e=>b("holdingPeriod",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Financing"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Debt Multiple"}),s.jsx("input",{type:"number",step:"0.1",value:x.seniorDebtMultiple,onChange:e=>b("seniorDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sub Debt Multiple"}),s.jsx("input",{type:"number",step:"0.1",value:x.subordinatedDebtMultiple,onChange:e=>b("subordinatedDebtMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senior Rate (%)"}),s.jsx("input",{type:"number",step:"0.001",value:100*x.seniorInterestRate,onChange:e=>b("seniorInterestRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Operating"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EBITDA Growth (%)"}),s.jsx("input",{type:"number",step:"0.01",value:100*x.ebitdaGrowthRate,onChange:e=>b("ebitdaGrowthRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exit Multiple"}),s.jsx("input",{type:"number",step:"0.1",value:x.exitMultiple,onChange:e=>b("exitMultiple",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate (%)"}),s.jsx("input",{type:"number",step:"0.01",value:100*x.taxRate,onChange:e=>b("taxRate",(e.target.value||0)/100),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})]})}),"results"===r&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:n?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p(n.baseCase?.returnsAnalysis?.irr||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"IRR"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(n.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"MOIC"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[(n.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Leverage"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h(n.baseCase?.exitAnalysis?.equityProceeds||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Exit Value"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Transaction Structure"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Purchase Price:"}),s.jsx("span",{className:"font-medium",children:h(n.transactionStructure?.purchasePrice)})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Total Debt:"}),s.jsx("span",{className:"font-medium",children:h(n.transactionStructure?.totalDebt)})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Equity Investment:"}),s.jsx("span",{className:"font-medium",children:h(n.transactionStructure?.equityContribution)})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Entry Multiple:"}),s.jsxs("span",{className:"font-medium",children:[(n.transactionStructure?.entryMultiple||0).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Debt/EBITDA:"}),s.jsxs("span",{className:"font-medium",children:[(n.transactionStructure?.debtToEbitda||0).toFixed(1),"x"]})]}),s.jsxs("div",{className:"flex justify-between py-2",children:[s.jsx("span",{children:"Equity %:"}),s.jsx("span",{className:"font-medium",children:p(n.transactionStructure?.equityPercentage||0)})]})]})]})]}),n.scenarios&&Object.keys(n.scenarios).length>0&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Analysis"}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx("th",{className:"text-left py-2",children:"Scenario"}),s.jsx("th",{className:"text-right py-2",children:"IRR"}),s.jsx("th",{className:"text-right py-2",children:"MOIC"}),s.jsx("th",{className:"text-right py-2",children:"Exit Value"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 font-medium",children:"Base Case"}),s.jsx("td",{className:"text-right py-2",children:p(n.baseCase?.returnsAnalysis?.irr||0)}),s.jsxs("td",{className:"text-right py-2",children:[(n.baseCase?.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("td",{className:"text-right py-2",children:h(n.baseCase?.exitAnalysis?.equityProceeds||0)})]}),Object.entries(n.scenarios).map(([e,t])=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2",children:e}),s.jsx("td",{className:"text-right py-2",children:p(t.returnsAnalysis?.irr||0)}),s.jsxs("td",{className:"text-right py-2",children:[(t.returnsAnalysis?.moic||0).toFixed(1),"x"]}),s.jsx("td",{className:"text-right py-2",children:h(t.exitAnalysis?.equityProceeds||0)})]},e))]})]})})]})]}):s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(d,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Run LBO calculation to see results"})]})})]})},Le=({data:a,onDataChange:i})=>{const[n,c]=e.useState("income"),[o,d]=e.useState({revenue:[1e5,105e3,110250,115763,121551],costOfGoodsSold:[6e4,63e3,66150,69458,72931],grossProfit:[4e4,42e3,44100,46305,48620],operatingExpenses:[25e3,26250,27563,28941,30388],ebitda:[15e3,15750,16538,17364,18232],depreciation:[3e3,3150,3308,3473,3647],ebit:[12e3,12600,13230,13891,14585],interestExpense:[2e3,1800,1580,1340,1080],ebt:[1e4,10800,11650,12551,13505],taxes:[2100,2268,2447,2636,2836],netIncome:[7900,8532,9203,9915,10669],cash:[5e3,8532,12735,17650,23319],accountsReceivable:[8333,8750,9188,9647,10129],inventory:[1e4,10500,11025,11576,12155],totalCurrentAssets:[23333,27782,32948,38873,45603],ppe:[5e4,51850,53543,55070,56423],totalAssets:[73333,79632,86491,93943,102026],accountsPayable:[5e3,5250,5513,5789,6078],shortTermDebt:[3e3,2e3,1e3,0,0],totalCurrentLiabilities:[8e3,7250,6513,5789,6078],longTermDebt:[25e3,23e3,21e3,19e3,17e3],totalLiabilities:[33e3,30250,27513,24789,23078],shareholderEquity:[40333,49382,58978,69154,78948],totalLiabilitiesEquity:[73333,79632,86491,93943,102026],operatingCashFlow:[8567,10233,11345,12464,13584],capex:[-5e3,-4850,-5e3,-5e3,-5e3],investingCashFlow:[-5e3,-4850,-5e3,-5e3,-5e3],debtRepayment:[-2e3,-2e3,-2e3,-2e3,-2e3],financingCashFlow:[-2e3,-2e3,-2e3,-2e3,-2e3],netCashFlow:[1567,3383,4345,5464,6584],endingCash:[5e3,8383,12728,18192,24776]}),[m,x]=e.useState({revenueGrowthRate:.05,cogsPercentOfRevenue:.6,opexGrowthRate:.05,taxRate:.21,depreciationRate:.06,capexPercentOfRevenue:.05,debtPaydown:2e3}),[u,p]=e.useState([]),g=["Year 1","Year 2","Year 3","Year 4","Year 5"],b=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(1e3*e):"$0",[]),j=e.useCallback(()=>{const e={...o};for(let t=1;t<5;t++){e.revenue[t]=e.revenue[t-1]*(1+m.revenueGrowthRate),e.costOfGoodsSold[t]=e.revenue[t]*m.cogsPercentOfRevenue,e.grossProfit[t]=e.revenue[t]-e.costOfGoodsSold[t],e.operatingExpenses[t]=e.operatingExpenses[t-1]*(1+m.opexGrowthRate),e.ebitda[t]=e.grossProfit[t]-e.operatingExpenses[t],e.depreciation[t]=e.ppe[t-1]*m.depreciationRate,e.ebit[t]=e.ebitda[t]-e.depreciation[t],e.interestExpense[t]=.06*e.longTermDebt[t-1],e.ebt[t]=e.ebit[t]-e.interestExpense[t],e.taxes[t]=Math.max(0,e.ebt[t]*m.taxRate),e.netIncome[t]=e.ebt[t]-e.taxes[t];const s=e.revenue[t]*m.capexPercentOfRevenue;e.ppe[t]=e.ppe[t-1]+s-e.depreciation[t],e.longTermDebt[t]=Math.max(0,e.longTermDebt[t-1]-m.debtPaydown),e.shortTermDebt[t]=Math.max(0,e.shortTermDebt[t-1]-1e3),e.accountsReceivable[t]=.083*e.revenue[t],e.inventory[t]=.1*e.costOfGoodsSold[t],e.accountsPayable[t]=.05*e.costOfGoodsSold[t];const a=e.accountsReceivable[t]-e.accountsReceivable[t-1]+(e.inventory[t]-e.inventory[t-1])-(e.accountsPayable[t]-e.accountsPayable[t-1]);e.operatingCashFlow[t]=e.netIncome[t]+e.depreciation[t]-a,e.capex[t]=-s,e.investingCashFlow[t]=e.capex[t],e.debtRepayment[t]=-m.debtPaydown,e.financingCashFlow[t]=e.debtRepayment[t],e.netCashFlow[t]=e.operatingCashFlow[t]+e.investingCashFlow[t]+e.financingCashFlow[t],e.endingCash[t]=e.cash[t-1]+e.netCashFlow[t],e.cash[t]=e.endingCash[t],e.totalCurrentAssets[t]=e.cash[t]+e.accountsReceivable[t]+e.inventory[t],e.totalAssets[t]=e.totalCurrentAssets[t]+e.ppe[t],e.totalCurrentLiabilities[t]=e.accountsPayable[t]+e.shortTermDebt[t],e.totalLiabilities[t]=e.totalCurrentLiabilities[t]+e.longTermDebt[t],e.shareholderEquity[t]=e.totalAssets[t]-e.totalLiabilities[t],e.totalLiabilitiesEquity[t]=e.totalLiabilities[t]+e.shareholderEquity[t]}d(e);const s=[];for(let t=0;t<5;t++){Math.abs(e.totalAssets[t]-e.totalLiabilitiesEquity[t])>1&&s.push(`Balance sheet doesn't balance in ${g[t]}`)}p(s)},[o,m,g]),y=e.useCallback((e,s)=>{x(t=>({...t,[e]:parseFloat(s)||0}))},[]),f=[{id:"income",label:"Income Statement",icon:t},{id:"balance",label:"Balance Sheet",icon:z},{id:"cashflow",label:"Cash Flow",icon:h},{id:"assumptions",label:"Assumptions",icon:l}];return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(r,{className:"text-green-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"3-Statement Financial Model"}),s.jsx("p",{className:"text-gray-600",children:"Integrated Income Statement, Balance Sheet & Cash Flow"})]})]}),s.jsxs(re.button,{onClick:j,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(q,{size:16}),s.jsx("span",{children:"Recalculate"})]})]}),0===u.length?s.jsxs("div",{className:"mb-6 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center",children:[s.jsx(T,{className:"text-green-500 mr-2",size:20}),s.jsx("span",{className:"text-green-800 font-medium",children:"Model is balanced and consistent"})]}):s.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(L,{className:"text-red-500 mr-2",size:20}),s.jsx("h3",{className:"font-semibold text-red-800",children:"Validation Errors"})]}),s.jsx("ul",{className:"text-sm text-red-700",children:u.map((e,t)=>s.jsxs("li",{children:["• ",e]},t))})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:f.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>c(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(n===e.id?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),"income"===n&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Income Statement ($000s)"}),g.map(e=>s.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:e},e))]})}),s.jsx("tbody",{children:[{label:"Revenue",key:"revenue"},{label:"Cost of Goods Sold",key:"costOfGoodsSold"},{label:"Gross Profit",key:"grossProfit"},{label:"Operating Expenses",key:"operatingExpenses"},{label:"EBITDA",key:"ebitda"},{label:"Depreciation",key:"depreciation"},{label:"EBIT",key:"ebit"},{label:"Interest Expense",key:"interestExpense"},{label:"EBT",key:"ebt"},{label:"Taxes",key:"taxes"},{label:"Net Income",key:"netIncome"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4 font-medium",children:e.label}),o[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key))})]})})}),"balance"===n&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Balance Sheet ($000s)"}),g.map(e=>s.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:e},e))]})}),s.jsxs("tbody",{children:[s.jsx("tr",{className:"bg-gray-100",children:s.jsx("td",{colSpan:6,className:"py-2 px-4 font-semibold",children:"ASSETS"})}),[{label:"Cash",key:"cash"},{label:"Accounts Receivable",key:"accountsReceivable"},{label:"Inventory",key:"inventory"},{label:"Total Current Assets",key:"totalCurrentAssets"},{label:"PP&E",key:"ppe"},{label:"Total Assets",key:"totalAssets"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4",children:e.label}),o[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key)),s.jsx("tr",{className:"bg-gray-100",children:s.jsx("td",{colSpan:6,className:"py-2 px-4 font-semibold",children:"LIABILITIES & EQUITY"})}),[{label:"Accounts Payable",key:"accountsPayable"},{label:"Short-term Debt",key:"shortTermDebt"},{label:"Total Current Liabilities",key:"totalCurrentLiabilities"},{label:"Long-term Debt",key:"longTermDebt"},{label:"Total Liabilities",key:"totalLiabilities"},{label:"Shareholder Equity",key:"shareholderEquity"},{label:"Total Liab. & Equity",key:"totalLiabilitiesEquity"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4",children:e.label}),o[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key))]})]})})}),"cashflow"===n&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Cash Flow Statement ($000s)"}),g.map(e=>s.jsx("th",{className:"text-right py-3 px-4 font-semibold",children:e},e))]})}),s.jsx("tbody",{children:[{label:"Operating Cash Flow",key:"operatingCashFlow"},{label:"CapEx",key:"capex"},{label:"Investing Cash Flow",key:"investingCashFlow"},{label:"Debt Repayment",key:"debtRepayment"},{label:"Financing Cash Flow",key:"financingCashFlow"},{label:"Net Cash Flow",key:"netCashFlow"},{label:"Ending Cash",key:"endingCash"}].map(e=>s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("td",{className:"py-2 px-4",children:e.label}),o[e.key]?.map((e,t)=>s.jsx("td",{className:"text-right py-2 px-4",children:b(e)},t))]},e.key))})]})})}),"assumptions"===n&&s.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"Key Assumptions"}),s.jsx("div",{className:"space-y-3",children:[{label:"Revenue Growth Rate (%)",key:"revenueGrowthRate",isPercent:!0},{label:"COGS % of Revenue",key:"cogsPercentOfRevenue",isPercent:!0},{label:"OpEx Growth Rate (%)",key:"opexGrowthRate",isPercent:!0},{label:"Tax Rate (%)",key:"taxRate",isPercent:!0},{label:"CapEx % of Revenue",key:"capexPercentOfRevenue",isPercent:!0},{label:"Annual Debt Paydown ($000s)",key:"debtPaydown",isPercent:!1}].map(e=>s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e.label}),s.jsx("input",{type:"number",step:"0.01",value:e.isPercent?100*m[e.key]:m[e.key],onChange:s=>y(e.key,e.isPercent?(s.target.value||0)/100:s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]},e.key))})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"Model Metrics"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"5-Year Revenue CAGR:"}),s.jsxs("span",{className:"font-medium",children:[(100*(Math.pow(o.revenue[4]/o.revenue[0],1/4)-1)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"5-Year EBITDA CAGR:"}),s.jsxs("span",{className:"font-medium",children:[(100*(Math.pow(o.ebitda[4]/o.ebitda[0],1/4)-1)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Exit EBITDA Margin:"}),s.jsxs("span",{className:"font-medium",children:[(o.ebitda[4]/o.revenue[4]*100).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Exit Debt/EBITDA:"}),s.jsxs("span",{className:"font-medium",children:[(o.longTermDebt[4]/o.ebitda[4]).toFixed(1),"x"]})]})]})]})]})})]})},ze=({data:t,onDataChange:r,calculateDCF:l,lboModelingEngine:i})=>{const[n,c]=e.useState("scenarios"),[o,m]=e.useState([{id:1,name:"Base Case",probability:40,revenueGrowth:5,marginExpansion:.5,exitMultiple:10,capexIntensity:3,isBase:!0},{id:2,name:"Bull Case",probability:30,revenueGrowth:8,marginExpansion:1.5,exitMultiple:12,capexIntensity:2.5,isBase:!1},{id:3,name:"Bear Case",probability:30,revenueGrowth:2,marginExpansion:-.5,exitMultiple:8,capexIntensity:4,isBase:!1}]),[x,h]=e.useState({modelType:"dcf",outputMetric:"enterpriseValue",includeCorrelations:!1,numSimulations:1e3}),[p,g]=e.useState(null),[b,j]=e.useState(!1),y=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),f=e.useCallback(e=>`${(e||0).toFixed(1)}%`,[]),v=e.useCallback(async()=>{j(!0);try{const e=[];for(const n of o){let s=null;if("dcf"===x.modelType){const e={...t,statements:{...t.statements,incomeStatement:{...t.statements.incomeStatement,totalRevenue:t.statements.incomeStatement.totalRevenue?.map((e,s)=>0===s?e:e*Math.pow(1+n.revenueGrowth/100,s))}}};s=l?l(e):null}else if("lbo"===x.modelType&&i){const e={symbol:t.symbol||"COMPANY",companyName:t.companyName||"Target Company",purchasePrice:5e8,ebitda:75e6,revenue:5e8,assumptions:{operating:{ebitdaGrowthRate:n.revenueGrowth/100,capexAsPercentOfRevenue:n.capexIntensity/100},exit:{exitMultiple:n.exitMultiple}}};s=i.buildLBOModel(e)}e.push({...n,result:s,enterpriseValue:s?.enterpriseValue||s?.baseCase?.exitAnalysis?.enterpriseValue||0,equityValue:s?.equityValue||s?.baseCase?.exitAnalysis?.equityProceeds||0,irr:s?.irr||s?.baseCase?.returnsAnalysis?.irr||0,moic:s?.moic||s?.baseCase?.returnsAnalysis?.moic||0})}const s=e.reduce((e,s)=>e+s.enterpriseValue*s.probability/100,0),a={min:Math.min(...e.map(e=>e.enterpriseValue)),max:Math.max(...e.map(e=>e.enterpriseValue)),range:Math.max(...e.map(e=>e.enterpriseValue))-Math.min(...e.map(e=>e.enterpriseValue))},r=Math.sqrt(e.reduce((e,t)=>{const a=t.enterpriseValue-s;return e+a*a*t.probability/100},0));g({scenarios:e,summary:{weightedValue:s,valueRange:a,standardDeviation:r,coefficientOfVariation:r/s,probabilityOfPositiveReturn:e.filter(e=>e.enterpriseValue>(t.currentMarketCap||1e9)).reduce((e,s)=>e+s.probability,0)},chartData:e.map(e=>({name:e.name,value:e.enterpriseValue,probability:e.probability,irr:100*e.irr,moic:e.moic}))})}catch(e){alert(`Error running scenario analysis: ${e.message}`)}finally{j(!1)}},[o,x,t,l,i]),N=e.useCallback(()=>{const e={id:Date.now(),name:`Scenario ${o.length+1}`,probability:Math.max(0,100-o.reduce((e,s)=>e+s.probability,0)),revenueGrowth:5,marginExpansion:0,exitMultiple:10,capexIntensity:3,isBase:!1};m(s=>[...s,e])},[o]),w=e.useCallback((e,s,t)=>{m(a=>a.map(a=>a.id===e?{...a,[s]:parseFloat(t)||t}:a))},[]),C=e.useCallback(e=>{m(s=>s.filter(s=>s.id!==e&&!s.isBase))},[]),k=e.useMemo(()=>o.reduce((e,s)=>e+s.probability,0),[o]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(d,{className:"text-purple-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Scenario Analysis"}),s.jsx("p",{className:"text-gray-600",children:"Cross-model scenario planning & risk assessment"})]})]}),s.jsx("div",{className:"flex space-x-3",children:s.jsxs(re.button,{onClick:v,disabled:b||100!==k,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(b||100!==k?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:b||100!==k?{}:{scale:1.02},children:[s.jsx(S,{size:18}),s.jsx("span",{children:b?"Running...":"Run Analysis"})]})})]}),s.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model Type"}),s.jsxs("select",{value:x.modelType,onChange:e=>h(s=>({...s,modelType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"dcf",children:"DCF Valuation"}),s.jsx("option",{value:"lbo",children:"LBO Analysis"}),s.jsx("option",{value:"3statement",children:"3-Statement Model"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Output Metric"}),s.jsxs("select",{value:x.outputMetric,onChange:e=>h(s=>({...s,outputMetric:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:"enterpriseValue",children:"Enterprise Value"}),s.jsx("option",{value:"equityValue",children:"Equity Value"}),s.jsx("option",{value:"irr",children:"IRR"}),s.jsx("option",{value:"moic",children:"MOIC"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Simulations"}),s.jsx("input",{type:"number",value:x.numSimulations,onChange:e=>h(s=>({...s,numSimulations:parseInt(e.target.value)||1e3})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:x.includeCorrelations,onChange:e=>h(s=>({...s,includeCorrelations:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Include Correlations"})]})})]})}),100!==k&&s.jsxs("div",{className:"mb-6 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-center",children:[s.jsx(I,{className:"text-amber-500 mr-2",size:20}),s.jsxs("span",{className:"text-amber-800",children:["Total probability is ",k,"%. Adjust scenarios to sum to 100%."]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Scenarios"}),s.jsxs(re.button,{onClick:N,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(a,{size:16}),s.jsx("span",{children:"Add Scenario"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4",children:"Scenario"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Probability (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Revenue Growth (%)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Margin Expansion (bps)"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Exit Multiple"}),s.jsx("th",{className:"text-right py-3 px-4",children:"CapEx Intensity (%)"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),s.jsx("tbody",{children:o.map(e=>s.jsxs("tr",{className:"border-b border-gray-200 "+(e.isBase?"bg-blue-50":""),children:[s.jsx("td",{className:"py-3 px-4",children:s.jsx("input",{type:"text",value:e.name,onChange:s=>w(e.id,"name",s.target.value),disabled:e.isBase,className:"border border-gray-300 rounded px-2 py-1 "+(e.isBase?"bg-gray-100":"")})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"1",value:e.probability,onChange:s=>w(e.id,"probability",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.revenueGrowth,onChange:s=>w(e.id,"revenueGrowth",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.marginExpansion,onChange:s=>w(e.id,"marginExpansion",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.exitMultiple,onChange:s=>w(e.id,"exitMultiple",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-right py-3 px-4",children:s.jsx("input",{type:"number",step:"0.1",value:e.capexIntensity,onChange:s=>w(e.id,"capexIntensity",s.target.value),className:"w-20 text-right border border-gray-300 rounded px-2 py-1"})}),s.jsx("td",{className:"text-center py-3 px-4",children:!e.isBase&&s.jsx("button",{onClick:()=>C(e.id),className:"text-red-600 hover:text-red-800",children:s.jsx(u,{size:16})})})]},e.id))})]})})]}),p&&s.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y(p.summary.weightedValue)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Expected Value"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:y(p.summary.valueRange.max)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Best Case"})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:y(p.summary.valueRange.min)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Worst Case"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:f(p.summary.probabilityOfPositiveReturn)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Success Probability"})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Scenario Results"}),s.jsx("div",{className:"h-80",children:s.jsx(ie,{width:"100%",height:"100%",children:s.jsxs(ne,{data:p.chartData,children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"name"}),s.jsx(de,{tickFormatter:e=>y(e)}),s.jsx(me,{formatter:e=>[y(e),"Enterprise Value"]}),s.jsx(xe,{dataKey:"value",fill:"#8884d8"})]})})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Risk Metrics"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Standard Deviation:"}),s.jsx("span",{className:"font-medium",children:y(p.summary.standardDeviation)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Coefficient of Variation:"}),s.jsxs("span",{className:"font-medium",children:[(100*p.summary.coefficientOfVariation).toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Value at Risk (5%):"}),s.jsx("span",{className:"font-medium",children:y(p.summary.valueRange.min)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Upside Potential:"}),s.jsx("span",{className:"font-medium",children:y(p.summary.valueRange.range)})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"Scenario Returns"}),s.jsx("div",{className:"space-y-2 text-sm",children:p.scenarios.map(e=>s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:[e.name,":"]}),s.jsx("span",{className:"font-medium",children:"irr"===x.outputMetric?f(e.irr):"moic"===x.outputMetric?`${e.moic.toFixed(1)}x`:y(e[x.outputMetric])})]},e.id))})]})]})]}),!p&&s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(d,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Configure scenarios and run analysis to see results"})]})]})},Ge=({data:r,onDataChange:l})=>{const[i,n]=e.useState("overview"),[c,o]=e.useState([{symbol:"SPY",name:"SPDR S&P 500 ETF",price:445.67,change:2.34,changePercent:.53,category:"index"},{symbol:"QQQ",name:"Invesco QQQ Trust",price:378.91,change:-1.45,changePercent:-.38,category:"index"},{symbol:"VIX",name:"CBOE Volatility Index",price:18.45,change:.87,changePercent:4.95,category:"volatility"},{symbol:"DXY",name:"US Dollar Index",price:102.45,change:-.23,changePercent:-.22,category:"currency"},{symbol:"^TNX",name:"10-Year Treasury Yield",price:4.25,change:.05,changePercent:1.19,category:"rates"}]),[u,g]=e.useState({indices:{"S&P 500":{value:4456.78,change:23.45,changePercent:.53},NASDAQ:{value:13789.45,change:-45.67,changePercent:-.33},DOW:{value:34567.89,change:156.78,changePercent:.46},"Russell 2000":{value:1987.65,change:12.34,changePercent:.63}},sectors:[{name:"Technology",change:1.2,weight:23.5},{name:"Healthcare",change:.8,weight:13.2},{name:"Financial",change:-.4,weight:12.8},{name:"Consumer Disc.",change:.6,weight:10.9},{name:"Communication",change:-.2,weight:9.1},{name:"Industrials",change:.9,weight:8.7}],economicIndicators:{"Fed Funds Rate":{value:5.25,change:0,unit:"%"},"10Y Treasury":{value:4.25,change:.05,unit:"%"},"Inflation (CPI)":{value:3.1,change:-.2,unit:"%"},Unemployment:{value:3.8,change:.1,unit:"%"},"GDP Growth":{value:2.4,change:.1,unit:"%"}}}),[b,j]=e.useState([{id:1,type:"price",symbol:"SPY",condition:"above",value:450,active:!0},{id:2,type:"volatility",symbol:"VIX",condition:"above",value:20,active:!0}]),[y,f]=e.useState(""),[v,N]=e.useState(!1),w=e.useCallback(e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),[]),C=e.useCallback(e=>`${e>=0?"+":""}${e.toFixed(2)}%`,[]),k=e.useCallback(e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",[]),M=e.useCallback(e=>e>0?t:e<0?m:x,[]);e.useEffect(()=>{const e=setInterval(()=>{o(e=>e.map(e=>({...e,price:e.price+2*(Math.random()-.5),change:e.change+.5*(Math.random()-.5),changePercent:e.changePercent+.1*(Math.random()-.5)})))},5e3);return()=>clearInterval(e)},[]);const R=e.useCallback(async()=>{if(y.trim()){N(!0);try{await new Promise(e=>setTimeout(e,1e3));const e={symbol:y.toUpperCase(),name:`${y.toUpperCase()} Inc.`,price:200*Math.random()+50,change:10*(Math.random()-.5),changePercent:5*(Math.random()-.5),category:"stock"};o(s=>[...s,e]),f("")}catch(e){}finally{N(!1)}}},[y]),S=e.useCallback(e=>{o(s=>s.filter(s=>s.symbol!==e))},[]),F=e.useMemo(()=>{const e=new Date;return Array.from({length:30},(s,t)=>({time:new Date(e.getTime()-24*(29-t)*60*60*1e3).toLocaleDateString(),SPY:440+10*Math.sin(.2*t)+5*Math.random(),QQQ:370+15*Math.sin(.25*t)+8*Math.random(),VIX:20+5*Math.sin(.3*t)+3*Math.random()}))},[]),D=e.useMemo(()=>[{pair:"SPY vs QQQ",correlation:.85,strength:"Strong Positive"},{pair:"SPY vs VIX",correlation:-.72,strength:"Strong Negative"},{pair:"QQQ vs VIX",correlation:-.68,strength:"Moderate Negative"},{pair:"SPY vs DXY",correlation:-.45,strength:"Moderate Negative"}],[]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(h,{className:"text-blue-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Enhanced Market Data Dashboard"}),s.jsx("p",{className:"text-gray-600",children:"Real-time market insights & valuation integration"})]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs(re.button,{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(q,{size:16}),s.jsx("span",{children:"Sync Data"})]}),s.jsxs(re.button,{className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg flex items-center space-x-2",whileHover:{scale:1.02},children:[s.jsx(p,{size:16}),s.jsx("span",{children:"Settings"})]})]})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Market Overview",icon:G},{id:"watchlist",label:"Watchlist",icon:d},{id:"charts",label:"Charts & Analysis",icon:$},{id:"alerts",label:"Alerts",icon:U}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>n(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(i===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),"overview"===i&&s.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Major Indices"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(u.indices).map(([e,t])=>{const a=M(t.change);return s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:e}),s.jsx("div",{className:"text-xl font-bold text-gray-800",children:t.value.toLocaleString()}),s.jsxs("div",{className:`flex items-center space-x-1 text-sm ${k(t.change)}`,children:[s.jsx(a,{size:14}),s.jsxs("span",{children:[t.change>0?"+":"",t.change.toFixed(2)]}),s.jsxs("span",{children:["(",C(t.changePercent),")"]})]})]},e)})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sector Performance"}),s.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:u.sectors.map(e=>s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-600",children:[e.weight,"% weight"]})]}),s.jsx("div",{className:`font-semibold ${k(e.change)}`,children:C(e.change)})]},e.name))})})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Economic Indicators"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(u.economicIndicators).map(([e,t])=>s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:e}),s.jsxs("div",{className:"text-lg font-bold text-gray-800",children:[t.value,t.unit]}),s.jsxs("div",{className:`text-sm ${k(t.change)}`,children:[t.change>0?"+":"",t.change,t.unit]})]},e))})]})]}),"watchlist"===i&&s.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("div",{className:"flex-1",children:s.jsx("input",{type:"text",placeholder:"Enter symbol (e.g., AAPL, MSFT)",value:y,onChange:e=>f(e.target.value.toUpperCase()),onKeyPress:e=>"Enter"===e.key&&R(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),s.jsxs(re.button,{onClick:R,disabled:v||!y.trim(),className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(v||!y.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"),whileHover:!v&&y.trim()?{scale:1.02}:{},children:[s.jsx(a,{size:16}),s.jsx("span",{children:v?"Adding...":"Add"})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b-2 border-gray-300",children:[s.jsx("th",{className:"text-left py-3 px-4",children:"Symbol"}),s.jsx("th",{className:"text-left py-3 px-4",children:"Name"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Price"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Change"}),s.jsx("th",{className:"text-right py-3 px-4",children:"Change %"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Category"}),s.jsx("th",{className:"text-center py-3 px-4",children:"Actions"})]})}),s.jsx("tbody",{children:c.map(e=>{const t=M(e.change);return s.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[s.jsx("td",{className:"py-3 px-4 font-medium text-gray-800",children:e.symbol}),s.jsx("td",{className:"py-3 px-4 text-gray-600",children:e.name}),s.jsx("td",{className:"text-right py-3 px-4 font-medium",children:w(e.price)}),s.jsx("td",{className:`text-right py-3 px-4 ${k(e.change)}`,children:s.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[s.jsx(t,{size:14}),s.jsxs("span",{children:[e.change>0?"+":"",e.change.toFixed(2)]})]})}),s.jsx("td",{className:`text-right py-3 px-4 font-medium ${k(e.changePercent)}`,children:C(e.changePercent)}),s.jsx("td",{className:"text-center py-3 px-4",children:s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("index"===e.category?"bg-blue-100 text-blue-800":"stock"===e.category?"bg-green-100 text-green-800":"volatility"===e.category?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.category})}),s.jsx("td",{className:"text-center py-3 px-4",children:s.jsx("button",{onClick:()=>S(e.symbol),className:"text-red-600 hover:text-red-800",children:s.jsx(x,{size:16})})})]},e.symbol)})})]})})]}),"charts"===i&&s.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"30-Day Price Performance"}),s.jsx("div",{className:"h-80",children:s.jsx(ie,{width:"100%",height:"100%",children:s.jsxs(ge,{data:F,children:[s.jsx(ce,{strokeDasharray:"3 3"}),s.jsx(oe,{dataKey:"time"}),s.jsx(de,{}),s.jsx(me,{}),s.jsx(je,{type:"monotone",dataKey:"SPY",stroke:"#3B82F6",strokeWidth:2,name:"S&P 500"}),s.jsx(je,{type:"monotone",dataKey:"QQQ",stroke:"#10B981",strokeWidth:2,name:"NASDAQ"}),s.jsx(je,{type:"monotone",dataKey:"VIX",stroke:"#EF4444",strokeWidth:2,name:"VIX"})]})})})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Correlation Analysis"}),s.jsx("div",{className:"space-y-3",children:D.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:e.pair}),s.jsx("div",{className:"text-sm text-gray-600",children:e.strength})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"text-lg font-bold "+(Math.abs(e.correlation)>.7?"text-red-600":Math.abs(e.correlation)>.4?"text-yellow-600":"text-green-600"),children:e.correlation.toFixed(2)}),s.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"h-2 rounded-full "+(Math.abs(e.correlation)>.7?"bg-red-600":Math.abs(e.correlation)>.4?"bg-yellow-600":"bg-green-600"),style:{width:100*Math.abs(e.correlation)+"%"}})})]})]},t))})]})]}),"alerts"===i&&s.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Active Alerts"}),s.jsx("div",{className:"space-y-3",children:b.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(U,{className:"text-yellow-600",size:20}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-gray-800",children:[e.symbol," ",e.type," alert"]}),s.jsxs("div",{className:"text-sm text-gray-600",children:["Notify when ",e.type," goes ",e.condition," ",e.value]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(e.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.active?"Active":"Inactive"}),s.jsx("button",{className:"text-red-600 hover:text-red-800",children:s.jsx(x,{size:16})})]})]},e.id))})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Market Status"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[s.jsx(T,{className:"text-green-600",size:20}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:"US Markets"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Open (6h 23m remaining)"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[s.jsx(L,{className:"text-yellow-600",size:20}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:"European Markets"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Closed"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[s.jsx(L,{className:"text-red-600",size:20}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-800",children:"Asian Markets"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Closed"})]})]})]})]})]})]})},$e=({data:a,dcfResults:r,lboResults:l,financialModel:i,scenarioResults:n,onDataChange:c})=>{const[o,d]=e.useState("unified"),[m,x]=e.useState({iterations:1e4,confidenceLevel:.95,correlationsEnabled:!0,crossModelAnalysis:!0,riskMetrics:["var","cvar","downside"]}),[u,p]=e.useState(null),[g,b]=e.useState(!1),[j,y]=e.useState(0),f=e.useCallback(e=>e||0===e?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"$0",[]),v=e.useCallback(e=>`${(100*e).toFixed(1)}%`,[]),N=e.useCallback(async()=>{b(!0),y(0);try{const e={dcf:null,lbo:null,correlation:null,portfolio:null,riskMetrics:null};if(r&&m.crossModelAnalysis){const s={revenueGrowthRate:{type:"normal",parameters:{mean:.05,stdDev:.02},enabled:!0},fcfMargin:{type:"triangular",parameters:{min:.1,mode:.15,max:.2},enabled:!0},wacc:{type:"normal",parameters:{mean:.1,stdDev:.015},enabled:!0},terminalGrowthRate:{type:"uniform",parameters:{min:.02,max:.03},enabled:!0}},t={currentRevenue:1e3*a?.statements?.incomeStatement?.totalRevenue?.[0]||1e6,currentPrice:100,sharesOutstanding:1e6,...r};y(25),e.dcf=await Se.runDCFSimulation(t,s,{iterations:m.iterations,confidenceLevel:m.confidenceLevel,onProgress:e=>y(25+.25*e)})}if(l&&m.crossModelAnalysis){const s={ebitdaGrowthRate:{type:"normal",parameters:{mean:.06,stdDev:.02},enabled:!0},exitMultiple:{type:"triangular",parameters:{min:8,mode:10,max:12},enabled:!0},leverageRatio:{type:"normal",parameters:{mean:5.5,stdDev:.5},enabled:!0}};y(50),e.lbo=await Se.runLBOSimulation(l.inputs||{},s,{iterations:m.iterations,confidenceLevel:m.confidenceLevel,onProgress:e=>y(50+.25*e)})}e.dcf&&e.lbo&&m.correlationsEnabled&&(y(75),e.correlation=w(e.dcf,e.lbo)),y(90),e.riskMetrics=M(e),n&&n.scenarios&&(e.portfolio=F(e,n)),y(100),p(e),c&&c({monteCarloIntegrated:{settings:m,results:e,timestamp:(new Date).toISOString()}})}catch(e){alert(`Simulation error: ${e.message}`)}finally{b(!1),y(0)}},[r,l,n,m,a,c]),w=e.useCallback((e,s)=>{const t=e.simulations?.map(e=>e.pricePerShare)||[],a=s.simulations?.map(e=>e.irr)||[];if(0===t.length||0===a.length)return null;const r=k(t,a);return{dcfLboCorrelation:r,interpretation:Math.abs(r)>.7?"Strong":Math.abs(r)>.4?"Moderate":"Weak",riskImplication:r>0?"Aligned Risk":"Hedged Risk"}},[]),k=(e,s)=>{const t=Math.min(e.length,s.length);if(0===t)return 0;const a=e.slice(0,t).reduce((e,s)=>e+s,0),r=s.slice(0,t).reduce((e,s)=>e+s,0),l=e.slice(0,t).reduce((e,t,a)=>e+t*s[a],0),i=e.slice(0,t).reduce((e,s)=>e+s*s,0),n=s.slice(0,t).reduce((e,s)=>e+s*s,0),c=t*l-a*r,o=Math.sqrt((t*i-a*a)*(t*n-r*r));return 0===o?0:c/o},M=e.useCallback(e=>{const s={};return e.dcf?.analysis&&(s.dcf={var95:e.dcf.analysis.percentiles?.pricePerShare?.p5||0,expectedValue:e.dcf.analysis.summary?.mean||0,volatility:e.dcf.analysis.summary?.standardDeviation||0}),e.lbo?.analysis&&(s.lbo={var95:e.lbo.analysis.percentiles?.irr?.p5||0,expectedValue:e.lbo.analysis.summary?.mean||0,volatility:e.lbo.analysis.summary?.standardDeviation||0}),s},[]),F=e.useCallback((e,s)=>s.scenarios.reduce((s,t)=>{const a=t.probability/100;return e.dcf&&(s.dcfWeighted=(s.dcfWeighted||0)+(e.dcf.analysis?.summary?.mean||0)*a),e.lbo&&(s.lboWeighted=(s.lboWeighted||0)+(e.lbo.analysis?.summary?.mean||0)*a),s},{}),[]),D=[{id:"unified",label:"Unified Analysis",icon:R},{id:"dcf",label:"DCF Monte Carlo",icon:t},{id:"lbo",label:"LBO Monte Carlo",icon:C},{id:"correlation",label:"Cross-Model Risk",icon:h}];return s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(R,{className:"text-purple-600",size:28}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Monte Carlo Integration Hub"}),s.jsx("p",{className:"text-gray-600",children:"Cross-model risk analysis & unified simulations"})]})]}),s.jsx("div",{className:"flex space-x-3",children:s.jsxs(re.button,{onClick:N,disabled:g,className:"px-6 py-2 rounded-lg font-medium flex items-center space-x-2 "+(g?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700 text-white"),whileHover:g?{}:{scale:1.02},whileTap:g?{}:{scale:.98},children:[s.jsx(S,{size:18}),s.jsx("span",{children:g?"Running...":"Run Integrated Simulation"})]})})]}),g&&s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Simulation Progress"}),s.jsxs("span",{className:"text-sm text-gray-500",children:[j.toFixed(0),"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${j}%`}})})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"Simulation Settings"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Iterations"}),s.jsx("input",{type:"number",value:m.iterations,onChange:e=>x(s=>({...s,iterations:parseInt(e.target.value)||1e4})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confidence Level"}),s.jsxs("select",{value:m.confidenceLevel,onChange:e=>x(s=>({...s,confidenceLevel:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[s.jsx("option",{value:.9,children:"90%"}),s.jsx("option",{value:.95,children:"95%"}),s.jsx("option",{value:.99,children:"99%"})]})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:m.correlationsEnabled,onChange:e=>x(s=>({...s,correlationsEnabled:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Cross-Model Correlations"})]})}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:m.crossModelAnalysis,onChange:e=>x(s=>({...s,crossModelAnalysis:e.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Cross-Model Analysis"})]})})]})]}),s.jsx("div",{className:"border-b border-gray-200 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:D.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>d(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(o===e.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(t,{size:16}),s.jsx("span",{children:e.label})]},e.id)})})}),u?s.jsxs(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:["unified"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[u.dcf&&s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f(u.dcf.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"DCF Expected Value"})]}),u.lbo&&s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:v(u.lbo.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"LBO Expected IRR"})]}),u.correlation&&s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:(u.correlation.dcfLboCorrelation||0).toFixed(2)}),s.jsx("div",{className:"text-sm text-gray-600",children:"DCF-LBO Correlation"})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:m.iterations.toLocaleString()}),s.jsx("div",{className:"text-sm text-gray-600",children:"Simulations Run"})]})]}),u.correlation&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Cross-Model Risk Analysis"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Correlation Strength"}),s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:u.correlation.interpretation}),s.jsx("div",{className:"text-sm text-gray-600",children:u.correlation.riskImplication})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Risk Diversification"}),s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.abs(u.correlation.dcfLboCorrelation)<.5?"High":"Low"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Portfolio benefit"})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Confidence Level"}),s.jsx("div",{className:"text-2xl font-bold text-green-600",children:v(m.confidenceLevel)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Statistical confidence"})]})]})]}),u.portfolio&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Portfolio-Weighted Analysis"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Scenario-Weighted DCF"}),s.jsx("div",{className:"text-xl font-bold text-blue-600",children:f(u.portfolio.dcfWeighted||0)})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg",children:[s.jsx("div",{className:"font-medium text-gray-800 mb-2",children:"Scenario-Weighted LBO IRR"}),s.jsx("div",{className:"text-xl font-bold text-green-600",children:v(u.portfolio.lboWeighted||0)})]})]})]})]}),"dcf"===o&&u.dcf&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"DCF Monte Carlo Results"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-blue-600",children:f(u.dcf.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Mean Value"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-green-600",children:f(u.dcf.analysis?.percentiles?.pricePerShare?.p95||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"95th Percentile"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-red-600",children:f(u.dcf.analysis?.percentiles?.pricePerShare?.p5||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"5th Percentile"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-purple-600",children:f(u.dcf.analysis?.summary?.standardDeviation||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Std Deviation"})]})]})]}),"lbo"===o&&u.lbo&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"LBO Monte Carlo Results"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-green-600",children:v(u.lbo.analysis?.summary?.mean||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"Mean IRR"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-blue-600",children:v(u.lbo.analysis?.percentiles?.irr?.p95||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"95th Percentile IRR"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-red-600",children:v(u.lbo.analysis?.percentiles?.irr?.p5||0)}),s.jsx("div",{className:"text-sm text-gray-600",children:"5th Percentile IRR"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-lg font-bold text-purple-600",children:[((u.lbo.analysis?.percentiles?.moic?.p95||0)+(u.lbo.analysis?.percentiles?.moic?.p5||0))/2,"x"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Avg MOIC"})]})]})]})]}):s.jsxs("div",{className:"text-center py-12 text-gray-500",children:[s.jsx(R,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Configure settings and run integrated simulation to see cross-model analysis"}),s.jsx("p",{className:"text-sm mt-2",children:r||l?"Ready to run comprehensive Monte Carlo analysis":"Run DCF and/or LBO analysis first to enable Monte Carlo integration"})]})]})},Ue=({financialData:a,currentMetric:r,analysisContext:l="general",onInsightClick:i,isVisible:o=!0,onToggle:m})=>{const[x,u]=e.useState({assumptions:!0,benchmarks:!0,insights:!0,suggestions:!1});e.useMemo(()=>({healthcare:{revenueGrowth:{min:8,median:15,max:25,unit:"%"},ebitdaMargin:{min:18,median:28,max:40,unit:"%"},grossMargin:{min:65,median:75,max:85,unit:"%"},roe:{min:12,median:18,max:25,unit:"%"}},technology:{revenueGrowth:{min:15,median:25,max:50,unit:"%"},ebitdaMargin:{min:20,median:35,max:50,unit:"%"},grossMargin:{min:70,median:80,max:90,unit:"%"},roe:{min:15,median:22,max:35,unit:"%"}},manufacturing:{revenueGrowth:{min:3,median:8,max:15,unit:"%"},ebitdaMargin:{min:10,median:18,max:25,unit:"%"},grossMargin:{min:25,median:35,max:45,unit:"%"},roe:{min:8,median:15,max:22,unit:"%"}}}),[]);const h=(()=>{const e=[];if(!a?.statements?.incomeStatement)return[{type:"info",title:"Getting Started",content:"Import financial data to see contextual insights and benchmarks.",action:"Import Data"}];const s=a.statements.incomeStatement,t=s.totalRevenue?.[2]||0,i=s.operatingIncome?.[2]||0;if(t>0){const s=i/t*100;e.push({type:"benchmark",title:"Operating Margin Analysis",content:`Current operating margin of ${s.toFixed(1)}% compares to healthcare industry median of 28%.`,metric:s,benchmark:28,status:s>=28?"above":s>=20?"within":"below"})}return"dcf"===l&&e.push({type:"assumption",title:"DCF Model Assumptions",content:"Consider industry-specific discount rates and terminal growth assumptions.",suggestions:["Healthcare companies typically use 8-12% WACC","Terminal growth rates should reflect long-term GDP growth (2-3%)","Consider regulatory risks in discount rate adjustments"]}),r?.includes("revenue")&&e.push({type:"insight",title:"Revenue Growth Drivers",content:"Analyze revenue composition and growth sustainability.",suggestions:["Break down revenue by service line","Assess recurring vs. one-time revenue","Evaluate market expansion opportunities"]}),e})(),p=e=>{u(s=>({...s,[e]:!s[e]}))},g=(e,t,a,r)=>{const l=r-a,i=Math.max(0,Math.min(100,(e-a)/l*100)),n=Math.max(0,Math.min(100,(t-a)/l*100));return s.jsxs("div",{className:"relative h-2 bg-slate-200 rounded-full overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 h-full bg-blue-200 rounded-full",style:{width:`${n}%`}}),s.jsx("div",{className:"absolute top-0 h-full w-1 bg-blue-600 rounded-full",style:{left:`${n}%`}}),s.jsx("div",{className:"absolute top-0 h-full w-1 bg-amber-500 rounded-full",style:{left:`${i}%`}})]})};return o?s.jsxs(re.div,{initial:{x:320,opacity:0},animate:{x:0,opacity:1},exit:{x:320,opacity:0},className:"fixed right-0 top-16 bottom-0 w-80 bg-slate-50 border-l border-slate-200 shadow-xl z-40 overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"p-1.5 bg-blue-100 rounded-lg",children:s.jsx(d,{size:16,className:"text-blue-600"})}),s.jsx("h3",{className:"font-semibold text-slate-900",children:"Contextual Insights"})]}),m&&s.jsx("button",{onClick:m,className:"p-1.5 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx(W,{size:16,className:"text-slate-500"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[s.jsxs("button",{onClick:()=>p("assumptions"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(C,{size:16,className:"text-amber-600"}),s.jsx("span",{className:"font-medium text-slate-900",children:"Key Assumptions"})]}),x.assumptions?s.jsx(n,{size:16,className:"text-slate-400"}):s.jsx(c,{size:16,className:"text-slate-400"})]}),s.jsx(le,{children:x.assumptions&&s.jsx(re.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Discount Rate"}),s.jsx("span",{className:"font-mono text-slate-900",children:"10.0%"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Terminal Growth"}),s.jsx("span",{className:"font-mono text-slate-900",children:"2.5%"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-600",children:"Tax Rate"}),s.jsx("span",{className:"font-mono text-slate-900",children:"25.0%"})]})]})})})]}),s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[s.jsxs("button",{onClick:()=>p("benchmarks"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(w,{size:16,className:"text-emerald-600"}),s.jsx("span",{className:"font-medium text-slate-900",children:"Industry Benchmarks"})]}),x.benchmarks?s.jsx(n,{size:16,className:"text-slate-400"}):s.jsx(c,{size:16,className:"text-slate-400"})]}),s.jsx(le,{children:x.benchmarks&&s.jsx(re.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-slate-600",children:"Revenue Growth"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Healthcare Industry"})]}),s.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[s.jsx("span",{children:"8%"}),s.jsx("span",{className:"font-medium",children:"15% (median)"}),s.jsx("span",{children:"25%"})]}),g(12,15,8,25)]}),s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-slate-600",children:"EBITDA Margin"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Healthcare Industry"})]}),s.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[s.jsx("span",{children:"18%"}),s.jsx("span",{className:"font-medium",children:"28% (median)"}),s.jsx("span",{children:"40%"})]}),g(24,28,18,40)]})]})})})]}),s.jsx("div",{className:"space-y-3",children:h.map((e,t)=>((e,t)=>{const a={info:"text-blue-500 bg-blue-50",benchmark:"text-emerald-500 bg-emerald-50",assumption:"text-amber-500 bg-amber-50",insight:"text-purple-500 bg-purple-50"},r={info:v,benchmark:C,assumption:I,insight:_}[e.type]||v,l=a[e.type]||a.info;return s.jsx(re.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"p-4 bg-white rounded-lg border border-slate-200 hover:border-slate-300 transition-colors",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`p-2 rounded-lg ${l}`,children:s.jsx(r,{size:16})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-semibold text-slate-900 text-sm mb-2",children:e.title}),s.jsx("p",{className:"text-sm text-slate-600 mb-3",children:e.content}),void 0!==e.metric&&void 0!==e.benchmark&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[s.jsxs("span",{children:["Current: ",e.metric.toFixed(1),"%"]}),s.jsxs("span",{children:["Benchmark: ",e.benchmark,"%"]})]}),g(e.metric,e.benchmark,0,Math.max(1.5*e.benchmark,1.2*e.metric))]}),e.suggestions&&s.jsx("div",{className:"mt-3",children:s.jsx("div",{className:"space-y-1",children:e.suggestions.map((e,t)=>s.jsxs("div",{className:"flex items-start gap-2 text-xs text-slate-600",children:[s.jsx(c,{size:12,className:"text-slate-400 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:e})]},t))})}),e.action&&s.jsx("button",{onClick:()=>i?.(e),className:"mt-3 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 text-xs font-medium rounded-md transition-colors",children:e.action})]})]})},t)})(e,t))}),s.jsxs("div",{className:"bg-white rounded-lg border border-slate-200",children:[s.jsxs("button",{onClick:()=>p("suggestions"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-slate-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(_,{size:16,className:"text-purple-600"}),s.jsx("span",{className:"font-medium text-slate-900",children:"Smart Suggestions"})]}),x.suggestions?s.jsx(n,{size:16,className:"text-slate-400"}):s.jsx(c,{size:16,className:"text-slate-400"})]}),s.jsx(le,{children:x.suggestions&&s.jsx(re.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-slate-100",children:s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-blue-50 rounded-lg",children:[s.jsx(d,{size:14,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-blue-900 mb-1",children:"Create Revenue vs CapEx Chart"}),s.jsx("div",{className:"text-xs text-blue-700",children:"Visualize the relationship between revenue growth and capital expenditure"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-emerald-50 rounded-lg",children:[s.jsx(t,{size:14,className:"text-emerald-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-emerald-900 mb-1",children:"Add Sensitivity Analysis"}),s.jsx("div",{className:"text-xs text-emerald-700",children:"Test how valuation changes with different assumptions"})]})]})]})})})]})]})})]}):null},We="1.0.0",_e="financeanalyst_",Ke={enabled:!0,threshold:1024},Ye={maxSize:52428800,cleanupThreshold:.8},He={dcfModel:{version:"1.0",required:["symbol","assumptions","projections","valuation"],structure:{symbol:"string",assumptions:"object",projections:"object",valuation:"object",metadata:"object"}},lboModel:{version:"1.0",required:["symbol","transaction","financing","returns"],structure:{symbol:"string",transaction:"object",financing:"object",returns:"object",metadata:"object"}},monteCarloResults:{version:"1.0",required:["modelType","iterations","results","statistics"],structure:{modelType:"string",iterations:"number",results:"array",statistics:"object",metadata:"object"}},userPreferences:{version:"1.0",required:["theme","layout"],structure:{theme:"string",layout:"object",notifications:"object",privacy:"object"}},marketData:{version:"1.0",required:["symbol","data","timestamp"],structure:{symbol:"string",data:"object",timestamp:"number",source:"string"}}};const Qe=new class{constructor(){this.isAvailable=this.checkStorageAvailability(),this.compressionWorker=null,this.initializeCompression(),this.setupQuotaMonitoring()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return we.log("ERROR","localStorage not available",{error:e.message}),!1}}initializeCompression(){"CompressionStream"in window?this.compressionAvailable=!0:this.compressionAvailable=!1}setupQuotaMonitoring(){"storage"in navigator&&"estimate"in navigator.storage&&this.monitorQuota()}async monitorQuota(){try{const e=await navigator.storage.estimate(),s=e.usage/e.quota;s>Ye.cleanupThreshold&&(we.log("WARN","Storage quota threshold exceeded",{usage:e.usage,quota:e.quota,ratio:s}),await this.performCleanup())}catch(e){we.log("ERROR","Failed to monitor storage quota",{error:e.message})}}generateKey(e,s){return`${_e}${e}_${s}`}validateData(e,s){const t=He[s];if(!t)throw new Error(`Unknown schema type: ${s}`);for(const a of t.required)if(!(a in e))throw new Error(`Missing required field: ${a}`);for(const[a,r]of Object.entries(t.structure))if(a in e){const s=Array.isArray(e[a])?"array":typeof e[a];if(s!==r)throw new Error(`Invalid type for ${a}: expected ${r}, got ${s}`)}return!0}async compressData(e){const s=JSON.stringify(e);if(s.length<Ke.threshold||!this.compressionAvailable)return{data:s,compressed:!1};try{return{data:await this.simpleCompress(s),compressed:!0}}catch(t){return we.log("WARN","Compression failed, storing uncompressed",{error:t.message}),{data:s,compressed:!1}}}async simpleCompress(e){return btoa(encodeURIComponent(e))}async decompressData(e,s){if(!s)return e;try{return decodeURIComponent(atob(e))}catch(t){throw we.log("ERROR","Decompression failed",{error:t.message}),new Error("Failed to decompress data")}}async setItem(e,s,t,a={}){if(!this.isAvailable)throw new Error("Storage not available");try{He[e]&&this.validateData(t,e);const r={version:We,schemaVersion:He[e]?.version||"1.0",timestamp:Date.now(),data:t,metadata:{type:e,identifier:s,size:JSON.stringify(t).length,...a.metadata}},{data:l,compressed:i}=await this.compressData(r),n={compressed:i,data:l},c=this.generateKey(e,s);return localStorage.setItem(c,JSON.stringify(n)),we.log("DEBUG","Data stored successfully",{key:c,type:e,identifier:s,compressed:i,size:l.length}),!0}catch(r){throw we.log("ERROR","Failed to store data",{type:e,identifier:s,error:r.message}),r}}async getItem(e,s){if(!this.isAvailable)return null;try{const t=this.generateKey(e,s),a=localStorage.getItem(t);if(!a)return null;const r=JSON.parse(a),l=await this.decompressData(r.data,r.compressed),i=JSON.parse(l);return i.version!==We&&we.log("WARN","Version mismatch detected",{stored:i.version,current:We}),we.log("DEBUG","Data retrieved successfully",{key:t,type:e,identifier:s,age:Date.now()-i.timestamp}),i.data}catch(t){return we.log("ERROR","Failed to retrieve data",{type:e,identifier:s,error:t.message}),null}}removeItem(e,s){if(!this.isAvailable)return!1;try{const t=this.generateKey(e,s);return localStorage.removeItem(t),we.log("DEBUG","Data removed successfully",{key:t,type:e,identifier:s}),!0}catch(t){return we.log("ERROR","Failed to remove data",{type:e,identifier:s,error:t.message}),!1}}listItems(e){if(!this.isAvailable)return[];const s=this.generateKey(e,""),t=[];for(let a=0;a<localStorage.length;a++){const e=localStorage.key(a);if(e&&e.startsWith(s)){const a=e.replace(s,"");t.push(a)}}return t}async performCleanup(){const e=Date.now()-2592e6;let s=0;for(let a=localStorage.length-1;a>=0;a--){const r=localStorage.key(a);if(r&&r.startsWith(_e))try{const t=localStorage.getItem(r),a=JSON.parse(t),l=await this.decompressData(a.data,a.compressed);JSON.parse(l).timestamp<e&&(localStorage.removeItem(r),s++)}catch(t){localStorage.removeItem(r),s++}}return we.log("INFO","Storage cleanup completed",{cleanedCount:s}),s}async getStorageStats(){let e=0,s=0;const t={};for(let r=0;r<localStorage.length;r++){const a=localStorage.key(r);if(a&&a.startsWith(_e)){e+=localStorage.getItem(a).length,s++;const r=a.split("_")[1];r&&(t[r]=(t[r]||0)+1)}}const a=await this.getQuotaInfo();return{totalSize:e,itemCount:s,typeStats:t,quota:a,usageRatio:a?e/a.quota:0}}async getQuotaInfo(){if("storage"in navigator&&"estimate"in navigator.storage)try{return await navigator.storage.estimate()}catch(e){we.log("ERROR","Failed to get quota info",{error:e.message})}return null}clearAll(){if(!this.isAvailable)return!1;const e=[];for(let s=0;s<localStorage.length;s++){const t=localStorage.key(s);t&&t.startsWith(_e)&&e.push(t)}return e.forEach(e=>localStorage.removeItem(e)),we.log("INFO","All application data cleared",{clearedCount:e.length}),!0}};const Je=new class{constructor(){this.storage=Qe}async saveDCFModel(e,s){try{const t={symbol:e.toUpperCase(),assumptions:s.assumptions||{},projections:s.projections||{},valuation:s.valuation||{},metadata:{createdAt:Date.now(),lastModified:Date.now(),version:"1.0",modelType:"DCF",...s.metadata}};return await this.storage.setItem("dcfModel",e.toUpperCase(),t),we.log("INFO","DCF model saved",{symbol:e,valuation:t.valuation.intrinsicValue}),!0}catch(t){throw we.log("ERROR","Failed to save DCF model",{symbol:e,error:t.message}),t}}async getDCFModel(e){try{const s=await this.storage.getItem("dcfModel",e.toUpperCase());return s&&we.log("DEBUG","DCF model retrieved",{symbol:e}),s}catch(s){return we.log("ERROR","Failed to retrieve DCF model",{symbol:e,error:s.message}),null}}async listDCFModels(){return this.storage.listItems("dcfModel")}async deleteDCFModel(e){return this.storage.removeItem("dcfModel",e.toUpperCase())}async saveLBOModel(e,s){try{const t={symbol:e.toUpperCase(),transaction:s.transaction||{},financing:s.financing||{},returns:s.returns||{},metadata:{createdAt:Date.now(),lastModified:Date.now(),version:"1.0",modelType:"LBO",...s.metadata}};return await this.storage.setItem("lboModel",e.toUpperCase(),t),we.log("INFO","LBO model saved",{symbol:e,irr:t.returns.irr,moic:t.returns.moic}),!0}catch(t){throw we.log("ERROR","Failed to save LBO model",{symbol:e,error:t.message}),t}}async getLBOModel(e){try{const s=await this.storage.getItem("lboModel",e.toUpperCase());return s&&we.log("DEBUG","LBO model retrieved",{symbol:e}),s}catch(s){return we.log("ERROR","Failed to retrieve LBO model",{symbol:e,error:s.message}),null}}async listLBOModels(){return this.storage.listItems("lboModel")}async deleteLBOModel(e){return this.storage.removeItem("lboModel",e.toUpperCase())}async saveMonteCarloResults(e,s){try{const t={modelType:s.modelType||"DCF",iterations:s.iterations||1e4,results:s.results||[],statistics:s.statistics||{},metadata:{createdAt:Date.now(),modelId:e,symbol:s.symbol,version:"1.0",...s.metadata}};return await this.storage.setItem("monteCarloResults",e,t),we.log("INFO","Monte Carlo results saved",{modelId:e,iterations:t.iterations,mean:t.statistics.mean}),!0}catch(t){throw we.log("ERROR","Failed to save Monte Carlo results",{modelId:e,error:t.message}),t}}async getMonteCarloResults(e){try{const s=await this.storage.getItem("monteCarloResults",e);return s&&we.log("DEBUG","Monte Carlo results retrieved",{modelId:e}),s}catch(s){return we.log("ERROR","Failed to retrieve Monte Carlo results",{modelId:e,error:s.message}),null}}async listMonteCarloResults(){return this.storage.listItems("monteCarloResults")}async deleteMonteCarloResults(e){return this.storage.removeItem("monteCarloResults",e)}async saveMarketData(e,s,t=15){try{const a={symbol:e.toUpperCase(),data:s,timestamp:Date.now(),source:s.source||"unknown",expiresAt:Date.now()+60*t*1e3};return await this.storage.setItem("marketData",e.toUpperCase(),a),we.log("DEBUG","Market data cached",{symbol:e,source:a.source,ttlMinutes:t}),!0}catch(a){throw we.log("ERROR","Failed to cache market data",{symbol:e,error:a.message}),a}}async getMarketData(e){try{const s=await this.storage.getItem("marketData",e.toUpperCase());return s&&s.expiresAt>Date.now()?(we.log("DEBUG","Market data cache hit",{symbol:e}),s.data):(s&&(await this.deleteMarketData(e),we.log("DEBUG","Market data cache expired",{symbol:e})),null)}catch(s){return we.log("ERROR","Failed to retrieve market data",{symbol:e,error:s.message}),null}}async deleteMarketData(e){return this.storage.removeItem("marketData",e.toUpperCase())}async saveUserPreferences(e){try{const s={theme:e.theme||"light",layout:e.layout||{},notifications:e.notifications||{},privacy:e.privacy||{},metadata:{lastUpdated:Date.now(),version:"1.0"}};return await this.storage.setItem("userPreferences","default",s),we.log("INFO","User preferences saved",{theme:s.theme}),!0}catch(s){throw we.log("ERROR","Failed to save user preferences",{error:s.message}),s}}async getUserPreferences(){try{const e=await this.storage.getItem("userPreferences","default");return e&&we.log("DEBUG","User preferences retrieved"),e}catch(e){return we.log("ERROR","Failed to retrieve user preferences",{error:e.message}),null}}async saveWatchlist(e,s){try{const t={name:e,symbols:s.map(e=>e.toUpperCase()),metadata:{createdAt:Date.now(),lastModified:Date.now(),symbolCount:s.length}};return await this.storage.setItem("watchlist",e,t),we.log("INFO","Watchlist saved",{name:e,symbolCount:s.length}),!0}catch(t){throw we.log("ERROR","Failed to save watchlist",{name:e,error:t.message}),t}}async getWatchlist(e){try{const s=await this.storage.getItem("watchlist",e);return s&&we.log("DEBUG","Watchlist retrieved",{name:e}),s}catch(s){return we.log("ERROR","Failed to retrieve watchlist",{name:e,error:s.message}),null}}async listWatchlists(){return this.storage.listItems("watchlist")}async deleteWatchlist(e){return this.storage.removeItem("watchlist",e)}async exportAllData(){try{const e={timestamp:Date.now(),version:"1.0",data:{dcfModels:{},lboModels:{},monteCarloResults:{},watchlists:{},userPreferences:null}},s=await this.listDCFModels();for(const l of s)e.data.dcfModels[l]=await this.getDCFModel(l);const t=await this.listLBOModels();for(const l of t)e.data.lboModels[l]=await this.getLBOModel(l);const a=await this.listMonteCarloResults();for(const l of a)e.data.monteCarloResults[l]=await this.getMonteCarloResults(l);const r=await this.listWatchlists();for(const l of r)e.data.watchlists[l]=await this.getWatchlist(l);return e.data.userPreferences=await this.getUserPreferences(),we.log("INFO","Data export completed",{dcfCount:s.length,lboCount:t.length,mcCount:a.length,watchlistCount:r.length}),e}catch(e){throw we.log("ERROR","Failed to export data",{error:e.message}),e}}async importData(e){try{let s=0;if(e.data.dcfModels)for(const[t,a]of Object.entries(e.data.dcfModels))await this.saveDCFModel(t,a),s++;if(e.data.lboModels)for(const[t,a]of Object.entries(e.data.lboModels))await this.saveLBOModel(t,a),s++;if(e.data.monteCarloResults)for(const[t,a]of Object.entries(e.data.monteCarloResults))await this.saveMonteCarloResults(t,a),s++;if(e.data.watchlists)for(const[t,a]of Object.entries(e.data.watchlists))await this.saveWatchlist(t,a.symbols),s++;return e.data.userPreferences&&(await this.saveUserPreferences(e.data.userPreferences),s++),we.log("INFO","Data import completed",{importCount:s}),s}catch(s){throw we.log("ERROR","Failed to import data",{error:s.message}),s}}async getFinancialDataStats(){return{...await this.storage.getStorageStats(),financialData:{dcfModels:(await this.listDCFModels()).length,lboModels:(await this.listLBOModels()).length,monteCarloResults:(await this.listMonteCarloResults()).length,watchlists:(await this.listWatchlists()).length}}}async cleanupExpiredMarketData(){const e=this.storage.listItems("marketData");let s=0;for(const t of e){const e=await this.storage.getItem("marketData",t);e&&e.expiresAt<=Date.now()&&(await this.deleteMarketData(t),s++)}return we.log("INFO","Expired market data cleaned",{cleanedCount:s}),s}},Xe=({data:t,onDataChange:a,savedAnalyses:l,onAnalysesChange:n})=>{const[c,o]=e.useState("excel"),[d,m]=e.useState(!1),[x,u]=e.useState(!1),[h,p]=e.useState(null),[g,b]=e.useState(null),[j,y]=e.useState(null),[f,N]=e.useState([{id:1,name:"Standard 3-Statement Model",category:"General",lastUsed:"2024-01-15",uses:42},{id:2,name:"SaaS DCF Template",category:"Technology",lastUsed:"2024-01-10",uses:28},{id:3,name:"LBO Analysis Template",category:"Private Equity",lastUsed:"2024-01-05",uses:35}]),[C,k]=e.useState([{id:1,name:"John Smith",email:"john@company.com",role:"Analyst",lastActive:"2 min ago",avatar:"JS"},{id:2,name:"Sarah Johnson",email:"sarah@company.com",role:"VP",lastActive:"1 hour ago",avatar:"SJ"}]);i.useEffect(()=>{M()},[]);const M=async()=>{try{const e=await Je.getFinancialDataStats();y(e)}catch(e){we.log("ERROR","Failed to load storage stats",{error:e.message})}},R=async()=>{m(!0),p(null);try{const e=await Je.exportAllData(),s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`financeanalyst_backup_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),p({type:"success",message:"Data exported successfully",details:{dcfModels:Object.keys(e.data.dcfModels).length,lboModels:Object.keys(e.data.lboModels).length,monteCarloResults:Object.keys(e.data.monteCarloResults).length,watchlists:Object.keys(e.data.watchlists).length}}),we.log("INFO","Data export completed",{totalItems:Object.keys(e.data.dcfModels).length+Object.keys(e.data.lboModels).length+Object.keys(e.data.monteCarloResults).length+Object.keys(e.data.watchlists).length})}catch(e){p({type:"error",message:"Export failed",details:e.message}),we.log("ERROR","Data export failed",{error:e.message})}finally{m(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Data Management"}),s.jsx("button",{onClick:onClose,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"×"})]}),s.jsx("div",{className:"border-b border-gray-200",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"excel",label:"Excel Integration",icon:K},{id:"templates",label:"Templates",icon:Y},{id:"collaboration",label:"Collaboration",icon:w},{id:"export",label:"Export",icon:D},{id:"import",label:"Import",icon:H},{id:"stats",label:"Statistics",icon:Q}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>o(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+(c===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(t,{className:"w-4 h-4"}),s.jsx("span",{children:e.label})]},e.id)})})}),s.jsxs("div",{className:"p-6",children:["excel"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(v,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Excel Integration"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Connect your Excel spreadsheets to FinanceAnalyst for seamless data synchronization."})]})]})}),s.jsx("button",{onClick:R,disabled:d,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:d?s.jsxs(s.Fragment,{children:[s.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{className:"w-4 h-4 mr-2"}),"Export All Data"]})}),h&&s.jsx("div",{className:"border rounded-lg p-4 "+("success"===h.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:s.jsxs("div",{className:"flex items-start",children:["success"===h.type?s.jsx(T,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):s.jsx(L,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium "+("success"===h.type?"text-green-900":"text-red-900"),children:h.message}),"success"===h.type&&h.details&&s.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[s.jsx("p",{children:"Exported items:"}),s.jsxs("ul",{className:"list-disc list-inside ml-4",children:[s.jsxs("li",{children:[h.details.dcfModels," DCF Models"]}),s.jsxs("li",{children:[h.details.lboModels," LBO Models"]}),s.jsxs("li",{children:[h.details.monteCarloResults," Monte Carlo Results"]}),s.jsxs("li",{children:[h.details.watchlists," Watchlists"]})]})]}),"error"===h.type&&s.jsx("p",{className:"text-sm text-red-700 mt-1",children:h.details})]})]})})]}),"templates"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Templates"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map(e=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.category}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Last used: ",e.lastUsed]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Uses: ",e.uses]})]},e.id))})]}),"collaboration"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Collaboration"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.map(e=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.email}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Role: ",e.role]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Last active: ",e.lastActive]})]},e.id))})]}),"export"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(v,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Export Your Data"}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Download all your financial models, analysis results, and preferences as a backup file."})]})]})}),s.jsx("button",{onClick:R,disabled:d,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:d?s.jsxs(s.Fragment,{children:[s.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{className:"w-4 h-4 mr-2"}),"Export All Data"]})}),h&&s.jsx("div",{className:"border rounded-lg p-4 "+("success"===h.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:s.jsxs("div",{className:"flex items-start",children:["success"===h.type?s.jsx(T,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):s.jsx(L,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium "+("success"===h.type?"text-green-900":"text-red-900"),children:h.message}),"success"===h.type&&h.details&&s.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[s.jsx("p",{children:"Exported items:"}),s.jsxs("ul",{className:"list-disc list-inside ml-4",children:[s.jsxs("li",{children:[h.details.dcfModels," DCF Models"]}),s.jsxs("li",{children:[h.details.lboModels," LBO Models"]}),s.jsxs("li",{children:[h.details.monteCarloResults," Monte Carlo Results"]}),s.jsxs("li",{children:[h.details.watchlists," Watchlists"]})]})]}),"error"===h.type&&s.jsx("p",{className:"text-sm text-red-700 mt-1",children:h.details})]})]})})]}),"import"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(L,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-amber-900",children:"Import Data"}),s.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"Import data from a backup file. This will add to your existing data."})]})]})}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[s.jsx(r,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsxs("label",{className:"cursor-pointer",children:[s.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Choose backup file"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Select a JSON backup file to import"}),s.jsx("input",{type:"file",accept:".json",onChange:async e=>{const s=e.target.files[0];if(s){u(!0),b(null);try{const e=await s.text(),t=JSON.parse(e);if(!t.data||!t.version)throw new Error("Invalid backup file format");const a=await Je.importData(t);b({type:"success",message:"Data imported successfully",details:{importCount:a,timestamp:new Date(t.timestamp).toLocaleString()}}),await M(),we.log("INFO","Data import completed",{importCount:a})}catch(t){b({type:"error",message:"Import failed",details:t.message}),we.log("ERROR","Data import failed",{error:t.message})}finally{u(!1),e.target.value=""}}},disabled:x,className:"hidden"})]})]}),x&&s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx(J,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Importing data..."})]}),g&&s.jsx("div",{className:"border rounded-lg p-4 "+("success"===g.type?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:s.jsxs("div",{className:"flex items-start",children:["success"===g.type?s.jsx(T,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}):s.jsx(L,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium "+("success"===g.type?"text-green-900":"text-red-900"),children:g.message}),"success"===g.type&&g.details&&s.jsxs("div",{className:"text-sm text-green-700 mt-2",children:[s.jsxs("p",{children:["Imported ",g.details.importCount," items"]}),s.jsxs("p",{children:["Backup created: ",g.details.timestamp]})]}),"error"===g.type&&s.jsx("p",{className:"text-sm text-red-700 mt-1",children:g.details})]})]})})]}),"stats"===c&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Storage Statistics"}),j?s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Storage Usage"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Size:"}),s.jsx("span",{className:"font-medium",children:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(j.totalSize)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Total Items:"}),s.jsx("span",{className:"font-medium",children:j.itemCount})]}),j.quota&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Usage:"}),s.jsxs("span",{className:"font-medium",children:[(100*j.usageRatio).toFixed(1),"%"]})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Financial Data"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"DCF Models:"}),s.jsx("span",{className:"font-medium",children:j.financialData.dcfModels})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"LBO Models:"}),s.jsx("span",{className:"font-medium",children:j.financialData.lboModels})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Monte Carlo Results:"}),s.jsx("span",{className:"font-medium",children:j.financialData.monteCarloResults})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Watchlists:"}),s.jsx("span",{className:"font-medium",children:j.financialData.watchlists})]})]})]})]}):s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx(J,{className:"w-6 h-6 animate-spin text-blue-600 mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Loading statistics..."})]})]})]})]})})};class Ze extends i.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,s){}render(){return this.state.hasError?this.props.fallback||s.jsx("div",{className:"p-8 text-center text-red-400",children:"Something went wrong. Please refresh the page."}):this.props.children}}const es=()=>{const[t,a]=e.useState("spreadsheet"),[l,i]=e.useState({lbo:null,threeStatement:null,scenarios:null,marketData:null,monteCarlo:null}),[n,c]=e.useState(ke),[o,d]=e.useState({}),[m,x]=e.useState({dcf:{discountRate:10,terminalGrowthRate:2.5,projectionYears:5,taxRate:25},scenario:{scenarios:[]}}),[u,p]=e.useState(!1),[g,b]=e.useState(null),[j,y]=e.useState(()=>{try{const e=localStorage.getItem("privateAnalyses");return e?JSON.parse(e):[]}catch(e){return[]}}),[f,v]=e.useState(!1),[N,w]=e.useState("ready"),[C,k]=e.useState(null),M=()=>{if(!n?.statements)return 0;let e=0,s=0;["totalRevenue","totalCostOfGoodsSold","operatingIncome","netIncome"].forEach(t=>{s+=3,void 0!==n.statements.incomeStatement?.[t]?.[2]&&(e+=3)}),["totalAssets","totalLiabilities","totalEquity"].forEach(t=>{s+=2,void 0!==n.statements.balanceSheet?.[t]?.[2]&&(e+=2)}),["operatingCashFlow","investingCashFlow","financingCashFlow"].forEach(t=>{s+=2,void 0!==n.statements.cashFlow?.[t]?.[2]&&(e+=2)});const t=Math.round(e/s*100);return void 0!==n?.statements?.incomeStatement?.totalRevenue?.[2]&&void 0!==n?.statements?.incomeStatement?.operatingIncome?.[2]?Math.max(t,80):t},R=()=>{let e=0;m?.dcf?.discountRate&&m?.dcf?.terminalGrowthRate&&(e+=40);return M()>=80&&(e+=20),m?.scenario?.scenarios&&m.scenario.scenarios.length>0&&(e+=20),(l.lbo||l.threeStatement||l.monteCarlo)&&(e+=20),Math.min(e,100)},S=()=>{let e=0;return n?.statements?.incomeStatement&&(e+=30),l.lbo&&(e+=20),l.threeStatement&&(e+=20),l.scenarios&&(e+=15),l.monteCarlo&&(e+=15),Math.min(e,100)};e.useEffect(()=>{S()>60&&!u&&p(!0)},[n,l,u]);const F=({status:e,label:t})=>s.jsxs("div",{className:`flex items-center gap-2 ${(()=>{switch(e){case"ready":return"text-green-400";case"modified":return"text-yellow-400";case"saving":return"text-blue-400";case"error":return"text-red-400";default:return"text-gray-400"}})()}`,children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-current animate-pulse"}),s.jsx("span",{className:"text-sm",children:t})]}),D=[{id:"spreadsheet",label:"Financial Spreadsheet",icon:Q},{id:"modeling",label:"Financial Modeling",icon:h},{id:"analysis",label:"Analysis & Results",icon:r},{id:"lbo",label:"Advanced LBO",icon:h},{id:"threestatement",label:"3-Statement Model",icon:Q},{id:"scenarios",label:"Scenario Analysis",icon:h},{id:"marketdata",label:"Market Data",icon:h},{id:"montecarlo",label:"Monte Carlo",icon:h},{id:"import-export",label:"Import/Export",icon:H}];return s.jsxs("div",{className:"min-h-screen bg-slate-900 relative",children:[s.jsx(ae,{title:"Private Analysis Suite | FinanceAnalyst Pro",description:"Comprehensive financial analysis platform with advanced modeling tools, scenario analysis, Monte Carlo simulation, and private equity workflows.",canonical:"/private-analysis",keywords:"private analysis, financial modeling, scenario analysis, Monte Carlo simulation, LBO analysis, private equity tools"}),s.jsx(se,{}),s.jsxs("main",{id:"main-content",className:"container mx-auto px-4 py-8",role:"main",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h1",{className:"text-3xl font-bold text-white",children:"Private Analysis"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(F,{status:N,label:"ready"===N?"Ready":"saving"===N?"Saving...":"Modified"}),C&&s.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[s.jsx(X,{className:"w-4 h-4"}),s.jsxs("span",{className:"text-sm",children:["Saved ",C.toLocaleTimeString()]})]}),s.jsxs(te,{onClick:()=>(async e=>{try{v(!0),w("saving");const t={id:Date.now().toString(),name:e||`Analysis ${(new Date).toLocaleDateString()}`,timestamp:(new Date).toISOString(),financialData:n,adjustedValues:o,modelInputs:m,advancedResults:l,dataCompleteness:M(),modelingProgress:R(),analysisProgress:S()},a=[...j,t];y(a);try{localStorage.setItem("privateAnalyses",JSON.stringify(a))}catch(s){throw new Error("Failed to save analysis to localStorage")}w("ready"),k(new Date)}catch(s){w("error")}finally{v(!1)}})(),disabled:f,className:"flex items-center gap-2",variant:"primary",children:[s.jsx(Z,{className:"w-4 h-4"}),f?"Saving...":"Save"]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-gray-400",children:"Data Completeness"}),s.jsxs("span",{className:"text-white font-semibold",children:[M(),"%"]})]}),s.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-500",style:{width:`${M()}%`}})})]}),s.jsxs("div",{className:"bg-slate-800 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-gray-400",children:"Analysis Progress"}),s.jsxs("span",{className:"text-white font-semibold",children:[S(),"%"]})]}),s.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:s.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-500",style:{width:`${S()}%`}})})]})]})]}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"flex flex-wrap gap-2 p-1 bg-slate-800 rounded-lg",children:D.map(e=>{const r=e.icon;return s.jsxs("button",{onClick:()=>a(e.id),className:`\n                    flex items-center gap-2 px-4 py-2 rounded-md transition-all duration-200\n                    ${t===e.id?"bg-blue-600 text-white shadow-lg":"text-gray-300 hover:text-white hover:bg-slate-700"}\n                  `,children:[s.jsx(r,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:e.label})]},e.id)})})}),s.jsx("div",{className:"relative",children:s.jsxs(re.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:["spreadsheet"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading spreadsheet. Please refresh the page."}),children:s.jsx(Fe,{data:n,onDataChange:c,onAdjustedValuesChange:d})}),"modeling"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading modeling tools. Please refresh the page."}),children:s.jsx(Te,{data:n,adjustedValues:o,onDataChange:c})}),"analysis"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading analysis results. Please check your data and refresh."}),children:s.jsx(Be,{data:n,adjustedValues:o,modelInputs:m,calculateDCF:e=>ee(e,m),formatCurrency:Re,formatPercentage:Me})}),"lbo"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading LBO tool. Please check your data."}),children:s.jsx(qe,{data:n,onDataChange:e=>i(s=>({...s,lbo:e}))})}),"threestatement"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading financial model workspace."}),children:s.jsx(Le,{data:n,onDataChange:e=>i(s=>({...s,threeStatement:e}))})}),"scenarios"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading scenario analysis."}),children:s.jsx(ze,{data:n,onDataChange:e=>i(s=>({...s,scenarios:e})),calculateDCF:e=>ee(e,m),lboModelingEngine:null})}),"marketdata"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading market data dashboard."}),children:s.jsx(Ge,{data:n,onDataChange:e=>i(s=>({...s,marketData:e}))})}),"montecarlo"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading Monte Carlo integration."}),children:s.jsx($e,{data:n,dcfResults:l.dcf,lboResults:l.lbo,financialModel:l.threeStatement,scenarioResults:l.scenarios,onDataChange:e=>i(s=>({...s,monteCarlo:e}))})}),"import-export"===t&&s.jsx(Ze,{fallback:s.jsx("div",{className:"p-8 text-center text-red-400",children:"Error loading import/export tools."}),children:s.jsx(Xe,{data:n,onDataChange:c,savedAnalyses:j,onAnalysesChange:y})})]},t)}),s.jsx(Ue,{financialData:n,currentMetric:g,analysisContext:"analysis"===t?"dcf":t,onInsightClick:e=>{b(e.metric)},isVisible:u,onToggle:()=>{p(!u)}})]})]})};export{es as default};
//# sourceMappingURL=PrivateAnalysis-NeQwhiBW.js.map
