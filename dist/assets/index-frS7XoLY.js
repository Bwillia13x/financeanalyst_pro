import{r as e,j as s}from"./react-DbKEDq5F.js";import{S as a,B as t,I as r,a as i,H as n,c as l}from"./ui-components-DUPitwH-.js";import{S as o}from"./valuation-tools-CH5aoDQV.js";import{R as c,B as d,C as m,X as x,Y as u,T as h,b as p,S as v,g as f,A as b,f as j,a as g}from"./recharts-vendor-CMq9LHd_.js";import"./ui-charts-CcCRCYtT.js";import"./utils-vendor-DofaKlSJ.js";import"./react-router-CGJIHeCu.js";import"./vendor-DYwn_Zoo.js";import"./animations-DmEkbmfl.js";import"./seo-vendor-85CQXWAt.js";import"./d3-vendor-C2v6EsNF.js";const N=({simulationResults:i,isSimulating:n})=>{const[l,o]=e.useState("distribution"),[N,y]=e.useState("enterprise_value"),w={summary:{mean:2847.5,median:2823.1,stdDev:456.2,percentile5:2156.7,percentile95:3687.4,iterations:1e4},distribution:Array.from({length:50},(e,s)=>({value:1500+60*s,frequency:Math.max(0,Math.round(200*Math.exp(-Math.pow((s-25)/10,2))))})),tornado:[{variable:"Revenue Growth",impact:847.2,direction:"positive"},{variable:"Terminal Growth",impact:623.8,direction:"positive"},{variable:"WACC",impact:-567.4,direction:"negative"},{variable:"Margin Expansion",impact:445.6,direction:"positive"},{variable:"CapEx Ratio",impact:-334.2,direction:"negative"},{variable:"Working Capital",impact:-187.9,direction:"negative"}],scatter:Array.from({length:1e3},(e,s)=>({revenueGrowth:.05+.3*Math.random(),enterpriseValue:1800+2e3*Math.random()+500*(Math.random()-.5)})),timeSeries:Array.from({length:20},(e,s)=>({iteration:500*(s+1),mean:2800+50*Math.sin(.5*s)+20*Math.random(),confidence95:3600+60*Math.sin(.5*s)+30*Math.random(),confidence5:2e3+40*Math.sin(.5*s)+20*Math.random()}))},S=i||w,M=[{value:"enterprise_value",label:"Enterprise Value ($M)"},{value:"equity_value",label:"Equity Value ($M)"},{value:"share_price",label:"Share Price ($)"},{value:"irr",label:"Internal Rate of Return (%)"},{value:"multiple",label:"EV/EBITDA Multiple"}];return s.jsxs("div",{className:"h-full flex flex-col bg-card",children:[s.jsx("div",{className:"p-6 border-b border-border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Simulation Results"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(a,{options:M,value:N,onChange:y,className:"w-48",disabled:n}),s.jsx(a,{options:[{value:"pdf",label:"PDF Report"},{value:"excel",label:"Excel Workbook"},{value:"csv",label:"CSV Data"},{value:"png",label:"PNG Image"}],value:"pdf",onChange:()=>{},className:"w-32",disabled:n}),s.jsx(t,{variant:"outline",iconName:"Download",disabled:n,children:"Export"})]})]})}),s.jsx("div",{className:"border-b border-border",children:s.jsx("div",{className:"flex",children:[{value:"distribution",label:"Distribution",icon:"BarChart3"},{value:"tornado",label:"Tornado Chart",icon:"BarChart2"},{value:"scatter",label:"Scatter Plot",icon:"Scatter3D"},{value:"convergence",label:"Convergence",icon:"TrendingUp"}].map(e=>s.jsxs("button",{onClick:()=>o(e.value),className:"flex items-center space-x-2 px-6 py-3 text-sm font-medium transition-smooth "+(l===e.value?"border-b-2 border-primary text-primary":"text-muted-foreground hover:text-foreground"),disabled:n,children:[s.jsx(r,{name:e.icon,size:16}),s.jsx("span",{children:e.label})]},e.value))})}),s.jsx("div",{className:"p-6 border-b border-border bg-muted/30",children:s.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-foreground",children:["$",(S.summary.mean/1e3).toFixed(1),"B"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Mean Value"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-foreground",children:["$",(S.summary.median/1e3).toFixed(1),"B"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Median Value"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-foreground",children:["Â±$",(S.summary.stdDev/1e3).toFixed(1),"B"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Std Deviation"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-success",children:["$",(S.summary.percentile95/1e3).toFixed(1),"B"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"95th Percentile"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-error",children:["$",(S.summary.percentile5/1e3).toFixed(1),"B"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"5th Percentile"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-foreground",children:S.summary.iterations.toLocaleString()}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Iterations"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsxs("div",{className:"text-center space-y-4",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),s.jsx("div",{className:"text-lg font-medium text-foreground",children:"Running Simulation..."}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Calculating Monte Carlo scenarios with ",S.summary.iterations.toLocaleString()," ","iterations"]})]})}):s.jsxs(s.Fragment,{children:["distribution"===l&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Value Distribution"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(t,{variant:"ghost",size:"sm",iconName:"ZoomIn"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"ZoomOut"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"RotateCcw"})]})]}),s.jsx("div",{className:"h-80",children:s.jsx(c,{width:"100%",height:"100%",children:s.jsxs(d,{data:S.distribution,children:[s.jsx(m,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),s.jsx(x,{dataKey:"value",stroke:"var(--color-muted-foreground)",fontSize:12,tickFormatter:e=>`$${(e/1e3).toFixed(1)}B`}),s.jsx(u,{stroke:"var(--color-muted-foreground)",fontSize:12}),s.jsx(h,{formatter:(e,s)=>[`${e} simulations`,"Frequency"],labelFormatter:e=>`Value: $${(e/1e3).toFixed(1)}B`,contentStyle:{backgroundColor:"var(--color-popover)",border:"1px solid var(--color-border)",borderRadius:"8px"}}),s.jsx(p,{dataKey:"frequency",fill:"var(--color-primary)",radius:[2,2,0,0]})]})})})]}),"tornado"===l&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Sensitivity Analysis"}),s.jsx(a,{options:[{value:"absolute",label:"Absolute Impact"},{value:"percentage",label:"Percentage Impact"}],value:"absolute",onChange:()=>{},className:"w-40"})]}),s.jsx("div",{className:"h-80",children:s.jsx(c,{width:"100%",height:"100%",children:s.jsxs(d,{data:S.tornado,layout:"horizontal",margin:{left:100},children:[s.jsx(m,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),s.jsx(x,{type:"number",stroke:"var(--color-muted-foreground)",fontSize:12,tickFormatter:e=>`$${Math.abs(e).toFixed(0)}M`}),s.jsx(u,{type:"category",dataKey:"variable",stroke:"var(--color-muted-foreground)",fontSize:12,width:90}),s.jsx(h,{formatter:(e,s)=>[`$${Math.abs(e).toFixed(1)}M`,"Impact"],contentStyle:{backgroundColor:"var(--color-popover)",border:"1px solid var(--color-border)",borderRadius:"8px"}}),s.jsx(p,{dataKey:"impact",fill:e=>"positive"===e.direction?"var(--color-success)":"var(--color-error)",radius:[0,2,2,0]})]})})})]}),"scatter"===l&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Variable Correlation"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(a,{options:[{value:"revenue_growth",label:"Revenue Growth"},{value:"margin_expansion",label:"Margin Expansion"},{value:"terminal_growth",label:"Terminal Growth"}],value:"revenue_growth",onChange:()=>{},className:"w-40"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"vs"}),s.jsx(a,{options:M,value:N,onChange:y,className:"w-40"})]})]}),s.jsx("div",{className:"h-80",children:s.jsx(c,{width:"100%",height:"100%",children:s.jsxs(v,{data:S.scatter,children:[s.jsx(m,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),s.jsx(x,{dataKey:"revenueGrowth",stroke:"var(--color-muted-foreground)",fontSize:12,tickFormatter:e=>`${(100*e).toFixed(0)}%`}),s.jsx(u,{dataKey:"enterpriseValue",stroke:"var(--color-muted-foreground)",fontSize:12,tickFormatter:e=>`$${(e/1e3).toFixed(1)}B`}),s.jsx(h,{formatter:(e,s)=>["revenueGrowth"===s?`${(100*e).toFixed(1)}%`:`$${(e/1e3).toFixed(1)}B`,"revenueGrowth"===s?"Revenue Growth":"Enterprise Value"],contentStyle:{backgroundColor:"var(--color-popover)",border:"1px solid var(--color-border)",borderRadius:"8px"}}),s.jsx(f,{dataKey:"enterpriseValue",fill:"var(--color-secondary)",fillOpacity:.6})]})})})]}),"convergence"===l&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Monte Carlo Convergence"}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[s.jsx(r,{name:"TrendingUp",size:16}),s.jsx("span",{children:"Convergence achieved at 8,500 iterations"})]})]}),s.jsx("div",{className:"h-80",children:s.jsx(c,{width:"100%",height:"100%",children:s.jsxs(b,{data:S.timeSeries,children:[s.jsx(m,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),s.jsx(x,{dataKey:"iteration",stroke:"var(--color-muted-foreground)",fontSize:12,tickFormatter:e=>`${(e/1e3).toFixed(0)}K`}),s.jsx(u,{stroke:"var(--color-muted-foreground)",fontSize:12,tickFormatter:e=>`$${(e/1e3).toFixed(1)}B`}),s.jsx(h,{formatter:(e,s)=>[`$${(e/1e3).toFixed(2)}B`,s],labelFormatter:e=>`Iteration: ${e.toLocaleString()}`,contentStyle:{backgroundColor:"var(--color-popover)",border:"1px solid var(--color-border)",borderRadius:"8px"}}),s.jsx(j,{dataKey:"confidence95",stroke:"var(--color-primary)",fill:"var(--color-primary)",fillOpacity:.1}),s.jsx(j,{dataKey:"confidence5",stroke:"var(--color-primary)",fill:"var(--color-background)",fillOpacity:1}),s.jsx(g,{dataKey:"mean",stroke:"var(--color-primary)",strokeWidth:2,dot:!1})]})})})]})]})})]})},y=({onScenarioUpdate:n,isSimulating:l})=>{const[o,c]=e.useState("variables"),[d,m]=e.useState([{id:1,name:"Base Case",probability:.4,variables:{revenueGrowth:.15,marginExpansion:.02,capexRatio:.08,terminalGrowth:.025}},{id:2,name:"Bull Case",probability:.3,variables:{revenueGrowth:.25,marginExpansion:.05,capexRatio:.06,terminalGrowth:.035}},{id:3,name:"Bear Case",probability:.3,variables:{revenueGrowth:.05,marginExpansion:-.01,capexRatio:.12,terminalGrowth:.015}}]),[x,u]=e.useState(d[0]),[h,p]=e.useState([{var1:"Revenue Growth",var2:"Margin Expansion",correlation:.65},{var1:"Revenue Growth",var2:"CapEx Ratio",correlation:-.45},{var1:"Margin Expansion",var2:"Terminal Growth",correlation:.35}]),v=[{value:"normal",label:"Normal Distribution"},{value:"triangular",label:"Triangular Distribution"},{value:"uniform",label:"Uniform Distribution"},{value:"lognormal",label:"Log-Normal Distribution"}],f=(e,s)=>{const a={...x,variables:{...x.variables,[e]:parseFloat(s)}};u(a);const t=d.map(e=>e.id===x.id?a:e);m(t),n(t)};return s.jsxs("div",{className:"h-full flex flex-col bg-card border-r border-border",children:[s.jsx("div",{className:"p-6 border-b border-border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Scenario Configuration"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full "+(l?"bg-warning":"bg-success")}),s.jsx("span",{className:"text-sm text-muted-foreground",children:l?"Simulating...":"Ready"})]})]})}),s.jsx("div",{className:"border-b border-border",children:s.jsx("div",{className:"flex",children:[{id:"variables",label:"Variables",icon:"Settings"},{id:"distributions",label:"Distributions",icon:"BarChart3"},{id:"correlations",label:"Correlations",icon:"Network"},{id:"templates",label:"Templates",icon:"FileTemplate"}].map(e=>s.jsxs("button",{onClick:()=>c(e.id),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-smooth "+(o===e.id?"border-b-2 border-primary text-primary":"text-muted-foreground hover:text-foreground"),disabled:l,children:[s.jsx(r,{name:e.icon,size:16}),s.jsx("span",{children:e.label})]},e.id))})}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:["variables"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Scenario Configuration"}),s.jsx(t,{variant:"outline",size:"sm",iconName:"Plus",onClick:()=>{const e={id:d.length+1,name:`Scenario ${d.length+1}`,probability:.1,variables:{...x.variables}};m([...d,e])},disabled:l,children:"Add Scenario"})]}),s.jsx("div",{className:"grid grid-cols-3 gap-2",children:d.map(e=>s.jsxs("button",{onClick:()=>u(e),className:"p-3 rounded-lg border text-left transition-smooth "+(x.id===e.id?"border-primary bg-primary/5 text-primary":"border-border hover:border-primary/50"),disabled:l,children:[s.jsx("div",{className:"font-medium text-sm",children:e.name}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["P: ",(100*e.probability).toFixed(0),"%"]})]},e.id))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Key Variables"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(i,{label:"Revenue Growth Rate",type:"number",value:x.variables.revenueGrowth,onChange:e=>f("revenueGrowth",e.target.value),placeholder:"0.15",disabled:l,description:"Annual revenue growth rate"}),s.jsx(i,{label:"Margin Expansion",type:"number",value:x.variables.marginExpansion,onChange:e=>f("marginExpansion",e.target.value),placeholder:"0.02",disabled:l,description:"EBITDA margin improvement"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(i,{label:"CapEx Ratio",type:"number",value:x.variables.capexRatio,onChange:e=>f("capexRatio",e.target.value),placeholder:"0.08",disabled:l,description:"CapEx as % of revenue"}),s.jsx(i,{label:"Terminal Growth Rate",type:"number",value:x.variables.terminalGrowth,onChange:e=>f("terminalGrowth",e.target.value),placeholder:"0.025",disabled:l,description:"Long-term growth rate"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Probability Weights"}),s.jsx("div",{className:"space-y-2",children:d.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"font-medium text-sm",children:e.name}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(i,{type:"number",value:e.probability,onChange:s=>{const a=d.map(a=>a.id===e.id?{...a,probability:parseFloat(s.target.value)}:a);m(a)},className:"w-20",disabled:l}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"%"})]})]},e.id))})]})]}),"distributions"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Distribution Parameters"}),s.jsx("div",{className:"space-y-4",children:Object.keys(x.variables).map(e=>s.jsxs("div",{className:"p-4 border border-border rounded-lg space-y-3",children:[s.jsx("h4",{className:"font-medium text-foreground capitalize",children:e.replace(/([A-Z])/g," $1").trim()}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(a,{label:"Distribution Type",options:v,value:"normal",onChange:()=>{},disabled:l}),s.jsx(i,{label:"Standard Deviation",type:"number",placeholder:"0.05",disabled:l,description:"Volatility parameter"})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsx(i,{label:"Min Value",type:"number",placeholder:"-0.1",disabled:l}),s.jsx(i,{label:"Most Likely",type:"number",value:x.variables[e],disabled:l}),s.jsx(i,{label:"Max Value",type:"number",placeholder:"0.5",disabled:l})]})]},e))})]}),"correlations"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Variable Correlations"}),s.jsx("div",{className:"space-y-4",children:h.map((e,a)=>s.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-sm",children:e.var1}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["vs ",e.var2]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(i,{type:"number",value:e.correlation,onChange:e=>{const s=h.map((s,t)=>t===a?{...s,correlation:parseFloat(e.target.value)}:s);p(s)},className:"w-24",disabled:l,min:"-1",max:"1",step:"0.01"}),s.jsx("div",{className:"w-3 h-3 rounded-full "+(e.correlation>.5?"bg-success":e.correlation<-.5?"bg-error":"bg-warning")})]})]},a))}),s.jsx(t,{variant:"outline",iconName:"Plus",disabled:l,className:"w-full",children:"Add Correlation Pair"})]}),"templates"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Scenario Templates"}),s.jsx(a,{label:"Load Template",options:[{value:"dcf_standard",label:"DCF Standard Variables"},{value:"lbo_analysis",label:"LBO Analysis Variables"},{value:"comps_analysis",label:"Comparable Analysis Variables"},{value:"custom",label:"Custom Variable Set"}],value:"dcf_standard",onChange:()=>{},disabled:l,description:"Pre-configured variable sets for common analyses"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Template Actions"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(t,{variant:"outline",iconName:"Download",disabled:l,className:"w-full",children:"Import from Excel"}),s.jsx(t,{variant:"outline",iconName:"Upload",disabled:l,className:"w-full",children:"Export Template"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Saved Templates"}),s.jsx("div",{className:"space-y-2",children:["Tech Company DCF","REIT Analysis","Energy Sector Model"].map((e,a)=>s.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-sm",children:e}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"Last modified: 2 days ago"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(t,{variant:"ghost",size:"sm",iconName:"Eye",disabled:l}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"Download",disabled:l})]})]},a))})]})]})]})]})},w=({onRunSimulation:n,isSimulating:l,progress:o,onStopSimulation:c})=>{const[d,m]=e.useState({iterations:1e4,confidenceLevel:.95,randomSeed:12345,method:"monte_carlo"});return s.jsxs("div",{className:"bg-card border-b border-border p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(a,{options:[{value:1e3,label:"1,000 iterations"},{value:5e3,label:"5,000 iterations"},{value:1e4,label:"10,000 iterations"},{value:25e3,label:"25,000 iterations"},{value:5e4,label:"50,000 iterations"},{value:1e5,label:"100,000 iterations"}],value:d.iterations,onChange:e=>m(s=>({...s,iterations:e})),disabled:l,className:"w-48"}),s.jsx(a,{options:[{value:"monte_carlo",label:"Monte Carlo Simulation"},{value:"latin_hypercube",label:"Latin Hypercube Sampling"},{value:"sobol_sequence",label:"Sobol Sequence"},{value:"halton_sequence",label:"Halton Sequence"}],value:d.method,onChange:e=>m(s=>({...s,method:e})),disabled:l,className:"w-56"}),s.jsx(a,{options:[{value:.9,label:"90% Confidence"},{value:.95,label:"95% Confidence"},{value:.99,label:"99% Confidence"}],value:d.confidenceLevel,onChange:e=>m(s=>({...s,confidenceLevel:e})),disabled:l,className:"w-40"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(i,{type:"number",value:d.randomSeed,onChange:e=>m(s=>({...s,randomSeed:parseInt(e.target.value)})),disabled:l,className:"w-24",placeholder:"Seed"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"Shuffle",onClick:()=>m(e=>({...e,randomSeed:Math.floor(1e5*Math.random())})),disabled:l,title:"Generate random seed"})]})]}),l&&s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-32 h-2 bg-muted rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${o}%`}})}),s.jsxs("span",{className:"text-sm font-mono text-muted-foreground",children:[o.toFixed(1),"%"]})]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.jsx("span",{className:"font-mono",children:Math.floor(o/100*d.iterations).toLocaleString()}),s.jsx("span",{className:"mx-1",children:"/"}),s.jsx("span",{className:"font-mono",children:d.iterations.toLocaleString()})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[!l&&s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Est. time: ",(()=>{const e=d.iterations/1e3;return e<60?`~${Math.ceil(e)}s`:`~${Math.ceil(e/60)}m`})()]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[l?s.jsx(t,{variant:"destructive",iconName:"Square",onClick:c,children:"Stop Simulation"}):s.jsx(t,{variant:"default",iconName:"Play",onClick:()=>{n(d)},children:"Run Simulation"}),s.jsx(t,{variant:"outline",iconName:"RotateCcw",disabled:l,title:"Reset parameters",onClick:()=>m({iterations:1e4,confidenceLevel:.95,randomSeed:12345,method:"monte_carlo"})}),s.jsx(t,{variant:"outline",iconName:"Settings",disabled:l,title:"Advanced settings"})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-border",children:[s.jsxs("div",{className:"flex items-center space-x-6 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(r,{name:"Cpu",size:16}),s.jsx("span",{children:"Web Workers: 4 active"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(r,{name:"MemoryStick",size:16}),s.jsx("span",{children:"Memory: 245MB allocated"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(r,{name:"Clock",size:16}),s.jsx("span",{children:"Last run: 2 min ago"})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(t,{variant:"ghost",size:"sm",iconName:"Download",disabled:l,children:"Export Config"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"Upload",disabled:l,children:"Import Config"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"History",disabled:l,children:"Run History"})]})]})]})},S=({simulationResults:r,isSimulating:i})=>{const[n,l]=e.useState("enterprise_value"),[o,c]=e.useState("summary"),d=(()=>{if(!r||r.error)return null;const e=r.summary;return{enterprise_value:{descriptive:{count:e.iterations,mean:e.mean,median:e.median,stdDev:e.stdDev,skewness:e.skewness||0,kurtosis:e.kurtosis||0,min:e.min,max:e.max,range:e.max-e.min,method:r.method},percentiles:{p1:e.percentile1,p5:e.percentile5,p10:r.summary.percentile10||1.1*e.percentile5,p25:r.summary.percentile25||1.2*e.percentile5,p50:e.median,p75:r.summary.percentile75||.8*e.percentile95,p90:r.summary.percentile90||.9*e.percentile95,p95:e.percentile95,p99:e.percentile99},confidence:r.confidenceInterval,convergence:r.convergence,performance:r.performance,quality:r.quality}}})(),m=d?d[n]:{enterprise_value:{descriptive:{count:1e4,mean:2847.5,median:2823.1,mode:2798.3,stdDev:456.2,variance:208118.44,skewness:.12,kurtosis:2.98,min:1654.3,max:4521.8,range:2867.5,iqr:615.7},percentiles:{p1:1876.4,p5:2156.7,p10:2287.9,p25:2534.2,p50:2823.1,p75:3149.9,p90:3456.8,p95:3687.4,p99:4123.6},confidence:{ci90_lower:2156.7,ci90_upper:3687.4,ci95_lower:2034.8,ci95_upper:3798.2,ci99_lower:1789.3,ci99_upper:4021.7},risk:{var95:1034.8,var99:1456.2,cvar95:1287.6,cvar99:1678.9,probabilityOfLoss:.023,expectedShortfall:1456.8}}}[n],x=(e,s=n)=>"irr"===s?`${(100*e).toFixed(2)}%`:"multiple"===s?`${e.toFixed(2)}x`:"share_price"===s?`$${e.toFixed(2)}`:`$${(e/1e3).toFixed(1)}B`;return i?s.jsx("div",{className:"h-full flex items-center justify-center bg-card",children:s.jsxs("div",{className:"text-center space-y-4",children:[s.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),s.jsx("div",{className:"text-lg font-medium text-foreground",children:"Calculating Statistics..."}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Processing simulation results and computing risk metrics"})]})}):s.jsxs("div",{className:"h-full flex flex-col bg-card",children:[s.jsx("div",{className:"p-6 border-b border-border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"Statistical Analysis"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(a,{options:[{value:"enterprise_value",label:"Enterprise Value ($M)"},{value:"equity_value",label:"Equity Value ($M)"},{value:"share_price",label:"Share Price ($)"},{value:"irr",label:"Internal Rate of Return (%)"},{value:"multiple",label:"EV/EBITDA Multiple"}],value:n,onChange:l,className:"w-48"}),s.jsx(a,{options:[{value:"summary",label:"Summary Statistics"},{value:"percentiles",label:"Percentile Analysis"},{value:"confidence",label:"Confidence Intervals"},{value:"risk",label:"Risk Metrics"}],value:o,onChange:c,className:"w-48"}),s.jsx(t,{variant:"outline",iconName:"Download",size:"sm",children:"Export"})]})]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:["summary"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Descriptive Statistics"}),d&&s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[s.jsx("span",{children:"Method:"}),s.jsx("span",{className:"px-2 py-1 bg-primary/10 rounded text-primary font-medium",children:m.descriptive.method?.replace("_"," ").toUpperCase()||"Monte Carlo"}),d.enterprise_value.quality&&s.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs",children:[d.enterprise_value.quality.efficiency," Efficiency"]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Central Tendency"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Mean"}),s.jsx("span",{className:"font-mono text-sm",children:x(m.descriptive.mean)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Median"}),s.jsx("span",{className:"font-mono text-sm",children:x(m.descriptive.median)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Mode"}),s.jsx("span",{className:"font-mono text-sm",children:x(m.descriptive.mode)})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Dispersion"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Standard Deviation"}),s.jsx("span",{className:"font-mono text-sm",children:x(m.descriptive.stdDev)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Variance"}),s.jsx("span",{className:"font-mono text-sm",children:x(m.descriptive.variance)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Range"}),s.jsx("span",{className:"font-mono text-sm",children:x(m.descriptive.range)})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Distribution Shape"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Skewness"}),s.jsx("span",{className:"font-mono text-sm",children:m.descriptive.skewness.toFixed(3)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Kurtosis"}),s.jsx("span",{className:"font-mono text-sm",children:m.descriptive.kurtosis.toFixed(3)})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Extremes"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Minimum"}),s.jsx("span",{className:"font-mono text-sm text-error",children:x(m.descriptive.min)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Maximum"}),s.jsx("span",{className:"font-mono text-sm text-success",children:x(m.descriptive.max)})]})]})]})]})]}),"percentiles"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Percentile Analysis"}),s.jsx("div",{className:"space-y-4",children:Object.entries(m.percentiles).map(([e,a])=>{const t=e.replace("p",""),r="1"===t||"99"===t,i=["25","50","75"].includes(t);return s.jsxs("div",{className:"flex justify-between items-center p-4 rounded-lg border "+(r?"border-warning bg-warning/5":i?"border-primary bg-primary/5":"border-border bg-muted"),children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-sm font-medium",children:"50"===t?"Median":`${t}th Percentile`}),i&&s.jsxs("div",{className:"px-2 py-1 bg-primary text-primary-foreground text-xs rounded",children:["Q","25"===t?"1":"50"===t?"2":"3"]})]}),s.jsx("span",{className:"font-mono text-sm font-medium",children:x(a)})]},e)})}),s.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[s.jsx("h4",{className:"font-medium text-foreground mb-3",children:"Interpretation"}),s.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[s.jsxs("p",{children:["â¢ 50% of outcomes fall below ",x(m.percentiles.p50)]}),s.jsxs("p",{children:["â¢ 90% of outcomes fall between ",x(m.percentiles.p5)," and"," ",x(m.percentiles.p95)]}),s.jsxs("p",{children:["â¢ Interquartile range: ",x(m.descriptive.iqr)]})]})]})]}),"confidence"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Confidence Intervals"}),s.jsx("div",{className:"space-y-4",children:[{level:"90%",lower:m.confidence.ci90_lower,upper:m.confidence.ci90_upper},{level:"95%",lower:m.confidence.ci95_lower,upper:m.confidence.ci95_upper},{level:"99%",lower:m.confidence.ci99_lower,upper:m.confidence.ci99_upper}].map(e=>s.jsxs("div",{className:"p-4 border border-border rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("span",{className:"font-medium text-foreground",children:[e.level," Confidence Interval"]}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Width: ",x(e.upper-e.lower)]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Lower Bound"}),s.jsx("div",{className:"font-mono text-sm font-medium text-error",children:x(e.lower)})]}),s.jsx("div",{className:"flex-1 mx-4",children:s.jsx("div",{className:"h-2 bg-muted rounded-full relative",children:s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-error via-warning to-success rounded-full"})})}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Upper Bound"}),s.jsx("div",{className:"font-mono text-sm font-medium text-success",children:x(e.upper)})]})]})]},e.level))})]}),"risk"===o&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Risk Assessment"}),s.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Value at Risk (VaR)"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-error/10 border border-error/20 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"95% VaR"}),s.jsx("span",{className:"font-mono text-sm text-error",children:x(m.risk.var95)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-error/10 border border-error/20 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"99% VaR"}),s.jsx("span",{className:"font-mono text-sm text-error",children:x(m.risk.var99)})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Conditional VaR (CVaR)"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-warning/10 border border-warning/20 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"95% CVaR"}),s.jsx("span",{className:"font-mono text-sm text-warning",children:x(m.risk.cvar95)})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-warning/10 border border-warning/20 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"99% CVaR"}),s.jsx("span",{className:"font-mono text-sm text-warning",children:x(m.risk.cvar99)})]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"Additional Risk Metrics"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Probability of Loss"}),s.jsxs("span",{className:"font-mono text-sm",children:[(100*m.risk.probabilityOfLoss).toFixed(2),"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Expected Shortfall"}),s.jsx("span",{className:"font-mono text-sm",children:x(m.risk.expectedShortfall)})]})]})]}),s.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[s.jsx("h4",{className:"font-medium text-foreground mb-3",children:"Risk Interpretation"}),s.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[s.jsxs("p",{children:["â¢ There is a 5% chance of losing more than ",x(m.risk.var95)]}),s.jsxs("p",{children:["â¢ In the worst 5% of scenarios, average loss is ",x(m.risk.cvar95)]}),s.jsxs("p",{children:["â¢ Probability of any loss: ",(100*m.risk.probabilityOfLoss).toFixed(1),"%"]})]})]})]})]})]})};class M{constructor(){this.workers=[],this.isRunning=!1,this.currentSimulation=null,this.sobolSequence=null,this.haltonIndices={}}async runSimulation(e,s,a,t){const{method:r="monte_carlo",iterations:i=1e4,confidenceLevel:n=.95,randomSeed:l=null,correlationMatrix:o=null}=e;this.isRunning=!0;const c=Date.now();try{let d;switch(l&&this.setSeed(l),r){case"latin_hypercube":d=await this.generateLatinHypercubeSamples(s,i,o,t);break;case"sobol_sequence":d=await this.generateSobolSamples(s,i,o,t);break;case"halton_sequence":d=await this.generateHaltonSamples(s,i,o,t);break;default:d=await this.generateMonteCarloSamples(s,i,o,t)}const m=await this.evaluateModel(d,a,t),x=this.calculateStatistics(m,n),u=Date.now()-c;return{method:r,parameters:e,statistics:x,results:m.slice(0,1e3),convergence:this.analyzeConvergence(m),performance:{executionTime:u,iterationsPerSecond:i/(u/1e3),memoryUsed:this.estimateMemoryUsage(i)},quality:this.assessSampleQuality(d,r),completedAt:new Date}}catch(d){throw this.isRunning=!1,d}finally{this.isRunning=!1}}async generateLatinHypercubeSamples(e,s,a,t){const r=Object.keys(e),i=r.length,n=[],l=this.generateLHSMatrix(i,s);for(let o=0;o<s;o++){const a={};r.forEach((s,t)=>{const r=e[s],i=l[o][t];a[s]=this.inverseCDF(i,r)}),n.push(a),o%Math.floor(s/20)===0&&t&&t(o/s*50)}return a?this.applyCorrelationToSamples(n,a,r):n}async generateSobolSamples(e,s,a,t){const r=Object.keys(e),i=r.length,n=[];this.initializeSobolSequence(i);for(let l=0;l<s;l++){const a={},o=this.getNextSobolPoint(i);r.forEach((s,t)=>{const r=e[s],i=o[t];a[s]=this.inverseCDF(i,r)}),n.push(a),l%Math.floor(s/20)===0&&t&&t(l/s*50)}return a?this.applyCorrelationToSamples(n,a,r):n}async generateHaltonSamples(e,s,a,t){const r=Object.keys(e),i=[],n=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47];for(let l=0;l<s;l++){const a={};r.forEach((s,t)=>{const r=e[s],i=n[t%n.length],o=this.haltonNumber(l+1,i);a[s]=this.inverseCDF(o,r)}),i.push(a),l%Math.floor(s/20)===0&&t&&t(l/s*50)}return a?this.applyCorrelationToSamples(i,a,r):i}async generateMonteCarloSamples(e,s,a,t){const r=Object.keys(e),i=[];for(let n=0;n<s;n++){const a={};r.forEach(s=>{const t=e[s];a[s]=this.sampleFromDistribution(t)}),i.push(a),n%Math.floor(s/20)===0&&t&&t(n/s*50)}return a?this.applyCorrelationToSamples(i,a,r):i}generateLHSMatrix(e,s){const a=[];for(let t=0;t<s;t++)a[t]=[];for(let t=0;t<e;t++){const e=[];for(let a=0;a<s;a++)e.push((a+Math.random())/s);this.shuffleArray(e);for(let r=0;r<s;r++)a[r][t]=e[r]}return a}initializeSobolSequence(e){this.sobolSequence={dimensions:e,index:0,direction:Array(e).fill(0).map(()=>Array(32).fill(0))};for(let s=0;s<e;s++){this.sobolSequence.direction[s][0]=1;for(let e=1;e<32;e++)this.sobolSequence.direction[s][e]=2*this.sobolSequence.direction[s][e-1]}}getNextSobolPoint(e){const s=new Array(e),a=this.sobolSequence.index++;for(let t=0;t<e;t++){let e=0,r=a,i=0;for(;r>0;)1&r&&(e^=this.sobolSequence.direction[t][i]),r>>=1,i++;s[t]=e/Math.pow(2,32)}return s}haltonNumber(e,s){let a=0,t=1/s,r=e;for(;r>0;)a+=r%s*t,r=Math.floor(r/s),t/=s;return a}inverseCDF(e,s){const{type:a,params:t}=s;switch(a){case"normal":return this.inverseNormalCDF(e,t.mean,t.std);case"lognormal":const s=this.inverseNormalCDF(e,t.logMean,t.logStd);return Math.exp(s);case"uniform":return t.min+e*(t.max-t.min);case"triangular":return this.inverseTriangularCDF(e,t.min,t.mode,t.max);case"beta":return this.inverseBetaCDF(e,t.alpha,t.beta);default:throw new Error(`Unsupported distribution type: ${a}`)}}inverseNormalCDF(e,s=0,a=1){let t,r,i=e-.5;return Math.abs(i)<.42?(t=i*i,r=i*(((-25.44106049637*t+41.39119773534)*t-18.61500062529)*t+2.50662823884)/((((3.13082909833*t-21.06224101826)*t+23.08336743743)*t-8.4735109309)*t+1)):(t=e,i>0&&(t=1-e),t=Math.log(-Math.log(t)),r=t*(t*(4.85014127135+2.32121276858*t)-2.29796479134)/(1+t*(3.54388924762+1.63706781897*t))-2.78718931138,i<0&&(r=-r)),s+r*a}inverseTriangularCDF(e,s,a,t){return e<(a-s)/(t-s)?s+Math.sqrt(e*(t-s)*(a-s)):t-Math.sqrt((1-e)*(t-s)*(t-a))}inverseBetaCDF(e,s,a){if(1===s&&1===a)return e;if(s>10&&a>10){const t=s/(s+a),r=s*a/((s+a)**2*(s+a+1)),i=this.inverseNormalCDF(e,t,Math.sqrt(r));return Math.max(0,Math.min(1,i))}return e}sampleFromDistribution(e){return this.inverseCDF(Math.random(),e)}applyCorrelationToSamples(e,s,a){const t=this.choleskyDecomposition(s),r=[];return e.forEach(e=>{const s=a.map(s=>{const a=e[s],t=this.cdfValue(a,e,s);return this.inverseNormalCDF(t,0,1)}),i=this.matrixVectorMultiply(t,s),n={};a.forEach((e,s)=>{const a=this.normalCDF(i[s]),t=this.getOriginalDistribution(e);n[e]=this.inverseCDF(a,t)}),r.push(n)}),r}async evaluateModel(e,s,a){const t=[],r=e.length;for(let i=0;i<r;i+=100){const n=e.slice(i,Math.min(i+100,r)).map(e=>{const a={...s,...e},t=this.calculateDCFValue(a);return{inputs:a,dcfValue:t,npv:t,irr:this.calculateIRR(a),paybackPeriod:this.calculatePaybackPeriod(a)}});if(t.push(...n),a){const e=50+(i+100)/r*50;a(Math.min(e,100))}}return t}calculateDCFValue(e){const{initialRevenue:s=1e6,revenueGrowthRate:a=.1,ebitdaMargin:t=.25,taxRate:r=.21,capexPercent:i=.05,workingCapitalPercent:n=.02,discountRate:l=.12,terminalGrowthRate:o=.03,forecastYears:c=5}=e;let d=0,m=s;for(let x=1;x<=c;x++){m*=1+a;const e=m*t;d+=(e-e*r-m*i-m*n)/Math.pow(1+l,x)}return d+m*t*(1-r)*(1+o)/(l-o)/Math.pow(1+l,c)}calculateStatistics(e,s){const a=e.map(e=>e.dcfValue).sort((e,s)=>e-s),t=a.length,r=a.reduce((e,s)=>e+s,0)/t,i=a.reduce((e,s)=>e+Math.pow(s-r,2),0)/(t-1),n=Math.sqrt(i),l=(1-s)/2,o=1-l;return{mean:r,median:a[Math.floor(t/2)],stdDev:n,variance:i,min:a[0],max:a[t-1],skewness:this.calculateSkewness(a,r,n),kurtosis:this.calculateKurtosis(a,r,n),percentiles:{p1:a[Math.floor(.01*t)],p5:a[Math.floor(.05*t)],p10:a[Math.floor(.1*t)],p25:a[Math.floor(.25*t)],p75:a[Math.floor(.75*t)],p90:a[Math.floor(.9*t)],p95:a[Math.floor(.95*t)],p99:a[Math.floor(.99*t)],lowerCI:a[Math.floor(t*l)],upperCI:a[Math.floor(t*o)]},confidenceInterval:{level:s,lower:a[Math.floor(t*l)],upper:a[Math.floor(t*o)]}}}analyzeConvergence(e){const s=e.map(e=>e.dcfValue),a=s.length,t=Math.floor(a/10),r=[];for(let o=0;o<10;o++){const e=o*t,i=Math.min(e+t,a),n=s.slice(e,i),l=n.reduce((e,s)=>e+s,0)/n.length;r.push(l)}const i=s.reduce((e,s)=>e+s,0)/a,n=r.reduce((e,s)=>e+Math.pow(s-i,2),0)/9,l=Math.sqrt(n);return{converged:l/Math.abs(i)<.01,standardError:l,relativeError:l/Math.abs(i),batchMeans:r}}assessSampleQuality(e,s){switch(s){case"latin_hypercube":return{method:s,efficiency:"High",coverage:"Excellent",convergenceRate:"O(1/n)",description:"Latin Hypercube ensures better coverage of input space"};case"sobol_sequence":return{method:s,efficiency:"Very High",coverage:"Excellent",convergenceRate:"O((log n)^d/n)",description:"Sobol sequence provides excellent equidistribution"};case"halton_sequence":return{method:s,efficiency:"High",coverage:"Good",convergenceRate:"O((log n)^d/n)",description:"Halton sequence offers good low-discrepancy properties"};default:return{method:s,efficiency:"Standard",coverage:"Good",convergenceRate:"O(1/ân)",description:"Standard Monte Carlo with random sampling"}}}setSeed(e){this.rng={seed:e%2147483647,next(){return this.seed=16807*this.seed%2147483647,(this.seed-1)/2147483646}};const s=Math.random;Math.random=()=>this.rng.next(),setTimeout(()=>{Math.random=s},100)}shuffleArray(e){for(let s=e.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[e[s],e[a]]=[e[a],e[s]]}}choleskyDecomposition(e){const s=e.length,a=Array(s).fill(0).map(()=>Array(s).fill(0));for(let t=0;t<s;t++)for(let s=0;s<=t;s++)if(t===s){let t=0;for(let e=0;e<s;e++)t+=a[s][e]*a[s][e];a[s][s]=Math.sqrt(e[s][s]-t)}else{let r=0;for(let e=0;e<s;e++)r+=a[t][e]*a[s][e];a[t][s]=(e[t][s]-r)/a[s][s]}return a}matrixVectorMultiply(e,s){return e.map(e=>e.reduce((e,a,t)=>e+a*s[t],0))}normalCDF(e){return.5*(1+this.erf(e/Math.sqrt(2)))}erf(e){const s=e>=0?1:-1,a=1/(1+.3275911*(e=Math.abs(e)));return s*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-e*e))}calculateSkewness(e,s,a){const t=e.length;return t/((t-1)*(t-2))*e.reduce((e,t)=>e+Math.pow((t-s)/a,3),0)}calculateKurtosis(e,s,a){const t=e.length;return t*(t+1)/((t-1)*(t-2)*(t-3))*e.reduce((e,t)=>e+Math.pow((t-s)/a,4),0)-3*(t-1)*(t-1)/((t-2)*(t-3))}calculateIRR(e){return e.discountRate+.02}calculatePaybackPeriod(e){return 5.5}estimateMemoryUsage(e){return Math.round(200*e/1024/1024)}cdfValue(e,s,a){return.5}getOriginalDistribution(e){return{type:"normal",params:{mean:0,std:1}}}stopSimulation(){this.isRunning=!1,this.currentSimulation=null}}const C=()=>{const[a,i]=e.useState(!1),[c,d]=e.useState(0),[m,x]=e.useState(null),[u,h]=e.useState([]),[p,v]=e.useState("visualization"),[f,b]=e.useState({connected:!0,lastSync:new Date(Date.now()-12e4),baseModel:"DCF_Analysis_v2.3"}),[j]=e.useState(()=>new M);return e.useEffect(()=>{const e=setInterval(()=>{b(e=>({...e,lastSync:new Date}))},6e4);return()=>clearInterval(e)},[]),s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(o,{title:"Scenario Analysis & Sensitivity Tools | Valor-IVX",description:"Run Monte Carlo simulations, sensitivity analysis, and visualize statistical outcomes for robust financial decision-making.",canonical:"/scenario-analysis-sensitivity-tools"}),s.jsx(n,{}),s.jsxs("div",{className:"pt-[60px] h-screen flex flex-col",children:[s.jsxs("div",{className:"px-6 py-2 bg-background border-b border-border",children:[s.jsx("h1",{className:"sr-only",children:"Scenario Analysis & Sensitivity Tools"}),s.jsx(l,{})]}),s.jsx(w,{onRunSimulation:async e=>{i(!0),d(0),x(null);try{const s={initialRevenue:{type:"normal",params:{mean:1e6,std:15e4}},revenueGrowthRate:{type:"triangular",params:{min:.05,mode:.12,max:.25}},ebitdaMargin:{type:"triangular",params:{min:.15,mode:.25,max:.35}},discountRate:{type:"triangular",params:{min:.08,mode:.12,max:.18}},terminalGrowthRate:{type:"triangular",params:{min:.02,mode:.03,max:.05}}},a={taxRate:.21,capexPercent:.05,workingCapitalPercent:.02,forecastYears:5},t=e=>{d(e)},r=await j.runSimulation(e,s,a,t),i={method:r.method,summary:{mean:r.statistics.mean,median:r.statistics.median,stdDev:r.statistics.stdDev,min:r.statistics.min,max:r.statistics.max,percentile5:r.statistics.percentiles.p5,percentile95:r.statistics.percentiles.p95,percentile1:r.statistics.percentiles.p1,percentile99:r.statistics.percentiles.p99,iterations:e.iterations,skewness:r.statistics.skewness,kurtosis:r.statistics.kurtosis},confidenceInterval:r.statistics.confidenceInterval,convergence:r.convergence,performance:r.performance,quality:r.quality,completedAt:r.completedAt,parameters:e,rawResults:r.results.slice(0,100)};x(i),d(100)}catch(s){x({error:!0,message:s.message,parameters:e})}finally{i(!1)}},isSimulating:a,progress:c,onStopSimulation:()=>{j.stopSimulation(),i(!1),d(0)}}),s.jsx("div",{className:"bg-muted/50 border-b border-border px-6 py-2",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full "+(f.connected?"bg-success":"bg-error")}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Base Model: ",f.baseModel]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(r,{name:"RefreshCw",size:14,className:"text-muted-foreground"}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last sync: ",(e=>{const s=Math.floor((new Date-e)/1e3);if(s<60)return`${s}s ago`;const a=Math.floor(s/60);return a<60?`${a}m ago`:`${Math.floor(a/60)}h ago`})(f.lastSync)]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(r,{name:"Users",size:14,className:"text-muted-foreground"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"3 collaborators active"})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx(t,{variant:"ghost",size:"sm",iconName:"Sync",disabled:a,children:"Sync Now"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"History",disabled:a,children:"Version History"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"Share2",disabled:a,children:"Share Analysis"})]})]})}),s.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[s.jsx("div",{className:"w-2/5 min-w-[480px]",children:s.jsx(y,{onScenarioUpdate:e=>{h(e)},isSimulating:a})}),s.jsxs("div",{className:"flex-1 flex flex-col",children:[s.jsx("div",{className:"bg-card border-b border-border p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center space-x-1",children:[{id:"visualization",label:"Charts",icon:"BarChart3"},{id:"statistics",label:"Statistics",icon:"Calculator"}].map(e=>s.jsxs("button",{onClick:()=>v(e.id),className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium rounded-lg transition-smooth "+(p===e.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted"),disabled:a,children:[s.jsx(r,{name:e.icon,size:16}),s.jsx("span",{children:e.label})]},e.id))}),s.jsxs("div",{className:"flex items-center space-x-2",children:[m&&s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Completed: ",m.completedAt.toLocaleTimeString()]}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"Maximize2",title:"Fullscreen view"}),s.jsx(t,{variant:"ghost",size:"sm",iconName:"Settings",title:"Display settings"})]})]})}),s.jsx("div",{className:"flex-1 overflow-hidden",children:"visualization"===p?s.jsx(N,{simulationResults:m,isSimulating:a}):s.jsx(S,{simulationResults:m,isSimulating:a})})]})]}),s.jsx("div",{className:"bg-muted/30 border-t border-border px-6 py-2",children:s.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsxs("span",{children:["Scenarios: ",u.length]}),s.jsx("span",{children:"Variables: 4 active"}),s.jsx("span",{children:"Correlations: 3 defined"}),m&&s.jsxs("span",{children:["Iterations: ",m.summary.iterations.toLocaleString()]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("span",{children:["Â© ",(new Date).getFullYear()," Valor-IVX"]}),s.jsx("span",{children:"â¢"}),s.jsx("span",{children:"SOX Compliant"}),s.jsx("span",{children:"â¢"}),s.jsx("span",{children:"Audit Trail: Enabled"})]})]})})]})]})};export{C as default};
//# sourceMappingURL=index-frS7XoLY.js.map
