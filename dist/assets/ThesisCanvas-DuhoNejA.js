import{j as e,r as t,R as s}from"./react-core-CeHLCIBw.js";import{P as a}from"./index-DdNfTkp9.js";import{H as r}from"./Header-BJUfWj4Q.js";import"./vendor-D2fsnhsW.js";import"./ai-vendor-CuiosWbE.js";import"./ui-vendor-B5RWaOCb.js";import"./advanced-analytics-y00dU25g.js";import"./utils-vendor-DUg4_aAP.js";import"./recharts-vendor-DQPXk1vH.js";import"./d3-vendor-DOBQrAlH.js";import"./react-dom-B6lyId6m.js";import"./data-vendor-vzM7rUwp.js";import"./react-router-D-l5j9EF.js";import"./state-vendor-ClT9_nJX.js";import"./businessIntelligenceService-sNUkhNJh.js";import"./SEOHead-B2_EtFOU.js";import"./SecondaryNav-8trPr0SB.js";const n=new class{constructor(){this.baseUrl="/api/canvas",this.mockMode=!0,this.mockStorage=new Map,this.mockUserId="user_123"}validateGraph(e){if(!e||"object"!=typeof e)throw new Error("Invalid graph: must be an object");if(!Array.isArray(e.nodes))throw new Error("Invalid graph: nodes must be an array");if(!Array.isArray(e.edges))throw new Error("Invalid graph: edges must be an array");for(const s of e.nodes)if(!s.id||"number"!=typeof s.x||"number"!=typeof s.y)throw new Error("Invalid node: missing required fields (id, x, y)");const t=new Set(e.nodes.map(e=>e.id));for(const s of e.edges)if(!t.has(s.from)||!t.has(s.to))throw new Error("Invalid edge: references non-existent node");return!0}async createCanvas(e,t,s=""){if(this.validateGraph(t),this.mockMode){const a=`canvas_${Date.now()}_${Math.random().toString(36).slice(2)}`,r={id:a,name:e||`Canvas ${(new Date).toISOString().slice(0,19)}`,description:s,graph:t,userId:this.mockUserId,created:(new Date).toISOString(),updated:(new Date).toISOString(),version:1};return this.mockStorage.set(a,r),{success:!0,data:r}}try{const a=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,description:s,graph:t})});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return{success:!0,data:await a.json()}}catch(a){return{success:!1,error:a.message}}}async updateCanvas(e,t,s=null,a=null){if(this.validateGraph(t),this.mockMode){const r=this.mockStorage.get(e);if(!r)return{success:!1,error:"Canvas not found"};const n={...r,graph:t,...s&&{name:s},...null!==a&&{description:a},updated:(new Date).toISOString(),version:r.version+1};return this.mockStorage.set(e,n),{success:!0,data:n}}try{const r={graph:t};s&&(r.name=s),null!==a&&(r.description=a);const n=await fetch(`${this.baseUrl}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);return{success:!0,data:await n.json()}}catch(r){return{success:!1,error:r.message}}}async getCanvas(e){if(this.mockMode){const t=this.mockStorage.get(e);return t?{success:!0,data:t}:{success:!1,error:"Canvas not found"}}try{const t=await fetch(`${this.baseUrl}/${e}`);if(!t.ok){if(404===t.status)return{success:!1,error:"Canvas not found"};throw new Error(`HTTP ${t.status}: ${t.statusText}`)}return{success:!0,data:await t.json()}}catch(t){return{success:!1,error:t.message}}}async listCanvases(e=null){if(this.mockMode)return{success:!0,data:Array.from(this.mockStorage.values()).filter(t=>!e||t.userId===e).sort((e,t)=>new Date(t.updated)-new Date(e.updated))};try{const t=e?`${this.baseUrl}?user=${e}`:this.baseUrl,s=await fetch(t);if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return{success:!0,data:await s.json()}}catch(t){return{success:!1,error:t.message}}}async deleteCanvas(e){if(this.mockMode)return this.mockStorage.delete(e)?{success:!0}:{success:!1,error:"Canvas not found"};try{const t=await fetch(`${this.baseUrl}/${e}`,{method:"DELETE"});if(!t.ok){if(404===t.status)return{success:!1,error:"Canvas not found"};throw new Error(`HTTP ${t.status}: ${t.statusText}`)}return{success:!0}}catch(t){return{success:!1,error:t.message}}}initializeMockData(){if(!this.mockMode)return;const e={id:"sample_1",name:"SaaS Investment Thesis",description:"Analysis of a high-growth SaaS company",graph:{nodes:[{id:"thesis_1",type:"thesis",x:240,y:220,text:"Investment thesis for high-growth SaaS company with strong unit economics",pins:[],collapsed:!1,created:Date.now()-864e5},{id:"claim_1",type:"claim",x:460,y:160,text:"Recurring revenue model with 95%+ retention",pins:[],collapsed:!1,created:Date.now()-864e5}],edges:[{id:"edge_1",from:"thesis_1",to:"claim_1",created:Date.now()-864e5}]},userId:this.mockUserId,created:new Date(Date.now()-864e5).toISOString(),updated:new Date(Date.now()-36e5).toISOString(),version:2};this.mockStorage.set(e.id,e)}exportMockData(){return this.mockMode?Array.from(this.mockStorage.values()):null}importMockData(e){if(this.mockMode){this.mockStorage.clear();for(const t of e)this.mockStorage.set(t.id,t)}}};n.initializeMockData();const i=190,o=72,l=12,d=[{k:"thesis",label:"Thesis",color:"#0ea5e9",icon:"ðŸŽ¯"},{k:"claim",label:"Claim",color:"#6366f1",icon:"ðŸ’¡"},{k:"evidence",label:"Evidence",color:"#10b981",icon:"ðŸ“Š"},{k:"risk",label:"Risk",color:"#ef4444",icon:"âš ï¸"},{k:"counter",label:"Counterpoint",color:"#f59e0b",icon:"ðŸ¤”"},{k:"data",label:"Data",color:"#14b8a6",icon:"ðŸ“ˆ"},{k:"decision",label:"Decision",color:"#334155",icon:"âœ“"}],c=s.memo(({title:t,right:s,children:a,className:r="",actions:n})=>e.jsxs("section",{className:`rounded-2xl border border-slate-200 bg-white shadow-sm transition-shadow hover:shadow-md ${r}`,children:[(t||s||n)&&e.jsxs("header",{className:"flex items-center justify-between border-b border-slate-200 px-4 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("h3",{className:"text-[13px] font-semibold tracking-wide text-slate-700",children:t}),s]}),n&&e.jsx("div",{className:"flex items-center gap-1",children:n})]}),e.jsx("div",{className:"p-3",children:a})]}));c.displayName="Card";const h=s.memo(({children:t,tone:s="slate",onClick:a,className:r=""})=>{const n={slate:"bg-slate-50 text-slate-700 border-slate-200",blue:"bg-blue-50 text-blue-700 border-blue-200",amber:"bg-amber-50 text-amber-700 border-amber-200",green:"bg-emerald-50 text-emerald-700 border-emerald-200",red:"bg-rose-50 text-rose-700 border-rose-200",violet:"bg-violet-50 text-violet-700 border-violet-200"},i=`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] transition-all ${n[s]||n.slate} ${r}`,o=a?"cursor-pointer hover:scale-105 active:scale-95":"";return e.jsx("span",{className:`${i} ${o}`,onClick:a,role:a?"button":void 0,tabIndex:a?0:void 0,children:t})});h.displayName="Pill";const x=s.memo(({children:t,variant:s="default",size:a="sm",onClick:r,disabled:n,className:i=""})=>e.jsx("button",{onClick:r,disabled:n,className:`rounded-md border font-medium transition-all hover:shadow-sm disabled:opacity-50 disabled:cursor-not-allowed ${{default:"border-slate-200 bg-white text-slate-700 hover:bg-slate-50",primary:"border-blue-600 bg-blue-600 text-white hover:bg-blue-700",danger:"border-rose-600 bg-rose-600 text-white hover:bg-rose-700",ghost:"border-transparent text-slate-700 hover:bg-slate-100"}[s]} ${{sm:"px-2 py-1 text-[12px]",md:"px-3 py-1.5 text-[13px]",lg:"px-4 py-2 text-[14px]"}[a]} ${i}`,children:t}));x.displayName="Button";const m=(e,t=8)=>Math.round(e/t)*t,u=(e,t,s,a)=>{const r=Math.max(40,.5*Math.abs(s-e));return`M ${e} ${t} C ${e+r} ${t}, ${s-r} ${a}, ${s} ${a}`},p=(e,t,s,a="")=>({id:Math.random().toString(36).slice(2),type:e,x:m(t),y:m(s),text:a,pins:[],collapsed:!1,created:Date.now()}),g=(e,t,s)=>{const a={};e.forEach(e=>(a[e.from]||=[]).push(e.to));const r=new Set([t]),n=[t];for(;n.length;){const e=n.pop();if(e===s)return!0;for(const t of a[e]||[])r.has(t)||(r.add(t),n.push(t))}return!1},f=s.memo(({node:s,selected:a,onMouseDown:r,onClick:n,onStartConnect:c,onDoubleClick:h,isHighlighted:x})=>{const m=d.find(e=>e.k===s.type)||d[0],[u,p]=t.useState(!1);return e.jsxs("g",{transform:`translate(${s.x},${s.y})`,onMouseDown:e=>r(s,e),onClick:e=>{e.stopPropagation(),n(s)},onDoubleClick:e=>{e.stopPropagation(),h(s)},onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),style:{cursor:"move"},children:[e.jsx("rect",{rx:l,ry:l,width:i,height:o,fill:"black",opacity:"0.1",transform:"translate(2, 2)"}),e.jsx("rect",{rx:l,ry:l,width:i,height:o,fill:"#ffffff",stroke:a?"#0ea5e9":x?"#6366f1":"#cbd5e1",strokeWidth:a||x?"3":"2"}),e.jsx("rect",{rx:l,ry:l,width:i,height:o,fill:m.color,opacity:u?"0.15":"0.10"}),e.jsxs("g",{children:[e.jsxs("text",{x:12,y:20,fill:"#0f172a",fontSize:"11",fontWeight:"700",children:[e.jsx("tspan",{children:m.icon}),e.jsx("tspan",{dx:4,children:m.label})]}),s.collapsed&&e.jsx("text",{x:142,y:18,fill:"#64748b",fontSize:"11",children:"(collapsed)"})]}),e.jsx("foreignObject",{x:12,y:26,width:166,height:34,children:e.jsx("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"overflow-hidden text-[12px] leading-tight text-slate-700",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s.text||e.jsx("span",{className:"text-slate-400 italic",children:"Add notesâ€¦"})})}),e.jsxs("g",{transform:"translate(176,58)",className:"cursor-crosshair",onMouseDown:e=>{e.stopPropagation(),c(s)},style:{opacity:u?1:0},children:[e.jsx("circle",{r:10,fill:"#fff",stroke:"#94a3b8",strokeWidth:"1.5"}),e.jsx("path",{d:"M -4 0 L 4 0 M 0 -4 L 0 4",stroke:"#0ea5e9",strokeWidth:"2",strokeLinecap:"round"})]}),s.pins&&s.pins.length>0&&e.jsxs("g",{transform:"translate(12, 60)",children:[e.jsx("circle",{r:6,fill:"#6366f1"}),e.jsx("text",{x:0,y:2,fill:"white",fontSize:"8",textAnchor:"middle",children:s.pins.length})]})]})});f.displayName="NodeView";const v=s.memo(({nodes:s,edges:a,viewport:r})=>{const n=t.useMemo(()=>{if(0===s.length)return{minX:0,minY:0,maxX:200,maxY:150};const e=s.map(e=>e.x),t=s.map(e=>e.y);return{minX:Math.min(...e)-50,minY:Math.min(...t)-50,maxX:Math.max(...e)+i+50,maxY:Math.max(...t)+o+50}},[s]),c=`${n.minX} ${n.minY} ${n.maxX-n.minX} ${n.maxY-n.minY}`;return e.jsx("div",{className:"absolute bottom-4 right-4 overflow-hidden rounded-lg border border-slate-300 bg-white/95 shadow-lg",children:e.jsxs("svg",{width:200,height:150,viewBox:c,children:[e.jsx("rect",{x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY,fill:"#f8fafc"}),a.map(t=>{const a=s.find(e=>e.id===t.from),r=s.find(e=>e.id===t.to);return a&&r?e.jsx("line",{x1:a.x+95,y1:a.y+36,x2:r.x+95,y2:r.y+36,stroke:"#cbd5e1",strokeWidth:"8"},t.id):null}),s.map(t=>{const s=d.find(e=>e.k===t.type)||d[0];return e.jsx("rect",{x:t.x,y:t.y,width:i,height:o,fill:s.color,opacity:"0.8",rx:l},t.id)}),e.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:"none",stroke:"#0ea5e9",strokeWidth:"12",opacity:"0.5"})]})})});v.displayName="Minimap";const y=s.memo(({nodes:s,onNodeSelect:a,onFilter:r})=>{const[n,i]=t.useState(""),[o,l]=t.useState("all"),x=t.useMemo(()=>{let e=s;if("all"!==o&&(e=e.filter(e=>e.type===o)),n){const t=n.toLowerCase();e=e.filter(e=>(e.text||"").toLowerCase().includes(t)||e.type.toLowerCase().includes(t))}return e},[s,n,o]);return t.useEffect(()=>{r(x.map(e=>e.id))},[x,r]),e.jsx(c,{title:"Search & Filter",right:e.jsx(h,{tone:"blue",children:x.length}),children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{value:n,onChange:e=>i(e.target.value),placeholder:"Search nodesâ€¦",className:"w-full rounded-md border border-slate-300 px-2 py-1 text-[12px]"}),e.jsxs("select",{value:o,onChange:e=>l(e.target.value),className:"w-full rounded-md border border-slate-300 px-2 py-1 text-[12px]",children:[e.jsx("option",{value:"all",children:"All Types"}),d.map(t=>e.jsx("option",{value:t.k,children:t.label},t.k))]}),e.jsx("div",{className:"max-h-32 space-y-1 overflow-y-auto",children:x.slice(0,10).map(t=>e.jsxs("button",{onClick:()=>a(t.id),className:"w-full text-left cursor-pointer rounded border border-slate-200 px-2 py-1 text-[11px] hover:bg-slate-50",children:[e.jsx("span",{className:"font-medium",children:d.find(e=>e.k===t.type)?.label}),e.jsxs("span",{className:"ml-1 text-slate-500",children:[(t.text||"").slice(0,50),"â€¦"]})]},t.id))})]})})});function b({nodes:s,setNodes:a,edges:r,setEdges:n,selectedIds:l,setSelectedIds:d,highlightIds:c}){const y=t.useRef(null),[b,j]=t.useState(null),[w,k]=t.useState(null),[N,S]=t.useState({x:0,y:0,scale:1}),[C,M]=t.useState(!1),[D,$]=t.useState(!1),A=t.useMemo(()=>new Set(c||[]),[c]),[I,L]=t.useState({x:0,y:0,width:800,height:600});t.useEffect(()=>{const e=e=>{"Space"!==e.code||e.repeat||($(!0),e.preventDefault())},t=e=>{"Space"===e.code&&($(!1),e.preventDefault())};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]);const E=t.useCallback((e,t)=>{const s=y.current?.getBoundingClientRect?.();return s?{x:(e-s.left-N.x)/N.scale,y:(t-s.top-N.y)/N.scale}:{x:0,y:0}},[N]),T=t.useCallback((e,t)=>s.find(s=>((e,t,s,a)=>e>=s&&e<=s+190&&t>=a&&t<=a+72)(e,t,s.x,s.y)),[s]),U=t.useCallback((e,t)=>!(!e||!t||e===t||r.some(s=>s.from===e&&s.to===t)||g(r,t,e)||(n([...r,{id:Math.random().toString(36).slice(2),from:e,to:t,created:Date.now()}]),0)),[r,n]),R=t.useCallback(e=>{const t=e.x+i-14,s=e.y+o-14;k({from:e.id,x0:t,y0:s,x:t,y:s})},[]),z=t.useCallback((e,t)=>{const a=E(t.clientX,t.clientY);t.shiftKey?d(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]):(l.includes(e.id)||d([e.id]),j({nodes:l.includes(e.id)?l:[e.id],startX:a.x,startY:a.y,offsets:s.filter(t=>l.includes(t.id)||t.id===e.id).map(e=>({id:e.id,dx:e.x-a.x,dy:e.y-a.y}))}))},[E,l,d,s]),Y=t.useCallback(e=>{const t=E(e.clientX,e.clientY);if(b){const e=t.x-b.startX,r=t.y-b.startY;a(s.map(t=>{const s=b.offsets.find(e=>e.id===t.id);return s?{...t,x:m(b.startX+s.dx+e),y:m(b.startY+s.dy+r)}:t}))}else C?S(t=>({...t,x:t.x+e.movementX,y:t.y+e.movementY})):w&&k(e=>({...e,x:t.x,y:t.y}))},[b,C,w,E,s,a]),O=t.useCallback(e=>{if(w){const t=E(e.clientX,e.clientY),s=T(t.x,t.y);s&&U(w.from,s.id),k(null)}j(null),M(!1)},[w,E,T,U]),P=t.useCallback(e=>{e.preventDefault();const t=y.current?.getBoundingClientRect?.();if(!t)return;const s=e.clientX-t.left,a=e.clientY-t.top,r=(s-N.x)/N.scale,n=(a-N.y)/N.scale,i=Math.min(2,Math.max(.25,N.scale*(e.deltaY<0?1.1:.9)));S({x:s-r*i,y:a-n*i,scale:i})},[N]),X=t.useCallback(e=>{const t=E(e.clientX,e.clientY),r=p("claim",t.x,t.y,"New node");a([...s,r]),d([r.id])},[E,s,a,d]),W=t.useCallback(e=>{1===e.button||0===e.button&&(e.metaKey||e.ctrlKey||D)?M(!0):e.shiftKey||d([])},[D,d]);t.useEffect(()=>{const e=y.current?.getBoundingClientRect?.();e&&L({x:-N.x/N.scale,y:-N.y/N.scale,width:e.width/N.scale,height:e.height/N.scale})},[N]);const B=t.useCallback((e="png")=>{const t=y.current;if(!t)return;const s=(new XMLSerializer).serializeToString(t),a=new Blob([s],{type:"image/svg+xml;charset=utf-8"});if("svg"===e){const e=URL.createObjectURL(a),t=document.createElement("a");t.href=e,t.download="thesis-canvas.svg",t.click(),URL.revokeObjectURL(e)}else{const e=new Image,s=URL.createObjectURL(a);e.onload=()=>{const a=document.createElement("canvas");a.width=2*t.clientWidth,a.height=2*t.clientHeight;const r=a.getContext("2d");r.scale(2,2),r.drawImage(e,0,0),a.toBlob(e=>{const t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="thesis-canvas.png",s.click(),URL.revokeObjectURL(t)}),URL.revokeObjectURL(s)},e.src=s}},[]);return e.jsxs("div",{className:"relative h-[640px] overflow-hidden rounded-2xl border border-slate-200 bg-slate-50",children:[e.jsxs("div",{className:"pointer-events-none absolute left-2 top-2 z-10 flex gap-1 text-[11px]",children:[e.jsx(h,{tone:"slate",children:"Space/Meta/Ctrl + Drag = Pan"}),e.jsxs(h,{tone:"blue",children:["Wheel = Zoom (",Math.round(100*N.scale),"%)"]}),e.jsx(h,{tone:"amber",children:"Shift+Click = Multi-select"})]}),e.jsxs("div",{className:"absolute right-2 top-2 z-10 flex gap-1",children:[e.jsx(x,{size:"sm",onClick:()=>B("svg"),children:"Export SVG"}),e.jsx(x,{size:"sm",onClick:()=>B("png"),children:"Export PNG"})]}),e.jsxs("svg",{ref:y,className:"h-full w-full",style:{cursor:C?"grabbing":D?"grab":"default"},onMouseMove:Y,onMouseUp:O,onWheel:P,onDoubleClick:X,onMouseDown:W,children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"24",height:"24",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 24 0 L 0 0 0 24",fill:"none",stroke:"#e2e8f0",strokeWidth:"1"})}),e.jsx("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#64748b"})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),e.jsxs("g",{transform:`translate(${N.x},${N.y}) scale(${N.scale})`,children:[e.jsx("g",{className:"edges",children:r.map(t=>{const a=s.find(e=>e.id===t.from),r=s.find(e=>e.id===t.to);if(!a||!r)return null;const n=a.x+i,o=a.y+36,d=r.x,c=r.y+36,h=u(n,o,d,c),x=l.includes(a.id)||l.includes(r.id)||A.has(a.id)&&A.has(r.id);return e.jsx("path",{d:h,fill:"none",stroke:x?"#0ea5e9":"#64748b",strokeWidth:x?"3":"2",markerEnd:"url(#arrow)",opacity:x?1:.7},t.id)})}),w&&e.jsx("path",{d:u(w.x0,w.y0,w.x,w.y),fill:"none",stroke:"#0ea5e9",strokeWidth:"2",strokeDasharray:"5,5"}),e.jsx("g",{className:"nodes",children:s.map(t=>e.jsx(f,{node:t,selected:l.includes(t.id),isHighlighted:A.has(t.id),onMouseDown:z,onClick:()=>d([t.id]),onDoubleClick:()=>{},onStartConnect:R},t.id))})]})]}),e.jsx(v,{nodes:s,edges:r,viewport:I})]})}function j({nodes:t,selectedIds:s,updateNode:a,deleteNodes:r}){const n=t.filter(e=>s.includes(e.id));if(0===n.length)return e.jsx(c,{title:"Inspector",children:e.jsx("div",{className:"text-[12px] text-slate-500",children:"Select a node to edit its properties."})});if(n.length>1)return e.jsx(c,{title:"Inspector",right:e.jsxs(h,{tone:"blue",children:[n.length," selected"]}),actions:e.jsx(x,{size:"sm",variant:"danger",onClick:()=>r(s),children:"Delete All"}),children:e.jsxs("div",{className:"space-y-2 text-[12px]",children:[e.jsx("div",{className:"text-slate-600",children:"Multiple nodes selected"}),e.jsx("div",{className:"space-y-1",children:n.map(t=>e.jsxs("div",{className:"flex items-center gap-2 rounded border border-slate-200 px-2 py-1",children:[e.jsx("span",{className:"font-medium",children:d.find(e=>e.k===t.type)?.icon}),e.jsx("span",{className:"truncate text-slate-700",children:t.text||"Untitled"})]},t.id))})]})});const i=n[0];return e.jsx(c,{title:"Inspector",right:e.jsx(h,{tone:"violet",children:i.type}),actions:e.jsx(x,{size:"sm",variant:"danger",onClick:()=>r([i.id]),children:"Delete"}),children:e.jsxs("div",{className:"space-y-3 text-[13px]",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`node-type-${i.id}`,className:"mb-1 block text-slate-600",children:"Type"}),e.jsx("select",{id:`node-type-${i.id}`,value:i.type,onChange:e=>a({...i,type:e.target.value}),className:"w-full rounded-md border border-slate-300 px-2 py-1",children:d.map(t=>e.jsxs("option",{value:t.k,children:[t.icon," ",t.label]},t.k))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`node-content-${i.id}`,className:"mb-1 block text-slate-600",children:"Content"}),e.jsx("textarea",{id:`node-content-${i.id}`,value:i.text,onChange:e=>a({...i,text:e.target.value}),className:"h-24 w-full rounded-md border border-slate-300 p-2 text-[12px]",placeholder:"Enter your thesis, claim, or evidence hereâ€¦"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"collapsed",checked:!!i.collapsed,onChange:e=>a({...i,collapsed:e.target.checked}),className:"rounded"}),e.jsx("label",{htmlFor:"collapsed",className:"text-slate-700",children:"Collapse children"})]}),e.jsxs("div",{className:"border-t border-slate-200 pt-2 text-[11px] text-slate-500",children:[e.jsxs("div",{children:["ID: ",i.id]}),e.jsxs("div",{children:["Position: (",i.x,", ",i.y,")"]}),e.jsxs("div",{children:["Created: ",new Date(i.created||Date.now()).toLocaleString()]})]})]})})}function w({onAdd:t}){return e.jsx(c,{title:"Palette",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 text-[12px]",children:d.map(s=>e.jsxs("button",{onClick:()=>t(s.k),className:"flex items-center gap-2 rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]},s.k))})})}function k({saves:s,setSaves:a,onLoad:r,graph:n,canvasApiService:i}){const[o,l]=t.useState(""),[d,m]=t.useState(!1),[u,p]=t.useState(null),[g,f]=t.useState(""),[v,y]=t.useState(!1),b=s.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())),j=async()=>{if(!g.trim())return void p("Please enter a name for your canvas");m(!0),p(null);const e=await i.createCanvas(g,n);e.success?(a([e.data,...s.filter(t=>t.id!==e.data.id)]),f(""),y(!1),"function"==typeof r&&r(e.data.graph,e.data.id)):p(e.error),m(!1)};return e.jsxs(c,{title:"Saves",right:e.jsx(h,{tone:"slate",children:b.length}),children:[e.jsxs("div",{className:"mb-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:o,onChange:e=>l(e.target.value),placeholder:"Filterâ€¦",className:"w-full rounded-md border border-slate-300 px-2 py-1 text-[12px]"}),e.jsx(x,{size:"sm",onClick:()=>y(!0),disabled:d,children:"Save"})]}),v&&e.jsxs("div",{className:"rounded-md border border-blue-200 bg-blue-50 p-2",children:[e.jsx("div",{className:"mb-2",children:e.jsx("input",{value:g,onChange:e=>f(e.target.value),placeholder:"Enter canvas name...",className:"w-full rounded-md border border-slate-300 px-2 py-1 text-[12px]",onKeyDown:e=>{"Enter"===e.key&&j(),"Escape"===e.key&&y(!1)},autoFocus:!0})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{size:"sm",variant:"primary",onClick:j,disabled:d,children:d?"Saving...":"Save Canvas"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>y(!1),children:"Cancel"})]})]}),u&&e.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 p-2 text-[11px] text-red-700",children:u})]}),e.jsxs("div",{className:"space-y-1 text-[12px]",children:[b.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 px-2 py-1",children:[e.jsxs("div",{className:"flex-1 truncate",children:[e.jsx("div",{className:"font-medium",children:t.name}),t.description&&e.jsx("div",{className:"text-slate-500 text-[10px]",children:t.description}),e.jsxs("div",{className:"text-slate-400 text-[10px]",children:["Updated ",new Date(t.updated).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-blue-700 hover:text-blue-900",onClick:()=>(async e=>{m(!0),p(null);try{r(e.graph,e.id)}catch{p("Failed to load canvas")}m(!1)})(t),disabled:d,children:"Load"}),e.jsx("button",{className:"text-rose-600 hover:text-rose-800",onClick:()=>(async e=>{m(!0),p(null);const t=await i.deleteCanvas(e);t.success?a(s.filter(t=>t.id!==e)):p(t.error),m(!1)})(t.id),disabled:d,children:"Delete"})]})]},t.id)),0===b.length&&e.jsx("div",{className:"text-slate-500",children:0===s.length?"No canvases saved yet.":"No matches found."})]})]})}function N({nodes:t,edges:s,_currentCanvasId:a,_saves:r,_isLoadingCanvases:n}){const i=new Set(t.map(e=>e.id)),o=[{name:"Edges reference existing nodes",pass:s.every(e=>i.has(e.from)&&i.has(e.to))},{name:"Graph is acyclic (DAG)",pass:s.every(e=>!g(s,e.to,e.from))},{name:"History initialized",pass:Array.isArray(t)&&Array.isArray(s)},{name:"Clipboard serialization (mock)",pass:(()=>{try{const e={nodes:[{id:"x"}],edges:[{id:"e1",from:"x",to:"y"}]},t=JSON.stringify(e);return JSON.parse(t),!0}catch{return!1}})()}];return e.jsx(c,{title:"Dev / Sanity Tests",children:e.jsx("ul",{className:"space-y-1 text-[13px]",children:o.map(t=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-700",children:t.name}),e.jsx("span",{className:"ml-2 "+(t.pass?"text-emerald-600":"text-rose-600"),children:t.pass?"PASS":"FAIL"})]},t.name))})})}function S(){const s=t.useMemo(()=>function(e=240,t=220){const s=p("thesis",e,t,"Investment Thesis: Identify companies with durable competitive advantages, strong unit economics, and rational capital allocation"),a=[p("claim",e+220,t-180,"Business Model: Recurring revenue with high gross margins and negative working capital"),p("claim",e+220,t-60,"Competitive Moat: Network effects and switching costs create pricing power"),p("claim",e+220,t+60,"Growth Runway: Large TAM with <10% penetration and expanding use cases"),p("claim",e+220,t+180,"Management: Founder-led with significant ownership and long-term incentives"),p("risk",e+440,t-120,"Key Risk: Regulatory changes could impact business model"),p("risk",e+440,t,"Bear Case: Competition from big tech with deeper pockets"),p("evidence",e+440,t+120,"Evidence: 40% YoY revenue growth, 120% net retention, 80% gross margins"),p("data",e+660,t-60,"Valuation: Trading at 8x revenue vs peers at 12x"),p("decision",e+660,t+60,"Decision: Initiate position at 2% with 30% margin of safety")],r=[s,...a],n=a.slice(0,4).map(e=>({id:Math.random().toString(36).slice(2),from:s.id,to:e.id,created:Date.now()}));return n.push({id:Math.random().toString(36).slice(2),from:a[1].id,to:a[4].id,created:Date.now()},{id:Math.random().toString(36).slice(2),from:a[2].id,to:a[6].id,created:Date.now()},{id:Math.random().toString(36).slice(2),from:a[6].id,to:a[8].id,created:Date.now()}),{nodes:r,edges:n}}(240,220),[]),{state:a,pushState:r,undo:i,redo:o,canUndo:l,canRedo:x}=(e=>{const s=t.useMemo(()=>({nodes:Array.isArray(e?.nodes)?e.nodes:[],edges:Array.isArray(e?.edges)?e.edges:[]}),[e]),[a,r]=t.useState([s]),[n,i]=t.useState(0),o=t.useCallback(e=>{const t={nodes:Array.isArray(e?.nodes)?e.nodes:[],edges:Array.isArray(e?.edges)?e.edges:[]};r(e=>[...e.slice(0,n+1),t]),i(e=>e+1)},[n]),l=t.useCallback(()=>{n>0&&i(e=>e-1)},[n]),d=t.useCallback(()=>{n<a.length-1&&i(e=>e+1)},[n,a.length]);return{state:a[n]??s,pushState:o,undo:l,redo:d,canUndo:n>0,canRedo:n<a.length-1}})(s),[m,u]=t.useState(()=>a?.nodes??s.nodes??[]),[g,f]=t.useState(()=>a?.edges??s.edges??[]),[v,S]=t.useState([]),[C,M]=t.useState([]),[D,$]=t.useState([]),[A,I]=t.useState(null),[L,E]=t.useState(!0),T=t.useCallback(e=>{const t=Array.isArray(e)?e:[];u(t),r({nodes:t,edges:g})},[g,r]),U=t.useCallback(e=>{const t=Array.isArray(e)?e:[];f(t),r({nodes:m,edges:t})},[m,r]);t.useEffect(()=>{a&&(u(Array.isArray(a.nodes)?a.nodes:[]),f(Array.isArray(a.edges)?a.edges:[]))},[a]);const R=t.useCallback(e=>{T(m.map(t=>t.id===e.id?e:t))},[m,T]),z=t.useCallback(e=>{const t=new Set(e);U(g.filter(e=>!t.has(e.from)&&!t.has(e.to))),T(m.filter(e=>!t.has(e.id))),S([])},[m,g,T,U]),Y=t.useCallback(e=>{const t=p(e,120+400*Math.random(),120+300*Math.random(),"");T([...m,t]),S([t.id])},[m,T]),O=t.useCallback((e,t=null)=>{e&&Array.isArray(e.nodes)&&Array.isArray(e.edges)&&(T(e.nodes),U(e.edges),S([]),I(t))},[T,U]);return t.useEffect(()=>{(async()=>{E(!0);const e=await n.listCanvases();e.success&&M(e.data),E(!1)})()},[]),t.useEffect(()=>{if(!A||!m.length)return;const e=setTimeout(async()=>{const e={nodes:m,edges:g},t=await n.updateCanvas(A,e);t.success&&M(e=>e.map(e=>e.id===A?t.data:e))},2e3);return()=>clearTimeout(e)},[m,g,A]),t.useEffect(()=>{const e=e=>{if(("Delete"===e.key||"Backspace"===e.key)&&v.length>0&&(e.preventDefault(),z(v)),e.ctrlKey||e.metaKey){if("z"===e.key&&!e.shiftKey&&l?(e.preventDefault(),i()):("z"===e.key&&e.shiftKey||"y"===e.key)&&x&&(e.preventDefault(),o()),"c"===e.key&&v.length>0){e.preventDefault();try{const e=new Set(v),t={nodes:m.filter(e=>v.includes(e.id)),edges:g.filter(t=>e.has(t.from)&&e.has(t.to))};localStorage.setItem("clipboard-data",JSON.stringify(t))}catch{}}else if("v"===e.key){e.preventDefault();try{const e=localStorage.getItem("clipboard-data");if(e){const t=JSON.parse(e),s=t.nodes||t,a=t.edges||[],r=new Map,n=s.map(e=>{const t=Math.random().toString(36).slice(2);return r.set(e.id,t),{...e,id:t,x:e.x+20,y:e.y+20}}),i=a.map(e=>({...e,id:Math.random().toString(36).slice(2),from:r.get(e.from),to:r.get(e.to),created:Date.now()}));T([...m,...n]),U([...g,...i]),S(n.map(e=>e.id))}}catch{}}"a"===e.key&&(e.preventDefault(),S(m.map(e=>e.id)))}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[v,m,g,z,T,i,o,l,x]),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 space-y-4 lg:col-span-3",children:[e.jsx(w,{onAdd:Y}),e.jsx(y,{nodes:m,onNodeSelect:e=>S([e]),onFilter:$}),e.jsx(k,{saves:C,setSaves:M,onLoad:O,graph:{nodes:m,edges:g},canvasApiService:n}),e.jsx(N,{nodes:m,edges:g,currentCanvasId:A,saves:C,isLoadingCanvases:L})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-6",children:[e.jsx(b,{nodes:m,setNodes:T,edges:g,setEdges:U,selectedIds:v,setSelectedIds:S,highlightIds:D}),e.jsx("div",{className:"mt-4 grid grid-cols-4 gap-2",children:d.map(t=>{const s=m.filter(e=>e.type===t.k).length;return e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsxs("span",{className:"text-[12px] text-slate-600",children:[t.icon," ",t.label]}),e.jsx("span",{className:"text-[13px] font-semibold",children:s})]},t.k)})})]}),e.jsxs("div",{className:"col-span-12 space-y-4 lg:col-span-3",children:[e.jsx(j,{nodes:m,selectedIds:v,updateNode:R,deleteNodes:z}),e.jsx(c,{title:"Keyboard Shortcuts",children:e.jsxs("div",{className:"space-y-1 text-[11px] text-slate-700",children:[e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Delete"})," â€” Remove selected nodes"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Ctrl/âŒ˜+Z"})," â€” Undo"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Ctrl/âŒ˜+Shift+Z"})," / ",e.jsx("kbd",{children:"Ctrl/âŒ˜+Y"})," â€” Redo"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Ctrl/âŒ˜+C"})," â€” Copy"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Ctrl/âŒ˜+V"})," â€” Paste"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Ctrl/âŒ˜+A"})," â€” Select all"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Shift+Click"})," â€” Multi-select"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Space/Meta/Ctrl + Drag"})," â€” Pan"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("kbd",{children:"Double-click"})," â€” Create node"]})]})}),e.jsx(c,{title:"Persistence Status",right:e.jsx(h,{tone:"amber",children:"Mock Mode"}),children:e.jsxs("div",{className:"space-y-2 text-[11px]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Auto-save"}),e.jsx("span",{className:"text-emerald-600",children:A?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Canvas ID"}),e.jsx("span",{className:"text-slate-600 font-mono",children:A||"None"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Saved Canvases"}),e.jsx("span",{className:"text-emerald-600",children:C.length})]}),L&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Loading..."}),e.jsx("span",{className:"text-amber-600",children:"â³"})]})]})})]})]})}y.displayName="SearchPanel";const C=()=>e.jsxs("div",{className:"min-h-[100dvh] bg-background text-foreground",children:[e.jsx(r,{}),e.jsxs("div",{className:"pt-[60px]",children:[e.jsx("div",{className:"border-b border-border bg-card",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-md bg-primary",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4 text-white",children:e.jsx("path",{d:"M9 12l2 2 4-4M21 12a9 9 0 11-18 0 9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs tracking-wide text-muted-foreground",children:"FinanceAnalyst Pro"}),e.jsx("div",{className:"text-[13px] font-semibold text-foreground",children:"Thesis Canvas"})]})]}),e.jsx("div",{className:"flex items-center gap-3 text-[12px]",children:e.jsx("div",{className:"px-2 py-1 rounded-md bg-primary/10 text-primary font-medium",children:"Canvas Mode"})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(S,{})})]}),e.jsx(a,{currentContext:{page:"canvas",canvasData:{title:"Investment Thesis Canvas",description:"Build and visualize your investment thesis framework"}},onNavigate:e=>{}})]});export{C as default};
//# sourceMappingURL=ThesisCanvas-DuhoNejA.js.map
