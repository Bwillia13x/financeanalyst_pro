import"./apiLogger-BNPwdfUB.js";const e=new class{constructor(){this.modelCache=new Map,this.assumptions=this.getDefaultAssumptions()}getDefaultAssumptions(){return{transaction:{holdingPeriod:5,managementRollover:.1,transactionFees:.02,financingFees:.015},debt:{seniorDebtMultiple:4,subordinatedDebtMultiple:1.5,totalDebtMultiple:5.5,seniorInterestRate:.055,subordinatedInterestRate:.095,mandatoryPaydown:.05,cashSweep:.5},operating:{ebitdaGrowthRate:.05,capexAsPercentOfRevenue:.03,nwcAsPercentOfRevenue:.02,taxRate:.21},exit:{exitMultiple:null,exitMultipleRange:[.8,1.2],publicMarketDiscount:.1},fees:{managementFeeRate:.02,carriedInterestRate:.2,hurdle:.08}}}buildLBOModel(e,t={}){const{symbol:a,companyName:i,purchasePrice:n,ebitda:r,revenue:s,marketData:o={},peerData:l={},assumptions:c={}}=e,u={...this.assumptions,...c},h=this.calculateTransactionStructure(n,r,u),d=this.calculateLBOScenario(e,h,u,"Base Case"),p={};if(!1!==t.upside){const t={...u,operating:{...u.operating,ebitdaGrowthRate:1.3*u.operating.ebitdaGrowthRate},exit:{...u.exit,exitMultiple:1.1*(u.exit.exitMultiple||10)}};p.upside=this.calculateLBOScenario(e,h,t,"Upside Case")}if(!1!==t.downside){const t={...u,operating:{...u.operating,ebitdaGrowthRate:.7*u.operating.ebitdaGrowthRate},exit:{...u.exit,exitMultiple:.9*(u.exit.exitMultiple||10)}};p.downside=this.calculateLBOScenario(e,h,t,"Downside Case")}const m=this.performLBOSensitivityAnalysis(e,h,u);return{symbol:a,companyName:i,modelType:"LBO",timestamp:(new Date).toISOString(),transactionStructure:h,baseCase:d,scenarios:p,sensitivityAnalysis:m,assumptions:u,summary:this.generateLBOSummary(d,p,h)}}calculateTransactionStructure(e,t,a){const{debt:i,transaction:n}=a,r=t*i.seniorDebtMultiple,s=r+t*i.subordinatedDebtMultiple,o=e*n.transactionFees,l=s*n.financingFees,c=e+o+l,u=Math.max(c-s,.2*c),h=e*n.managementRollover,d=Math.max(u-h,0),p=c-u,m=Math.min(r,.8*p);return{purchasePrice:e,transactionFees:o,financingFees:l,totalUses:c,seniorDebt:m,subordinatedDebt:p-m,totalDebt:p,equityContribution:u,sponsorEquity:d,managementRollover:h,debtToEbitda:p/t,equityToTotalCapital:u/c}}calculateLBOScenario(e,t,a,i){const{ebitda:n,revenue:r}=e,{holdingPeriod:s}=a.transaction,o=this.projectLBOOperatingPerformance(r,n,a.operating,s),l=this.calculateDebtSchedule(t,o,a.debt,s),c=this.calculateEquityCashFlows(o,l,a),u=this.calculateExitAnalysis(o[s-1],l[s-1],t,a),h=this.calculateReturnsMetrics(t.sponsorEquity,c,u.netProceeds,s);return{scenarioName:i,operatingProjections:o,debtSchedule:l,equityCashFlows:c,exitAnalysis:u,returnsAnalysis:h,keyMetrics:this.calculateLBOKeyMetrics(t,u,h)}}projectLBOOperatingPerformance(e,t,a,i){const n=[];let r=e,s=t;for(let o=1;o<=i;o++){const e=a.ebitdaGrowthRate;s*=1+e,r*=1+e;const t=s/r,i=r*a.capexAsPercentOfRevenue,l=1===o?r*a.nwcAsPercentOfRevenue:(r-n[o-2].revenue)*a.nwcAsPercentOfRevenue,c=s*a.taxRate,u=s-c-i-l;n.push({year:o,revenue:r,ebitda:s,ebitdaMargin:t,capex:i,nwcChange:l,taxes:c,unleveredFCF:u})}return n}calculateDebtSchedule(e,t,a,i){const n=[];let r=e.seniorDebt,s=e.subordinatedDebt;const o=e.revolvingDebt||0,l={...a,revolvingRate:a.revolvingRate||.045,minCashBalance:a.minCashBalance||1e7,maxLeverageRatio:a.maxLeverageRatio||6,minCoverageRatio:a.minCoverageRatio||1.25,maxCapexRatio:a.maxCapexRatio||.05};for(let c=1;c<=i;c++){const i=t[c-1],u=r*a.seniorInterestRate,h=s*a.subordinatedInterestRate,d=u+h,p=i.unleveredFCF-d,m=Math.min(r*a.mandatoryPaydown,r),b=Math.max(0,p-m),g=b*a.cashSweep,v=m+g,R=Math.min(v,r),x=Math.max(0,v-R);r=Math.max(0,r-R),s=Math.max(0,s-x);const y=(r+s+o)/i.ebitda,M=i.ebitda/d,f=(i.capex||0)/i.revenue,C={leverageCompliance:y<=l.maxLeverageRatio,coverageCompliance:M>=l.minCoverageRatio,capexCompliance:f<=l.maxCapexRatio,leverageRatio:y,coverageRatio:M,capexRatio:f},w=p/(d+m);n.push({year:c,beginningBalance:{senior:1===c?e.seniorDebt:n[c-2].endingBalance.senior,subordinated:1===c?e.subordinatedDebt:n[c-2].endingBalance.subordinated,revolving:1===c?e.revolvingDebt||0:n[c-2].endingBalance.revolving},interestExpense:{senior:u,subordinated:h,revolving:o*l.revolvingRate,total:d+o*l.revolvingRate},principalPayment:{senior:R,subordinated:x,revolving:0,total:v},endingBalance:{senior:r,subordinated:s,revolving:o,total:r+s+o},cashAvailableForDebt:p,excessCash:b-g,mandatoryPaydown:m,cashSweep:g,dscr:w,covenantTests:C,netDebtToEbitda:(r+s+o)/i.ebitda,ebitdaToInterest:i.ebitda/d})}return n}calculateEquityCashFlows(e,t,a){return e.map((e,i)=>{const n=t[i],r=a.fees.managementFeeRate*(a.transaction.sponsorEquity||0),s=n.excessCash-r;return{year:e.year,unleveredFCF:e.unleveredFCF,interestExpense:n.interestExpense.total,principalPayment:n.principalPayment.total,managementFees:r,cashFlowToEquity:Math.max(0,s)}})}calculateExitAnalysis(e,t,a,i){const n=i.exit.exitMultiple||10,r=e.ebitda,s=r*n,o=t.endingBalance.total,l=s-o,c=l,u=a.sponsorEquity,h=Math.max(0,c-u)*i.fees.carriedInterestRate;return{exitEbitda:r,exitMultiple:n,enterpriseValue:s,totalDebtAtExit:o,grossProceeds:l,carriedInterest:h,netProceeds:l-h,managementProceeds:l*(a.managementRollover/a.equityContribution)}}calculateReturnsMetrics(e,t,a,i){if(!e||e<=0)return{irr:NaN,moic:NaN,totalCashReturned:0,initialInvestment:e||0,holdingPeriod:i,annualizedReturn:NaN};const n=[-Math.abs(e)];t.forEach(e=>{n.push(e.cashFlowToEquity||0)}),n.length>1?n[n.length-1]+=a||0:n.push(a||0);const r=this.calculateIRR(n),s=t.reduce((e,t)=>e+(t.cashFlowToEquity||0),0)+(a||0),o=s/Math.abs(e);return{irr:isNaN(r)?0:r,moic:isNaN(o)?0:o,totalCashReturned:s,initialInvestment:Math.abs(e),holdingPeriod:i,annualizedReturn:isNaN(o)||o<=0?0:Math.pow(o,1/i)-1,cashFlows:n}}calculateIRR(e,t={}){if(!e||e.length<2)return NaN;if(e.every(e=>0===e))return 0;if(0===e.slice(1).reduce((t,a,i)=>t+(Math.sign(a)!==Math.sign(e[i])?1:0),0))return e[0]<0?-1:1/0;const{tolerance:a=1e-8,maxIterations:i=200,initialGuess:n=.1}=t;let r=this.newtonRaphsonIRR(e,n,a,i);return!isNaN(r)&&isFinite(r)||(r=this.bisectionIRR(e,a,i)),!isNaN(r)&&isFinite(r)||(r=this.secantIRR(e,a,i)),r}newtonRaphsonIRR(e,t,a,i){let n=t;for(let r=0;r<i;r++){let t=0,i=0;for(let a=0;a<e.length;a++){const r=Math.pow(1+n,a);t+=e[a]/r,a>0&&(i-=a*e[a]/(r*(1+n)))}if(Math.abs(t)<a)return n;if(Math.abs(i)<a)break;const r=n-t/i;if(Math.abs(r-n)<a)return r;n=r<-.99?-.99:r>50?50:r}return n}bisectionIRR(e,t,a){let i=-.99,n=5;const r=this.calculateNPV(e,i);if(r*this.calculateNPV(e,n)>0)return NaN;for(let s=0;s<a;s++){const a=(i+n)/2,s=this.calculateNPV(e,a);if(Math.abs(s)<t)return a;if(r*s<0?n=a:i=a,Math.abs(n-i)<t)return(i+n)/2}return(i+n)/2}secantIRR(e,t,a){let i=0,n=.1;for(let r=0;r<a;r++){const a=this.calculateNPV(e,i),r=this.calculateNPV(e,n);if(Math.abs(r)<t)return n;if(Math.abs(r-a)<t)break;const s=n-r*(n-i)/(r-a);if(Math.abs(s-n)<t)return s;i=n,n=s}return n}calculateNPV(e,t){return e.reduce((e,a,i)=>e+a/Math.pow(1+t,i),0)}calculateLBOKeyMetrics(e,t,a,i=[]){const n=e.purchasePrice/(e.entryMultiple||10),r=n>0?e.purchasePrice/n:null,s=Math.max(...i.map(e=>e.netDebtToEbitda||0)),o=Math.min(...i.map(e=>e.ebitdaToInterest||1/0)),l=i.length>0?i.reduce((e,t)=>e+(t.dscr||0),0)/i.length:0,c=t.exitMultiple-(r||10),u=a.moic-1-c,h=e.totalDebt/e.equityContribution;return{entryMultiple:r,entryLeverage:e.debtToEbitda,equityContribution:e.equityContribution,debtToEquity:h,exitMultiple:t.exitMultiple,exitLeverage:t.totalDebtAtExit/t.exitEbitda,irr:a.irr,moic:a.moic,totalReturn:a.totalCashReturned,leverageReduction:e.totalDebt-t.totalDebtAtExit,peakLeverage:s,minCoverage:o,avgDSCR:l,multipleExpansion:c,operationalImprovement:u,leverageContribution:h>1?(a.moic-1)*(h-1)/h:0,breakdownLeverage:i.length>0?Math.max(...i.map(e=>e.leverageRatio||0)):null,covenantBreaches:i.filter(e=>e.covenantTests&&(!e.covenantTests.leverageCompliance||!e.covenantTests.coverageCompliance)).length,equityEfficiency:a.totalCashReturned/e.equityContribution,timeToRecoverEquity:this.calculateTimeToRecoverEquity(a.cashFlows,e.equityContribution)}}calculateTimeToRecoverEquity(e,t){if(!e||0===e.length)return null;let a=0;for(let i=1;i<e.length;i++)if(a+=e[i],a>=t)return i;return null}performLBOSensitivityAnalysis(e,t,a){const i={};return Object.entries({ebitdaGrowthRate:[-.02,-.01,0,.01,.02],exitMultiple:[-1,-.5,0,.5,1],debtMultiple:[-.5,-.25,0,.25,.5]}).forEach(([n,r])=>{i[n]=r.map(i=>{const r={...a};if("ebitdaGrowthRate"===n)r.operating.ebitdaGrowthRate+=i;else if("exitMultiple"===n)r.exit.exitMultiple=(r.exit.exitMultiple||10)+i;else if("debtMultiple"===n){const a=t.debtToEbitda+i,n={...t,totalDebt:e.ebitda*a};n.equityContribution=t.totalUses-n.totalDebt}try{const a=this.calculateLBOScenario(e,t,r,`${n}_${i}`);return{variation:i,irr:a.returnsAnalysis.irr,moic:a.returnsAnalysis.moic}}catch(s){return{variation:i,irr:null,moic:null,error:s.message}}})}),i}generateLBOSummary(e,t,a){const i=[e,...Object.values(t)],n=i.map(e=>e.returnsAnalysis.irr).filter(e=>null!==e),r=i.map(e=>e.returnsAnalysis.moic).filter(e=>null!==e);return{returnRange:{irrMin:Math.min(...n),irrMax:Math.max(...n),irrAverage:n.reduce((e,t)=>e+t,0)/n.length,moicMin:Math.min(...r),moicMax:Math.max(...r),moicAverage:r.reduce((e,t)=>e+t,0)/r.length},investmentHighlights:this.generateInvestmentHighlights(e,a),riskFactors:this.generateRiskFactors(e,a)}}generateInvestmentHighlights(e,t){const a=[],i=e.returnsAnalysis.irr,n=e.returnsAnalysis.moic;return i>.2&&a.push(`Strong projected IRR of ${(100*i).toFixed(1)}%`),n>2.5&&a.push(`Attractive multiple of ${n.toFixed(1)}x invested capital`),t.debtToEbitda<5&&a.push(`Conservative leverage at ${t.debtToEbitda.toFixed(1)}x EBITDA`),a}generateRiskFactors(e,t){const a=[];return t.debtToEbitda>6&&a.push(`High leverage at ${t.debtToEbitda.toFixed(1)}x EBITDA`),e.returnsAnalysis.irr<.15&&a.push(`Below-target IRR of ${(100*e.returnsAnalysis.irr).toFixed(1)}%`),a}};export{e as l};
//# sourceMappingURL=lboModelingEngine-DdqVJUup.js.map
