import{j as e,r as t,R as s}from"./react-core-CeHLCIBw.js";import{C as a,N as i,S as r,P as l,u as n,l as c}from"./ai-vendor-CuiosWbE.js";import{H as o}from"./Header-BJUfWj4Q.js";import"./vendor-D2fsnhsW.js";import"./react-dom-B6lyId6m.js";import"./ui-vendor-B5RWaOCb.js";import"./advanced-analytics-y00dU25g.js";import"./utils-vendor-DUg4_aAP.js";import"./recharts-vendor-DQPXk1vH.js";import"./d3-vendor-DOBQrAlH.js";import"./react-router-D-l5j9EF.js";import"./businessIntelligenceService-sNUkhNJh.js";import"./SEOHead-B2_EtFOU.js";import"./index-DdNfTkp9.js";import"./data-vendor-vzM7rUwp.js";import"./state-vendor-ClT9_nJX.js";import"./SecondaryNav-8trPr0SB.js";const d=({assumptions:t,setAssumptions:s})=>{const n=e=>a=>s({...t,[e]:a});return e.jsx(a,{title:"Assumptions",right:e.jsx(l,{tone:"blue",children:t.currency}),children:e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-12",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(i,{label:"Shares",value:t.shares,onChange:n("shares"),suffix:"sh",step:1e3,min:1}),e.jsx(i,{label:"Price",value:t.price,onChange:n("price"),suffix:t.currency,step:.01,min:0}),e.jsx(i,{label:"Net Debt",value:t.netDebt,onChange:n("netDebt"),suffix:t.currency,step:1e6}),e.jsx(i,{label:"Minority Interest",value:t.minorityInterest,onChange:n("minorityInterest"),suffix:t.currency,step:1e6}),e.jsx(i,{label:"Cash Adj.",value:t.cashAdjust,onChange:n("cashAdjust"),suffix:t.currency,step:1e6})]})}),e.jsx("div",{className:"col-span-12 border-t pt-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(i,{label:"Revenue₀",value:t.rev0,onChange:n("rev0"),suffix:t.currency,step:1e6}),e.jsx(i,{label:"Tax rate",value:t.taxRate,onChange:n("taxRate"),suffix:"ratio",step:.005,min:0,max:.6}),e.jsx(i,{label:"EBIT margin₀",value:t.ebitMargin0,onChange:n("ebitMargin0"),suffix:"ratio",step:.005,min:0,max:.6}),e.jsx(i,{label:"EBIT margin_T",value:t.ebitMarginT,onChange:n("ebitMarginT"),suffix:"ratio",step:.005,min:0,max:.6}),e.jsx(i,{label:"Projection years",value:t.years,onChange:n("years"),step:1,min:3,max:30}),e.jsx(i,{label:"Growth horizon (yrs)",value:t.growthYears,onChange:n("growthYears"),step:1,min:1,max:t.years})]})}),e.jsxs("div",{className:"col-span-12 border-t pt-3",children:[e.jsx("div",{className:"mb-1 text-[12px] font-semibold text-slate-700",children:"Reinvestment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(r,{label:"Use Sales‑to‑Capital",on:"salesToCapital"===t.reinvMethod,setOn:e=>n("reinvMethod")(e?"salesToCapital":"components")}),"salesToCapital"===t.reinvMethod?e.jsx(i,{label:"Sales‑to‑Capital",value:t.salesToCapital,onChange:n("salesToCapital"),step:.1,min:.2,max:10}):e.jsxs(e.Fragment,{children:[e.jsx(i,{label:"Capex % sales",value:t.capexPctSales,onChange:n("capexPctSales"),step:.005,min:0,max:.2}),e.jsx(i,{label:"D&A % sales",value:t.depPctSales,onChange:n("depPctSales"),step:.005,min:0,max:.2}),e.jsx(i,{label:"NWC % sales",value:t.nwcPctSales,onChange:n("nwcPctSales"),step:.005,min:0,max:.5})]})]})]}),e.jsxs("div",{className:"col-span-12 border-t pt-3",children:[e.jsx("div",{className:"mb-1 text-[12px] font-semibold text-slate-700",children:"Capital costs"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(r,{label:"Use CAPM for Ke",on:"capm"===t.capmMode,setOn:e=>n("capmMode")(e?"capm":"manualKe")}),"capm"===t.capmMode?e.jsxs(e.Fragment,{children:[e.jsx(i,{label:"Risk‑free (rf)",value:t.rf,onChange:n("rf"),step:.0025,min:0,max:.2}),e.jsx(i,{label:"Beta",value:t.beta,onChange:n("beta"),step:.05,min:-1,max:3}),e.jsx(i,{label:"ERP",value:t.erp,onChange:n("erp"),step:.005,min:0,max:.15})]}):e.jsx(i,{label:"Ke (manual)",value:t.keManual,onChange:n("keManual"),step:.0025,min:.02,max:.3}),e.jsx(i,{label:"Kd (pre‑tax)",value:t.kd,onChange:n("kd"),step:.0025,min:.01,max:.2}),e.jsx(i,{label:"W_d",value:t.wd,onChange:n("wd"),step:.01,min:0,max:1}),e.jsx(i,{label:"W_e",value:t.we,onChange:n("we"),step:.01,min:0,max:1})]})]}),e.jsxs("div",{className:"col-span-12 border-t pt-3",children:[e.jsx("div",{className:"mb-1 text-[12px] font-semibold text-slate-700",children:"Terminal"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(r,{label:"Gordon Growth",on:"gordon"===t.terminalMethod,setOn:e=>n("terminalMethod")(e?"gordon":"exitMultiple")}),"gordon"===t.terminalMethod?e.jsx(i,{label:"Terminal g",value:t.tg,onChange:n("tg"),step:.001,min:-.02,max:.05}):e.jsxs(e.Fragment,{children:[e.jsx(i,{label:"Exit EV Multiple",value:t.exitEVMultiple,onChange:n("exitEVMultiple"),step:.25,min:2,max:25}),e.jsxs("label",{className:"flex items-center justify-between text-[13px]",children:[e.jsx("span",{className:"text-slate-600",children:"Metric"}),e.jsxs("select",{className:"rounded-md border border-slate-300 bg-white px-2 py-1",value:t.exitMetric,onChange:e=>n("exitMetric")(e.target.value),children:[e.jsx("option",{value:"EBITDA",children:"EBITDA"}),e.jsx("option",{value:"EBIT",children:"EBIT"})]})]})]})]})]})]})})},x=({onAxisChange:s,currentConfig:r})=>{const[l,n]=t.useState(!1),[c,o]=t.useState(r||{wacc:{min:.06,max:.14,steps:5},growth:{min:.015,max:.035,steps:5},exitMultiple:{min:8,max:16,steps:5}}),d=(e,t,a)=>{const i={...c,[e]:{...c[e],[t]:a}};o(i),s?.(i)},x={conservative:{wacc:{min:.08,max:.12,steps:5},growth:{min:.02,max:.03,steps:5},exitMultiple:{min:10,max:14,steps:5}},aggressive:{wacc:{min:.06,max:.16,steps:7},growth:{min:.01,max:.05,steps:7},exitMultiple:{min:6,max:20,steps:7}},tight:{wacc:{min:.075,max:.105,steps:4},growth:{min:.02,max:.03,steps:4},exitMultiple:{min:10,max:14,steps:4}}};return l?e.jsxs(a,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-[14px] font-semibold text-slate-800",children:"Sensitivity Axis Configuration"}),e.jsx("button",{onClick:()=>n(!1),className:"text-[12px] text-slate-500 hover:text-slate-700",children:"✕"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[12px] font-medium text-slate-700",children:"Quick Presets"}),e.jsx("div",{className:"flex gap-2",children:Object.keys(x).map(t=>e.jsx("button",{onClick:()=>(e=>{const t=x[e];o(t),s?.(t)})(t),className:"px-3 py-1 text-[11px] font-medium bg-slate-100 hover:bg-slate-200 rounded-md transition-colors capitalize",children:t},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[12px] font-medium text-slate-700",children:"WACC Range"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(i,{label:"Min",value:c.wacc.min,onChange:e=>d("wacc","min",e),step:.005,min:.01,max:.5,format:"percent",placeholder:"6%"}),e.jsx(i,{label:"Max",value:c.wacc.max,onChange:e=>d("wacc","max",e),step:.005,min:.01,max:.5,format:"percent",placeholder:"14%"}),e.jsx(i,{label:"Steps",value:c.wacc.steps,onChange:e=>d("wacc","steps",e),step:1,min:3,max:10,format:"integer",placeholder:"5"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[12px] font-medium text-slate-700",children:"Terminal Growth Range"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(i,{label:"Min",value:c.growth.min,onChange:e=>d("growth","min",e),step:.0025,min:-.02,max:.1,format:"percent",placeholder:"1.5%"}),e.jsx(i,{label:"Max",value:c.growth.max,onChange:e=>d("growth","max",e),step:.0025,min:-.02,max:.1,format:"percent",placeholder:"3.5%"}),e.jsx(i,{label:"Steps",value:c.growth.steps,onChange:e=>d("growth","steps",e),step:1,min:3,max:10,format:"integer",placeholder:"5"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[12px] font-medium text-slate-700",children:"Exit Multiple Range"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(i,{label:"Min",value:c.exitMultiple.min,onChange:e=>d("exitMultiple","min",e),step:.5,min:1,max:50,format:"number",placeholder:"8x"}),e.jsx(i,{label:"Max",value:c.exitMultiple.max,onChange:e=>d("exitMultiple","max",e),step:.5,min:1,max:50,format:"number",placeholder:"16x"}),e.jsx(i,{label:"Steps",value:c.exitMultiple.steps,onChange:e=>d("exitMultiple","steps",e),step:1,min:3,max:10,format:"integer",placeholder:"5"})]})]}),e.jsx("div",{className:"pt-2 border-t border-slate-200",children:e.jsxs("div",{className:"text-[11px] text-slate-600 space-y-1",children:[e.jsxs("div",{children:["WACC: ",(100*c.wacc.min).toFixed(1),"% → ",(100*c.wacc.max).toFixed(1),"% (",c.wacc.steps," steps)"]}),e.jsxs("div",{children:["Growth: ",(100*c.growth.min).toFixed(1),"% → ",(100*c.growth.max).toFixed(1),"% (",c.growth.steps," steps)"]}),e.jsxs("div",{children:["Exit Multiple: ",c.exitMultiple.min.toFixed(1),"x → ",c.exitMultiple.max.toFixed(1),"x (",c.exitMultiple.steps," steps)"]})]})})]}):e.jsx(a,{className:"p-3",children:e.jsx("button",{onClick:()=>n(!0),className:"w-full text-left text-[13px] text-slate-600 hover:text-slate-800 transition-colors",children:"⚙️ Customize Sensitivity Ranges"})})},m=(e,t=0)=>e>=1e9?`$${(e/1e9).toFixed(t)}B`:e>=1e6?`$${(e/1e6).toFixed(t)}M`:`$${e.toFixed(t)}`,p=(e,t=1)=>`${(100*e).toFixed(t)}%`,h=(e,t,s)=>Math.max(t,Math.min(s,e));function u(e){const t="capm"===e.capmMode?e.rf+e.beta*e.erp:e.keManual;return e.wd*e.kd*(1-e.taxRate)+e.we*t}function g(e,t){const s=[];let a=e.rev0;const i=e.years;for(let r=1;r<=i;r++){const i=a;a*=1+(t[Math.min(r-1,t.length-1)]||0);const l=h((r-1)/Math.max(1,e.growthYears-1),0,1),n=e.ebitMargin0*(1-l)+e.ebitMarginT*l,c=a*n,o=c*(1-e.taxRate);let d=0,x=a*e.depPctSales,m=a*e.capexPctSales,p=(a-i)*e.nwcPctSales;if("salesToCapital"===e.reinvMethod){const t=(a-i)/(e.salesToCapital||1e-9);d=Math.max(0,t),p=Math.max(0,(a-i)*e.nwcPctSales),m=Math.max(0,d-p)+x,x=a*e.depPctSales}else d=Math.max(0,m-x+p);const u=o-d,g="EBITDA"===e.exitMetric?c+x:c;s.push({year:r,revenue:a,ebitMargin:n,ebit:c,nopat:o,reinvest:d,fcff:u,dep:x,capex:m,dNWC:p,metricForExit:g})}return s}function j(e,t,s){const a=t[t.length-1];if("gordon"===e.terminalMethod)return{tv:a.fcff*(1+e.tg)/(s-e.tg),basis:"FCFF",label:"Gordon: FCFFₙ₊₁/(WACC−g)"};{const t=a.metricForExit*e.exitEVMultiple,s=`Exit ${e.exitMetric}×`;return{tv:t,basis:e.exitMetric,label:s}}}function b(e,t){const s=u(e),{pv:a}=function(e,t){let s=0;const a=[];for(let i=0;i<e.length;i++){const r=i+1,l=e[i].fcff/(1+t)**r;s+=l,a.push(l)}return{pv:s,pvSeries:a}}(t,s),{tv:i}=j(e,t,s),r=i/(1+s)**t.length,l=a+r,n=l-e.netDebt-e.minorityInterest+e.cashAdjust,c=n/(e.shares||1e-9);return{ev:l,pvTV:r,pvFCFF:a,tv:i,equity:n,perShare:c,mos:(c-e.price)/(e.price||1e-9)}}function v(e,t,s){const a=[];for(let i=1;i<=t;i++){const r=i<=s?1:Math.max(0,1-(i-s)/(t-s));a.push(e*r)}return a}const f=({validation:t})=>!t||0===t.errors.length&&0===t.warnings.length?null:e.jsxs("div",{className:"space-y-2",children:[t.errors.map((t,s)=>e.jsx("div",{className:"rounded-lg border border-rose-200 bg-rose-50 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5 h-4 w-4 rounded-full bg-rose-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-[10px] font-bold",children:"!"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[13px] font-semibold text-rose-800",children:t.message}),e.jsx("div",{className:"text-[12px] text-rose-700 mt-1",children:t.guidance})]})]})},`error-${s}`)),t.warnings.map((t,s)=>e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5 h-4 w-4 rounded-full bg-amber-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-[10px] font-bold",children:"?"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[13px] font-semibold text-amber-800",children:t.message}),e.jsx("div",{className:"text-[12px] text-amber-700 mt-1",children:t.guidance})]})]})},`warning-${s}`))]}),M=({data:t})=>{if(0===t.length)return null;const s=t[0],a=(t[t.length-1]-s)/24,i=new Array(24).fill(0);for(const e of t)i[Math.min(23,Math.max(0,Math.floor((e-s)/(a||1))))]++;const r=Math.max(...i,1);return e.jsx("svg",{width:360,height:160,className:"text-slate-600",children:i.map((t,s)=>{const a=10+s*(340/24),i=t/r*140;return e.jsx("rect",{x:a,y:150-i,width:340/24-2,height:i,fill:"#60a5fa"},s)})})};function N(e){const t=Math.random();return t<(e.mid-e.min)/(e.max-e.min+1e-9)?e.min+Math.sqrt(t*(e.max-e.min)*(e.mid-e.min)):e.max-Math.sqrt((1-t)*(e.max-e.min)*(e.max-e.mid))}const y=({_projections:t,_onUpdate:s,_currency:a="USD",_financialMetrics:i})=>e.jsx("div",{className:"overflow-auto rounded-xl border border-slate-200",children:e.jsxs("table",{className:"min-w-[720px] text-right text-[12px]",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1 text-left",children:"Year"}),e.jsx("th",{className:"px-2 py-1",children:"Revenue"}),e.jsx("th",{className:"px-2 py-1",children:"EBIT%"}),e.jsx("th",{className:"px-2 py-1",children:"EBIT"}),e.jsx("th",{className:"px-2 py-1",children:"NOPAT"}),e.jsx("th",{className:"px-2 py-1",children:"Reinvest"}),e.jsx("th",{className:"px-2 py-1",children:"FCFF"}),e.jsx("th",{className:"px-2 py-1",children:"D&A"}),e.jsx("th",{className:"px-2 py-1",children:"Capex"}),e.jsx("th",{className:"px-2 py-1",children:"ΔNWC"})]})}),e.jsx("tbody",{children:[{year:2024,revenue:1e5,ebitMargin:.25,ebit:25e3,nopat:18750,reinvest:5e3,fcff:13750,dep:3e3,capex:6e3,dNWC:2e3},{year:2025,revenue:11e4,ebitMargin:.26,ebit:28600,nopat:21450,reinvest:5500,fcff:15950,dep:3300,capex:6600,dNWC:2200},{year:2026,revenue:121e3,ebitMargin:.27,ebit:32670,nopat:24502,reinvest:6050,fcff:18452,dep:3630,capex:7260,dNWC:2420}].map(t=>e.jsxs("tr",{className:"odd:bg-white even:bg-slate-50/40",children:[e.jsx("td",{className:"px-2 py-1 text-left",children:t.year}),e.jsx("td",{className:"px-2 py-1",children:m(t.revenue,0)}),e.jsx("td",{className:"px-2 py-1",children:p(t.ebitMargin,1)}),e.jsx("td",{className:"px-2 py-1",children:m(t.ebit,0)}),e.jsx("td",{className:"px-2 py-1",children:m(t.nopat,0)}),e.jsx("td",{className:"px-2 py-1",children:m(t.reinvest,0)}),e.jsx("td",{className:"px-2 py-1 font-semibold",children:m(t.fcff,0)}),e.jsx("td",{className:"px-2 py-1",children:m(t.dep,0)}),e.jsx("td",{className:"px-2 py-1",children:m(t.capex,0)}),e.jsx("td",{className:"px-2 py-1",children:m(t.dNWC,0)})]},t.year))})]})}),w=({_symbol:s,_onBack:r,_currentValuation:l})=>{const n={price:150,shares:1e6,cashAndInvestments:5e7,debt:25e6,tg:.025,years:5,growthYears:5},[c,o]=t.useState(150),[d,x]=t.useState(0),[m,p]=t.useState("growth"),[h,j]=t.useState(null),[f,M]=t.useState(n),N=(e,t)=>"targetPrice"===t?`$${e.toFixed(2)}`:`${(100*e).toFixed(2)}%`;return e.jsx(a,{title:"Reverse DCF / Implied Expectations",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(i,{label:"Target Price",value:c,onChange:o,suffix:n.currency,step:.01,min:.01}),e.jsx(i,{label:"Target MOS",value:d,onChange:x,suffix:"ratio",step:.01,min:-.5,max:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[12px] font-semibold text-slate-700",children:"Solve For:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{value:"growth",label:"Terminal Growth"},{value:"wacc",label:"WACC (Ke)"},{value:"margin",label:"Terminal Margin"},{value:"targetPrice",label:"Price for MOS"}].map(t=>e.jsx("button",{onClick:()=>p(t.value),className:"px-3 py-2 text-[12px] rounded-md border transition-colors "+(m===t.value?"bg-blue-500 text-white border-blue-500":"bg-white text-slate-600 border-slate-300 hover:bg-slate-50"),children:t.label},t.value))})]}),e.jsx("button",{onClick:()=>{try{let e,t,s;switch(m){case"growth":e=function(e,t,s=1e-6,a=100){let i=-.05,r=.2,l=0;for(;Math.abs(r-i)>s&&l<a;){const s=(i+r)/2,a={...e,tg:s,terminalMethod:"gordon"};b(a,g(a,v(.05,a.years,a.growthYears))).perShare>t?r=s:i=s,l++}return(i+r)/2}(n,c),t="Implied Terminal Growth",s=n.tg;break;case"wacc":e=function(e,t,s=1e-6,a=100){let i=.01,r=.3,l=0;for(;Math.abs(r-i)>s&&l<a;){const s=(i+r)/2,a={...e,capmMode:"manualKe",keManual:s};b(a,g(a,v(.05,a.years,a.growthYears))).perShare>t?i=s:r=s,l++}return(i+r)/2}(n,c),t="Implied WACC (Ke)",s=u(n);break;case"margin":e=function(e,t,s=1e-6,a=100){let i=.01,r=.5,l=0;for(;Math.abs(r-i)>s&&l<a;){const s=(i+r)/2,a={...e,ebitMarginT:s};b(a,g(a,v(.05,a.years,a.growthYears))).perShare>t?r=s:i=s,l++}return(i+r)/2}(n,c),t="Implied Terminal Margin",s=n.ebitMarginT;break;case"targetPrice":e=function(e,t){return e.price*(1+t)}(n,d),t="Target Price for MOS",s=n.price;break;default:return}j({impliedValue:e,label:t,currentValue:s})}catch(e){j({error:"Unable to solve - check assumptions"})}},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Solve Reverse DCF"}),h&&e.jsx("div",{className:"rounded-lg border border-slate-200 p-3",children:h.error?e.jsx("div",{className:"text-rose-600 text-[12px]",children:h.error}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-[13px]",children:[e.jsx("span",{className:"text-slate-600",children:h.label}),e.jsx("span",{className:"font-mono font-semibold text-blue-600",children:N(h.impliedValue,m)})]}),"targetPrice"!==m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between text-[12px] text-slate-500",children:[e.jsx("span",{children:"Current Value"}),e.jsx("span",{className:"font-mono",children:N(h.currentValue,m)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[12px] text-slate-500",children:[e.jsx("span",{children:"Difference"}),e.jsxs("span",{className:"font-mono "+(h.impliedValue>h.currentValue?"text-emerald-600":"text-rose-600"),children:[h.impliedValue>h.currentValue?"+":"",N(h.impliedValue-h.currentValue,m)]})]}),e.jsx("button",{onClick:()=>{if(!h||h.error||"targetPrice"===m)return;const e={...n};switch(m){case"growth":e.tg=h.impliedValue,e.terminalMethod="gordon";break;case"wacc":e.keManual=h.impliedValue,e.capmMode="manualKe";break;case"margin":e.ebitMarginT=h.impliedValue}M(e)},className:"w-full mt-2 px-3 py-1 bg-emerald-500 text-white text-[12px] rounded-md hover:bg-emerald-600 transition-colors",children:"Apply to Assumptions"})]}),"targetPrice"===m&&e.jsxs("div",{className:"text-[11px] text-slate-500",children:["Price needed for ",(100*d).toFixed(1),"% margin of safety"]})]})}),e.jsx("div",{className:"text-[11px] text-slate-500",children:"Solves for the implied value that makes DCF per-share equal target price, or calculates target price for desired margin of safety."})]})})},C=({scenarios:t,setScenarios:s,assumptions:i,setAssumptions:r,rows:l,valuation:n})=>e.jsxs(a,{title:"Scenario Library",right:e.jsx("button",{onClick:()=>{const e={id:Math.random().toString(36).slice(2),name:`${i.name} • ${(new Date).toISOString().slice(0,10)}`,assumptions:{...i},created:(new Date).toISOString()};s([e,...t].slice(0,10))},className:"rounded-md border border-slate-200 bg-white px-2 py-1 text-[12px] hover:bg-slate-50",children:"Save Current"}),children:[e.jsxs("div",{className:"flex items-center justify-between text-[12px] mb-2",children:[e.jsxs("div",{className:"text-slate-600",children:[t.length," saved"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const e=l.map(e=>`${e.year},${e.revenue.toFixed(2)},${(100*e.ebitMargin).toFixed(2)}%,${e.ebit.toFixed(2)},${e.nopat.toFixed(2)},${e.reinvest.toFixed(2)},${e.fcff.toFixed(2)},${e.dep.toFixed(2)},${e.capex.toFixed(2)},${e.dNWC.toFixed(2)}`).join("\n"),t=`\nEV,${n.ev.toFixed(2)}\nEquity,${n.equity.toFixed(2)}\nPerShare,${n.perShare.toFixed(2)}\n`,s=new Blob(["year,revenue,ebit%,ebit,nopat,reinvest,fcff,dep,capex,dnwc\n"+e+t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download="valuation.csv",i.click(),URL.revokeObjectURL(a)},className:"rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50",children:"Export CSV"}),e.jsx("button",{onClick:()=>{const e=new Blob([JSON.stringify({scenarios:t},null,2)],{type:"application/json"}),s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download="scenarios.json",a.click(),URL.revokeObjectURL(s)},className:"rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50",children:"Export JSON"}),e.jsxs("label",{className:"rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50 cursor-pointer",children:["Import JSON",e.jsx("input",{type:"file",accept:".json",onChange:e=>{const a=e.target.files[0];if(!a)return;const i=new FileReader;i.onload=e=>{try{const a=JSON.parse(e.target.result);if(a.scenarios&&Array.isArray(a.scenarios)){const e=new Set(t.map(e=>e.id)),i=a.scenarios.filter(t=>!e.has(t.id));s([...i,...t].slice(0,20))}}catch(a){alert("Invalid JSON file format")}},i.readAsText(a),e.target.value=""},className:"hidden"})]})]})]}),e.jsx("ul",{className:"space-y-1 text-[12px]",children:t.map(a=>e.jsxs("li",{className:"flex items-center justify-between rounded border border-slate-200 px-2 py-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-slate-800",children:a.name}),e.jsx("span",{className:"text-slate-500",children:new Date(a.created).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r({...a.assumptions}),className:"rounded-md border border-slate-200 bg-white px-2 py-1 hover:bg-slate-50",children:"Load"}),e.jsx("button",{onClick:()=>{return e=a.id,s(t.filter(t=>t.id!==e));var e},className:"text-rose-600 hover:text-rose-800",children:"Delete"})]})]},a.id))})]}),S=({grid:t,xLabels:a,yLabels:i})=>{const r=Math.min(...t.flat()),l=Math.max(...t.flat()),n=e=>`hsl(${220-(e-r)/(l-r+1e-9)*220} 80% 55%)`;return e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-200",children:e.jsxs("div",{className:"grid",style:{gridTemplateColumns:`auto repeat(${a.length}, minmax(0,1fr))`},children:[e.jsx("div",{className:"bg-slate-50 px-2 py-1 text-[11px] text-slate-600"}),a.map((t,s)=>e.jsx("div",{className:"bg-slate-50 px-2 py-1 text-center text-[11px] text-slate-600",children:t},s)),i.map((a,i)=>e.jsxs(s.Fragment,{children:[e.jsx("div",{className:"bg-slate-50 px-2 py-1 text-[11px] text-slate-600",children:a}),t[i].map((t,s)=>e.jsx("div",{className:"h-7 text-center text-[11px] flex items-center justify-center text-white font-medium",style:{background:n(t)},children:t.toFixed(2)},s))]},i))]})})};function F(e,t,s){if(1===s)return[e];const a=(t-e)/(s-1);return Array.from({length:s},(t,s)=>e+s*a)}function T(e,t,s,a){const i=[];for(let r=0;r<t.length;r++){const l=[];for(let i=0;i<s.length;i++){const n={...e},c=v(n.growthYears>0?n.ebitMarginT>n.ebitMargin0?.06:.03:0,n.years,n.growthYears);a?(n.terminalMethod="gordon",n.tg=s[i]):(n.terminalMethod="exitMultiple",n.exitEVMultiple=s[i]),"capm"===n.capmMode?(n.rf,n.beta,n.erp):n.keManual,n.wd,n.kd,n.taxRate,n.we;const o=(t[r]-n.wd*n.kd*(1-n.taxRate))/(n.we||1e-9);n.capmMode="manualKe",n.keManual=o;const d=b(n,g(n,c)).perShare;l.push(d)}i.push(l)}return i}const E=({tests:t})=>e.jsx(a,{title:"Dev / Sanity Tests",children:e.jsx("ul",{className:"space-y-1 text-[13px]",children:t.map(t=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-700",children:t.name}),e.jsx("span",{className:"ml-2 "+(t.pass?"text-emerald-600":"text-rose-600"),children:t.pass?"PASS":"FAIL"})]},t.name))})}),k=({items:t})=>{const s=Math.max(...t.map(e=>Math.abs(e.delta)),1);return e.jsx("div",{className:"space-y-1",children:t.map((t,a)=>{const i=Math.abs(t.delta)/s,r=t.delta>=0;return e.jsxs("div",{className:"flex items-center gap-2 text-[12px]",children:[e.jsx("div",{className:"w-40 text-slate-700",children:t.label}),e.jsxs("div",{className:"relative h-5 flex-1 rounded bg-slate-100",children:[e.jsx("div",{className:"absolute top-0 h-5 rounded "+(r?"bg-emerald-400":"bg-rose-400"),style:{width:100*i+"%",left:r?"50%":50-50*i+"%"}}),e.jsx("div",{className:"absolute left-1/2 top-0 h-5 w-px bg-white/60"})]}),e.jsxs("div",{className:"w-20 text-right "+(r?"text-emerald-700":"text-rose-700"),children:[t.delta>=0?"+":"",t.delta.toFixed(2)]})]},a)})})},A=({valuation:t,assumptions:s})=>{const a=t.tv/(t.ev||1e-9);return e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-[13px]",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 p-3",children:[e.jsx("div",{className:"text-slate-500",children:"PV(FCFF)"}),e.jsx("div",{className:"text-lg font-semibold",children:m(t.pvFCFF,0)}),e.jsx("div",{className:"text-slate-500",children:"PV(Terminal)"}),e.jsx("div",{className:"text-lg font-semibold",children:m(t.pvTV,0)}),e.jsx("div",{className:"text-slate-500",children:"EV"}),e.jsx("div",{className:"text-lg font-semibold",children:m(t.ev,0)}),e.jsx("div",{className:"text-slate-500",children:"TV/EV Ratio"}),e.jsx("div",{className:"text-sm font-medium "+(i=a,i>.8?"text-amber-600":i>.6?"text-slate-600":"text-emerald-600"),children:p(a,1)})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 p-3",children:[e.jsx("div",{className:"text-slate-500",children:"EV − Net Debt − MI + Cash Adj."}),e.jsx("div",{className:"text-lg font-semibold",children:m(t.equity,0)}),e.jsx("div",{className:"text-slate-500",children:"Per Share"}),e.jsxs("div",{className:"text-2xl font-bold "+(t.perShare>=s.price?"text-emerald-600":"text-rose-600"),children:[s.currency," ",t.perShare.toFixed(2)]}),e.jsx("div",{className:"text-slate-500",children:"Margin of Safety vs Price"}),e.jsx("div",{className:"text-lg font-semibold "+(t.mos>=0?"text-emerald-700":"text-rose-700"),children:p(t.mos,1)})]})]});var i},V={name:"VALR demo",currency:"USD",shares:3e8,price:25,netDebt:2e9,minorityInterest:0,cashAdjust:0,rev0:5e9,growthYears:5,years:10,taxRate:.23,ebitMargin0:.12,ebitMarginT:.18,reinvMethod:"salesToCapital",salesToCapital:2.5,capexPctSales:.05,depPctSales:.04,nwcPctSales:.1,capmMode:"capm",rf:.04,beta:1.1,erp:.05,keManual:.1,kd:.06,wd:.25,we:.75,terminalMethod:"gordon",tg:.025,exitEVMultiple:9,exitMetric:"EBITDA"},P=()=>{const[s,i]=t.useState({...V}),[r,m]=t.useState([]),[P,$]=t.useState(null),[R,I]=t.useState({wacc:{min:.06,max:.14,steps:5},growth:{min:.015,max:.035,steps:5},exitMultiple:{min:8,max:16,steps:5}}),{auditLog:L,updateAssumptions:W,clearAuditLog:D,exportAuditLog:O}=n(s,i),Y=t.useMemo(()=>v(.05,s.years,s.growthYears),[s.years,s.growthYears]),B=t.useMemo(()=>g(s,Y),[s,Y]),_=t.useMemo(()=>b(s,B),[s,B]),G=t.useMemo(()=>u(s),[s]),U=t.useMemo(()=>function(e,t=null){const s=t||{wacc:{min:.06,max:.14,steps:5},growth:{min:.015,max:.035,steps:5},exitMultiple:{min:8,max:16,steps:5}},a=F(s.wacc.min,s.wacc.max,s.wacc.steps),i=F(s.growth.min,s.growth.max,s.growth.steps),r=F(s.exitMultiple.min,s.exitMultiple.max,s.exitMultiple.steps);return{waccGrowth:{grid:T(e,a,i,!0),xLabels:i.map(e=>(100*e).toFixed(1)+"%"),yLabels:a.map(e=>(100*e).toFixed(1)+"%"),title:"WACC × Terminal Growth"},waccExit:{grid:T(e,a,r,!1),xLabels:r.map(e=>e.toFixed(1)+"x"),yLabels:a.map(e=>(100*e).toFixed(1)+"%"),title:"WACC × Exit Multiple"}}}(s,R),[s,R]),q=t.useMemo(()=>function(e,t,s){const a=(t,a)=>{const i={...e};return a(i),{label:t,delta:b(i,g(i,v(i.growthYears>0?i.ebitMarginT>i.ebitMargin0?.06:.03:0,i.years,i.growthYears))).perShare-s}};return[a("WACC +100 bps",e=>{"capm"===e.capmMode?e.rf+=.01:e.keManual+=.01}),a("WACC −100 bps",e=>{"capm"===e.capmMode?e.rf-=.01:e.keManual-=.01}),a("Terminal g +50 bps",e=>{e.terminalMethod="gordon",e.tg+=.005}),a("Terminal g −50 bps",e=>{e.terminalMethod="gordon",e.tg-=.005}),a("Exit multiple +1x",e=>{e.terminalMethod="exitMultiple",e.exitEVMultiple+=1}),a("Exit multiple −1x",e=>{e.terminalMethod="exitMultiple",e.exitEVMultiple-=1}),a("EBIT margin +100 bps",e=>{e.ebitMarginT+=.01}),a("EBIT margin −100 bps",e=>{e.ebitMarginT-=.01}),a("Sales‑to‑Capital +0.5",e=>{e.reinvMethod="salesToCapital",e.salesToCapital+=.5}),a("Sales‑to‑Capital −0.5",e=>{e.reinvMethod="salesToCapital",e.salesToCapital=Math.max(.1,e.salesToCapital-.5)})].sort((e,t)=>Math.abs(t.delta)-Math.abs(e.delta))}(s,0,_.perShare),[s,B,_.perShare]),K=t.useMemo(()=>function(e){return{g:{min:.02,mid:.05,max:.08},marginT:{min:e.ebitMargin0,mid:e.ebitMarginT,max:Math.max(e.ebitMarginT+.05,.25)},waccShifter:{min:-.01,mid:0,max:.01},stc:{min:1.5,mid:e.salesToCapital,max:3.5},tgOrExit:"gordon"===e.terminalMethod?{min:0,mid:e.tg,max:.04}:{min:6,mid:e.exitEVMultiple,max:12}}}(s),[s]),H=t.useMemo(()=>function(e,t,s){const a=[],i=u(e),r=t.reduce((e,t,s)=>e+t.fcff/(1+i)**(s+1),0),l=j(e,t,i).tv,n=l/(1+i)**t.length;a.push({name:"EV identity (PV_FCFF + PV_TV)",pass:Math.abs(r+n-s.ev)<1e-6}),"gordon"===e.terminalMethod&&a.push({name:"WACC > g (Gordon)",pass:i>e.tg});const c={...e,rf:e.rf+.005},o={...e,rf:Math.max(0,e.rf-.005)},d=b(c,g(c,v(.05,c.years,c.growthYears))).perShare,x=b(o,g(o,v(.05,o.years,o.growthYears))).perShare;a.push({name:"Per‑share ↓ when WACC ↑",pass:d<s.perShare&&x>s.perShare}),a.push({name:"Reinvestment non‑negative",pass:t.every(e=>e.reinvest>=-1e-9)}),a.push({name:"FCFF finite",pass:t.every(e=>Number.isFinite(e.fcff))});const m={...e,rev0:10*e.rev0,netDebt:10*e.netDebt,minorityInterest:10*e.minorityInterest,cashAdjust:10*e.cashAdjust,price:10*e.price},p=b(m,g(m,v(.05,m.years,m.growthYears)));if(a.push({name:"Currency-scale invariance",pass:Math.abs(p.perShare/10-s.perShare)<1e-6}),e.netDebt<0){const t={...e,netDebt:0},i=b(t,g(t,v(.05,t.years,t.growthYears)));a.push({name:"Net cash increases equity",pass:s.equity>i.equity})}if(a.push({name:"Shares > 0 (division safe)",pass:e.shares>0}),"gordon"===e.terminalMethod&&e.tg>0&&i>e.tg){const i=l/t[t.length-1].metricForExit,r={...e,terminalMethod:"exitMultiple",exitEVMultiple:i},n=b(r,g(r,v(.05,r.years,r.growthYears)));a.push({name:"Terminal method parity",pass:Math.abs(n.perShare-s.perShare)<.01})}return a}(s,B,_),[s,B,_]),z=t.useMemo(()=>function(e){const t=[],s=[],a=u(e);return"gordon"===e.terminalMethod&&a<=e.tg&&t.push({type:"gordon_constraint",message:"WACC ≤ Terminal Growth Rate",guidance:`WACC (${(100*a).toFixed(1)}%) must exceed terminal growth (${(100*e.tg).toFixed(1)}%). Try lowering terminal growth or increasing WACC components.`,severity:"critical"}),e.shares<=0&&t.push({type:"shares_invalid",message:"Invalid Share Count",guidance:"Shares outstanding must be positive to calculate per-share value.",severity:"critical"}),e.price<=0&&s.push({type:"price_zero",message:"Zero Stock Price",guidance:"Margin of Safety calculation may be unreliable with zero price.",severity:"warning"}),e.salesToCapital<.5&&s.push({type:"low_stc",message:"Very Low Sales-to-Capital",guidance:`Sales-to-Capital of ${e.salesToCapital.toFixed(1)}x implies very high reinvestment needs. Consider if this is realistic.`,severity:"warning"}),e.ebitMarginT>.4&&s.push({type:"high_margin",message:"Very High Terminal Margin",guidance:`Terminal EBIT margin of ${(100*e.ebitMarginT).toFixed(1)}% is unusually high. Verify competitive sustainability.`,severity:"warning"}),"exitMultiple"===e.terminalMethod&&e.exitEVMultiple>20&&s.push({type:"high_multiple",message:"High Exit Multiple",guidance:`Exit multiple of ${e.exitEVMultiple.toFixed(1)}x may produce unrealistic terminal values.`,severity:"warning"}),e.rf<0&&s.push({type:"negative_rf",message:"Negative Risk-Free Rate",guidance:"Negative risk-free rates can create unusual WACC dynamics. Verify your rate source.",severity:"warning"}),{errors:t,warnings:s,isValid:0===t.length}}(s),[s]);return t.useEffect(()=>{$(null)},[s]),e.jsxs("div",{className:"min-h-[100dvh] bg-background text-foreground",children:[e.jsx(o,{}),e.jsxs("div",{className:"pt-[60px]",children:[e.jsx("div",{className:"border-b border-border bg-card",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-md bg-primary",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4 text-white",children:e.jsx("path",{d:"M4 6h16M4 12h10M4 18h7",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs tracking-wide text-muted-foreground",children:"FinanceAnalyst Pro"}),e.jsx("div",{className:"text-[13px] font-semibold text-foreground",children:"Valuation Workbench"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[12px]",children:[e.jsx(l,{tone:"green",children:`WACC ${p(G,1)}`}),e.jsx(l,{tone:"amber",children:"gordon"===s.terminalMethod?`g ${p(s.tg,1)}`:`Exit ×${s.exitEVMultiple.toFixed(1)} ${s.exitMetric}`}),e.jsx(l,{tone:"blue",children:_.perShare>=s.price?"Undervalued":"Overvalued"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-4 space-y-4",children:[e.jsx(d,{assumptions:s,setAssumptions:W}),e.jsx(f,{validation:z}),e.jsx(w,{assumptions:s,setAssumptions:W,currentValuation:_}),e.jsx(c,{auditLog:L,onClear:D,onExport:O}),e.jsx(C,{scenarios:r,setScenarios:m,assumptions:s,setAssumptions:W,rows:B,valuation:_})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-5 space-y-4",children:[e.jsx(a,{title:"10‑Year Projections (FCFF)",children:e.jsx(y,{rows:B,currency:s.currency})}),e.jsx(a,{title:"Enterprise → Equity Bridge",children:e.jsx(A,{valuation:_,assumptions:s})})]}),e.jsxs("div",{className:"col-span-12 lg:col-span-3 space-y-4",children:[e.jsxs(a,{className:"p-4",children:[e.jsx("h3",{className:"text-[16px] font-semibold text-foreground mb-4",children:"Sensitivity Analysis"}),e.jsx("div",{className:"mb-4",children:e.jsx(x,{currentConfig:R,onAxisChange:I})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-[14px] font-medium text-foreground mb-2",children:U.waccGrowth.title}),e.jsx(S,{grid:U.waccGrowth.grid,xLabels:U.waccGrowth.xLabels,yLabels:U.waccGrowth.yLabels})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[14px] font-medium text-foreground mb-2",children:U.waccExit.title}),e.jsx(S,{grid:U.waccExit.grid,xLabels:U.waccExit.xLabels,yLabels:U.waccExit.yLabels})]})]})]}),e.jsx(a,{title:"Tornado (Δ per‑share)",children:e.jsx(k,{items:q})}),e.jsx(a,{title:"Monte Carlo (1000 runs)",right:e.jsx("button",{onClick:()=>$(function(e,t,s=1e3){const a=[];for(let r=0;r<s;r++){const s={...e},i=v(N(t.g),s.years,s.growthYears);s.ebitMarginT=h(N(t.marginT),0,.6);const r=N(t.waccShifter);"capm"===s.capmMode?s.rf=Math.max(0,s.rf+r):s.keManual=Math.max(.01,s.keManual+r),s.salesToCapital=Math.max(.2,N(t.stc)),"gordon"===s.terminalMethod?s.tg=h(N(t.tgOrExit),-.01,.05):s.exitEVMultiple=Math.max(2,N(t.tgOrExit));const l=g(s,i);a.push(b(s,l).perShare)}a.sort((e,t)=>e-t);const i=e=>a[Math.max(0,Math.min(a.length-1,Math.floor(e*(a.length-1))))];return{vals:a,p5:i(.05),p50:i(.5),p95:i(.95)}}(s,K,1e3)),className:"rounded-md border border-border bg-card px-2 py-1 text-[12px] hover:bg-muted",children:"Run"}),children:P?e.jsxs("div",{className:"space-y-2 text-[12px]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"P5"}),e.jsx("span",{className:"font-mono",children:P.p5.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"P50"}),e.jsx("span",{className:"font-mono",children:P.p50.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"P95"}),e.jsx("span",{className:"font-mono",children:P.p95.toFixed(2)})]}),e.jsx(M,{data:P.vals})]}):e.jsx("div",{className:"text-[12px] text-muted-foreground",children:"Stochastic valuation with triangular priors on g, margins, WACC shift, S/C, terminal. Click Run."})})]})]}),e.jsx(E,{tests:H}),e.jsx("div",{className:"mt-2 text-[11px] text-muted-foreground",children:"Tip: to feed real tickers, pipe reported revenue, margins, share count, and balance sheet into the assumptions; set priors from historical distributions."})]})]})]})};export{P as default};
//# sourceMappingURL=ValuationWorkbench-DK1Rcqaj.js.map
