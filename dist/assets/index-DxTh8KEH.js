import{j as e,I as t}from"./index-By8bwNCY.js";import{r as s}from"./react-vendor-BaLqnLcQ.js";import{B as a}from"./Button-BTp6y2ew.js";import{H as r}from"./Header-CFwDfd7Y.js";import{d as n}from"./dataFetching-D13QSlSP.js";import"./ui-vendor-Cvmjbkc9.js";import"./charts-vendor-D2zAVpJz.js";import"./utils-vendor-Cj_bvvWu.js";import"./data-vendor-B1ga0eaz.js";const i=({calculations:r,errors:n,warnings:i})=>{const[l,o]=s.useState("calculations"),[c,d]=s.useState(new Set),[m,u]=s.useState("all"),x={calculations:[{id:1,timestamp:new Date(Date.now()-3e5),type:"calculation",operation:"DCF Valuation",formula:"NPV(FCFF_2024:2028, WACC)",result:2547.5,inputs:{FCFF_2024:187.5,FCFF_2025:206.3,FCFF_2026:226.9,FCFF_2027:249.6,FCFF_2028:274.6,WACC:.098},executionTime:.045,status:"success"},{id:2,timestamp:new Date(Date.now()-6e5),type:"calculation",operation:"WACC Calculation",formula:"WACC(cost_equity, cost_debt, tax_rate, debt_ratio)",result:.098,inputs:{cost_equity:.123,cost_debt:.045,tax_rate:.25,debt_ratio:.4},executionTime:.012,status:"success"},{id:3,timestamp:new Date(Date.now()-9e5),type:"calculation",operation:"Terminal Value",formula:"TERMINAL_VALUE(FCF_final, terminal_growth, WACC)",result:1247.3,inputs:{FCF_final:274.6,terminal_growth:.025,WACC:.098},executionTime:.008,status:"success"}],errors:[{id:1,timestamp:new Date(Date.now()-12e5),type:"error",severity:"high",message:"Division by zero in WACC calculation",formula:"WACC(cost_equity, cost_debt, tax_rate, debt_ratio)",location:"Cell B15",suggestion:"Ensure debt_ratio is not equal to 1.0",resolved:!0}],warnings:[{id:1,timestamp:new Date(Date.now()-18e4),type:"warning",severity:"medium",message:"Beta coefficient (1.15) is above industry average (0.95)",formula:"CAPM(risk_free, beta, market_premium)",location:"Assumptions",suggestion:"Consider reviewing beta calculation or using industry average",acknowledged:!1},{id:2,timestamp:new Date(Date.now()-42e4),type:"warning",severity:"low",message:"Terminal growth rate (2.5%) close to discount rate component",formula:"TERMINAL_VALUE(FCF_final, terminal_growth, WACC)",location:"Terminal Value",suggestion:"Ensure terminal growth rate is reasonable for long-term GDP growth",acknowledged:!0}],validations:[{id:1,timestamp:new Date(Date.now()-6e4),type:"validation",check:"Circular Reference Check",status:"passed",details:"No circular references detected in model"},{id:2,timestamp:new Date(Date.now()-12e4),type:"validation",check:"Balance Sheet Check",status:"passed",details:"Assets = Liabilities + Equity for all projection years"},{id:3,timestamp:new Date(Date.now()-24e4),type:"validation",check:"Cash Flow Consistency",status:"warning",details:"Minor rounding differences in cash flow statements (<$0.1M)"}]},p=[{id:"calculations",label:"Calculations",icon:"Calculator",count:x.calculations.length},{id:"errors",label:"Errors",icon:"XCircle",count:x.errors.length},{id:"warnings",label:"Warnings",icon:"AlertTriangle",count:x.warnings.length},{id:"validations",label:"Validations",icon:"CheckCircle",count:x.validations.length}],h=e=>{switch(e){case"success":case"passed":return{icon:"CheckCircle",color:"text-success"};case"error":return{icon:"XCircle",color:"text-destructive"};case"warning":return{icon:"AlertTriangle",color:"text-warning"};default:return{icon:"Info",color:"text-muted-foreground"}}},f=e=>{switch(e){case"high":return"text-destructive bg-destructive/10";case"medium":return"text-warning bg-warning/10";default:return"text-muted-foreground bg-muted"}},g=()=>e.jsx("div",{className:"space-y-3",children:x.calculations.map(s=>{return e.jsxs("div",{className:"p-4 bg-background border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(t,{name:"Calculator",size:16,className:"text-primary"}),e.jsx("span",{className:"font-medium text-foreground",children:s.operation}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${h(s.status).color} bg-current/10`,children:s.status})]}),e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded font-mono text-foreground block mb-2",children:s.formula}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[e.jsx("span",{children:s.timestamp.toLocaleTimeString()}),e.jsxs("span",{children:["Execution: ",(r=s.executionTime,r<.001?"<1ms":r<1?`${(1e3*r).toFixed(0)}ms`:`${r.toFixed(2)}s`)]}),e.jsxs("span",{children:["Result: $",s.result.toFixed(2),"M"]})]})]}),e.jsx(a,{variant:"ghost",size:"sm",iconName:c.has(s.id)?"ChevronUp":"ChevronDown",onClick:()=>(e=>{const t=new Set(c);t.has(e)?t.delete(e):t.add(e),d(t)})(s.id)})]}),c.has(s.id)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("h5",{className:"text-sm font-medium text-foreground mb-2",children:"Input Values"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(s.inputs).map(([t,s])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[t,":"]}),e.jsx("span",{className:"text-foreground font-mono",children:"number"==typeof s?s.toFixed(3):s})]},t))})]})]},s.id);var r})});return e.jsxs("div",{className:"flex flex-col h-full bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"FileText",size:20,className:"text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Audit Trail"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",iconName:"Download",children:"Export Log"}),e.jsx(a,{variant:"outline",size:"sm",iconName:"RefreshCw",children:"Refresh"})]})]}),e.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:p.map(s=>e.jsxs("button",{onClick:()=>o(s.id),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(l===s.id?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(t,{name:s.icon,size:16}),e.jsx("span",{children:s.label}),s.count>0&&e.jsx("span",{className:"px-2 py-1 bg-current/20 rounded-full text-xs",children:s.count})]},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(()=>{switch(l){case"calculations":default:return g();case"errors":return e.jsx("div",{className:"space-y-3",children:x.errors.map(s=>e.jsx("div",{className:"p-4 bg-background border border-destructive/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:"XCircle",size:16,className:"text-destructive mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.message}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${f(s.severity)}`,children:s.severity}),s.resolved&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs text-success bg-success/10",children:"Resolved"})]}),e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded font-mono text-foreground block mb-2",children:s.formula}),e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Location: ",s.location]}),e.jsxs("div",{className:"text-sm text-foreground bg-muted/50 p-2 rounded",children:[e.jsx("strong",{children:"Suggestion:"})," ",s.suggestion]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:s.timestamp.toLocaleString()})]})]})},s.id))});case"warnings":return e.jsx("div",{className:"space-y-3",children:x.warnings.map(s=>e.jsx("div",{className:"p-4 bg-background border border-warning/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:"AlertTriangle",size:16,className:"text-warning mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.message}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${f(s.severity)}`,children:s.severity}),s.acknowledged&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs text-muted-foreground bg-muted",children:"Acknowledged"})]}),e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded font-mono text-foreground block mb-2",children:s.formula}),e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Location: ",s.location]}),e.jsxs("div",{className:"text-sm text-foreground bg-muted/50 p-2 rounded",children:[e.jsx("strong",{children:"Suggestion:"})," ",s.suggestion]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timestamp.toLocaleString()}),!s.acknowledged&&e.jsx(a,{variant:"outline",size:"sm",children:"Acknowledge"})]})]})]})},s.id))});case"validations":return e.jsx("div",{className:"space-y-3",children:x.validations.map(s=>e.jsx("div",{className:"p-4 bg-background border border-border rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:h(s.status).icon,size:16,className:`${h(s.status).color} mt-0.5`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:s.check}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${h(s.status).color} bg-current/10`,children:s.status})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:s.details}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timestamp.toLocaleString()})]})]})},s.id))})}})()}),e.jsx("div",{className:"p-4 border-t border-border bg-muted/50",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Last updated: ",(new Date).toLocaleTimeString()]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:"Auto-refresh: ON"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),e.jsx("span",{children:"Audit logging active"})]})]})})]})},l=({results:r,onExport:n})=>{const[i,l]=s.useState("summary"),[o,c]=s.useState(new Set(["valuation"])),d={summary:{enterpriseValue:2847.5,equityValue:2547.5,sharePrice:127.38,impliedReturn:.156,confidence:.87},cashFlows:[{year:2024,revenue:1250,ebitda:312.5,fcf:187.5,pv:170.5},{year:2025,revenue:1375,ebitda:343.8,fcf:206.3,pv:172.8},{year:2026,revenue:1513,ebitda:378.2,fcf:226.9,pv:175.2},{year:2027,revenue:1664,ebitda:416,fcf:249.6,pv:177.7},{year:2028,revenue:1830,ebitda:457.6,fcf:274.6,pv:180.3}],sensitivity:{wacc:[.08,.09,.1,.11,.12],growth:[.015,.02,.025,.03,.035],matrix:[[145.2,138.7,132.8,127.4,122.5],[152.1,144.9,138.2,132.1,126.4],[159.8,151.9,144.6,137.8,131.6],[168.4,159.7,151.8,144.4,137.6],[178.1,168.4,159.7,151.8,144.4]]},scenarios:[{name:"Base Case",probability:.6,sharePrice:127.38,irr:.156},{name:"Bull Case",probability:.25,sharePrice:145.67,irr:.189},{name:"Bear Case",probability:.15,sharePrice:98.42,irr:.087}],multiples:[{metric:"EV/Revenue",current:2.3,peer_avg:2.8,premium:-17.9},{metric:"EV/EBITDA",current:9.1,peer_avg:11.2,premium:-18.8},{metric:"P/E Ratio",current:18.5,peer_avg:22.1,premium:-16.3},{metric:"P/B Ratio",current:2.1,peer_avg:2.6,premium:-19.2}]},m=(e,t=2)=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:t,maximumFractionDigits:t}).format(e),u=(e,t=1)=>`${(100*e).toFixed(t)}%`,x=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Enterprise Value"}),e.jsx(t,{name:"Building",size:16,className:"text-muted-foreground"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-2xl font-bold text-foreground",children:[m(d.summary.enterpriseValue,1),"M"]})})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Equity Value"}),e.jsx(t,{name:"PieChart",size:16,className:"text-muted-foreground"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-2xl font-bold text-foreground",children:[m(d.summary.equityValue,1),"M"]})})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Share Price"}),e.jsx(t,{name:"DollarSign",size:16,className:"text-muted-foreground"})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-2xl font-bold text-foreground",children:m(d.summary.sharePrice)})})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Implied Return"}),e.jsx(t,{name:"TrendingUp",size:16,className:"text-success"})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-2xl font-bold text-success",children:u(d.summary.impliedReturn)})})]})]}),e.jsxs("div",{className:"p-4 bg-background border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Model Confidence"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:u(d.summary.confidence)})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-success h-2 rounded-full transition-all duration-300",style:{width:100*d.summary.confidence+"%"}})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Based on data quality, assumption validity, and sensitivity analysis"})]})]});return e.jsxs("div",{className:"flex flex-col h-full bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Calculator",size:20,className:"text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Calculation Results"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",iconName:"Download",onClick:()=>n&&n("excel"),children:"Export"}),e.jsx(a,{variant:"outline",size:"sm",iconName:"Share2",children:"Share"})]})]}),e.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:[{id:"summary",label:"Summary",icon:"BarChart3"},{id:"cashflows",label:"Cash Flows",icon:"TrendingUp"},{id:"sensitivity",label:"Sensitivity",icon:"Target"},{id:"scenarios",label:"Scenarios",icon:"GitBranch"},{id:"multiples",label:"Multiples",icon:"Layers"}].map(s=>e.jsxs("button",{onClick:()=>l(s.id),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(i===s.id?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(t,{name:s.icon,size:16}),e.jsx("span",{children:s.label})]},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:(()=>{switch(i){case"summary":default:return x();case"cashflows":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-2 text-muted-foreground font-medium",children:"Year"}),e.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Revenue"}),e.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"EBITDA"}),e.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"FCF"}),e.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Present Value"})]})}),e.jsx("tbody",{children:d.cashFlows.map((t,s)=>e.jsxs("tr",{className:"border-b border-border/50",children:[e.jsx("td",{className:"py-3 text-foreground font-medium",children:t.year}),e.jsxs("td",{className:"py-3 text-right text-foreground",children:[m(t.revenue,0),"M"]}),e.jsxs("td",{className:"py-3 text-right text-foreground",children:[m(t.ebitda,1),"M"]}),e.jsxs("td",{className:"py-3 text-right text-foreground",children:[m(t.fcf,1),"M"]}),e.jsxs("td",{className:"py-3 text-right text-success font-medium",children:[m(t.pv,1),"M"]})]},s))})]})}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Terminal Value"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:[m(1247.3,1),"M"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"2.5% perpetual growth rate applied to 2028 FCF"})]})]});case"sensitivity":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-2",children:"Share Price Sensitivity Analysis"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"WACC vs Terminal Growth Rate"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left text-muted-foreground",children:"WACC \\ Growth"}),d.sensitivity.growth.map((t,s)=>e.jsx("th",{className:"p-2 text-center text-muted-foreground",children:u(t)},s))]})}),e.jsx("tbody",{children:d.sensitivity.wacc.map((t,s)=>e.jsxs("tr",{className:"border-t border-border/50",children:[e.jsx("td",{className:"p-2 text-muted-foreground font-medium",children:u(t)}),d.sensitivity.matrix[s].map((t,s)=>e.jsx("td",{className:"p-2 text-center font-medium "+(Math.abs(t-127.38)<5?"bg-primary/20 text-primary":"text-foreground"),children:m(t)},s))]},s))})]})})]});case"scenarios":return e.jsx("div",{className:"space-y-4",children:d.scenarios.map((t,s)=>e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.name}),e.jsxs("span",{className:"text-xs bg-background px-2 py-1 rounded text-muted-foreground",children:[u(t.probability)," probability"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-foreground",children:m(t.sharePrice)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[u(t.irr)," IRR"]})]})]}),e.jsx("div",{className:"w-full bg-background rounded-full h-1",children:e.jsx("div",{className:"bg-primary h-1 rounded-full",style:{width:100*t.probability+"%"}})})]},s))});case"multiples":return e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-2 text-muted-foreground font-medium",children:"Multiple"}),e.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Current"}),e.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Peer Avg"}),e.jsx("th",{className:"text-right py-2 text-muted-foreground font-medium",children:"Premium/Discount"})]})}),e.jsx("tbody",{children:d.multiples.map((t,s)=>e.jsxs("tr",{className:"border-b border-border/50",children:[e.jsx("td",{className:"py-3 text-foreground font-medium",children:t.metric}),e.jsxs("td",{className:"py-3 text-right text-foreground",children:[t.current,"x"]}),e.jsxs("td",{className:"py-3 text-right text-foreground",children:[t.peer_avg,"x"]}),e.jsxs("td",{className:"py-3 text-right font-medium "+(t.premium>0?"text-success":"text-destructive"),children:[t.premium>0?"+":"",t.premium.toFixed(1),"%"]})]},s))})]})})})}})()}),e.jsx("div",{className:"p-4 border-t border-border bg-muted/50",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Last Updated: ",(new Date).toLocaleTimeString()]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:"Auto-refresh: ON"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),e.jsx("span",{children:"Calculations current"})]})]})})]})},o=({onFormulaCreate:r,variables:n})=>{const[i,l]=s.useState("valuation"),[o,c]=s.useState(null),[d,m]=s.useState(""),[u,x]=s.useState(""),[p,h]=s.useState(!1),f=s.useRef(null),g={valuation:{name:"Valuation",icon:"TrendingUp",functions:[{name:"DCF",syntax:"DCF(fcf_array, discount_rate, terminal_growth)",description:"Discounted Cash Flow valuation"},{name:"NPV",syntax:"NPV(cash_flows, discount_rate)",description:"Net Present Value calculation"},{name:"IRR",syntax:"IRR(cash_flows)",description:"Internal Rate of Return"},{name:"TERMINAL_VALUE",syntax:"TERMINAL_VALUE(final_fcf, growth_rate, discount_rate)",description:"Terminal value calculation"},{name:"WACC",syntax:"WACC(cost_equity, cost_debt, tax_rate, debt_ratio)",description:"Weighted Average Cost of Capital"}]},financial:{name:"Financial Ratios",icon:"Calculator",functions:[{name:"ROE",syntax:"ROE(net_income, shareholders_equity)",description:"Return on Equity"},{name:"ROA",syntax:"ROA(net_income, total_assets)",description:"Return on Assets"},{name:"DEBT_TO_EQUITY",syntax:"DEBT_TO_EQUITY(total_debt, total_equity)",description:"Debt to Equity ratio"},{name:"CURRENT_RATIO",syntax:"CURRENT_RATIO(current_assets, current_liabilities)",description:"Current ratio calculation"},{name:"QUICK_RATIO",syntax:"QUICK_RATIO(quick_assets, current_liabilities)",description:"Quick ratio calculation"}]},statistical:{name:"Statistical",icon:"BarChart3",functions:[{name:"CORRELATION",syntax:"CORRELATION(dataset1, dataset2)",description:"Correlation coefficient"},{name:"REGRESSION",syntax:"REGRESSION(dependent_var, independent_var)",description:"Linear regression analysis"},{name:"VOLATILITY",syntax:"VOLATILITY(returns, period)",description:"Historical volatility"},{name:"BETA",syntax:"BETA(stock_returns, market_returns)",description:"Beta coefficient calculation"},{name:"SHARPE_RATIO",syntax:"SHARPE_RATIO(returns, risk_free_rate)",description:"Risk-adjusted return metric"}]},mathematical:{name:"Mathematical",icon:"Sigma",functions:[{name:"SUM",syntax:"SUM(range)",description:"Sum of values"},{name:"AVERAGE",syntax:"AVERAGE(range)",description:"Average of values"},{name:"MEDIAN",syntax:"MEDIAN(range)",description:"Median value"},{name:"STDEV",syntax:"STDEV(range)",description:"Standard deviation"},{name:"PERCENTILE",syntax:"PERCENTILE(range, percentile)",description:"Percentile calculation"}]}},b=()=>(d.match(/\(/g)||[]).length===(d.match(/\)/g)||[]).length;return e.jsxs("div",{className:"flex flex-col h-full bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Wrench",size:20,className:"text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Formula Builder"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(a,{variant:"outline",size:"sm",iconName:"Plus",onClick:()=>h(!p),children:"New Formula"})})]}),e.jsx("div",{className:"flex border-b border-border",children:Object.entries(g).map(([s,a])=>e.jsxs("button",{onClick:()=>l(s),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-smooth "+(i===s?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(t,{name:a.icon,size:16}),e.jsx("span",{children:a.name})]},s))}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"p-4 space-y-3",children:g[i].functions.map((s,r)=>e.jsx("div",{draggable:!0,onDragStart:e=>((e,t)=>{c(t),e.dataTransfer.effectAllowed="copy"})(e,s),className:"p-3 bg-muted rounded-lg border border-border cursor-move hover:bg-muted/80 transition-smooth group",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Move",size:14,className:"text-muted-foreground group-hover:text-foreground"}),e.jsx("span",{className:"font-medium text-foreground",children:s.name})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsx("code",{className:"text-xs bg-background px-2 py-1 rounded mt-2 block font-mono text-foreground",children:s.syntax})]}),e.jsx(a,{variant:"ghost",size:"sm",iconName:"Plus",onClick:()=>(e=>{const t=d+(d?" + ":"")+e.syntax;m(t)})(s),className:"opacity-0 group-hover:opacity-100 transition-opacity"})]})},r))}),e.jsxs("div",{className:"border-t border-border p-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground mb-3 flex items-center space-x-2",children:[e.jsx(t,{name:"BookOpen",size:16}),e.jsx("span",{children:"Saved Formulas"})]}),e.jsx("div",{className:"space-y-2",children:[{name:"Custom_DCF_Tech",formula:"DCF(FCFF_PROJECTIONS, WACC(0.12, 0.04, 0.25, 0.3), 0.025)",category:"Custom"},{name:"LBO_Returns",formula:"IRR([INITIAL_INVESTMENT * -1, EXIT_VALUE])",category:"Custom"},{name:"Comp_Multiple",formula:"AVERAGE(PEER_EV_REVENUE) * TARGET_REVENUE",category:"Custom"}].map((t,s)=>e.jsxs("div",{className:"p-3 bg-background rounded-lg border border-border hover:bg-muted/50 transition-smooth cursor-pointer",onClick:()=>m(t.formula),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.name}),e.jsx("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:t.category})]}),e.jsx("code",{className:"text-xs text-muted-foreground mt-1 block font-mono",children:t.formula})]},s))})]})]}),p&&e.jsx("div",{className:"border-t border-border bg-background",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Formula Name"}),e.jsx("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:"Enter formula name...",className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Formula Expression"}),e.jsx("div",{ref:f,onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:e=>{if(e.preventDefault(),o){const e=d+(d?" + ":"")+o.syntax;m(e),c(null)}},className:"min-h-[100px] p-3 bg-input border-2 border-dashed border-border rounded-lg focus-within:border-ring transition-colors",children:e.jsx("textarea",{value:d,onChange:e=>m(e.target.value),placeholder:"Drag functions here or type formula manually...",className:"w-full h-20 bg-transparent text-foreground placeholder-muted-foreground resize-none outline-none font-mono text-sm"})}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("div",{className:"flex items-center space-x-2",children:b()?e.jsxs("div",{className:"flex items-center space-x-1 text-success",children:[e.jsx(t,{name:"CheckCircle",size:14}),e.jsx("span",{className:"text-xs",children:"Valid syntax"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-destructive",children:[e.jsx(t,{name:"XCircle",size:14}),e.jsx("span",{className:"text-xs",children:"Invalid syntax"})]})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[d.length," characters"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(a,{variant:"outline",size:"sm",iconName:"Trash2",onClick:()=>{m(""),x("")},children:"Clear"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",iconName:"Eye",disabled:!b(),children:"Preview"}),e.jsx(a,{variant:"default",size:"sm",iconName:"Save",onClick:()=>{u&&d&&(r&&r({name:u,formula:d,timestamp:new Date}),x(""),m(""),h(!1))},disabled:!u||!d||!b(),children:"Save Formula"})]})]})]})})]})},c=({onTemplateSelect:r,onTemplateCreate:n})=>{const[i,l]=s.useState("valuation"),[o,c]=s.useState(""),[d,m]=s.useState(!1),u={valuation:{name:"Valuation Models",icon:"TrendingUp",templates:[{id:"dcf_standard",name:"DCF - Standard",description:"Traditional discounted cash flow model with 5-year projections and terminal value",complexity:"Intermediate",timeToComplete:"45 min",lastUsed:"2024-07-10",popularity:95,features:["5-year projections","Terminal value","Sensitivity analysis","WACC calculation"]},{id:"dcf_tech",name:"DCF - Technology",description:"Specialized DCF for high-growth technology companies with adjusted metrics",complexity:"Advanced",timeToComplete:"60 min",lastUsed:"2024-07-08",popularity:87,features:["SaaS metrics","User-based projections","Churn analysis","Rule of 40"]},{id:"sum_of_parts",name:"Sum-of-the-Parts",description:"Multi-business valuation with segment-specific assumptions and multiples",complexity:"Advanced",timeToComplete:"90 min",lastUsed:"2024-07-05",popularity:73,features:["Segment analysis","Multiple approaches","Holding company discount","Synergy modeling"]}]},lbo:{name:"LBO Models",icon:"Layers",templates:[{id:"lbo_standard",name:"LBO - Standard",description:"Complete leveraged buyout model with debt sizing and returns analysis",complexity:"Advanced",timeToComplete:"120 min",lastUsed:"2024-07-09",popularity:91,features:["Debt capacity","Returns waterfall","Management rollover","Exit scenarios"]},{id:"lbo_growth",name:"LBO - Growth Equity",description:"Growth-focused LBO with minority investment and expansion capital",complexity:"Advanced",timeToComplete:"100 min",lastUsed:"2024-07-06",popularity:68,features:["Growth capital","Minority stake","Management incentives","Expansion modeling"]}]},comps:{name:"Comparable Analysis",icon:"BarChart3",templates:[{id:"trading_comps",name:"Trading Comparables",description:"Public company multiple analysis with statistical benchmarking",complexity:"Beginner",timeToComplete:"30 min",lastUsed:"2024-07-11",popularity:98,features:["Multiple analysis","Statistical metrics","Peer screening","Premium/discount analysis"]},{id:"transaction_comps",name:"Transaction Comparables",description:"M&A transaction analysis with control premiums and synergies",complexity:"Intermediate",timeToComplete:"45 min",lastUsed:"2024-07-07",popularity:82,features:["M&A multiples","Control premiums","Synergy analysis","Transaction screening"]}]},merger:{name:"M&A Models",icon:"GitMerge",templates:[{id:"merger_model",name:"Merger Model",description:"Comprehensive merger analysis with accretion/dilution and pro forma statements",complexity:"Expert",timeToComplete:"180 min",lastUsed:"2024-07-04",popularity:76,features:["Accretion/dilution","Pro forma statements","Synergy modeling","Financing structure"]},{id:"acquisition_model",name:"Acquisition Model",description:"Strategic acquisition analysis with integration costs and value creation",complexity:"Expert",timeToComplete:"150 min",lastUsed:"2024-07-03",popularity:71,features:["Integration costs","Value creation","Financing options","Risk analysis"]}]}},x=e=>{switch(e){case"Beginner":return"text-success bg-success/10";case"Intermediate":return"text-warning bg-warning/10";case"Advanced":return"text-accent bg-accent/10";case"Expert":return"text-destructive bg-destructive/10";default:return"text-muted-foreground bg-muted"}},p=()=>{const e=u[i]?.templates||[];return o?e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.description.toLowerCase().includes(o.toLowerCase())):e},h=e=>{r&&r(e)};return e.jsxs("div",{className:"flex flex-col h-full bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"FileTemplate",size:20,className:"text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Model Templates"})]}),e.jsx(a,{variant:"outline",size:"sm",iconName:"Plus",onClick:()=>m(!0),children:"Create Template"})]}),e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"relative",children:[e.jsx(t,{name:"Search",size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",value:o,onChange:e=>c(e.target.value),placeholder:"Search templates...",className:"w-full pl-10 pr-4 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]})}),e.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:Object.entries(u).map(([s,a])=>e.jsxs("button",{onClick:()=>l(s),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(i===s?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(t,{name:a.icon,size:16}),e.jsx("span",{children:a.name})]},s))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[!o&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground mb-3 flex items-center space-x-2",children:[e.jsx(t,{name:"Clock",size:16}),e.jsx("span",{children:"Recently Used"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:[{id:"dcf_standard",name:"DCF - Standard",lastUsed:"2024-07-11 14:30"},{id:"trading_comps",name:"Trading Comparables",lastUsed:"2024-07-11 09:15"},{id:"lbo_standard",name:"LBO - Standard",lastUsed:"2024-07-10 16:45"}].map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg hover:bg-muted/80 transition-smooth cursor-pointer",onClick:()=>h(s),children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last used: ",s.lastUsed]})]}),e.jsx(t,{name:"ChevronRight",size:16,className:"text-muted-foreground"})]},s.id))})]}),e.jsx("div",{className:"space-y-4",children:p().map(s=>e.jsxs("div",{className:"p-4 bg-background border border-border rounded-lg hover:border-primary/50 transition-smooth cursor-pointer group",onClick:()=>h(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h5",{className:"font-semibold text-foreground group-hover:text-primary transition-colors",children:s.name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x(s.complexity)}`,children:s.complexity})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[e.jsx(t,{name:"Star",size:12}),e.jsxs("span",{children:[s.popularity,"%"]})]}),e.jsx(t,{name:"ChevronRight",size:16,className:"text-muted-foreground group-hover:text-primary transition-colors"})]})]}),e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(t,{name:"Clock",size:12}),e.jsx("span",{children:s.timeToComplete})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(t,{name:"Calendar",size:12}),e.jsxs("span",{children:["Last used: ",s.lastUsed]})]})]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.features.map((t,s)=>e.jsx("span",{className:"px-2 py-1 bg-muted text-xs text-muted-foreground rounded",children:t},s))})]},s.id))}),0===p().length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(t,{name:"FileX",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-foreground mb-2",children:"No templates found"}),e.jsx("p",{className:"text-muted-foreground",children:o?"Try adjusting your search terms":"No templates available in this category"})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-elevation-2 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Create New Template"}),e.jsx(a,{variant:"ghost",size:"sm",iconName:"X",onClick:()=>m(!1)})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Template Name"}),e.jsx("input",{type:"text",placeholder:"Enter template name...",className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Description"}),e.jsx("textarea",{placeholder:"Describe your template...",rows:3,className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Category"}),e.jsxs("select",{className:"w-full px-3 py-2 bg-input border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-ring",children:[e.jsx("option",{value:"valuation",children:"Valuation Models"}),e.jsx("option",{value:"lbo",children:"LBO Models"}),e.jsx("option",{value:"comps",children:"Comparable Analysis"}),e.jsx("option",{value:"merger",children:"M&A Models"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 p-4 border-t border-border",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>m(!1),children:"Cancel"}),e.jsx(a,{variant:"default",size:"sm",onClick:()=>{m(!1),n&&n()},children:"Create Template"})]})]})})]})},d=(e,t="USD",s=!1)=>{if(null==e||isNaN(e))return"N/A";return new Intl.NumberFormat("en-US",{style:"currency",currency:t,notation:s?"compact":"standard",minimumFractionDigits:0,maximumFractionDigits:2}).format(e)},m=(e,t=1)=>null==e||isNaN(e)?"N/A":`${(100*e).toFixed(t)}%`,u=(e,t=2,s=!1)=>{if(null==e||isNaN(e))return"N/A";return new Intl.NumberFormat("en-US",{notation:s?"compact":"standard",minimumFractionDigits:0,maximumFractionDigits:t}).format(e)},x=e=>{const{currentRevenue:t,revenueGrowthRate:s,fcfMargin:a,wacc:r,terminalGrowthRate:n,sharesOutstanding:i,totalDebt:l,cash:o,projectionYears:c=5}=e,d=((e,t,s=5)=>{const a=[];let r=e;for(let n=0;n<s;n++)r*=1+(Array.isArray(t)?t[n]||t[t.length-1]:t),a.push(r);return a})(t,s,c),m=d.map(e=>e*a),u=((e,t,s)=>e*(1+t)/(s-t))(m[m.length-1],n,r),x=(p=r,m.reduce((e,t,s)=>e+t/Math.pow(1+p,s+1),0));var p;const h=u/Math.pow(1+r,c),f=x+h,g=f-l+o;return{enterpriseValue:f,equityValue:g,pricePerShare:g/i,pvOfCashFlows:x,pvOfTerminalValue:h,terminalValue:u,projectedRevenues:d,projectedFCFs:m,wacc:r,terminalGrowthRate:n}},p=e=>{const{purchasePrice:t,ebitda:s,debtMultiple:a=5,exitMultiple:r,exitYear:n=5,managementFeeRate:i=.02,carriedInterestRate:l=.2}=e,o=s*a,c=t-o,d=s*Math.pow(1.05,n),m=d*r,u=m-.5*o,x=u/c,p=Math.pow(x,1/n)-1,h=x,f=c*i*n,g=Math.max(0,(u-c)*l);return{equityInvestment:c,totalDebt:o,exitEquityValue:u,totalReturn:x,irr:p,moic:h,exitEbitda:d,exitEnterpriseValue:m,managementFees:f,carriedInterest:g,netReturn:u-f-g}},h=(e,t)=>{const s={};return["marketCap","peRatio","evToEbitda","priceToBook","debtToEquity"].forEach(e=>{const a=t.map(t=>t[e]);s[e]=(e=>{const t=e.filter(e=>null!=e&&!isNaN(e));return 0===t.length?{median:null,mean:null,min:null,max:null}:(t.sort((e,t)=>e-t),{median:t.length%2==0?(t[t.length/2-1]+t[t.length/2])/2:t[Math.floor(t.length/2)],mean:t.reduce((e,t)=>e+t,0)/t.length,min:Math.min(...t),max:Math.max(...t),count:t.length})})(a)}),{company:e,peerStatistics:s,relativeValuation:{marketCapPercentile:f(e.marketCap,t.map(e=>e.marketCap)),peRatioRelative:e.peRatio/s.peRatio.median,evEbitdaRelative:e.evToEbitda/s.evToEbitda.median,priceToBookRelative:e.priceToBook/s.priceToBook.median}}},f=(e,t)=>{const s=t.filter(e=>null!=e&&!isNaN(e));if(0===s.length||null==e||isNaN(e))return null;s.sort((e,t)=>e-t);return s.filter(t=>t<e).length/s.length},g=({onCommandExecute:a,calculationResults:r})=>{const[i,l]=s.useState([{id:1,type:"system",content:"FinanceAnalyst Pro Terminal v2.3.1 - Ready for financial modeling",timestamp:new Date},{id:2,type:"system",content:'Type "help" for available commands or start with DCF(AAPL), LBO(TSLA), or COMP(MSFT)',timestamp:new Date}]),[o,c]=s.useState(""),[f,g]=s.useState([]),[b,v]=s.useState(!1),[y,j]=s.useState(0),[N,C]=s.useState(!1),w=s.useRef(null),T=s.useRef(null),A=["DCF(ticker) - Discounted Cash Flow with real data","LBO(ticker) - Leveraged Buyout analysis with real data","COMP(ticker) - Comparable company analysis","FETCH(ticker) - Get comprehensive company data","PROFILE(ticker) - Company profile and metrics","FINANCIALS(ticker, statement) - Financial statements","MARKET(ticker) - Real-time market data","PEERS(ticker) - Peer company analysis","SEC(ticker, filing_type) - SEC filings data","NPV(cash_flows, discount_rate)","IRR(cash_flows)","WACC(cost_equity, cost_debt, tax_rate, debt_ratio)","CAPM(risk_free, beta, market_return)","SENSITIVITY(ticker, variable, range)","MONTE_CARLO(ticker, iterations)","BETA(ticker)","SHARPE_RATIO(ticker)","VAR(ticker, confidence_level)","CORRELATION(ticker1, ticker2)","VOLATILITY(ticker)","BLACK_SCHOLES(spot, strike, time, rate, volatility)","BOND_PRICE(face_value, coupon_rate, yield, maturity)"],E=["help","clear","history","export excel","export pdf","save model","load template","set currency USD","set precision 2","show variables","validate model","run simulation","status","cache clear","rate limits"];s.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[i]),s.useEffect(()=>{T.current&&T.current.focus()},[]);const k=async()=>{if(!o.trim())return;const e={id:i.length+1,type:"user",content:o,timestamp:new Date};l(t=>[...t,e]),C(!0),c(""),v(!1);try{const e=await S(o),t={id:i.length+2,type:e.type,content:e.content,timestamp:new Date,data:e.data};l(e=>[...e,t]),a&&a(o,e)}catch(t){const e={id:i.length+2,type:"error",content:`Error: ${t.message}`,timestamp:new Date};l(t=>[...t,e])}finally{C(!1)}},S=async e=>{const t=e.toLowerCase().trim();if("help"===t)return{type:"system",content:"Available Commands:\n\nðŸ“Š Real-Time Data Functions:\nâ€¢ DCF(AAPL) - Discounted Cash Flow with live data\nâ€¢ LBO(TSLA) - Leveraged Buyout analysis\nâ€¢ COMP(MSFT) - Comparable company analysis\nâ€¢ FETCH(GOOGL) - Get comprehensive company data\nâ€¢ PROFILE(AMZN) - Company profile and metrics\nâ€¢ MARKET(NFLX) - Real-time market data\nâ€¢ PEERS(META) - Peer company analysis\nâ€¢ SEC(AAPL, 10-K) - SEC filings data\n\nðŸ§® Classic Financial Functions:\nâ€¢ NPV([cf1,cf2,cf3], 0.10) - Net Present Value\nâ€¢ IRR([cf1,cf2,cf3]) - Internal Rate of Return\nâ€¢ WACC(0.12, 0.05, 0.25, 0.3) - Cost of Capital\n\nðŸ”¬ Analysis Tools:\nâ€¢ SENSITIVITY(AAPL, wacc, [0.08,0.12]) - Sensitivity analysis\nâ€¢ MONTE_CARLO(AAPL, 1000) - Monte Carlo simulation\n\nðŸ› ï¸ Utility Commands:\nâ€¢ clear - Clear terminal\nâ€¢ status - Show system and API status\nâ€¢ validate - Validate API keys\nâ€¢ cache clear - Clear data cache\nâ€¢ export excel/pdf - Export current model\nâ€¢ save model - Save current work\n\nðŸ’¡ Examples:\nâ€¢ DCF(AAPL) - Runs full DCF with live Apple data\nâ€¢ validate - Check your API key configuration\nâ€¢ status - See current system status\n\n"+(n.demoMode?'ðŸš¨ Note: Currently running in demo mode. Use "validate" to check API keys.':"âœ… Live data mode active")};if("clear"===t)return setTimeout(()=>l([]),100),{type:"system",content:"Terminal cleared."};if("status"===t)try{const e=await n.getApiStatus(),t=e.validation;let s=`System Status:\n\nðŸ“Š Data Sources: ${e.demoMode?"Demo Mode (Mock Data)":"Live APIs Connected"}\nðŸ”„ Cache: ${e.cacheSize} entries\nâ±ï¸ Rate Limits: ${e.demoMode?"Disabled (Demo)":"Active"}\nðŸŒ Network: Connected\nðŸ’¾ Cache TTL: 15min-24hrs depending on data type\nðŸŽ¯ Overall API Status: ${t.overall.toUpperCase()}\n\nðŸ”‘ API Key Validation:`;return Object.entries(t.services).forEach(([e,t])=>{const a="valid"===t.status?"âœ…":"missing"===t.status?"âŒ":"invalid"===t.status?"ðŸš«":"rate_limited"===t.status?"âš ï¸":"â“";s+=`\nâ€¢ ${e}: ${a} ${t.message}`}),t.recommendations.length>0&&(s+="\n\nðŸ’¡ Recommendations:",t.recommendations.forEach(e=>{s+=`\nâ€¢ ${e}`})),s+=`\n\nLast Updated: ${(new Date).toLocaleTimeString()}`,{type:"info",content:s}}catch(s){return{type:"error",content:`Error checking system status: ${s.message}`}}if("validate"===t)try{const e=await n.validateApiKeys();let t=`ðŸ” API Key Validation Results:\n\nOverall Status: ${e.overall.toUpperCase()}\n\nService Details:`;return Object.entries(e.services).forEach(([e,s])=>{const a="valid"===s.status?"âœ…":"missing"===s.status?"âŒ":"invalid"===s.status?"ðŸš«":"rate_limited"===s.status?"âš ï¸":"network_error"===s.status?"ðŸŒ":"â“";t+=`\nâ€¢ ${e}: ${a} ${s.message}`}),e.recommendations.length>0&&(t+="\n\nðŸ’¡ Recommendations:",e.recommendations.forEach(e=>{t+=`\nâ€¢ ${e}`})),t+=`\n\nValidation completed at: ${e.timestamp.toLocaleTimeString()}`,{type:"complete"===e.overall?"success":"demo"===e.overall?"warning":"info",content:t}}catch(s){return{type:"error",content:`Validation failed: ${s.message}`}}if("cache clear"===t)return n.cache.clear(),n.cacheExpiry.clear(),{type:"success",content:"Data cache cleared successfully."};if(t.match(/^dcf\s*\(\s*([A-Z]{1,5})\s*\)$/i)){const e=t.match(/^dcf\s*\(\s*([A-Z]{1,5})\s*\)$/i)[1].toUpperCase(),a={id:i.length+2,type:"info",content:`ðŸ”„ Fetching comprehensive data for ${e}...\nâ€¢ Company profile and metrics\nâ€¢ 5 years of financial statements\nâ€¢ Market data and pricing\nâ€¢ Calculating DCF valuation...\n${n.demoMode?"\nâš ï¸  Using demo data - configure API keys for live data":"\nâœ… Using live market data"}`,timestamp:new Date};l(e=>[...e,a]);try{const t=await n.fetchDCFInputs(e),s=x(t),a=(s.pricePerShare-t.currentPrice)/t.currentPrice*100;return{type:"success",content:`DCF Analysis Complete for ${t.companyName} (${e})\n\nðŸ“ˆ VALUATION RESULTS:\nâ€¢ Current Price: ${d(t.currentPrice)}\nâ€¢ DCF Fair Value: ${d(s.pricePerShare)}\nâ€¢ Upside/(Downside): ${m(a/100)}\n\nðŸ’° VALUE BREAKDOWN:\nâ€¢ Enterprise Value: ${d(s.enterpriseValue,"USD",!0)}\nâ€¢ Equity Value: ${d(s.equityValue,"USD",!0)}\nâ€¢ PV of Cash Flows: ${d(s.pvOfCashFlows,"USD",!0)}\nâ€¢ PV of Terminal Value: ${d(s.pvOfTerminalValue,"USD",!0)}\n\nðŸ”¢ KEY ASSUMPTIONS:\nâ€¢ Revenue Growth: ${m(t.revenueGrowthRate)}\nâ€¢ FCF Margin: ${m(t.fcfMargin)}\nâ€¢ WACC: ${m(t.wacc)}\nâ€¢ Terminal Growth: ${m(t.terminalGrowthRate)}\nâ€¢ Beta: ${u(t.beta,2)}\n\nðŸ“Š Current Metrics:\nâ€¢ Market Cap: ${d(t.marketCap,"USD",!0)}\nâ€¢ P/E Ratio: ${u(t.peRatio,1)}x\nâ€¢ Net Debt: ${d(t.totalDebt-t.cash,"USD",!0)}\n\n${n.demoMode?"âš ï¸  Demo data used - results are illustrative only":"âœ… Analysis based on live market data"}`,data:{dcfInputs:t,dcfResult:s,analysis:"dcf"}}}catch(s){return{type:"error",content:`DCF Analysis Failed: ${s.message}\n\nTroubleshooting:\nâ€¢ Check ticker symbol spelling\nâ€¢ Ensure internet connection\nâ€¢ Verify API keys are configured (if not using demo mode)\nâ€¢ Try 'status' command to check system status`}}}if(t.match(/^lbo\s*\(\s*([A-Z]{1,5})\s*\)$/i)){const e=t.match(/^lbo\s*\(\s*([A-Z]{1,5})\s*\)$/i)[1].toUpperCase(),a={id:i.length+2,type:"info",content:`ðŸ”„ Analyzing LBO potential for ${e}...\nâ€¢ Fetching financial statements\nâ€¢ Calculating debt capacity\nâ€¢ Analyzing peer multiples\nâ€¢ Computing returns scenarios...\n${n.demoMode?"\nâš ï¸  Using demo data - configure API keys for live data":"\nâœ… Using live market data"}`,timestamp:new Date};l(e=>[...e,a]);try{const t=await n.fetchLBOInputs(e),s=[{name:"Conservative",exitMultiple:.9*t.avgPeerMultiple,debtMultiple:4},{name:"Base Case",exitMultiple:t.avgPeerMultiple,debtMultiple:5},{name:"Aggressive",exitMultiple:1.1*t.avgPeerMultiple,debtMultiple:6}].map(e=>{const s=t.suggestedPurchasePrice;return{scenario:e.name,...p({purchasePrice:s,ebitda:t.ebitda,debtMultiple:e.debtMultiple,exitMultiple:e.exitMultiple})}}),a=s[1];return{type:"success",content:`LBO Analysis Complete for ${t.companyName} (${e})\n\nðŸŽ¯ BASE CASE SCENARIO:\nâ€¢ Purchase Price: ${d(t.suggestedPurchasePrice,"USD",!0)}\nâ€¢ Equity Investment: ${d(a.equityInvestment,"USD",!0)}\nâ€¢ Total Debt: ${d(a.totalDebt,"USD",!0)}\nâ€¢ 5-Year IRR: ${m(a.irr)}\nâ€¢ Money Multiple: ${u(a.moic,1)}x\n\nðŸ“Š TRANSACTION METRICS:\nâ€¢ Current EV/EBITDA: ${u(t.evEbitdaMultiple,1)}x\nâ€¢ Purchase Multiple: ${u(t.suggestedPurchasePrice/t.ebitda,1)}x\nâ€¢ Debt/EBITDA: ${u(a.totalDebt/t.ebitda,1)}x\nâ€¢ Current Debt/EBITDA: ${u(t.debtToEbitda,1)}x\n\nðŸ’¼ SCENARIO ANALYSIS:\nâ€¢ Conservative IRR: ${m(s[0].irr)} (${u(s[0].moic,1)}x)\nâ€¢ Base Case IRR: ${m(s[1].irr)} (${u(s[1].moic,1)}x)\nâ€¢ Aggressive IRR: ${m(s[2].irr)} (${u(s[2].moic,1)}x)\n\nâš ï¸  KEY RISKS:\nâ€¢ Interest Coverage: ${u(t.interestCoverage,1)}x\nâ€¢ Max Debt Capacity: ${d(t.maxDebtCapacity,"USD",!0)}\nâ€¢ Current Market Cap: ${d(t.marketCap,"USD",!0)}\n\n${n.demoMode?"âš ï¸  Demo data used - results are illustrative only":"âœ… Analysis based on live market data"}`,data:{lboInputs:t,results:s,analysis:"lbo"}}}catch(s){return{type:"error",content:`LBO Analysis Failed: ${s.message}\n\nTroubleshooting:\nâ€¢ Check ticker symbol spelling\nâ€¢ Ensure internet connection\nâ€¢ Verify API keys are configured (if not using demo mode)\nâ€¢ Try 'status' command to check system status`}}}if(t.match(/^comp\s*\(\s*([A-Z]{1,5})\s*\)$/i)){const e=t.match(/^comp\s*\(\s*([A-Z]{1,5})\s*\)$/i)[1].toUpperCase(),a={id:i.length+2,type:"info",content:`ðŸ”„ Building comparable company analysis for ${e}...\nâ€¢ Identifying peer companies\nâ€¢ Fetching peer financial data\nâ€¢ Calculating valuation multiples\nâ€¢ Generating relative analysis...\n${n.demoMode?"\nâš ï¸  Using demo data - configure API keys for live data":"\nâœ… Using live market data"}`,timestamp:new Date};l(e=>[...e,a]);try{const[t,s]=await Promise.all([n.fetchCompanyProfile(e),n.fetchPeerComparables(e)]),a={symbol:e,name:t.companyName,marketCap:t.mktCap,peRatio:t.pe,evToEbitda:t.enterpriseValueOverEBITDA,priceToBook:t.pb,debtToEquity:t.debtToEquity},r=h(a,s);return{type:"success",content:`Comparable Company Analysis for ${t.companyName} (${e})\n\nðŸ¢ PEER GROUP (${s.length} companies):\n${s.slice(0,5).map(e=>`â€¢ ${e.symbol}: ${e.name}`).join("\n")}\n\nðŸ“Š VALUATION MULTIPLES vs PEERS:\nâ€¢ P/E Ratio: ${u(a.peRatio,1)}x (Median: ${u(r.peerStatistics.peRatio.median,1)}x)\nâ€¢ EV/EBITDA: ${u(a.evToEbitda,1)}x (Median: ${u(r.peerStatistics.evToEbitda.median,1)}x)\nâ€¢ Price/Book: ${u(a.priceToBook,1)}x (Median: ${u(r.peerStatistics.priceToBook.median,1)}x)\nâ€¢ Debt/Equity: ${u(a.debtToEquity,1)}x (Median: ${u(r.peerStatistics.debtToEquity.median,1)}x)\n\nðŸ“ˆ RELATIVE VALUATION:\nâ€¢ P/E vs Peers: ${m(r.relativeValuation.peRatioRelative-1)} ${r.relativeValuation.peRatioRelative>1?"premium":"discount"}\nâ€¢ EV/EBITDA vs Peers: ${m(r.relativeValuation.evEbitdaRelative-1)} ${r.relativeValuation.evEbitdaRelative>1?"premium":"discount"}\nâ€¢ Market Cap Percentile: ${m(r.relativeValuation.marketCapPercentile)}\n\nðŸ’° PEER STATISTICS:\nâ€¢ P/E Range: ${u(r.peerStatistics.peRatio.min,1)}x - ${u(r.peerStatistics.peRatio.max,1)}x\nâ€¢ EV/EBITDA Range: ${u(r.peerStatistics.evToEbitda.min,1)}x - ${u(r.peerStatistics.evToEbitda.max,1)}x\nâ€¢ Average Market Cap: ${d(r.peerStatistics.marketCap.mean,"USD",!0)}\n\n${n.demoMode?"âš ï¸  Demo data used - results are illustrative only":"âœ… Analysis based on live market data"}`,data:{companyData:a,peers:s,compAnalysis:r,analysis:"comparable"}}}catch(s){return{type:"error",content:`Comparable Analysis Failed: ${s.message}\n\nTroubleshooting:\nâ€¢ Check ticker symbol spelling\nâ€¢ Ensure internet connection\nâ€¢ Verify API keys are configured (if not using demo mode)\nâ€¢ Try 'status' command to check system status`}}}if(t.match(/^fetch\s*\(\s*([A-Z]{1,5})\s*\)$/i)){const e=t.match(/^fetch\s*\(\s*([A-Z]{1,5})\s*\)$/i)[1].toUpperCase();try{const t=await n.fetchCompanyProfile(e),s=await n.fetchMarketData(e);return{type:"success",content:`Company Data for ${t.companyName} (${e})\n\nðŸ’¼ PROFILE:\nâ€¢ Sector: ${t.sector}\nâ€¢ Industry: ${t.industry}\nâ€¢ Employees: ${u(t.fullTimeEmployees,0)}\nâ€¢ Founded: ${t.ipoDate}\n\nðŸ“Š MARKET DATA:\nâ€¢ Current Price: ${d(s.currentPrice)}\nâ€¢ Market Cap: ${d(t.mktCap,"USD",!0)}\nâ€¢ 52W Range: ${t.range} \nâ€¢ Volume: ${u(s.volume,0,!0)}\nâ€¢ Beta: ${u(t.beta,2)}\n\nðŸ“ˆ VALUATION:\nâ€¢ P/E Ratio: ${u(t.pe,1)}x\nâ€¢ P/B Ratio: ${u(t.pb,1)}x\nâ€¢ EV/EBITDA: ${u(t.enterpriseValueOverEBITDA,1)}x\nâ€¢ Debt/Equity: ${u(t.debtToEquity,1)}x\n\nðŸ’° PROFITABILITY:\nâ€¢ Revenue TTM: ${d(t.revenueTTM,"USD",!0)}\nâ€¢ Gross Margin: ${m(t.grossProfitMargin)}\nâ€¢ Net Margin: ${m(t.netProfitMargin)}\nâ€¢ ROE: ${m(t.returnOnEquityTTM)}\nâ€¢ ROA: ${m(t.returnOnAssetsTTM)}\n\n${n.demoMode?"âš ï¸  Demo data used - results are illustrative only":"âœ… Data based on live market feeds"}`,data:{profile:t,marketData:s,analysis:"comprehensive"}}}catch(s){return{type:"error",content:`Data Fetch Failed: ${s.message}\n\nTroubleshooting:\nâ€¢ Check ticker symbol spelling\nâ€¢ Ensure internet connection\nâ€¢ Verify API keys are configured (if not using demo mode)\nâ€¢ Try 'status' command to check system status`}}}if(t.match(/^npv\s*\(\s*\[([^\]]+)\]\s*,\s*([\d.]+)\s*\)$/i)){const e=t.match(/^npv\s*\(\s*\[([^\]]+)\]\s*,\s*([\d.]+)\s*\)$/i),s=e[1].split(",").map(e=>parseFloat(e.trim())),a=parseFloat(e[2]);let r=0;const n=s.map((e,t)=>{const s=e/Math.pow(1+a,t+1);return r+=s,{year:t+1,cashFlow:e,presentValue:s}});return{type:"success",content:`NPV Calculation:\n\nCash Flows: [${s.map(e=>d(e)).join(", ")}]\nDiscount Rate: ${m(a)}\n\nNet Present Value: ${d(r)}\n\nYear-by-Year Breakdown:\n${n.map(e=>`Year ${e.year}: ${d(e.cashFlow)} â†’ PV: ${d(e.presentValue)}`).join("\n")}`,data:{npv:r,cashFlows:s,discountRate:a,pvBreakdown:n}}}return"show variables"===t?{type:"info",content:"Current Model Variables:\n\nâ€¢ Revenue Growth: 5.2%\nâ€¢ EBITDA Margin: 23.5%\nâ€¢ Tax Rate: 25.0%\nâ€¢ WACC: 9.8%\nâ€¢ Terminal Growth: 2.5%\nâ€¢ Debt/Equity: 0.4x\nâ€¢ Beta: 1.15\nâ€¢ Risk-free Rate: 3.2%\nâ€¢ Market Premium: 6.5%\n\nðŸ”„ Data Sources Active:\n"+(n.demoMode?"â€¢ Demo Mode: Mock data for all sources":"â€¢ Alpha Vantage: Market data\nâ€¢ FMP: Financial statements\nâ€¢ SEC EDGAR: Regulatory filings\nâ€¢ Yahoo Finance: Real-time quotes")}:"validate model"===t?{type:"warning",content:`Model Validation Results:\n\nâœ“ All formulas syntactically correct\nâœ“ No circular references detected\n${n.demoMode?"âš  Demo mode: Using mock data":"âœ“ Data sources responding normally"}\n${n.demoMode?"âš  Configure API keys for live validation":"âœ“ Rate limits within acceptable range"}\nâœ“ Cache functioning properly\nâœ“ All required inputs available\n\nOverall Status: ${n.demoMode?"Valid (Demo Mode)":"Valid with live data"}\nLast validation: ${(new Date).toLocaleTimeString()}`}:{type:"error",content:`Unknown command: "${e}"\n\nTry these real-data commands:\nâ€¢ DCF(AAPL) - Apple DCF analysis\nâ€¢ LBO(TSLA) - Tesla LBO analysis\nâ€¢ COMP(MSFT) - Microsoft comparables\nâ€¢ FETCH(GOOGL) - Google company data\n\nType "help" for full command list.\n\n${n.demoMode?"ðŸ’¡ Tip: Configure API keys in your .env file for live data analysis":""}`}};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-900 text-green-400 font-mono text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Terminal",size:16,className:"text-green-400"}),e.jsx("span",{className:"text-green-400 font-medium",children:"Financial Terminal"}),e.jsx("span",{className:"text-xs text-blue-400",children:"â€¢ Live Data Enabled"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+(N?"bg-yellow-400 animate-pulse":"bg-green-400")}),e.jsx("span",{className:"text-xs text-gray-400",children:N?"Processing...":"Connected"})]})]}),e.jsxs("div",{ref:w,className:"flex-1 overflow-y-auto p-4 space-y-2",onClick:()=>T.current?.focus(),children:[i.map(s=>e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-start space-x-2",children:["user"===s.type&&e.jsx("span",{className:"text-blue-400 shrink-0",children:"analyst@finpro:~$"}),"system"===s.type&&e.jsx(t,{name:"Info",size:14,className:"text-yellow-400 mt-0.5 shrink-0"}),"success"===s.type&&e.jsx(t,{name:"CheckCircle",size:14,className:"text-green-400 mt-0.5 shrink-0"}),"error"===s.type&&e.jsx(t,{name:"XCircle",size:14,className:"text-red-400 mt-0.5 shrink-0"}),"warning"===s.type&&e.jsx(t,{name:"AlertTriangle",size:14,className:"text-yellow-400 mt-0.5 shrink-0"}),"info"===s.type&&e.jsx(t,{name:"Info",size:14,className:"text-blue-400 mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:s.content}),s.data&&e.jsx("div",{className:"mt-2 p-2 bg-gray-800 rounded border border-gray-700",children:e.jsxs("div",{className:"text-xs text-gray-400",children:["Real-time calculation data available â€¢ Analysis:"," ",s.data.analysis||"financial"]})})]})]})},s.id)),N&&e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-400",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-yellow-400 border-t-transparent rounded-full"}),e.jsx("span",{children:"Fetching real-time data..."})]}),e.jsxs("div",{className:"flex items-center space-x-2 relative",children:[e.jsx("span",{className:"text-blue-400 shrink-0",children:"analyst@finpro:~$"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:T,type:"text",value:o,onChange:e=>{const t=e.target.value;if(c(t),t.length>0){const e=[...A,...E].filter(e=>e.toLowerCase().includes(t.toLowerCase()));g(e.slice(0,8)),v(e.length>0),j(0)}else v(!1)},onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),k()):"ArrowUp"===e.key&&b?(e.preventDefault(),j(e=>Math.max(0,e-1))):"ArrowDown"===e.key&&b?(e.preventDefault(),j(e=>Math.min(f.length-1,e+1))):"Tab"===e.key&&b?(e.preventDefault(),c(f[y]),v(!1)):"Escape"===e.key&&v(!1)},className:"w-full bg-transparent text-green-400 outline-none border-none",placeholder:"Enter command with ticker (e.g., DCF(AAPL))...",autoComplete:"off",disabled:N}),b&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-600 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:f.map((t,s)=>e.jsx("div",{className:"px-3 py-2 cursor-pointer text-sm "+(s===y?"bg-gray-700 text-green-300":"text-gray-300 hover:bg-gray-700"),onClick:()=>(e=>{c(e),v(!1),T.current?.focus()})(t),children:t},s))})]})]})]}),e.jsx("div",{className:"px-4 py-2 bg-gray-800 border-t border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{children:"Tab: Autocomplete"}),e.jsx("span",{children:"Ctrl+C: Cancel"}),e.jsx("span",{children:"â†‘â†“: Navigate suggestions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{children:["Commands: ",i.filter(e=>"user"===e.type).length]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Cache: ",n?.cache?.size||0]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:(new Date).toLocaleTimeString()})]})]})})]})},b=({onVariableChange:r,onBulkEdit:n})=>{const[i,l]=s.useState("assumptions"),[o,c]=s.useState(!1),[d,m]=s.useState(""),[u,x]=s.useState({assumptions:{revenue_growth:{value:.052,unit:"%",description:"Annual revenue growth rate",category:"Growth"},ebitda_margin:{value:.235,unit:"%",description:"EBITDA as % of revenue",category:"Profitability"},tax_rate:{value:.25,unit:"%",description:"Corporate tax rate",category:"Tax"},capex_revenue:{value:.035,unit:"%",description:"CapEx as % of revenue",category:"Investment"},working_capital_revenue:{value:.02,unit:"%",description:"Working capital as % of revenue",category:"Working Capital"},terminal_growth:{value:.025,unit:"%",description:"Long-term growth rate",category:"Terminal"}},cost_of_capital:{risk_free_rate:{value:.032,unit:"%",description:"Risk-free rate (10Y Treasury)",category:"Market"},market_premium:{value:.065,unit:"%",description:"Equity risk premium",category:"Market"},beta:{value:1.15,unit:"x",description:"Asset beta coefficient",category:"Risk"},cost_of_debt:{value:.045,unit:"%",description:"Pre-tax cost of debt",category:"Debt"},debt_equity_ratio:{value:.4,unit:"x",description:"Target debt-to-equity ratio",category:"Capital Structure"}},market_data:{current_share_price:{value:125.5,unit:"$",description:"Current trading price",category:"Market"},shares_outstanding:{value:20,unit:"M",description:"Shares outstanding",category:"Equity"},market_cap:{value:2510,unit:"$M",description:"Current market capitalization",category:"Valuation"},enterprise_value:{value:2810,unit:"$M",description:"Current enterprise value",category:"Valuation"},net_debt:{value:300,unit:"$M",description:"Net debt position",category:"Debt"}}}),p=(e,t)=>"%"===t?(100*e).toFixed(1):"$"===t||"$M"===t?e.toFixed(2):e.toFixed(3),h=e=>{if(!d)return e;const t={};return Object.entries(e).forEach(([e,s])=>{(e.toLowerCase().includes(d.toLowerCase())||s.description.toLowerCase().includes(d.toLowerCase()))&&(t[e]=s)}),t};return e.jsxs("div",{className:"flex flex-col h-full bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Sliders",size:20,className:"text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Variable Inputs"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",iconName:o?"Check":"Edit",onClick:()=>c(!o),children:o?"Done":"Edit"}),e.jsx(a,{variant:"outline",size:"sm",iconName:"Download",onClick:()=>{const e=JSON.stringify(u,null,2),t=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="model_variables.json",a.click(),URL.revokeObjectURL(s)},children:"Export"})]})]}),e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"relative",children:[e.jsx(t,{name:"Search",size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",value:d,onChange:e=>m(e.target.value),placeholder:"Search variables...",className:"w-full pl-10 pr-4 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"})]})}),e.jsx("div",{className:"flex border-b border-border overflow-x-auto",children:[{id:"assumptions",label:"Key Assumptions",icon:"Settings"},{id:"cost_of_capital",label:"Cost of Capital",icon:"Percent"},{id:"market_data",label:"Market Data",icon:"TrendingUp"}].map(s=>e.jsxs("button",{onClick:()=>l(s.id),className:"flex items-center space-x-2 px-4 py-3 text-sm font-medium whitespace-nowrap transition-smooth "+(i===s.id?"bg-primary text-primary-foreground border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-muted"),children:[e.jsx(t,{name:s.icon,size:16}),e.jsx("span",{children:s.label})]},s.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[Object.entries((e=>{const t={};return Object.entries(e).forEach(([e,s])=>{const a=s.category||"Other";t[a]||(t[a]=[]),t[a].push({key:e,...s})}),t})(h(u[i]))).map(([s,a])=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground mb-3 flex items-center space-x-2",children:[e.jsx(t,{name:"Folder",size:16}),e.jsx("span",{children:s})]}),e.jsx("div",{className:"space-y-3",children:a.map(s=>e.jsxs("div",{className:"p-3 bg-background border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-foreground capitalize",children:s.key.replace(/_/g," ")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]}),e.jsx("div",{className:"flex items-center space-x-2 ml-4",children:o?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"number",value:p(s.value,s.unit),onChange:e=>((e,t,s)=>{const a={...u,[e]:{...u[e],[t]:{...u[e][t],value:parseFloat(s)||0}}};x(a),r&&r(e,t,s)})(i,s.key,e.target.value),step:"%"===s.unit?"0.1":"0.01",className:"w-20 px-2 py-1 text-sm bg-input border border-border rounded text-foreground focus:outline-none focus:ring-1 focus:ring-ring"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.unit})]}):e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-foreground",children:p(s.value,s.unit)}),e.jsx("span",{className:"text-sm text-muted-foreground ml-1",children:s.unit})]})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-success rounded-full"}),e.jsx("span",{className:"text-muted-foreground",children:"Within range"})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[e.jsx(t,{name:"TrendingUp",size:12}),e.jsx("span",{children:"High impact"})]})]})]},s.key))})]},s)),0===Object.keys(h(u[i])).length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(t,{name:"Search",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-foreground mb-2",children:"No variables found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search terms"})]})]}),e.jsx("div",{className:"p-4 border-t border-border bg-muted/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[e.jsx(t,{name:"Info",size:12}),e.jsx("span",{children:"Changes auto-save every 30 seconds"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",iconName:"RotateCcw",onClick:()=>{const e={...u};x(e)},children:"Reset"}),e.jsx(a,{variant:"outline",size:"sm",iconName:"Grid",onClick:()=>n&&n(),children:"Bulk Edit"})]})]})})]})},v=()=>{const[n,d]=s.useState("dual-pane"),[m,u]=s.useState("terminal"),[x,p]=s.useState("results"),[h,f]=s.useState(!1),[v,y]=s.useState({name:"DCF_Analysis_v2.3",saved:!0,calculating:!1,lastSaved:new Date}),[j,N]=s.useState(null),[C,w]=s.useState(!1);s.useEffect(()=>{const e=setInterval(()=>{v.saved||y(e=>({...e,saved:!0,lastSaved:new Date}))},3e4);return()=>clearInterval(e)},[v.saved]);const T=(e,t)=>{y(e=>({...e,saved:!1})),t.data&&N(t.data)},A=e=>{y(t=>({...t,name:`${e.name}_${(new Date).toISOString().split("T")[0]}`,saved:!1})),w(!1),u("terminal")},E=(e,t,s)=>{y(e=>({...e,saved:!1}))},k=e=>{};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(r,{}),e.jsxs("div",{className:"pt-[60px] h-screen flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-card border-b border-border",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center space-x-1 bg-muted rounded-lg p-1",children:[{id:"dual-pane",label:"Dual Pane",icon:"Columns"},{id:"terminal-focus",label:"Terminal Focus",icon:"Terminal"},{id:"results-focus",label:"Results Focus",icon:"BarChart3"},{id:"full-screen",label:"Full Screen",icon:"Maximize"}].map(s=>e.jsxs("button",{onClick:()=>d(s.id),className:"flex items-center space-x-1 px-3 py-2 text-sm font-medium rounded-md transition-smooth "+(n===s.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-background"),title:s.label,children:[e.jsx(t,{name:s.icon,size:16}),e.jsx("span",{className:"hidden lg:inline",children:s.label})]},s.id))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{htmlFor:"left-panel-select",className:"sr-only",children:"Left Panel Content"}),e.jsx("select",{id:"left-panel-select",value:m,onChange:e=>u(e.target.value),className:"px-3 py-2 bg-input border border-border rounded-lg text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-ring",children:[{id:"terminal",label:"Terminal",icon:"Terminal"},{id:"formula-builder",label:"Formula Builder",icon:"Wrench"},{id:"templates",label:"Templates",icon:"FileTemplate"}].map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))}),"full-screen"!==n&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"right-panel-select",className:"sr-only",children:"Right Panel Content"}),e.jsx("select",{id:"right-panel-select",value:x,onChange:e=>p(e.target.value),className:"px-3 py-2 bg-input border border-border rounded-lg text-foreground text-sm focus:outline-none focus:ring-2 focus:ring-ring",children:[{id:"results",label:"Results",icon:"Calculator"},{id:"variables",label:"Variables",icon:"Sliders"},{id:"audit",label:"Audit Trail",icon:"FileText"}].map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 bg-muted rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+(v.saved?"bg-success":"bg-warning")}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:v.name}),!v.saved&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Unsaved changes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",iconName:"Save",onClick:()=>{y(e=>({...e,saved:!0,lastSaved:new Date}))},disabled:v.saved,children:"Save"}),e.jsx(a,{variant:"outline",size:"sm",iconName:"FileTemplate",onClick:()=>w(!0),children:"Templates"}),e.jsx(a,{variant:"outline",size:"sm",iconName:"Users",onClick:()=>f(!h),children:"Collaborate"}),e.jsx(a,{variant:"outline",size:"sm",iconName:"Download",onClick:()=>{},children:"Export"})]})]})]}),e.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:e.jsxs("div",{className:`h-full ${(()=>{switch(n){case"dual-pane":default:return"grid grid-cols-[60%_40%] gap-4";case"terminal-focus":return"grid grid-cols-[80%_20%] gap-4";case"results-focus":return"grid grid-cols-[30%_70%] gap-4";case"full-screen":return"grid grid-cols-1"}})()}`,children:[e.jsx("div",{className:"h-full border border-border rounded-lg overflow-hidden",children:(()=>{switch(m){case"terminal":return e.jsx(g,{onCommandExecute:T,calculationResults:j});case"formula-builder":return e.jsx(o,{onFormulaCreate:e=>{},variables:[]});case"templates":return e.jsx(c,{onTemplateSelect:A,onTemplateCreate:()=>{}});default:return e.jsx(g,{onCommandExecute:T})}})()}),"full-screen"!==n&&e.jsx("div",{className:"h-full border border-border rounded-lg overflow-hidden",children:(()=>{switch(x){case"results":default:return e.jsx(l,{results:j,onExport:k});case"variables":return e.jsx(b,{onVariableChange:E,onBulkEdit:()=>{}});case"audit":return e.jsx(i,{calculations:[],errors:[],warnings:[]})}})()})]})}),h&&e.jsxs("div",{className:"fixed right-0 top-[60px] bottom-0 w-80 bg-card border-l border-border shadow-elevation-2 z-40",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Collaboration"}),e.jsx(a,{variant:"ghost",size:"sm",iconName:"X",onClick:()=>f(!1)})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Active Collaborators"}),e.jsx("div",{className:"space-y-3",children:[{id:1,name:"Sarah Chen",role:"Senior Analyst",status:"active",avatar:"https://randomuser.me/api/portraits/women/1.jpg"},{id:2,name:"Michael Rodriguez",role:"VP Finance",status:"viewing",avatar:"https://randomuser.me/api/portraits/men/2.jpg"},{id:3,name:"Emily Johnson",role:"Junior Analyst",status:"idle",avatar:"https://randomuser.me/api/portraits/women/3.jpg"}].map(t=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.role})]}),e.jsx("div",{className:"w-2 h-2 rounded-full "+("active"===t.status?"bg-success":"viewing"===t.status?"bg-warning":"bg-muted-foreground")})]},t.id))}),e.jsx("div",{className:"mt-6",children:e.jsx(a,{variant:"outline",size:"sm",iconName:"UserPlus",fullWidth:!0,children:"Invite Collaborator"})})]})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-elevation-2 w-full max-w-4xl mx-4 h-[80vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Select Model Template"}),e.jsx(a,{variant:"ghost",size:"sm",iconName:"X",onClick:()=>w(!1)})]}),e.jsx("div",{className:"h-[calc(80vh-80px)]",children:e.jsx(c,{onTemplateSelect:A,onTemplateCreate:()=>{}})})]})})]})]})};export{v as default};
//# sourceMappingURL=index-DxTh8KEH.js.map
