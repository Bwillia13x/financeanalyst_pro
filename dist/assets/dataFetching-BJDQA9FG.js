import{a as e}from"./data-vendor-vzM7rUwp.js";import{a as t,f as a,l as s}from"./financial-engines-B7TnAHCU.js";const r=new class{constructor(){this.validationResults=new Map,this.lastValidation=null}async validateAllKeys(){const e={timestamp:new Date,overall:"unknown",services:{},recommendations:[]},t="your_staging_alpha_vantage_api_key_here",a="your_staging_fmp_api_key_here",s=void 0,r=void 0,i=[this.validateAlphaVantage(t),this.validateFMP(a),this.validateQuandl(s),this.validateFRED(r)];try{const[t,a,s,r]=await Promise.allSettled(i);e.services={alphaVantage:this.processValidationResult(t),fmp:this.processValidationResult(a),quandl:this.processValidationResult(s),fred:this.processValidationResult(r)};const n=Object.values(e.services).filter(e=>"valid"===e.status).length,o=Object.values(e.services).filter(e=>"missing"!==e.status).length,c=Object.keys(e.services).length;return 0===n?(e.overall="demo",e.recommendations.push("No valid API keys found. Running in demo mode with mock data."),e.recommendations.push("Add at least one API key (Alpha Vantage or FMP recommended) for live data.")):n<o||o<c?(e.overall="partial",e.recommendations.push(`${n}/${o} configured API keys are valid. Some features may use demo data.`)):(e.overall="complete",e.recommendations.push("All API keys are valid. Full functionality available.")),this.lastValidation=e,e}catch(n){return e.overall="error",e.error=n.message,e.recommendations.push("Error validating API keys. Check your internet connection."),e}}async validateAlphaVantage(t){if(!t||"demo"===t)return{status:"missing",message:"API key not configured"};try{const a=await e.get("https://www.alphavantage.co/query",{params:{function:"GLOBAL_QUOTE",symbol:"AAPL",apikey:t},timeout:1e4});return a.data["Error Message"]?{status:"invalid",message:"Invalid API key"}:a.data.Note?{status:"rate_limited",message:"API key valid but rate limited"}:a.data["Global Quote"]?{status:"valid",message:"API key is valid and working"}:{status:"unknown",message:"Unexpected response format"}}catch(a){return 401===a.response?.status||403===a.response?.status?{status:"invalid",message:"Invalid API key"}:429===a.response?.status?{status:"rate_limited",message:"API key valid but rate limited"}:"ENOTFOUND"===a.code||"ECONNREFUSED"===a.code?{status:"network_error",message:"Network connection failed"}:{status:"error",message:a.message}}}async validateFMP(t){if(!t||"demo"===t)return{status:"missing",message:"API key not configured"};try{const a=await e.get("https://financialmodelingprep.com/api/v3/profile/AAPL",{params:{apikey:t},timeout:1e4});return a.data.error?{status:"invalid",message:"Invalid API key"}:Array.isArray(a.data)&&a.data.length>0?{status:"valid",message:"API key is valid and working"}:{status:"unknown",message:"Unexpected response format"}}catch(a){return 401===a.response?.status?{status:"invalid",message:"Invalid API key"}:429===a.response?.status?{status:"rate_limited",message:"API key valid but rate limited"}:"ENOTFOUND"===a.code||"ECONNREFUSED"===a.code?{status:"network_error",message:"Network connection failed"}:{status:"error",message:a.message}}}async validateQuandl(t){if(!t||"demo"===t)return{status:"missing",message:"API key not configured"};try{const a=await e.get("https://data.nasdaq.com/api/v3/datasets/WIKI/AAPL.json",{params:{api_key:t,rows:1},timeout:1e4});return a.data.quandl_error?{status:"invalid",message:"Invalid API key"}:a.data.dataset?{status:"valid",message:"API key is valid and working"}:{status:"unknown",message:"Unexpected response format"}}catch(a){return 401===a.response?.status?{status:"invalid",message:"Invalid API key"}:429===a.response?.status?{status:"rate_limited",message:"API key valid but rate limited"}:"ENOTFOUND"===a.code||"ECONNREFUSED"===a.code?{status:"network_error",message:"Network connection failed"}:{status:"error",message:a.message}}}async validateFRED(t){if(!t||"demo"===t)return{status:"missing",message:"API key not configured"};try{const a=await e.get("https://api.stlouisfed.org/fred/series",{params:{series_id:"GDP",api_key:t,file_type:"json"},timeout:1e4});return a.data.error_message?{status:"invalid",message:"Invalid API key"}:a.data.seriess?{status:"valid",message:"API key is valid and working"}:{status:"unknown",message:"Unexpected response format"}}catch(a){return 400===a.response?.status?{status:"invalid",message:"Invalid API key"}:429===a.response?.status?{status:"rate_limited",message:"API key valid but rate limited"}:"ENOTFOUND"===a.code||"ECONNREFUSED"===a.code?{status:"network_error",message:"Network connection failed"}:{status:"error",message:a.message}}}processValidationResult(e){return"fulfilled"===e.status?e.value:{status:"error",message:e.reason.message}}getServiceStatus(e){return this.lastValidation?this.lastValidation.services[e]||{status:"unknown",message:"Service not found"}:{status:"unknown",message:"Validation not run yet"}}getOverallStatus(){return this.lastValidation?this.lastValidation.overall:"unknown"}getRecommendations(){return this.lastValidation?this.lastValidation.recommendations:["Run API key validation first"]}shouldUseDemoMode(){const e=this.getOverallStatus();return"demo"===e||"unknown"===e}},i={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ADSENSE_ID:"your-adsense-id-here",VITE_ALPHA_VANTAGE_API_KEY:"your_staging_alpha_vantage_api_key_here",VITE_ALPHA_VANTAGE_BASE_URL:"https://www.alphavantage.co/query",VITE_ANTHROPIC_API_KEY:"your-anthropic-api-key-here",VITE_API_BASE_URL:"https://api.financeanalyst.pro",VITE_APP_ENV:"production",VITE_APP_URL:"https://financeanalyst.pro",VITE_APP_VERSION:"1.0.0",VITE_ASSETS_BASE_URL:"/assets/",VITE_BACKUP_ENABLED:"true",VITE_CACHE_ENABLED:"true",VITE_CACHE_TTL:"300000",VITE_CDN_URL:"https://cdn.yourapp.com",VITE_COOKIE_CONSENT_ENABLED:"true",VITE_CORE_WEB_VITALS_TRACKING:"true",VITE_DEBUG:"false",VITE_DEFAULT_TICKER:"AAPL",VITE_ENABLE_ADVANCED_FEATURES:"true",VITE_ENABLE_ANALYTICS:"true",VITE_ENABLE_BETA_FEATURES:"false",VITE_ENABLE_DEBUG_MODE:"false",VITE_ENABLE_ERROR_REPORTING:"true",VITE_ENABLE_TEST_DATA:"true",VITE_FMP_API_KEY:"your_staging_fmp_api_key_here",VITE_FMP_BASE_URL:"https://financialmodelingprep.com/api/v3",VITE_FORCE_DEMO_MODE:"false",VITE_GA_TRACKING_ID:"your_google_analytics_id_here",VITE_GEMINI_API_KEY:"your-gemini-api-key-here",VITE_GOOGLE_ANALYTICS_ID:"your-google-analytics-id-here",VITE_HOTJAR_ID:"your_hotjar_id_here",VITE_LIGHTHOUSE_CI:"true",VITE_MAX_REQUESTS_PER_MINUTE:"60",VITE_MOCK_API_RESPONSES:"false",VITE_OPENAI_API_KEY:"your-openai-api-key-here",VITE_PERFORMANCE_MONITORING:"true",VITE_PERPLEXITY_API_KEY:"your-perplexity-api-key-here",VITE_POLYGON_API_KEY:"your_staging_polygon_api_key_here",VITE_POLYGON_BASE_URL:"https://api.polygon.io/v2",VITE_PRIVACY_POLICY_URL:"https://financeanalyst.pro/privacy",VITE_RATE_LIMITING_ENABLED:"true",VITE_SENTRY_DSN:"your_sentry_dsn_here",VITE_STORAGE_BUCKET:"financeanalyst-prod-storage",VITE_STRIPE_PUBLISHABLE_KEY:"your-stripe-publishable-key-here",VITE_SUPABASE_ANON_KEY:"dummykey.updateyourkkey.here",VITE_SUPABASE_URL:"https://dummy.supabase.co",VITE_SUPPORT_URL:"https://support.financeanalyst.pro",VITE_TERMS_OF_SERVICE_URL:"https://financeanalyst.pro/terms",VITE_VERBOSE_LOGGING:"true"},n="https://www.alphavantage.co/query",o="your_staging_alpha_vantage_api_key_here",c="https://financialmodelingprep.com/api/v3",l="your_staging_fmp_api_key_here",u="https://query1.finance.yahoo.com/v8/finance/chart",h={ALPHA_VANTAGE:{requests:5,period:6e4},FMP:{requests:250,period:864e5},SEC_EDGAR:{requests:10,period:1e3}},m={maxRetries:3,baseDelay:1e3,maxDelay:3e4,exponentialBase:2,jitterFactor:.1,retryableStatusCodes:[408,429,500,502,503,504],retryableErrors:["ECONNRESET","ENOTFOUND","ECONNREFUSED","ETIMEDOUT"]},d={failureThreshold:5,recoveryTimeout:3e4,monitoringPeriod:6e4,halfOpenMaxCalls:3},p="CLOSED",g="OPEN",y="HALF_OPEN";class E{constructor(e,t=d){this.name=e,this.config={...d,...t},this.state=p,this.failureCount=0,this.lastFailureTime=null,this.halfOpenCallCount=0,this.successCount=0,this.totalCalls=0}canExecute(){const e=Date.now();switch(this.state){case p:return!0;case g:return e-this.lastFailureTime>=this.config.recoveryTimeout&&(this.state=y,this.halfOpenCallCount=0,!0);case y:return this.halfOpenCallCount<this.config.halfOpenMaxCalls;default:return!1}}recordSuccess(){switch(this.successCount++,this.totalCalls++,this.state){case y:this.halfOpenCallCount++,this.halfOpenCallCount>=this.config.halfOpenMaxCalls&&(this.state=p,this.failureCount=0,this.halfOpenCallCount=0);break;case p:this.failureCount=0}}recordFailure(){switch(this.failureCount++,this.totalCalls++,this.lastFailureTime=Date.now(),this.state){case p:this.failureCount>=this.config.failureThreshold&&(this.state=g);break;case y:this.state=g,this.halfOpenCallCount=0}}getStatus(){return{name:this.name,state:this.state,failureCount:this.failureCount,successCount:this.successCount,totalCalls:this.totalCalls,failureRate:this.totalCalls>0?this.failureCount/this.totalCalls:0,lastFailureTime:this.lastFailureTime,isOpen:this.state===g,nextRetryTime:this.state===g?this.lastFailureTime+this.config.recoveryTimeout:null}}async execute(e){if(!this.canExecute()){const e=new Error(`Circuit breaker ${this.name} is OPEN - failing fast`);throw e.circuitBreakerOpen=!0,e}try{const t=await e();return this.recordSuccess(),t}catch(t){throw this.recordFailure(),t}}}class f{constructor(e=m){this.config={...m,...e}}calculateDelay(e){const t=this.config.baseDelay*Math.pow(this.config.exponentialBase,e),a=t+t*this.config.jitterFactor*Math.random();return Math.min(a,this.config.maxDelay)}isRetryableError(e){return!(!e.code||!this.config.retryableErrors.includes(e.code))||!(!e.response?.status||!this.config.retryableStatusCodes.includes(e.response.status))||!!e.message?.includes("timeout")}async executeWithRetry(e,t="API call"){let a;for(let r=0;r<=this.config.maxRetries;r++)try{return await e()}catch(s){if(a=s,r===this.config.maxRetries)break;if(!this.isRetryableError(s))throw s;const e=this.calculateDelay(r);await new Promise(t=>setTimeout(t,e))}throw a}}const _=new class{constructor(e=i,a=null,s=null,r=null){this.rateLimiters={},this.cache=new Map,this.cacheExpiry=new Map,this.env=e,this.customRateLimits=a,this.demoMode=this.isDemoMode(e),this.retryManager=new f(s),this.circuitBreakers=this.initializeCircuitBreakers(r),this.logger=t,this.initializeRateLimiters(),this.logger.log("INFO","ðŸš€ DataFetchingService initialized",{demoMode:this.demoMode,environment:e.VITE_APP_ENV||"development"})}isDemoMode(e=i){return"true"===e.VITE_FORCE_DEMO_MODE||!(e.VITE_ALPHA_VANTAGE_API_KEY&&"demo"!==e.VITE_ALPHA_VANTAGE_API_KEY||e.VITE_FMP_API_KEY&&"demo"!==e.VITE_FMP_API_KEY)}initializeCircuitBreakers(e){const t={};return["ALPHA_VANTAGE","FMP","SEC_EDGAR","YAHOO_FINANCE"].forEach(a=>{t[a]=new E(a,e)}),t}initializeRateLimiters(){const e=this.customRateLimits||h;Object.keys(e).forEach(t=>{this.rateLimiters[t]={requests:[],limit:e[t].requests,period:e[t].period}})}async checkRateLimit(e){const t=this.rateLimiters[e];if(!t)return!0;const a=Date.now();if(t.requests=t.requests.filter(e=>a-e<t.period),t.requests.length>=t.limit){const s=Math.min(...t.requests),r=t.period-(a-s);throw this.logger.logRateLimit(e,r,t.limit-t.requests.length),new Error(`Rate limit exceeded for ${e}. Please wait ${Math.ceil(r/1e3)} seconds.`)}return t.requests.push(a),!0}getCacheKey(e,t){return`${e}_${JSON.stringify(t)}`}getFromCache(e){const t=this.cacheExpiry.get(e);if(t&&Date.now()>t)return this.cache.delete(e),this.cacheExpiry.delete(e),this.logger.logCache("miss",e,{reason:"expired"}),null;const a=this.cache.get(e);return void 0!==a?(this.logger.logCache("hit",e,{size:JSON.stringify(a).length}),a):(this.logger.logCache("miss",e,{reason:"not_found"}),null)}setCache(e,t,a=60){this.cache.set(e,t),this.cacheExpiry.set(e,Date.now()+60*a*1e3),this.logger.logCache("set",e,{ttlMinutes:a,size:JSON.stringify(t).length,expiresAt:new Date(Date.now()+60*a*1e3).toISOString()})}generateMockData(e,t){const a=100+200*Math.random(),s=1e9+1e10*Math.random(),r={AAPL:"Apple Inc.",MSFT:"Microsoft Corporation",GOOGL:"Alphabet Inc.",AMZN:"Amazon.com Inc.",META:"Meta Platforms Inc.",TSLA:"Tesla Inc.",NVDA:"NVIDIA Corporation"};switch(t){case"profile":return{symbol:e,companyName:r[e]||`${e} Corporation`,mktCap:s,pe:15+20*Math.random(),pb:1+4*Math.random(),beta:.8+.8*Math.random(),sector:"Technology",industry:"Software",sharesOutstanding:s/a,enterpriseValueOverEBITDA:10+15*Math.random(),debtToEquity:2*Math.random(),revenueTTM:.8*s,grossProfitMargin:.3+.4*Math.random(),netProfitMargin:.1+.2*Math.random(),returnOnEquityTTM:.1+.2*Math.random(),returnOnAssetsTTM:.05+.15*Math.random(),effectiveTaxRateTTM:.21,fullTimeEmployees:1e3+5e4*Math.random(),ipoDate:"2010-01-01",range:`$${(.8*a).toFixed(2)} - $${(1.3*a).toFixed(2)}`};case"marketData":return{symbol:e,currentPrice:a,previousClose:a*(.98+.04*Math.random()),marketCap:s,volume:1e6+5e6*Math.random(),currency:"USD"};case"incomeStatement":case"income":const t=.8*s;return[{revenue:t,ebitda:.25*t,netIncome:.15*t,capex:.05*t,interestExpense:.02*t,grossProfitMargin:.6}];case"balanceSheet":return[{totalDebt:.3*s,cashAndCashEquivalents:.1*s,totalCurrentAssets:.4*s,totalCurrentLiabilities:.2*s}];case"cashFlow":return[{freeCashFlow:.12*s}];default:return null}}async fetchCompanyProfile(t){const a=this.getCacheKey("profile",{ticker:t}),s=this.getFromCache(a);if(s)return s;if(this.demoMode){const e=this.generateMockData(t,"profile");return this.setCache(a,e,1440),e}return this.circuitBreakers.FMP.execute(async()=>this.retryManager.executeWithRetry(async()=>{await this.checkRateLimit("FMP");const s=this.logger.logApiRequest("FMP",`/profile/${t}`,{ticker:t});try{const r=await e.get(`${c}/profile/${t}`,{params:{apikey:l},timeout:1e4});if(!r.data||!Array.isArray(r.data)||0===r.data.length)throw new Error(`Company profile not found for ticker: ${t}`);const i=r.data[0];if(!i||"object"!=typeof i)throw new Error(`Company profile not found for ticker: ${t}`);return this.logger.logApiResponse(s,!0,{profileFound:!0,ticker:i.symbol}),this.setCache(a,i,1440),i}catch(r){throw this.logger.logApiResponse(s,!1,null,r),r}},`Company profile fetch for ${t}`)).catch(e=>{if(e.circuitBreakerOpen)throw e;if(403===e.response?.status||401===e.response?.status){const e=this.generateMockData(t,"profile");return this.setCache(a,e,1440),e}throw new Error(`Failed to fetch company profile: ${e.message}`)})}async fetchFinancialStatements(t,a="income-statement",s="annual",r=5){const i=this.getCacheKey("financials",{ticker:t,statement:a,period:s,limit:r}),n=this.getFromCache(i);if(n)return n;if(this.demoMode){const e=this.generateMockData(t,a.replace("-statement","").replace("-",""));return this.setCache(i,e,360),e}return this.retryManager.executeWithRetry(async()=>{await this.checkRateLimit("FMP");const n=await e.get(`${c}/${a}/${t}`,{params:{apikey:l,period:s,limit:r},timeout:15e3});if(!n.data||0===n.data.length)throw new Error(`No ${a} data found for ${t}`);return this.setCache(i,n.data,360),n.data},`Financial statements fetch for ${t} (${a})`).catch(e=>{if(403===e.response?.status||401===e.response?.status){const e=this.generateMockData(t,a.replace("-statement","").replace("-",""));return this.setCache(i,e,360),e}throw new Error(`Failed to fetch ${a}: ${e.message}`)})}async fetchMarketData(t,a="1y"){const s=this.getCacheKey("market",{ticker:t,range:a}),r=this.getFromCache(s);if(r)return r;if(this.demoMode){const e=this.generateMockData(t,"marketData");return this.setCache(s,e,15),e}try{return await this.retryManager.executeWithRetry(async()=>{const r=(await e.get(`${u}/${t}`,{params:{range:a,interval:"1d"},timeout:1e4})).data.chart.result[0];if(!r)throw new Error(`No market data found for ticker: ${t}`);const i={symbol:r.meta.symbol,currentPrice:r.meta.regularMarketPrice,previousClose:r.meta.previousClose,marketCap:r.meta.marketCap,volume:r.meta.regularMarketVolume,timestamps:r.timestamp,prices:r.indicators.quote[0],currency:r.meta.currency};return this.setCache(s,i,15),i},`Market data fetch for ${t}`)}catch(i){return this.fetchMarketDataAlternative(t)}}async fetchMarketDataAlternative(t){if(this.demoMode)return this.generateMockData(t,"marketData");try{return await this.retryManager.executeWithRetry(async()=>{await this.checkRateLimit("ALPHA_VANTAGE");const a=(await e.get(n,{params:{function:"GLOBAL_QUOTE",symbol:t,apikey:o},timeout:1e4})).data["Global Quote"];if(!a||0===Object.keys(a).length)throw new Error(`No market data found for ticker: ${t}`);return{symbol:a["01. symbol"],currentPrice:parseFloat(a["05. price"]),previousClose:parseFloat(a["08. previous close"]),volume:parseInt(a["06. volume"]),change:parseFloat(a["09. change"]),changePercent:a["10. change percent"]}},`Alternative market data fetch for ${t}`)}catch(a){return this.generateMockData(t,"marketData")}}async fetchSECFilings(e,t="10-K",a=5){const s=this.getCacheKey("sec",{ticker:e,filingType:t,count:a}),r=this.getFromCache(s);if(r)return r;try{return this.demoMode||await this.checkRateLimit("SEC_EDGAR"),[{form:t,filingDate:"2023-12-31",accessionNumber:"0000000000-00-000000",reportDate:"2023-12-31",acceptanceDateTime:"2024-01-15T16:30:00",act:"34",primaryDocument:`${e.toLowerCase()}-${t.toLowerCase()}.htm`,url:"#demo-filing"}]}catch(i){throw new Error(`Failed to fetch SEC filings: ${i.message}`)}}async fetchPeerComparables(e,t=null){const a=this.getCacheKey("peers",{ticker:e,industryCode:t}),s=this.getFromCache(a);if(s)return s;try{if(this.demoMode){const t=["AAPL","MSFT","GOOGL","AMZN","META"].filter(t=>t!==e).slice(0,5).map(e=>{const t=100+200*Math.random();return{symbol:e,name:`${e} Corporation`,marketCap:1e9+2e9*Math.random(),currentPrice:t,sector:"Technology",industry:"Software",peRatio:15+20*Math.random(),evToEbitda:10+15*Math.random(),priceToBook:1+4*Math.random(),debtToEquity:2*Math.random()}});return this.setCache(a,t,240),t}await this.checkRateLimit("FMP"),await this.fetchCompanyProfile(e);const t=["AAPL","MSFT","GOOGL","AMZN","META"].filter(t=>t!==e),s=(await Promise.allSettled(t.slice(0,5).map(async e=>{const t=await this.fetchCompanyProfile(e),a=await this.fetchMarketData(e);return{symbol:e,name:t.companyName,marketCap:t.mktCap,currentPrice:a.currentPrice,sector:t.sector,industry:t.industry,peRatio:t.pe,evToEbitda:t.enterpriseValueOverEBITDA,priceToBook:t.pb,debtToEquity:t.debtToEquity}}))).filter(e=>"fulfilled"===e.status).map(e=>e.value);return this.setCache(a,s,240),s}catch(r){throw new Error(`Failed to fetch peer comparables: ${r.message}`)}}async fetchDCFInputs(e){try{const[t,a,s,r,i]=await Promise.all([this.fetchCompanyProfile(e),this.fetchFinancialStatements(e,"income-statement","annual",5),this.fetchFinancialStatements(e,"balance-sheet-statement","annual",5),this.fetchFinancialStatements(e,"cash-flow-statement","annual",5),this.fetchMarketData(e)]),n=Array.isArray(a)?a.map(e=>e.revenue).reverse():[a.revenue],o=[];for(let e=1;e<n.length;e++)n[e-1]&&n[e]&&o.push((n[e]-n[e-1])/n[e-1]);const c=o.length>0?o.reduce((e,t)=>e+t,0)/o.length:.05,l=Array.isArray(r)?r[0]:r,u=Array.isArray(a)?a[0]:a,h=l.freeCashFlow/u.revenue,m=.045,d=.065,p=t.beta||1,g=m+p*d,y=Array.isArray(s)?s[0]:s,E=y.totalDebt||0,f=i.marketCap||i.currentPrice*t.sharesOutstanding,_=E/(E+f),A=g*(1-_)+.04*_*(1-(t.effectiveTaxRateTTM||.21));return{symbol:e,companyName:t.companyName,currentRevenue:u.revenue,revenueGrowthRate:c,fcfMargin:h,wacc:A,terminalGrowthRate:.025,currentPrice:i.currentPrice,sharesOutstanding:t.sharesOutstanding,marketCap:f,totalDebt:E,cash:y.cashAndCashEquivalents||0,beta:p,peRatio:t.pe,historicalData:{revenues:n,revenueGrowthRates:o,freeCashFlows:Array.isArray(r)?r.map(e=>e.freeCashFlow).reverse():[l.freeCashFlow],margins:Array.isArray(a)?a.map(e=>e.grossProfitMargin).reverse():[u.grossProfitMargin]}}}catch(t){throw new Error(`Failed to fetch DCF inputs for ${e}: ${t.message}`)}}async fetchLBOInputs(e){try{const[t,a,s,r,i]=await Promise.all([this.fetchCompanyProfile(e),this.fetchFinancialStatements(e,"income-statement","annual",3),this.fetchFinancialStatements(e,"balance-sheet-statement","annual",3),this.fetchMarketData(e),this.fetchPeerComparables(e)]),n=Array.isArray(a)?a[0]:a,o=Array.isArray(s)?s[0]:s,c=n.ebitda,l=r.marketCap+o.totalDebt-o.cashAndCashEquivalents,u=l/c,h=i.filter(e=>e.evToEbitda&&e.evToEbitda>0).map(e=>e.evToEbitda),m=h.length>0?h.reduce((e,t)=>e+t,0)/h.length:u;return{symbol:e,companyName:t.companyName,currentPrice:r.currentPrice,marketCap:r.marketCap,enterpriseValue:l,ebitda:c,evEbitdaMultiple:u,revenue:n.revenue,netIncome:n.netIncome,totalDebt:o.totalDebt,cash:o.cashAndCashEquivalents,workingCapital:o.totalCurrentAssets-o.totalCurrentLiabilities,capex:Math.abs(n.capex||0),debtToEbitda:o.totalDebt/c,interestCoverage:c/(n.interestExpense||1),avgPeerMultiple:m,suggestedPurchasePrice:c*m,maxDebtCapacity:6*c,sharesOutstanding:t.sharesOutstanding}}catch(t){throw new Error(`Failed to fetch LBO inputs for ${e}: ${t.message}`)}}async validateTicker(e){try{return this.demoMode?["AAPL","MSFT","GOOGL","AMZN","META","TSLA","NVDA"].includes(e):(await this.fetchCompanyProfile(e),!0)}catch(t){return!1}}async getApiStatus(){const e=await r.validateAllKeys(),t=this.logger.getMetrics();return{demoMode:this.demoMode,cacheSize:this.cache.size,validation:e,circuitBreakers:this.getCircuitBreakerStatus(),metrics:t,performance:{uptime:t.uptime,totalRequests:Object.values(t.services).reduce((e,t)=>e+(t.requests?.total||0),0),totalErrors:Object.values(t.services).reduce((e,t)=>e+(t.error?.total||0),0),averageResponseTime:this.calculateAverageResponseTime(t.services),cacheHitRate:this.calculateCacheHitRate(t.cache)},availableKeys:{alphaVantage:!0,fmp:!0,quandl:!1,fred:!1},recommendations:e.recommendations}}getCircuitBreakerStatus(){const e={};return Object.keys(this.circuitBreakers).forEach(t=>{e[t]=this.circuitBreakers[t].getStatus()}),e}calculateAverageResponseTime(e){let t=0,a=0;return Object.values(e).forEach(e=>{e.duration&&(t+=e.duration.total,a+=e.duration.count)}),a>0?Math.round(t/a):0}calculateCacheHitRate(e){const t=e.hit?.total||0,a=t+(e.miss?.total||0);return a>0?Math.round(t/a*100):0}getRecentLogs(e=50,t=null){return this.logger.getRecentLogs(e,t)}clearMetrics(){this.logger.clear()}async validateApiKeys(){return await r.validateAllKeys()}async buildAdvancedDCFModel(e,s={},r={}){try{const[i,n,o]=await Promise.all([this.fetchCompanyProfile(e),this.fetchFinancialStatements(e,"income-statement"),this.fetchMarketData(e)]),c={symbol:e,companyName:i.companyName||e,currentRevenue:n.revenue||0,currentPrice:o.price||0,sharesOutstanding:i.sharesOutstanding||0,totalDebt:i.totalDebt||0,cash:i.cash||0,historicalGrowthRates:this.calculateHistoricalGrowthRates(n),margins:{ebitdaMargin:(n.ebitda||0)/(n.revenue||1)},balanceSheetData:n,marketData:o,assumptions:{...s,wacc:s.wacc||this.calculateWACC(i,o),revenueGrowthRate:s.revenueGrowthRate||this.estimateGrowthRate(n)}},l=a.buildDCFModel(c,r);return t.log("INFO",`Advanced DCF model built for ${e}`,{baseCase:l.baseCase.pricePerShare,scenarios:Object.keys(l.scenarios).length}),l}catch(i){throw t.log("ERROR",`Failed to build DCF model for ${e}`,{error:i.message}),new Error(`DCF modeling failed: ${i.message}`)}}async buildAdvancedLBOModel(e,a,r={},i={}){try{const[n,o,c,l]=await Promise.all([this.fetchCompanyProfile(e),this.fetchFinancialStatements(e,"income-statement"),this.fetchMarketData(e),this.fetchPeerComparison(e)]),u={symbol:e,companyName:n.companyName||e,purchasePrice:a.purchasePrice||c.marketCap,ebitda:o.ebitda||0,revenue:o.revenue||0,marketData:c,peerData:l,assumptions:{...r,exit:{...r.exit,exitMultiple:r.exit?.exitMultiple||this.calculatePeerAverageMultiple(l)}}},h=s.buildLBOModel(u,i);return t.log("INFO",`Advanced LBO model built for ${e}`,{baseCase:h.baseCase.returnsAnalysis.irr,scenarios:Object.keys(h.scenarios).length}),h}catch(n){throw t.log("ERROR",`Failed to build LBO model for ${e}`,{error:n.message}),new Error(`LBO modeling failed: ${n.message}`)}}calculateHistoricalGrowthRates(e){return[.15,.12,.1,.08,.06]}estimateGrowthRate(e){return.1}calculatePeerAverageMultiple(e){if(!e||!e.peers)return 10;const t=e.peers.map(e=>e.evToEbitda).filter(e=>e&&e>0);return 0===t.length?10:t.reduce((e,t)=>e+t,0)/t.length}};export{_ as d};
//# sourceMappingURL=dataFetching-BJDQA9FG.js.map
