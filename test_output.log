🚀 Initializing Core Functionality Test Suite...

📊 Production Monitor initialized
📊 Production Monitor initialized
🚀 Enhanced CLI System initializing...
📋 Command Registry initializing...
[31;1mFailed to load persisted registry: localStorage is not defined[0m
✅ Command Registry initialized
🔌 Plugin Manager initializing...
[31;1mFailed to load plugin registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: DCF
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: LBO
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: COMPS
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: EPV
📦 Registered plugin: calculators (Financial Calculators)
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: QUOTE
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: CHART
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: NEWS
📦 Registered plugin: market-data (Market Data Provider)
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: PORTFOLIO
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: ANALYZE
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: OPTIMIZE
📦 Registered plugin: portfolio (Portfolio Management)
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: EXPORT
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: REPORT
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: VISUALIZE
📦 Registered plugin: reporting (Advanced Reporting)
📝 Registered command: SCHEDULE
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: WORKFLOW
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: BATCH
📦 Registered plugin: automation (Workflow Automation)
✅ Plugin Manager initialized
🔒 Security Manager initializing...
🔒 Security settings persistence not available in current environment
✅ Security Manager initialized
🧠 Context Manager initializing...
🧠 Context persistence not available in current environment
✅ Context Manager initialized
📚 Help System initializing...
🎯 Initializing Interactive Tutorials...
✅ Interactive Tutorials initialized
🎯 Initializing Contextual Help...
✅ Contextual Help initialized
✅ Help System initialized
🎯 Auto-Completion System initializing...
✅ Auto-Completion System initialized
🎯 Interactive Command System initializing...
✅ Interactive Command System initialized
🔗 Command Pipeline System initializing...
[31;1mFailed to load saved pipelines: localStorage is not defined[0m
✅ Command Pipeline System initialized
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: HELP
📝 Registered command: CLEAR
📝 Registered command: HISTORY
📝 Registered command: DCF
📝 Registered command: COMPS
📝 Registered command: LBO
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'DCF' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: QUOTE
[31;1mCommand 'COMPS' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'LBO' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'QUOTE' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'CHART' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
📝 Registered command: CHART
📝 Registered command: NEWS
📝 Registered command: PORTFOLIO
📝 Registered command: ANALYZE
📝 Registered command: REPORT
📝 Registered command: EXPORT
📝 Registered command: VISUALIZE
📝 Registered command: INTERACTIVE
📝 Registered command: COMPLETE
📝 Registered command: PIPELINE
📝 Registered command: BATCH
📝 Registered command: JOBS
📝 Registered command: TUTORIAL
📝 Registered command: TIPS
📝 Registered command: LEARN
🔄 Loading core plugins...
[31;1mCommand 'NEWS' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'PORTFOLIO' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'ANALYZE' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'REPORT' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'EXPORT' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'VISUALIZE' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mCommand 'BATCH' already registered, overwriting[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to persist registry: localStorage is not defined[0m
[31;1mFailed to restore CLI state: localStorage is not defined[0m
🔌 Loaded plugin: calculators v1.0.0
🔌 Loaded plugin: market-data v1.0.0
🔌 Loaded plugin: portfolio v1.0.0
🔌 Loaded plugin: reporting v1.0.0
🔌 Loaded plugin: automation v1.0.0
✅ Loaded 5 core plugins
🚀 Starting production monitoring...
📈 Metrics collection started
[INFO] Health check: healthy {
  memory: { status: 'healthy', value: '0.00%' },
  errorRate: { status: 'healthy', value: '0.00%' },
  responseTime: { status: 'healthy', value: '0.00ms' }
}
🏥 Health checks started
✅ Production monitoring started
✅ Enhanced CLI System initialized successfully
✅ System initialized successfully

🎯 STARTING COMPREHENSIVE CORE FUNCTIONALITY TESTING

============================================================

📝 Testing Basic CLI Commands...

[INFO] Command executed {
  command: 'HELP',
  success: true,
  responseTime: 4.097124999999998,
  userId: undefined,
  sessionId: undefined
}
✅ help: PASSED
[INFO] Command executed {
  command: 'CLEAR',
  success: true,
  responseTime: 0.7792499999999976,
  userId: undefined,
  sessionId: undefined
}
✅ clear: PASSED
[INFO] Command executed {
  command: 'HISTORY',
  success: true,
  responseTime: 0.09662500000000307,
  userId: undefined,
  sessionId: undefined
}
✅ history: PASSED
[INFO] Command executed {
  command: 'TUTORIAL',
  success: true,
  responseTime: 0.19274999999999665,
  userId: undefined,
  sessionId: undefined
}
✅ tutorial: PASSED

💰 Testing Financial Calculations...

[INFO] Command executed {
  command: 'DCF',
  success: true,
  responseTime: 0.21279100000000284,
  userId: undefined,
  sessionId: undefined
}
✅ DCF Analysis - Apple: PASSED
[INFO] Command executed {
  command: 'COMPS',
  success: true,
  responseTime: 0.1755420000000001,
  userId: undefined,
  sessionId: undefined
}
✅ Comps Analysis - Tech Sector: PASSED
[INFO] Command executed {
  command: 'LBO',
  success: true,
  responseTime: 0.13937499999999403,
  userId: undefined,
  sessionId: undefined
}
✅ LBO Analysis - Tesla: PASSED

📊 Testing Market Data Functionality...

[INFO] Command executed {
  command: 'QUOTE',
  success: true,
  responseTime: 0.16645799999999866,
  userId: undefined,
  sessionId: undefined
}
✅ Quote - Apple: PASSED
[INFO] Command executed {
  command: 'QUOTE',
  success: true,
  responseTime: 0.04954199999999531,
  userId: undefined,
  sessionId: undefined
}
✅ Quote - Microsoft: PASSED
[INFO] Command executed {
  command: 'CHART',
  success: true,
  responseTime: 1.4627079999999992,
  userId: undefined,
  sessionId: undefined
}
✅ Chart Data - Apple: PASSED
[INFO] Command executed {
  command: 'NEWS',
  success: true,
  responseTime: 0.134999999999998,
  userId: undefined,
  sessionId: undefined
}
✅ Market News: PASSED

📁 Testing Portfolio Management...

[INFO] Command executed {
  command: 'PORTFOLIO',
  success: true,
  responseTime: 0.12383400000000222,
  userId: undefined,
  sessionId: undefined
}
✅ Portfolio Create: PASSED
[INFO] Command executed {
  command: 'PORTFOLIO',
  success: true,
  responseTime: 0.09799999999999898,
  userId: undefined,
  sessionId: undefined
}
✅ Add Holdings: PASSED
[INFO] Command executed {
  command: 'PORTFOLIO',
  success: true,
  responseTime: 0.043124999999996305,
  userId: undefined,
  sessionId: undefined
}
✅ Portfolio List: PASSED
[INFO] Command executed {
  command: 'PORTFOLIO',
  success: true,
  responseTime: 0.031083000000002414,
  userId: undefined,
  sessionId: undefined
}
✅ Portfolio Analysis: PASSED
[INFO] Command executed {
  command: 'PORTFOLIO',
  success: true,
  responseTime: 0.09270799999999468,
  userId: undefined,
  sessionId: undefined
}
✅ Portfolio Export: PASSED

📋 Testing Reporting Functionality...

[INFO] Command executed {
  command: 'REPORT',
  success: true,
  responseTime: 0.2731670000000008,
  userId: undefined,
  sessionId: undefined
}
✅ Generate Report: PASSED
[INFO] Command executed {
  command: 'EXPORT',
  success: true,
  responseTime: 0.1074169999999981,
  userId: undefined,
  sessionId: undefined
}
✅ Export Data - Excel: PASSED
[INFO] Command executed {
  command: 'EXPORT',
  success: true,
  responseTime: 0.09675000000000011,
  userId: undefined,
  sessionId: undefined
}
✅ Export Data - CSV: PASSED
[INFO] Command executed {
  command: 'VISUALIZE',
  success: true,
  responseTime: 0.08500000000000085,
  userId: undefined,
  sessionId: undefined
}
✅ Visualize Data: PASSED

🤖 Testing Automation Features...

🔍 Testing Create Pipeline with role: analyst
[31;1m[WARN] Security event: permission_denied {[0m
[31;1m  userId: 'test-user-analyst',[0m
[31;1m  command: 'PIPELINE',[0m
[31;1m  required: 'utility:write',[0m
[31;1m  userRole: undefined[0m
[31;1m}[0m
❌ Create Pipeline: FAILED
🔍 Testing Batch Commands with role: analyst
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: 'test-user-analyst', command: '"quote' }[0m
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: 'test-user-analyst', command: 'AAPL"' }[0m
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: 'test-user-analyst', command: '"quote' }[0m
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: 'test-user-analyst', command: 'MSFT"' }[0m
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: 'test-user-analyst', command: '"quote' }[0m
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: 'test-user-analyst', command: 'TSLA"' }[0m
[INFO] Command executed {
  command: 'BATCH',
  success: true,
  responseTime: 1.158417,
  userId: 'test-user-analyst',
  sessionId: 'test-session-1756770002701'
}
✅ Batch Commands: PASSED
🔍 Testing Workflow Execution with role: analyst
[INFO] Command executed {
  command: 'WORKFLOW',
  success: true,
  responseTime: 0.0925410000000042,
  userId: 'test-user-analyst',
  sessionId: 'test-session-1756770002702'
}
✅ Workflow Execution: PASSED
🔍 Testing Job Scheduling with role: analyst
[INFO] Command executed {
  command: 'JOBS',
  success: true,
  responseTime: 0.09266600000000125,
  userId: 'test-user-analyst',
  sessionId: 'test-session-1756770002702'
}
✅ Job Scheduling: PASSED

🔒 Testing Security Features...

[31;1m[WARN] Security event: permission_denied {[0m
[31;1m  userId: undefined,[0m
[31;1m  command: 'DCF',[0m
[31;1m  required: 'financial:analyze',[0m
[31;1m  userRole: 'viewer'[0m
[31;1m}[0m
✅ Permission Enforcement - Viewer: PASSED
[INFO] Command executed {
  command: 'DCF',
  success: true,
  responseTime: 0.07800000000000296,
  userId: undefined,
  sessionId: undefined
}
✅ Permission Enforcement - Analyst: PASSED
[31;1m🔒 Security Event: blocked_request {[0m
[31;1m  reason: 'Cross-site scripting detected',[0m
[31;1m  command: 'help <script>alert("xss")</script>',[0m
[31;1m  userId: undefined[0m
[31;1m}[0m
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: undefined, command: 'help' }[0m
✅ Input Sanitization - XSS: PASSED
[31;1m🔒 Security Event: blocked_request {[0m
[31;1m  reason: 'Suspicious pattern detected: \\b(rm|del|delete|drop|truncate)\\b',[0m
[31;1m  command: "quote AAPL'; DROP TABLE users; --",[0m
[31;1m  patterns: [ '\\b(rm|del|delete|drop|truncate)\\b' ],[0m
[31;1m  userId: undefined[0m
[31;1m}[0m
[31;1m[WARN] Security event: blocked_request { reason: undefined, userId: undefined, command: 'quote' }[0m
✅ Input Sanitization - SQL Injection: PASSED

🔌 Testing Plugin System...

✅ Plugin Discovery: PASSED
[INFO] Command executed {
  command: 'DCF',
  success: true,
  responseTime: 0.06504199999999827,
  userId: undefined,
  sessionId: undefined
}
✅ Calculator Plugin: PASSED
[INFO] Command executed {
  command: 'QUOTE',
  success: true,
  responseTime: 0.030833999999998696,
  userId: undefined,
  sessionId: undefined
}
✅ Market Data Plugin: PASSED
✅ Plugin Method Validation: PASSED

🎯 CORE FUNCTIONALITY TEST RESULTS
============================================================

🎯 OVERALL RESULTS:
   Total Tests: 32
   ✅ Passed: 31
   ❌ Failed: 1
   📈 Success Rate: 96.88%
   ⏱️  Duration: 0.04s

📋 CATEGORY BREAKDOWN:
   Basic Commands: 4/4 (100.0%)
   Financial Calculations: 3/3 (100.0%)
   Market Data: 4/4 (100.0%)
   Portfolio Management: 5/5 (100.0%)
   Reporting: 4/4 (100.0%)
   Automation: 3/4 (75.0%)
   Security: 4/4 (100.0%)
   Plugins: 4/4 (100.0%)

🏆 FUNCTIONALITY READINESS VERDICT:
   🎉 ALL CORE FEATURES OPERATIONAL
   ✅ Critical functionality validated
   ✅ Enterprise features working
   ✅ Security systems active
   ✅ Plugin architecture functional

============================================================
🏁 CORE FUNCTIONALITY TESTING COMPLETE
============================================================

📋 DETAILED TEST RESULTS:

🔹 Basic Commands:
   ✅ help: help executed successfully
   ✅ clear: clear executed successfully
   ✅ history: history executed successfully
   ✅ tutorial: tutorial executed successfully

🔹 Financial Calculations:
   ✅ DCF Analysis - Apple: DCF Analysis - Apple calculation completed
   ✅ Comps Analysis - Tech Sector: Comps Analysis - Tech Sector calculation completed
   ✅ LBO Analysis - Tesla: LBO Analysis - Tesla calculation completed

🔹 Market Data:
   ✅ Quote - Apple: Quote - Apple data retrieved
   ✅ Quote - Microsoft: Quote - Microsoft data retrieved
   ✅ Chart Data - Apple: Chart Data - Apple data retrieved
   ✅ Market News: Market News data retrieved

🔹 Portfolio Management:
   ✅ Portfolio Create: Portfolio Create operation completed
   ✅ Add Holdings: Add Holdings operation completed
   ✅ Portfolio List: Portfolio List operation completed
   ✅ Portfolio Analysis: Portfolio Analysis operation completed
   ✅ Portfolio Export: Portfolio Export operation completed

🔹 Reporting:
   ✅ Generate Report: Generate Report completed
   ✅ Export Data - Excel: Export Data - Excel completed
   ✅ Export Data - CSV: Export Data - CSV completed
   ✅ Visualize Data: Visualize Data completed

🔹 Automation:
   ❌ Create Pipeline: Failed Create Pipeline
   ✅ Batch Commands: Batch Commands completed
   ✅ Workflow Execution: Workflow Execution completed
   ✅ Job Scheduling: Job Scheduling completed

🔹 Security:
   ✅ Permission Enforcement - Viewer: Permission Enforcement - Viewer behaved correctly
   ✅ Permission Enforcement - Analyst: Permission Enforcement - Analyst behaved correctly
   ✅ Input Sanitization - XSS: Input Sanitization - XSS behaved correctly
   ✅ Input Sanitization - SQL Injection: Input Sanitization - SQL Injection behaved correctly

🔹 Plugins:
   ✅ Plugin Discovery: Plugin Discovery passed
   ✅ Calculator Plugin: Calculator Plugin executed successfully
   ✅ Market Data Plugin: Market Data Plugin executed successfully
   ✅ Plugin Method Validation: Plugin Method Validation passed

[INFO] Metrics collected {
  commandsTotal: 26,
  successRate: '100.00%',
  avgResponseTime: '0.38ms',
  errorRate: '0.00%',
  activeUsers: 1
}
[INFO] Health check: healthy {
  memory: { status: 'healthy', value: '0.00%' },
  errorRate: { status: 'healthy', value: '0.00%' },
  responseTime: { status: 'healthy', value: '0.38ms' }
}
[INFO] Metrics collected {
  commandsTotal: 26,
  successRate: '100.00%',
  avgResponseTime: '0.38ms',
  errorRate: '0.00%',
  activeUsers: 1
}
[INFO] Metrics collected {
  commandsTotal: 26,
  successRate: '100.00%',
  avgResponseTime: '0.38ms',
  errorRate: '0.00%',
  activeUsers: 1
}
