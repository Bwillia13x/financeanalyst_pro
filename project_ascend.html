<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Ascend - M&A Analysis Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .progress-bar {
            transition: width 0.3s ease-in-out;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="gradient-bg text-white py-6 px-6">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold">Project Ascend</h1>
                    <p class="text-blue-100 mt-1">AI-Powered M&A Deal Analysis Platform</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-blue-100">Cosmetic Physician Partners</p>
                    <p class="text-xs text-blue-200">Corporate Development Team</p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <!-- Upload Section -->
        <div class="bg-white rounded-lg card-shadow p-6 mb-8">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4">
                    <svg class="w-8 h-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z" />
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900 mb-2">Deal Book Analysis</h2>
                <p class="text-gray-600 mb-6">Upload and analyze deal books using our AI-powered multi-agent system</p>
                
                <button id="analyzeBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg transition duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 inline-flex items-center">
                    <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 3.5a1.5 1.5 0 013 0V4a1 1 0 001 1h1a1 1 0 011 1v3.5a1.5 1.5 0 01-3 0V9a1 1 0 00-1-1h-1a1 1 0 01-1-1V3.5zM3 5.5a1.5 1.5 0 013 0V6a1 1 0 001 1h1a1 1 0 011 1v3.5a1.5 1.5 0 01-3 0V10a1 1 0 00-1-1H6a1 1 0 01-1-1V5.5z" />
                        <path d="M11 12.5a1.5 1.5 0 013 0V13a1 1 0 001 1h1a1 1 0 011 1v3.5a1.5 1.5 0 01-3 0V17a1 1 0 00-1-1h-1a1 1 0 01-1-1v-3.5z" />
                    </svg>
                    Analyze Mock Deal Book
                </button>
                
                <!-- Progress Indicator -->
                <div id="progressSection" class="hidden mt-6">
                    <div class="bg-gray-200 rounded-full h-2 mb-4">
                        <div id="progressBar" class="bg-blue-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
                    </div>
                    <div id="progressText" class="text-sm text-gray-600 loading-dots">Initializing analysis</div>
                </div>
            </div>
        </div>

        <!-- Deal Scorecard Section -->
        <div id="scorecardSection" class="hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Deal Scorecard</h2>
                <p class="text-gray-600">Comprehensive analysis results from our AI agent system</p>
            </div>

            <!-- Top-Level Verdict -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex items-center">
                        <div id="accretionIcon" class="h-10 w-10 rounded-full flex items-center justify-center flex-shrink-0"></div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Deal Impact</p>
                            <p id="accretionAnalysis" class="text-lg font-semibold"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex items-center">
                        <div class="h-10 w-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                             <svg class="w-6 h-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" />
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Growth Potential</p>
                            <p id="growthScore" class="text-lg font-semibold text-gray-900"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex items-center">
                        <div class="h-10 w-10 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12a7.5 7.5 0 0015 0m-15 0a7.5 7.5 0 1115 0m-15 0H3m16.5 0H21m-1.5 0H12m-8.457 3.077l1.41-.513m14.095-5.13l-1.41-.513M5.106 17.785l1.153-.96m13.09-11.52l-1.152-.96M12 6.75l-.513 1.41m0 0l-1.41.513m1.923-1.923l.513-1.41m-1.923 1.923l1.41-.513m-1.41.513l.513 1.41m1.41-.513l1.923 1.923" />
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Integration Ease</p>
                            <p id="integrationScore" class="text-lg font-semibold text-gray-900"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deal Overview and Valuation -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6M9 11.25h6m-6 4.5h6M6.75 21v-2.25a2.25 2.25 0 012.25-2.25h6a2.25 2.25 0 012.25 2.25V21" /></svg>
                        Deal Overview
                    </h3>
                    <div class="space-y-4 text-sm">
                        <div class="flex justify-between"><span class="text-gray-600">Target:</span><span id="targetName" class="font-medium text-gray-900"></span></div>
                        <div class="flex justify-between"><span class="text-gray-600">Location:</span><span id="location" class="font-medium text-gray-900"></span></div>
                        <div class="flex justify-between"><span class="text-gray-600">Online Rating:</span><span id="rating" class="font-medium text-gray-900"></span></div>
                        <div class="flex justify-between"><span class="text-gray-600">EMR System:</span><span id="emrSystem" class="font-medium text-gray-900"></span></div>
                        <div class="flex justify-between"><span class="text-gray-600">Sale Reason:</span><span id="saleReason" class="font-medium text-gray-900"></span></div>
                    </div>
                </div>

                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008zm0 3h.008v.008H8.25v-.008zm0 3h.008v.008H8.25v-.008zm3-6h.008v.008H11.25v-.008zm0 3h.008v.008H11.25v-.008zm0 3h.008v.008H11.25v-.008zM12 21a8.967 8.967 0 005.27-1.743l-1.027-1.027a6 6 0 01-8.486 0l-1.027 1.027A8.967 8.967 0 0012 21zm3.75-9.75a.75.75 0 000-1.5h-7.5a.75.75 0 000 1.5h7.5z" /></svg>
                        Valuation Summary
                    </h3>
                    <div class="space-y-4 text-sm">
                        <div class="flex justify-between"><span class="text-gray-600">LTM Revenue:</span><span id="ltmRevenue" class="font-medium text-gray-900"></span></div>
                        <div class="flex justify-between"><span class="text-gray-600">Reported EBITDA:</span><span id="reportedEbitda" class="font-medium text-gray-900"></span></div>
                        <div class="flex justify-between"><span class="text-gray-600">Normalized EBITDA:</span><span id="normalizedEbitda" class="font-medium text-green-600"></span></div>
                        <div class="border-t pt-4 mt-4"><div class="flex justify-between"><span class="text-gray-600">Valuation (5.0x):</span><span id="valuation" class="font-bold text-lg text-blue-600"></span></div></div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg card-shadow p-6 mb-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                     <svg class="w-6 h-6 mr-2 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" /></svg>
                    EBITDA Normalization Bridge
                </h3>
                <div class="chart-container">
                    <canvas id="ebitdaChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg card-shadow p-6 mb-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.008H12v-.008z" /></svg>
                    Strategic Analysis (SWOT)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 bg-green-50 rounded-lg"><h4 class="font-medium text-green-800 mb-2 flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>Strengths</h4><p id="strengths" class="text-green-700 text-sm"></p></div>
                    <div class="p-4 bg-red-50 rounded-lg"><h4 class="font-medium text-red-800 mb-2 flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>Weaknesses</h4><p id="weaknesses" class="text-red-700 text-sm"></p></div>
                    <div class="p-4 bg-blue-50 rounded-lg"><h4 class="font-medium text-blue-800 mb-2 flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 7.072l.707-.707a1 1 0 10-1.414-1.414l-.707.707a1 1 0 101.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 100 2h1z" /></svg>Opportunities</h4><p id="opportunities" class="text-blue-700 text-sm"></p></div>
                    <div class="p-4 bg-yellow-50 rounded-lg"><h4 class="font-medium text-yellow-800 mb-2 flex items-center"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 011-1h.008a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>Threats</h4><p id="threats" class="text-yellow-700 text-sm"></p></div>
                </div>
            </div>

            <div class="bg-white rounded-lg card-shadow p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-orange-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" /></svg>
                    Key Diligence Questions
                </h3>
                <div id="diligenceQuestions" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let ebitdaChartInstance = null;
            
            // Mock CIM Data
            const mockCimData = {
                targetName: "Calgary Wellness Medispa",
                sourceBroker: "Western Canada Business Brokers",
                financials: {
                    ltmRevenue: 4500000,
                    ltmReportedEbitda: 750000,
                },
                operations: {
                    location: "Aspen Woods, Calgary, AB",
                    services: ["Injectables", "Laser Hair Removal", "CoolSculpting"],
                    onlineRating: 4.8,
                    emrSystem: "JaneApp",
                },
                dealContext: {
                    reasonForSale: "Owner retiring",
                    keyPersonnel: ["Dr. Sarah Jenkins (Founder)", "Jessica Lang (Lead Injector)"],
                }
            };

            function intakeAnalyst() {
                return new Promise(resolve => setTimeout(() => resolve(mockCimData), 1000));
            }

            function valuationAnalyst(data) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        const ownerSalaryAdjustment = 200000;
                        const normalizedEbitda = data.financials.ltmReportedEbitda + ownerSalaryAdjustment;
                        const valuationAt5x = normalizedEbitda * 5.0;
                        const targetMargin = normalizedEbitda / data.financials.ltmRevenue;
                        const cppAverageMargin = 0.18;
                        const accretionAnalysis = targetMargin > cppAverageMargin ? "Accretive" : "Dilutive";
                        resolve({ normalizedEbitda, valuationAt5x, accretionAnalysis, ownerSalaryAdjustment });
                    }, 1500);
                });
            }

            function strategyAnalyst(data) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        let growthProspectScore = 5;
                        if (data.operations.onlineRating > 4.5) growthProspectScore += 2;
                        if (data.operations.location.includes("Aspen Woods")) growthProspectScore += 1;

                        let integrationComplexityScore = 10;
                        if (data.operations.emrSystem === "JaneApp") integrationComplexityScore -= 3;
                        if (data.dealContext.reasonForSale === "Owner retiring") integrationComplexityScore -= 2;

                        resolve({
                            growthProspectScore,
                            integrationComplexityScore,
                            swotAnalysis: {
                                strengths: "High online rating, located in affluent suburb.",
                                weaknesses: "High key-person risk on founder and lead injector.",
                                opportunities: "Implement CPP's marketing playbook to increase patient flow.",
                                threats: "Vulnerable to key staff departure post-acquisition."
                            },
                            keyDiligenceQuestions: [
                                "What are the employment terms for Jessica Lang (Lead Injector)?",
                                "Can you provide a breakdown of revenue by service line?",
                                "Is the JaneApp EMR contract transferable?"
                            ]
                        });
                    }, 2000);
                });
            }

            async function runAnalysis() {
                const analyzeBtn = document.getElementById('analyzeBtn');
                const progressSection = document.getElementById('progressSection');
                const progressBar = document.getElementById('progressBar');
                const progressText = document.getElementById('progressText');
                const scorecardSection = document.getElementById('scorecardSection');

                analyzeBtn.disabled = true;
                analyzeBtn.classList.add('opacity-50', 'cursor-not-allowed');
                progressSection.classList.remove('hidden');
                scorecardSection.classList.add('hidden');

                try {
                    progressText.textContent = 'Agent 1: Extracting data from deal book';
                    progressBar.style.width = '20%';
                    const extractedData = await intakeAnalyst();

                    progressText.textContent = 'Agent 2: Performing financial analysis';
                    progressBar.style.width = '50%';
                    const financialAnalysis = await valuationAnalyst(extractedData);

                    progressText.textContent = 'Agent 3: Conducting strategic evaluation';
                    progressBar.style.width = '80%';
                    const strategicAnalysis = await strategyAnalyst(extractedData);

                    progressText.textContent = 'Generating Deal Scorecard';
                    progressBar.style.width = '100%';
                    await new Promise(resolve => setTimeout(resolve, 500));

                    populateDashboard(extractedData, financialAnalysis, strategicAnalysis);

                    progressSection.classList.add('hidden');
                    scorecardSection.classList.remove('hidden');
                    scorecardSection.classList.add('fade-in');
                } catch (error) {
                    console.error('Analysis failed:', error);
                    progressText.textContent = 'Analysis failed. Please try again.';
                } finally {
                    analyzeBtn.disabled = false;
                    analyzeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            function populateDashboard(data, financial, strategic) {
                const accretionElement = document.getElementById('accretionAnalysis');
                const accretionIcon = document.getElementById('accretionIcon');
                accretionElement.textContent = financial.accretionAnalysis;
                
                if (financial.accretionAnalysis === 'Accretive') {
                    accretionElement.className = 'text-lg font-semibold text-green-600';
                    accretionIcon.className = 'h-10 w-10 bg-green-100 rounded-full flex items-center justify-center';
                    accretionIcon.innerHTML = `<svg class="w-6 h-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" /></svg>`;
                } else {
                    accretionElement.className = 'text-lg font-semibold text-red-600';
                    accretionIcon.className = 'h-10 w-10 bg-red-100 rounded-full flex items-center justify-center';
                    accretionIcon.innerHTML = `<svg class="w-6 h-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6L9 12.75l4.286-4.286a11.948 11.948 0 014.306 6.43l.776 2.898m0 0l3.182-5.511m-3.182 5.51l-5.511-3.181" /></svg>`;
                }

                document.getElementById('growthScore').textContent = `${strategic.growthProspectScore}/10`;
                document.getElementById('integrationScore').textContent = `${strategic.integrationComplexityScore}/10`;
                document.getElementById('targetName').textContent = data.targetName;
                document.getElementById('location').textContent = data.operations.location;
                document.getElementById('rating').textContent = `${data.operations.onlineRating}/5.0`;
                document.getElementById('emrSystem').textContent = data.operations.emrSystem;
                document.getElementById('saleReason').textContent = data.dealContext.reasonForSale;
                document.getElementById('ltmRevenue').textContent = formatCurrency(data.financials.ltmRevenue);
                document.getElementById('reportedEbitda').textContent = formatCurrency(data.financials.ltmReportedEbitda);
                document.getElementById('normalizedEbitda').textContent = formatCurrency(financial.normalizedEbitda);
                document.getElementById('valuation').textContent = formatCurrency(financial.valuationAt5x);
                document.getElementById('strengths').textContent = strategic.swotAnalysis.strengths;
                document.getElementById('weaknesses').textContent = strategic.swotAnalysis.weaknesses;
                document.getElementById('opportunities').textContent = strategic.swotAnalysis.opportunities;
                document.getElementById('threats').textContent = strategic.swotAnalysis.threats;

                const questionsContainer = document.getElementById('diligenceQuestions');
                questionsContainer.innerHTML = '';
                strategic.keyDiligenceQuestions.forEach((question, index) => {
                    questionsContainer.innerHTML += `<div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg"><span class="flex-shrink-0 w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center text-sm font-medium">${index + 1}</span><p class="text-gray-700 text-sm">${question}</p></div>`;
                });
                
                createEbitdaChart(data.financials.ltmReportedEbitda, financial.ownerSalaryAdjustment, financial.normalizedEbitda);
            }

            function createEbitdaChart(reported, adjustment, normalized) {
                const ctx = document.getElementById('ebitdaChart').getContext('2d');
                if (ebitdaChartInstance) {
                    ebitdaChartInstance.destroy();
                }
                
                ebitdaChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Reported EBITDA', 'Owner Salary Adj.', 'Normalized EBITDA'],
                        datasets: [{
                            label: 'EBITDA ($)',
                            data: [
                                [0, reported],
                                [reported, reported + adjustment],
                                [0, normalized]
                            ],
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.7)', // Red
                                'rgba(16, 185, 129, 0.7)', // Green
                                'rgba(59, 130, 246, 0.7)' // Blue
                            ],
                            borderColor: [
                                'rgb(239, 68, 68)',
                                'rgb(16, 185, 129)',
                                'rgb(59, 130, 246)'
                            ],
                            borderWidth: 1,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        if (context.dataIndex === 1) { // Adjustment
                                            return `Adjustment: ${formatCurrency(value[1] - value[0])}`;
                                        }
                                        return `${context.label}: ${formatCurrency(value[1])}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + (value / 1000).toFixed(0) + 'K';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount);
            }

            document.getElementById('analyzeBtn').addEventListener('click', runAnalysis);
        });
    </script>
</body>
</html>
